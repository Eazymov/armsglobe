"use strict";function RGBColor(e){this.ok=!1,"#"==e.charAt(0)&&(e=e.substr(1,6)),e=e.replace(/ /g,""),e=e.toLowerCase();var t={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"};for(var n in t)e==n&&(e=t[n]);for(var r=[{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(e){return[parseInt(e[1]),parseInt(e[2]),parseInt(e[3])]}},{re:/^(\w{2})(\w{2})(\w{2})$/,example:["#00ff00","336699"],process:function(e){return[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16)]}},{re:/^(\w{1})(\w{1})(\w{1})$/,example:["#fb0","f0f"],process:function(e){return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16)]}}],i=0;i<r.length;i++){var o=r[i].re,a=r[i].process,s=o.exec(e);s&&(channels=a(s),this.r=channels[0],this.g=channels[1],this.b=channels[2],this.ok=!0)}this.r=this.r<0||isNaN(this.r)?0:this.r>255?255:this.r,this.g=this.g<0||isNaN(this.g)?0:this.g>255?255:this.g,this.b=this.b<0||isNaN(this.b)?0:this.b>255?255:this.b,this.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"},this.toHex=function(){var e=this.r.toString(16),t=this.g.toString(16),n=this.b.toString(16);return 1==e.length&&(e="0"+e),1==t.length&&(t="0"+t),1==n.length&&(n="0"+n),"#"+e+t+n},this.getHelpXML=function(){for(var e=new Array,n=0;n<r.length;n++)for(var i=r[n].example,o=0;o<i.length;o++)e[e.length]=i[o];for(var a in t)e[e.length]=a;var s=document.createElement("ul");s.setAttribute("id","rgbcolor-examples");for(var n=0;n<e.length;n++)try{var l=document.createElement("li"),c=new RGBColor(e[n]),u=document.createElement("div");u.style.cssText="margin: 3px; border: 1px solid black; background:"+c.toHex()+"; color:"+c.toHex(),u.appendChild(document.createTextNode("test"));var h=document.createTextNode(" "+e[n]+" -> "+c.toRGB()+" -> "+c.toHex());l.appendChild(u),l.appendChild(h),s.appendChild(l)}catch(e){}return s}}function toTHREEColor(e){return new THREE.Color(parseInt(e.substr(1),16))}function toMonthName(e){return monthNames[e]}function componentToHex(e){var t=e.toString(16);return 1==t.length?"0"+t:t}function rgbToHex(e,t,n){return"#"+componentToHex(e)+componentToHex(t)+componentToHex(n)}function gup(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t="[\\?&]"+e+"=([^&#]*)",n=new RegExp(t),r=n.exec(window.location.href);return null==r?"":r[1]}function wrap(e,t,n){for(n-=t;e<t;)e+=n;return e%n}function getAbsOrigin(e){var t=e.matrixWorld,n=new THREE.Vector3;return n.x=t.n14,n.y=t.n24,n.z=t.n34,n}function screenXY(e){var t=new THREE.Projector,n=t.projectVector(e.clone(),camera),r=new Object,i=window.innerWidth;return i<1280&&(i=1280),r.x=Math.round(n.x*(i/2))+i/2,r.y=Math.round((0-n.y)*(window.innerHeight/2))+window.innerHeight/2,r}function buildHexColumnGeo(e,t){for(var n=[],r=0,i=2*Math.PI/6,o=0;o<7;o++){var a=Math.cos(r)*e,s=-Math.sin(r)*e;n.push(new THREE.Vector2(a,s)),r+=i}var l=new THREE.Shape(n),c={size:0,amount:t,steps:1,bevelEnabled:!1};return new THREE.ExtrudeGeometry(l,c)}function map(e,t,n,r,i){return r+(i-r)*(e-t)/(n-t)}function numberWithCommas(e){return e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}function roundNumber(e,t){return Math.round(e*Math.pow(10,t))/Math.pow(10,t)}function save(e,t,n){function r(r){var i=function(){r.root.getFile("data.tar",{create:!0},function(r){r.createWriter(function(i){var o=new window.WebKitBlobBuilder;e=s(e);var l=a(t,e.byteLength,n);o.append(l),o.append(e),i.write(o.getBlob("tar/archive")),window.open(r.toURL(),"_blank","width=400,height=10")},l("Error creating writer"))},l("Error getting file"))};r.root.getFile("data.tar",{create:!1},function(e){e.remove(i,l("Error deleting file"))},i)}function i(e,t,n,r){var i,o,a=0,s=Math.min(e.length,r);for(i=0;i<s;i++)o=e.charCodeAt(i),t[n]=o,a+=o,n+=1;return a}function o(e,t){if(t<e.length)throw new Error("Incompatible size");for(var n=t-e.length,r=0;r<n;r++)e="0"+e;return e}function a(e,t,n){var r=new ArrayBuffer(512),a=new Uint8Array(r),s=0;s+=i(e,a,0,99),s+=i(t.toString(8),a,124,12),s+=i(o("644 \0",8),a,100,8);var l=(new Date).getTime();return l=Math.floor(l/1e3),s+=i(l.toString(8),a,136,12),s+=i("0",a,156,1),s+=i("ustar ",a,257,6),s+=i("00",a,263,2),s+=256,i(o(s.toString(8)+"\0 ",8),a,148,8),r}function s(e){for(var t=512-e.length%512,n=new ArrayBuffer(e.length+t),r=new Uint8Array(n),i=0;i<e.length;i++)r[i]=e.charCodeAt(i);return n}function l(e){return function(t){console.log(e,t)}}window.webkitRequestFileSystem(window.TEMPORARY,1048576,r,l("Error getting file system"))}function wrap(e,t,n){for(n-=t;e<t;)e+=n;return e%n}function onDocumentMouseMove(e){pmouseX=mouseX,pmouseY=mouseY,mouseX=e.clientX-.5*window.innerWidth,mouseY=e.clientY-.5*window.innerHeight,dragging&&(0==keyboard.pressed("shift")?(rotateVY+=(mouseX-pmouseX)/2*Math.PI/180*.3,rotateVX+=(mouseY-pmouseY)/2*Math.PI/180*.3):(camera.position.x-=.5*(mouseX-pmouseX),camera.position.y+=.5*(mouseY-pmouseY)))}function onDocumentMouseDown(e){-1===e.target.className.indexOf("noMapDrag")&&(dragging=!0,pressX=mouseX,pressY=mouseY,rotateTargetX=void 0,rotateTargetX=void 0)}function onDocumentMouseUp(e){dragging=!1,histogramPressed=!1}function onClick(e){if(!(Math.abs(pressX-mouseX)>3||Math.abs(pressY-mouseY)>3)){var t=getPickColor();for(var n in countryColorMap){var r=n;if(t==countryColorMap[n]){var i=countryLookup[r];if(void 0===i)return;if($.inArray(i,selectableCountries)<=-1)return;var o=selectionData;return o.selectedCountry=i,void selectVisualization(timeBins,o.selectedYear,[o.selectedCountry],o.getExportCategories(),o.getImportCategories())}}}}function onKeyDown(e){}function handleMWheel(e){camera.scale.z+=.1*e,camera.scale.z=constrain(camera.scale.z,.7,5)}function onMouseWheel(e){var t=0;e.wheelDelta?t=e.wheelDelta/120:e.detail&&(t=-e.detail/3),t&&handleMWheel(t),e.returnValue=!1}function onDocumentResize(e){}function buildGUI(){var e=new Selection;selectionData=e}function loadGeoData(e){for(var t in e.countries){var n=e.countries[t];n.countryCode=t,n.countryName=countryLookup[t];var r=n.lon-90,i=n.lat,o=Math.PI/2-i*Math.PI/180-.01*Math.PI,a=2*Math.PI-r*Math.PI/180+.06*Math.PI,s=new THREE.Vector3;s.x=Math.sin(o)*Math.cos(a)*100,s.y=100*Math.cos(o),s.z=Math.sin(o)*Math.sin(a)*100,n.center=s,countryData[n.countryName]=n}}function getCountry(e){return countryData[e.toUpperCase()]}function buildDataVizGeometries(e){for(var t in e){var n=e[t].data,r=e[t].t;selectableYears.push(r);for(var i in n){var o=n[i],a=o.e.toUpperCase(),s=o.i.toUpperCase();exporter=countryData[a],importer=countryData[s],void 0!==exporter&&importer}}}function getVisualizedMesh(e,t,n,r,i){for(var o in n)n[o]=n[o].toUpperCase();var a=parseInt(t)-1992;a>=timeBins.length&&(a=timeBins.length-1);var s=[],l=e[a].data,c=new THREE.Geometry,u=[],h=new THREE.Geometry,f=[];for(o in l){var d=l[o],p=d.e.toUpperCase(),m=d.i.toUpperCase(),v=$.inArray(p,n)>=0,g=$.inArray(m,n)>=0,E=v,y=g,x=reverseWeaponLookup[d.wc],T=v&&$.inArray(x,r)>=0,b=g&&$.inArray(x,i)>=0;if((y||E)&&(T||b)){if(void 0===d.lineGeometry)continue;var R=!1;p==selectedCountry.countryName&&(R=!0);var w,_=R?new THREE.Color(exportColor):new THREE.Color(importColor);for(P in d.lineGeometry.vertices){var H=d.lineGeometry.vertices[P];u.push(_),w=_}THREE.GeometryUtils.merge(c,d.lineGeometry);var M=w.clone(),S=d.lineGeometry.vertices,C=Math.floor(d.v/8e3/d.lineGeometry.vertices.length)+1;C=constrain(C,1,100);for(var A=d.lineGeometry.size,P=0;P<C;P++){var D=P/C*S.length,L=constrain(Math.floor(D),0,S.length-1),N=S[L],k=N.clone();k.moveIndex=L,k.nextIndex=L+1,k.nextIndex>=S.length&&(k.nextIndex=0),k.lerpN=0,k.path=S,h.vertices.push(k),k.size=A,f.push(M)}$.inArray(p,s)<0&&s.push(p),$.inArray(m,s)<0&&s.push(m);var F=d.v,U=countryData[p];void 0===U.mapColor?U.mapColor=F:U.mapColor+=F;var B=countryData[m];void 0===B.mapColor?B.mapColor=F:B.mapColor+=F,U.exportedAmount+=F,B.importedAmount+=F,U==selectedCountry&&(selectedCountry.summary.exported[d.wc]+=d.v,selectedCountry.summary.exported.total+=d.v),B==selectedCountry&&(selectedCountry.summary.imported[d.wc]+=d.v,selectedCountry.summary.imported.total+=d.v),B!=selectedCountry&&U!=selectedCountry||(selectedCountry.summary.total+=d.v)}}c.colors=u;var V=new THREE.Line(c,new THREE.LineBasicMaterial({color:16777215,opacity:1,blending:THREE.AdditiveBlending,transparent:!0,depthWrite:!1,vertexColors:!0,linewidth:1}));V.renderDepth=!1,attributes={size:{type:"f",value:[]},customColor:{type:"c",value:[]}},uniforms={amplitude:{type:"f",value:1},color:{type:"c",value:new THREE.Color(16777215)},texture:{type:"t",value:0,texture:THREE.ImageUtils.loadTexture("assets/img/particleA.png")}};var z=new THREE.ShaderMaterial({uniforms:uniforms,attributes:attributes,vertexShader:document.getElementById("vertexshader").textContent,fragmentShader:document.getElementById("fragmentshader").textContent,blending:THREE.AdditiveBlending,depthTest:!0,depthWrite:!1,transparent:!0}),I=THREE.ImageUtils.loadTexture("assets/img/map_mask.png");new THREE.ParticleBasicMaterial({map:I,color:16777215,size:60,blending:THREE.NormalBlending,transparent:!0,depthWrite:!1,vertexColors:!0,sizeAttenuation:!0});h.colors=f;var O=new THREE.ParticleSystem(h,z);O.dynamic=!0,V.add(O);for(var W=O.geometry.vertices,j=attributes.size.value,G=attributes.customColor.value,H=0;H<W.length;H++)j[H]=O.geometry.vertices[H].size,G[H]=f[H];return O.update=function(){for(var e in this.geometry.vertices){var t=this.geometry.vertices[e],n=t.path;n.length;t.lerpN+=.05,t.lerpN>1&&(t.lerpN=0,t.moveIndex=t.nextIndex,++t.nextIndex>=n.length&&(t.moveIndex=0,t.nextIndex=1));var r=n[t.moveIndex],i=n[t.nextIndex];t.copy(r),t.lerpSelf(i,t.lerpN)}this.geometry.verticesNeedUpdate=!0},V.affectedCountries=s,V}function selectVisualization(e,t,n,r,i){var o=n[0].toUpperCase();$("#hudButtons .countryTextInput").val(o),previouslySelectedCountry=selectedCountry,selectedCountry=countryData[n[0].toUpperCase()],selectedCountry.summary={imported:{mil:0,civ:0,ammo:0,total:0},exported:{mil:0,civ:0,ammo:0,total:0},total:0,historical:getHistoricalData(selectedCountry)};for(var a in countryData){var s=countryData[a];s.exportedAmount=0,s.importedAmount=0,s.mapColor=0}for(var a in selectableCountries)removeMarkerFromCountry(selectableCountries[a]);for(;visualizationMesh.children.length>0;){var l=visualizationMesh.children[0];visualizationMesh.remove(l)}console.time("getVisualizedMesh");var c=getVisualizedMesh(timeBins,t,n,r,i);visualizationMesh.add(c),0==c.affectedCountries.length&&c.affectedCountries.push(o);for(var a in c.affectedCountries){var u=c.affectedCountries[a],s=countryData[u];attachMarkerToCountry(u,s.mapColor)}if(highlightCountry(c.affectedCountries),previouslySelectedCountry!==selectedCountry&&selectedCountry){rotateTargetX=selectedCountry.lat*Math.PI/180;for(var h=-(selectedCountry.lon-9)*Math.PI/180,f=0;;){var d=h-2*Math.PI*f,p=h+2*Math.PI*f;if(Math.abs(d-rotating.rotation.y)<Math.PI){rotateTargetY=d;break}if(Math.abs(p-rotating.rotation.y)<Math.PI){rotateTargetY=p;break}f++,rotateTargetY=wrap(h,-Math.PI,Math.PI)}rotateVX*=.6,rotateVY*=.6}}function makeConnectionLineGeometry(e,t,n,r){if(void 0!=e.countryName&&void 0!=t.countryName){var i=e.center.clone().subSelf(t.center).length(),o=e.center,a=t.center,s=o.clone().lerpSelf(a,.5),l=s.length();s.normalize(),s.multiplyScalar(l+.7*i);var c=(new THREE.Vector3).sub(o,a);c.normalize();var u=.5*i,h=o,f=s.clone().addSelf(c.clone().multiplyScalar(u)),d=s.clone().addSelf(c.clone().multiplyScalar(-u)),p=a,m=new THREE.CubicBezierCurve3(o,h,f,s),v=new THREE.CubicBezierCurve3(s,d,p,a),g=2*Math.floor(.02*i+6),E=m.getPoints(g);E=E.splice(0,E.length-1),E=E.concat(v.getPoints(g)),E.push(vec3_origin);var y=3e-4*n,x=10+Math.sqrt(y);x=constrain(x,.1,60);var T=THREE.Curve.Utils.createLineGeometry(E);return T.size=x,T}}function constrain(e,t,n){return e<t?e=t:e>n&&(e=n),e}function onMarkerHover(e){var t=e.clientX-.5*window.innerWidth,n=e.clientY-.5*window.innerHeight,r=mouseX-t,i=mouseY-n;Math.sqrt(r*r+i*i)}function attachMarkerToCountry(e,t){e=e.toUpperCase();var n=countryData[e];if(void 0!==n){var r=document.getElementById("visualization"),i=document.querySelector(".marker"),o=i.cloneNode(!0);n.marker=o,r.appendChild(o),o.countryName=e,o.importance=t,o.selected=!1,o.hover=!1,e===selectedCountry.countryName.toUpperCase()&&(o.selected=!0),o.setPosition=function(e,t,n){this.style.left=e+"px",this.style.top=t+"px",this.style.zIndex=n},o.setVisible=function(e){this.style.display=e?"inline":"none"};var a=o.querySelector(".marker__country-text");o.countryLayer=a,o.jquery=$(o),o.setSize=function(e){var t=Math.floor(2+.5*e),n=2*t;this.style.fontSize=1.125*n+"pt",this.countryLayer.style.marginTop=t<=8?"0px":"-1px"},o.update=function(){var e=rotating.matrixWorld,t=e.multiplyVector3(n.center.clone()),r=screenXY(t),i=.3+1*camera.scale.z,o=this.importance/5e6;o=constrain(o,0,18),i+=o,this.tiny&&(i*=.75),this.selected&&(i=30),this.hover&&(i=15),this.setSize(i),this.setVisible(t.z>60&&i>3);var a=Math.floor(1e3-t.z+i);(this.selected||this.hover)&&(a=1e4),this.setPosition(r.x,r.y,a)};var s=o.querySelector(".marker__country-text"),l=t<2e7&&!o.selected;o.tiny=l,s.innerHTML=e.replace(" ","&nbsp;");var c=function(e){var t=selectionData;selectVisualization(timeBins,t.selectedYear,[this.countryName],t.getExportCategories(),t.getImportCategories())};o.addEventListener("click",c,!0),markers.push(o)}}function removeMarkerFromCountry(e){e=e.toUpperCase();var t=countryData[e];if(void 0!==t&&void 0!==t.marker){var n=markers.indexOf(t.marker);n>=0&&markers.splice(n,1);document.getElementById("visualization").removeChild(t.marker),t.marker=void 0}}function loadSVGAssets(e,t){var n=this;this.svgList=[],this.tempCallback=function(e){n.svgList.push(e),n.checkFinished()},this.checkFinished=function(){n.svgList.length<e.length?loadSVGAsset(e[n.svgList.length],n.tempCallback):t(this.svgList)},loadSVGAsset(e[0],this.tempCallback)}function loadSVGAsset(e,t){var n=this;n.filename=e,e in assets==!1&&(console.log("loading "+e),assets[e]="",xhr=new XMLHttpRequest,xhr.open("GET",e,!0),xhr.send(null),xhr.onreadystatechange=function(){if(4===xhr.readyState&&200===xhr.status){var e=xhr.responseText,r=new DOMParser;r.async=!1;var i=r.parseFromString(e,"text/xml").documentElement;i.svgText=e,assets[n.filename]=i,console.log("loaded "+n.filename),t(i)}})}function SVGToy(e,t){var n=this;this.container=document.createElement("div"),t&&t.appendChild(this.container),this.parentContainer=t,this.container.style["-webkit-transform-style"]="preserve-3d",this.container.style.position="absolute",this.container.style["pointer-events"]="none",this.svg=assets[e].cloneNode(!0),this.svg.style.position="relative",this.svg.style.display="block",this.svg.style["pointer-events"]="visibleFill",this.container.appendChild(this.svg),this.origin=this.getOriginFromFile(),this.setOrigin(this.origin.x,this.origin.y),this.TransformHelper=function(){this.value="",this.translate=function(e,t){return this.value+="translate("+e+","+t+") ",this},this.rotate=function(e){return this.value+="rotate("+e+") ",this},this.rotateOrigin=function(e,t,n){return this.value+="translate("+t+","+n+") ",this.value+="rotate("+e+") ",this.value+="translate("+-t+","+-n+") ",this},this.scale=function(e){return this.value+="scale("+e+") ",this},this.scaleOrigin=function(e,t,n){return this.value+="translate("+t+","+n+") ",this.value+="scale("+e+") ",this.value+="translate("+-t+","+-n+") ",this},this.endTransform=function(){return this.value}},this.prepVars=function(e){return void 0===e._ox&&(e._ox=n.origin.x),void 0===e._oy&&(e._oy=n.origin.y),void 0===e._tx&&(e._tx=0),void 0===e._ty&&(e._ty=0),void 0===e._ro&&(e._ro=0),void 0===e._so&&(e._so=1),e},this.getInitialStateFromElement=function(e,t){for(prop in e)console.log(typeof e[prop]);return{}},this.setAnimation=function(e,t){var r=this.svg.getElementById(e);if(void 0!==r&&null!==r){for(var i,o,a=0;a<t.length;a++){var s=t[a],l=void 0!==s.duration?s.duration:1e3,c=void 0!==s.easing?s.easing:TWEEN.Easing.Linear.EaseNone,u=s.loop,h=s.loopedVars,f={};for(p in s.vars)n.isEscapeProperty(p)||p in f==0&&(f[p]=0);a>0&&(f=t[a-1].vars);var d=s.vars;for(var p in f)p in d||(d[p]=f[p]);var m=n.setTweenStates(e,f,d,l,c);0==a?o=m:i.chain(m),u&&m.chain(m),void 0!==h&&m.onComplete(function(){for(var e in h)f[e]=h[e]}),i=m}o.start()}},this.setTweenStates=function(e,t,r,i,o){n.prepVars(t),n.prepVars(r);var a=t;return n.makeTween(a,r,i,o,function(){var t=n.beginTransform().translate(a._tx,a._ty).rotateOrigin(a._ro,a._ox,a._oy).scaleOrigin(a._so,a._ox,a._oy).endTransform();n.setProperty(e,"transform",t);for(prop in a)n.isEscapeProperty(prop)||n.setProperty(e,prop,a[prop])})},this.makeTween=function(e,t,n,r,i){var o=new TWEEN.Tween(e);return o.to(t,n),o.easing(r),o.onUpdate(i),o},this.isEscapeProperty=function(e){return"_ox"===e||"_oy"===e||"_tx"===e||"_ty"===e||"_ro"===e||"_so"===e||"duration"===e||"easing"===e||"vars"===e||"loop"===e||"loopedVars"===e}}function loadWorldPins(e){xhr=new XMLHttpRequest,xhr.open("GET",latlonFile,!0),xhr.onreadystatechange=function(){4===xhr.readyState&&200===xhr.status&&(latlonData=JSON.parse(xhr.responseText),e&&e())},xhr.send(null)}function loadContentData(e){var t="src/countries.json";t=encodeURI(t),xhr=new XMLHttpRequest,xhr.open("GET",t,!0),xhr.onreadystatechange=function(){4===xhr.readyState&&200===xhr.status&&(timeBins=JSON.parse(xhr.responseText).timeBins,maxValue=0,startTime=timeBins[0].t,endTime=timeBins[timeBins.length-1].t,timeLength=endTime-startTime,e&&e())},xhr.send(null)}function loadCountryCodes(e){cxhr=new XMLHttpRequest,cxhr.open("GET",isoFile,!0),cxhr.onreadystatechange=function(){4===cxhr.readyState&&200===cxhr.status&&(countryLookup=JSON.parse(cxhr.responseText),e())},cxhr.send(null)}function initScene(){scene=new THREE.Scene,scene.matrixAutoUpdate=!1,scene.add(new THREE.AmbientLight(5263440)),light1=new THREE.SpotLight(15658734,3),light1.position.x=730,light1.position.y=520,light1.position.z=626,light1.castShadow=!0,scene.add(light1),light2=new THREE.PointLight(2236962,14.8),light2.position.x=-640,light2.position.y=-500,light2.position.z=-1e3,scene.add(light2),rotating=new THREE.Object3D,scene.add(rotating),lookupCanvas=document.createElement("canvas"),lookupCanvas.width=256,lookupCanvas.height=1,lookupTexture=new THREE.Texture(lookupCanvas),lookupTexture.magFilter=THREE.NearestFilter,lookupTexture.minFilter=THREE.NearestFilter,lookupTexture.needsUpdate=!0;var e=new THREE.Texture(mapIndexedImage);e.needsUpdate=!0,e.magFilter=THREE.NearestFilter,e.minFilter=THREE.NearestFilter;var t=new THREE.Texture(mapOutlineImage);t.needsUpdate=!0;var n={mapIndex:{type:"t",value:0,texture:e},lookup:{type:"t",value:1,texture:lookupTexture},outline:{type:"t",value:2,texture:t},outlineLevel:{type:"f",value:1}};mapUniforms=n;var r=new THREE.ShaderMaterial({uniforms:n,vertexShader:document.getElementById("globeVertexShader").textContent,fragmentShader:document.getElementById("globeFragmentShader").textContent});backMat=new THREE.MeshBasicMaterial({}),sphere=new THREE.Mesh(new THREE.SphereGeometry(100,40,40),r),sphere.doubleSided=!1,sphere.rotation.x=Math.PI,sphere.rotation.y=-Math.PI/2,sphere.rotation.z=Math.PI,sphere.id="base",rotating.add(sphere);for(var i in timeBins){var o=timeBins[i].data;for(var a in o){var s=o[a],l=s.e.toUpperCase(),c=s.i.toUpperCase();$.inArray(l,selectableCountries)<0&&selectableCountries.push(l),$.inArray(c,selectableCountries)<0&&selectableCountries.push(c)}}loadGeoData(latlonData),buildDataVizGeometries(timeBins),visualizationMesh=new THREE.Object3D,rotating.add(visualizationMesh),buildGUI(),selectVisualization(timeBins,"2010",["UNITED STATES"],["Military Weapons","Civilian Weapons","Ammunition"],["Military Weapons","Civilian Weapons","Ammunition"]),renderer=new THREE.WebGLRenderer({antialias:!1}),renderer.setSize(window.innerWidth,window.innerHeight),renderer.autoClear=!1,renderer.sortObjects=!1,renderer.generateMipmaps=!1,glContainer.appendChild(renderer.domElement),document.addEventListener("mousemove",onDocumentMouseMove,!0),document.addEventListener("windowResize",onDocumentResize,!1),document.addEventListener("mousedown",onDocumentMouseDown,!0),document.addEventListener("mouseup",onDocumentMouseUp,!1),masterContainer.addEventListener("click",onClick,!0),masterContainer.addEventListener("mousewheel",onMouseWheel,!1),masterContainer.addEventListener("DOMMouseScroll",function(e){onMouseWheel(window.event||e)},!1),document.addEventListener("keydown",onKeyDown,!1),camera=new THREE.PerspectiveCamera(12,window.innerWidth/window.innerHeight,1,2e4),camera.position.z=1400,camera.position.y=0,camera.lookAt(scene.width/2,scene.height/2),scene.add(camera);THREEx.WindowResize(renderer,camera)}function animate(){void 0!==rotateTargetX&&void 0!==rotateTargetY&&(rotateVX+=.012*(rotateTargetX-rotateX),rotateVY+=.012*(rotateTargetY-rotateY),Math.abs(rotateTargetX-rotateX)<.1&&Math.abs(rotateTargetY-rotateY)<.1&&(rotateTargetX=void 0,rotateTargetY=void 0)),rotateX+=rotateVX,rotateY+=rotateVY,rotateVX*=.98,rotateVY*=.98,(dragging||void 0!==rotateTargetX)&&(rotateVX*=.6,rotateVY*=.6),rotateY+=.01*controllers.spin,rotateX<-rotateXMax&&(rotateX=-rotateXMax,rotateVX*=-.95),rotateX>rotateXMax&&(rotateX=rotateXMax,rotateVX*=-.95),TWEEN.update(),rotating.rotation.x=rotateX,rotating.rotation.y=rotateY,render(),requestAnimationFrame(animate),THREE.SceneUtils.traverseHierarchy(rotating,function(e){void 0!==e.update&&e.update()});for(var e in markers){markers[e].update()}}function render(){renderer.clear(),renderer.render(scene,camera)}function findCode(e){e=e.toUpperCase();for(var t in countryLookup)if(countryLookup[t]===e)return t;return"not found"}function highlightCountry(e){var t=[];for(var n in e){var r=findCode(e[n]);t.push(r)}var i=lookupCanvas.getContext("2d");i.clearRect(0,0,256,1);var o=0==e.length?0:1,a=10*o;i.fillStyle="rgb("+a+","+a+","+a+")",i.fillRect(0,0,1,1);var s=selectedCountry.countryCode;for(var n in t){var l=t[n],c=countryColorMap[l],u=(countryData[e[n]].mapColor,"#333333");l===s&&(u="#eeeeee"),i.fillStyle=u,i.fillRect(c,0,1,1)}lookupTexture.needsUpdate=!0}function getHistoricalData(e){var t=[],n=e.countryName,r=selectionData.getExportCategories(),i=selectionData.getImportCategories();for(var o in timeBins){var a=timeBins[o].data,s={imports:0,exports:0};for(var l in a){var c=a[l],u=reverseWeaponLookup[c.wc],h=c.e.toUpperCase(),f=c.i.toUpperCase();0!=(n==h&&$.inArray(u,r)>=0||n==f&&$.inArray(u,i)>=0)&&(void 0!==countryData[h]&&void 0!==countryData[f]&&(h==n&&(s.exports+=c.v),f==n&&(s.imports+=c.v)))}t.push(s)}return t}function getPickColor(){var e=void 0;void 0!==visualizationMesh.children[0]&&(e=visualizationMesh.children[0].affectedCountries),highlightCountry([]),rotating.remove(visualizationMesh),mapUniforms.outlineLevel.value=0,lookupTexture.needsUpdate=!0,renderer.autoClear=!1,renderer.autoClearColor=!1,renderer.autoClearDepth=!1,renderer.autoClearStencil=!1,renderer.preserve,renderer.clear(),renderer.render(scene,camera);var t=renderer.context;t.preserveDrawingBuffer=!0;var n=mouseX+renderer.context.canvas.width/2,r=-mouseY+renderer.context.canvas.height/2;n=Math.floor(n),r=Math.floor(r);var i=new Uint8Array(4);return t.readPixels(n,r,1,1,t.RGBA,t.UNSIGNED_BYTE,i),renderer.autoClear=!0,renderer.autoClearColor=!0,renderer.autoClearDepth=!0,renderer.autoClearStencil=!0,t.preserveDrawingBuffer=!1,mapUniforms.outlineLevel.value=1,rotating.add(visualizationMesh),void 0!==e&&highlightCountry(e),i[0]}Detector={canvas:!!window.CanvasRenderingContext2D,webgl:function(){try{return!!window.WebGLRenderingContext&&!!document.createElement("canvas").getContext("experimental-webgl")}catch(e){return!1}}(),workers:!!window.Worker,fileapi:window.File&&window.FileReader&&window.FileList&&window.Blob,getWebGLErrorMessage:function(){var e=document.createElement("div");return e.id="webgl-error-message",e.style.fontFamily="arial",e.style.fontSize="13px",e.style.fontWeight="normal",e.style.textAlign="center",e.style.background="#222222",e.style.color="#ffffff",e.style.padding="1.5em",e.style.width="100%",e.style.margin="5em auto 0",e.style.zIndex="500000",e.style.position="absolute",e.style.pointerEvents="all",this.webgl||(e.innerHTML=['Either your graphics card or your browser does not support WebGL.. Try <a href="http://www.google.com/chrome/" style="color:#ffffff; text-decoration:underline; text-transform:capitalize">Google Chrome</a><br>','or <a href="http://www.khronos.org/webgl/wiki_1_15/index.php/Getting_a_WebGL_Implementation" style="color:#ffffff; text-decoration:underline; text-transform:none">view a list</a> of WebGL compatible browsers.'].join("\n")),e},addGetWebGLMessage:function(e){var t,n,r;e=e||{},t=void 0!==e.parent?e.parent:document.body,n=void 0!==e.id?e.id:"oldie",r=Detector.getWebGLErrorMessage(),r.id=n,t.appendChild(r)}};var TWEEN=TWEEN||function(){var e,t,n,r=60,i=!1,o=[];return{setFPS:function(e){r=e||60},start:function(e){0!=arguments.length&&this.setFPS(e),t=setInterval(this.update,1e3/r)},stop:function(){clearInterval(t)},setAutostart:function(e){(i=e)&&!t&&this.start()},add:function(e){o.push(e),i&&!t&&this.start()},getAll:function(){return o},removeAll:function(){o=[]},remove:function(t){-1!==(e=o.indexOf(t))&&o.splice(e,1)},update:function(t){e=0,n=o.length;for(var r=t||Date.now();e<n;)o[e].update(r)?e++:(o.splice(e,1),n--);0==n&&1==i&&this.stop()}}}();TWEEN.Tween=function(e){var t=e,n={},r={},i={},o=1e3,a=0,s=null,l=TWEEN.Easing.Linear.EaseNone,c=null,u=null,h=null;this.to=function(e,n){null!==n&&(o=n);for(var r in e)null!==t[r]&&(i[r]=e[r]);return this},this.start=function(e){TWEEN.add(this),s=e?e+a:Date.now()+a;for(var o in i)null!==t[o]&&(n[o]=t[o],r[o]=i[o]-t[o]);return this},this.stop=function(){return TWEEN.remove(this),this},this.delay=function(e){return a=e,this},this.easing=function(e){return l=e,this},this.chain=function(e){c=e},this.onUpdate=function(e){return u=e,this},this.onComplete=function(e){return h=e,this},this.update=function(e){var i,a,f;if(e<s)return!0;a=(e-s)/o,a=a>1?1:a,f=l(a);for(i in r)t[i]=n[i]+r[i]*f;return null!==u&&u.call(t,f),1!=a||(null!==h&&h.call(t),null!==c&&c.start(),!1)}},TWEEN.Easing={Linear:{},Quadratic:{},Cubic:{},Quartic:{},Quintic:{},Sinusoidal:{},Exponential:{},Circular:{},Elastic:{},Back:{},Bounce:{}},TWEEN.Easing.Linear.EaseNone=function(e){return e},TWEEN.Easing.Quadratic.EaseIn=function(e){return e*e},TWEEN.Easing.Quadratic.EaseOut=function(e){return-e*(e-2)},TWEEN.Easing.Quadratic.EaseInOut=function(e){return(e*=2)<1?.5*e*e:-.5*(--e*(e-2)-1)},TWEEN.Easing.Cubic.EaseIn=function(e){return e*e*e},TWEEN.Easing.Cubic.EaseOut=function(e){return--e*e*e+1},TWEEN.Easing.Cubic.EaseInOut=function(e){return(e*=2)<1?.5*e*e*e:.5*((e-=2)*e*e+2)},TWEEN.Easing.Quartic.EaseIn=function(e){return e*e*e*e},TWEEN.Easing.Quartic.EaseOut=function(e){return-(--e*e*e*e-1)},TWEEN.Easing.Quartic.EaseInOut=function(e){return(e*=2)<1?.5*e*e*e*e:-.5*((e-=2)*e*e*e-2)},TWEEN.Easing.Quintic.EaseIn=function(e){return e*e*e*e*e},TWEEN.Easing.Quintic.EaseOut=function(e){return(e-=1)*e*e*e*e+1},TWEEN.Easing.Quintic.EaseInOut=function(e){return(e*=2)<1?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2)},TWEEN.Easing.Sinusoidal.EaseIn=function(e){return 1-Math.cos(e*Math.PI/2)},TWEEN.Easing.Sinusoidal.EaseOut=function(e){return Math.sin(e*Math.PI/2)},TWEEN.Easing.Sinusoidal.EaseInOut=function(e){return-.5*(Math.cos(Math.PI*e)-1)},TWEEN.Easing.Exponential.EaseIn=function(e){return 0==e?0:Math.pow(2,10*(e-1))},TWEEN.Easing.Exponential.EaseOut=function(e){return 1==e?1:1-Math.pow(2,-10*e)},TWEEN.Easing.Exponential.EaseInOut=function(e){return 0==e?0:1==e?1:(e*=2)<1?.5*Math.pow(2,10*(e-1)):.5*(2-Math.pow(2,-10*(e-1)))},TWEEN.Easing.Circular.EaseIn=function(e){return-(Math.sqrt(1-e*e)-1)},TWEEN.Easing.Circular.EaseOut=function(e){return Math.sqrt(1- --e*e)},TWEEN.Easing.Circular.EaseInOut=function(e){return(e/=.5)<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1)},TWEEN.Easing.Elastic.EaseIn=function(e){var t,n=.1,r=.4;return 0==e?0:1==e?1:(r||(r=.3),!n||n<1?(n=1,t=r/4):t=r/(2*Math.PI)*Math.asin(1/n),-n*Math.pow(2,10*(e-=1))*Math.sin((e-t)*(2*Math.PI)/r))},TWEEN.Easing.Elastic.EaseOut=function(e){var t,n=.1,r=.4;return 0==e?0:1==e?1:(r||(r=.3),!n||n<1?(n=1,t=r/4):t=r/(2*Math.PI)*Math.asin(1/n),n*Math.pow(2,-10*e)*Math.sin((e-t)*(2*Math.PI)/r)+1)},TWEEN.Easing.Elastic.EaseInOut=function(e){var t,n=.1,r=.4;return 0==e?0:1==e?1:(r||(r=.3),!n||n<1?(n=1,t=r/4):t=r/(2*Math.PI)*Math.asin(1/n),(e*=2)<1?n*Math.pow(2,10*(e-=1))*Math.sin((e-t)*(2*Math.PI)/r)*-.5:n*Math.pow(2,-10*(e-=1))*Math.sin((e-t)*(2*Math.PI)/r)*.5+1)},TWEEN.Easing.Back.EaseIn=function(e){var t=1.70158;return e*e*((t+1)*e-t)},TWEEN.Easing.Back.EaseOut=function(e){var t=1.70158;return(e-=1)*e*((t+1)*e+t)+1},TWEEN.Easing.Back.EaseInOut=function(e){var t=2.5949095;return(e*=2)<1?e*e*((t+1)*e-t)*.5:.5*((e-=2)*e*((t+1)*e+t)+2)},TWEEN.Easing.Bounce.EaseIn=function(e){return 1-TWEEN.Easing.Bounce.EaseOut(1-e)},TWEEN.Easing.Bounce.EaseOut=function(e){return(e/=1)<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},TWEEN.Easing.Bounce.EaseInOut=function(e){return e<.5?.5*TWEEN.Easing.Bounce.EaseIn(2*e):.5*TWEEN.Easing.Bounce.EaseOut(2*e-1)+.5};var dat=dat||{};dat.gui=dat.gui||{},dat.utils=dat.utils||{},dat.controllers=dat.controllers||{},dat.dom=dat.dom||{},
dat.color=dat.color||{},dat.utils.css=function(){return{load:function(e,t){var t=t||document,n=t.createElement("link");n.type="text/css",n.rel="stylesheet",n.href=e,t.getElementsByTagName("head")[0].appendChild(n)},inject:function(e,t){var t=t||document,n=document.createElement("style");n.type="text/css",n.innerHTML=e,t.getElementsByTagName("head")[0].appendChild(n)}}}(),dat.utils.common=function(){var e=Array.prototype.forEach,t=Array.prototype.slice;return{BREAK:{},extend:function(e){return this.each(t.call(arguments,1),function(t){for(var n in t)this.isUndefined(t[n])||(e[n]=t[n])},this),e},defaults:function(e){return this.each(t.call(arguments,1),function(t){for(var n in t)this.isUndefined(e[n])&&(e[n]=t[n])},this),e},compose:function(){var e=t.call(arguments);return function(){for(var n=t.call(arguments),r=e.length-1;r>=0;r--)n=[e[r].apply(this,n)];return n[0]}},each:function(t,n,r){if(e&&t.forEach===e)t.forEach(n,r);else if(t.length===t.length+0)for(var i=0,o=t.length;i<o&&!(i in t&&n.call(r,t[i],i)===this.BREAK);i++);else for(i in t)if(n.call(r,t[i],i)===this.BREAK)break},defer:function(e){setTimeout(e,0)},toArray:function(e){return e.toArray?e.toArray():t.call(e)},isUndefined:function(e){return void 0===e},isNull:function(e){return null===e},isNaN:function(e){return e!==e},isArray:Array.isArray||function(e){return e.constructor===Array},isObject:function(e){return e===Object(e)},isNumber:function(e){return e===e+0},isString:function(e){return e===e+""},isBoolean:function(e){return!1===e||!0===e},isFunction:function(e){return"[object Function]"===Object.prototype.toString.call(e)}}}(),dat.controllers.Controller=function(e){var t=function(e,t){this.initialValue=e[t],this.domElement=document.createElement("div"),this.object=e,this.property=t,this.__onFinishChange=this.__onChange=void 0};return e.extend(t.prototype,{onChange:function(e){return this.__onChange=e,this},onFinishChange:function(e){return this.__onFinishChange=e,this},setValue:function(e){return this.object[this.property]=e,this.__onChange&&this.__onChange.call(this,e),this.updateDisplay(),this},getValue:function(){return this.object[this.property]},updateDisplay:function(){return this},isModified:function(){return this.initialValue!==this.getValue()}}),t}(dat.utils.common),dat.dom.dom=function(e){function t(t){return"0"===t||e.isUndefined(t)?0:(t=t.match(r),e.isNull(t)?0:parseFloat(t[1]))}var n={};e.each({HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]},function(t,r){e.each(t,function(e){n[e]=r})});var r=/(\d+(\.\d+)?)px/,i={makeSelectable:function(e,t){void 0!==e&&void 0!==e.style&&(e.onselectstart=t?function(){return!1}:function(){},e.style.MozUserSelect=t?"auto":"none",e.style.KhtmlUserSelect=t?"auto":"none",e.unselectable=t?"on":"off")},makeFullscreen:function(t,n,r){e.isUndefined(n)&&(n=!0),e.isUndefined(r)&&(r=!0),t.style.position="absolute",n&&(t.style.left=0,t.style.right=0),r&&(t.style.top=0,t.style.bottom=0)},fakeEvent:function(t,r,i,o){var i=i||{},a=n[r];if(!a)throw Error("Event type "+r+" not supported.");var s=document.createEvent(a);switch(a){case"MouseEvents":s.initMouseEvent(r,i.bubbles||!1,i.cancelable||!0,window,i.clickCount||1,0,0,i.x||i.clientX||0,i.y||i.clientY||0,!1,!1,!1,!1,0,null);break;case"KeyboardEvents":a=s.initKeyboardEvent||s.initKeyEvent,e.defaults(i,{cancelable:!0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:void 0,charCode:void 0}),a(r,i.bubbles||!1,i.cancelable,window,i.ctrlKey,i.altKey,i.shiftKey,i.metaKey,i.keyCode,i.charCode);break;default:s.initEvent(r,i.bubbles||!1,i.cancelable||!0)}e.defaults(s,o),t.dispatchEvent(s)},bind:function(e,t,n,r){return e.addEventListener?e.addEventListener(t,n,r||!1):e.attachEvent&&e.attachEvent("on"+t,n),i},unbind:function(e,t,n,r){return e.removeEventListener?e.removeEventListener(t,n,r||!1):e.detachEvent&&e.detachEvent("on"+t,n),i},addClass:function(e,t){if(void 0===e.className)e.className=t;else if(e.className!==t){var n=e.className.split(/ +/);-1==n.indexOf(t)&&(n.push(t),e.className=n.join(" ").replace(/^\s+/,"").replace(/\s+$/,""))}return i},removeClass:function(e,t){if(t){if(void 0!==e.className)if(e.className===t)e.removeAttribute("class");else{var n=e.className.split(/ +/),r=n.indexOf(t);-1!=r&&(n.splice(r,1),e.className=n.join(" "))}}else e.className=void 0;return i},hasClass:function(e,t){return RegExp("(?:^|\\s+)"+t+"(?:\\s+|$)").test(e.className)||!1},getWidth:function(e){return e=getComputedStyle(e),t(e["border-left-width"])+t(e["border-right-width"])+t(e["padding-left"])+t(e["padding-right"])+t(e.width)},getHeight:function(e){return e=getComputedStyle(e),t(e["border-top-width"])+t(e["border-bottom-width"])+t(e["padding-top"])+t(e["padding-bottom"])+t(e.height)},getOffset:function(e){var t={left:0,top:0};if(e.offsetParent)do{t.left+=e.offsetLeft,t.top+=e.offsetTop}while(e=e.offsetParent);return t},isActive:function(e){return e===document.activeElement&&(e.type||e.href)}};return i}(dat.utils.common),dat.controllers.OptionController=function(e,t,n){var r=function(e,i,o){r.superclass.call(this,e,i);var a=this;if(this.__select=document.createElement("select"),n.isArray(o)){var s={};n.each(o,function(e){s[e]=e}),o=s}n.each(o,function(e,t){var n=document.createElement("option");n.innerHTML=t,n.setAttribute("value",e),a.__select.appendChild(n)}),this.updateDisplay(),t.bind(this.__select,"change",function(){a.setValue(this.options[this.selectedIndex].value)}),this.domElement.appendChild(this.__select)};return r.superclass=e,n.extend(r.prototype,e.prototype,{setValue:function(e){return e=r.superclass.prototype.setValue.call(this,e),this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),e},updateDisplay:function(){return this.__select.value=this.getValue(),r.superclass.prototype.updateDisplay.call(this)}}),r}(dat.controllers.Controller,dat.dom.dom,dat.utils.common),dat.controllers.NumberController=function(e,t){var n=function(e,r,i){n.superclass.call(this,e,r),i=i||{},this.__min=i.min,this.__max=i.max,this.__step=i.step,e=this.__impliedStep=t.isUndefined(this.__step)?0==this.initialValue?1:Math.pow(10,Math.floor(Math.log(this.initialValue)/Math.LN10))/10:this.__step,e=e.toString(),this.__precision=e.indexOf(".")>-1?e.length-e.indexOf(".")-1:0};return n.superclass=e,t.extend(n.prototype,e.prototype,{setValue:function(e){return void 0!==this.__min&&e<this.__min?e=this.__min:void 0!==this.__max&&e>this.__max&&(e=this.__max),void 0!==this.__step&&e%this.__step!=0&&(e=Math.round(e/this.__step)*this.__step),n.superclass.prototype.setValue.call(this,e)},min:function(e){return this.__min=e,this},max:function(e){return this.__max=e,this},step:function(e){return this.__step=e,this}}),n}(dat.controllers.Controller,dat.utils.common),dat.controllers.NumberControllerBox=function(e,t,n){var r=function(e,i,o){function a(){var e=parseFloat(u.__input.value);n.isNaN(e)||u.setValue(e)}function s(e){var t=c-e.clientY;u.setValue(u.getValue()+t*u.__impliedStep),c=e.clientY}function l(){t.unbind(window,"mousemove",s),t.unbind(window,"mouseup",l)}this.__truncationSuspended=!1,r.superclass.call(this,e,i,o);var c,u=this;this.__input=document.createElement("input"),this.__input.setAttribute("type","text"),t.bind(this.__input,"change",a),t.bind(this.__input,"blur",function(){a(),u.__onFinishChange&&u.__onFinishChange.call(u,u.getValue())}),t.bind(this.__input,"mousedown",function(e){t.bind(window,"mousemove",s),t.bind(window,"mouseup",l),c=e.clientY}),t.bind(this.__input,"keydown",function(e){13===e.keyCode&&(u.__truncationSuspended=!0,this.blur(),u.__truncationSuspended=!1)}),this.updateDisplay(),this.domElement.appendChild(this.__input)};return r.superclass=e,n.extend(r.prototype,e.prototype,{updateDisplay:function(){var e,t=this.__input;if(this.__truncationSuspended)e=this.getValue();else{e=this.getValue();var n=Math.pow(10,this.__precision);e=Math.round(e*n)/n}return t.value=e,r.superclass.prototype.updateDisplay.call(this)}}),r}(dat.controllers.NumberController,dat.dom.dom,dat.utils.common),dat.controllers.NumberControllerSlider=function(e,t,n,r,i){var o=function(e,n,r,i,a){function s(e){e.preventDefault();var n=t.getOffset(c.__background),r=t.getWidth(c.__background);return c.setValue(c.__min+(c.__max-c.__min)*((e.clientX-n.left)/(n.left+r-n.left))),!1}function l(){t.unbind(window,"mousemove",s),t.unbind(window,"mouseup",l),c.__onFinishChange&&c.__onFinishChange.call(c,c.getValue())}o.superclass.call(this,e,n,{min:r,max:i,step:a});var c=this;this.__background=document.createElement("div"),this.__foreground=document.createElement("div"),t.bind(this.__background,"mousedown",function(e){t.bind(window,"mousemove",s),t.bind(window,"mouseup",l),s(e)}),t.addClass(this.__background,"slider"),t.addClass(this.__foreground,"slider-fg"),this.updateDisplay(),this.__background.appendChild(this.__foreground),this.domElement.appendChild(this.__background)};return o.superclass=e,o.useDefaultStyles=function(){n.inject(".slider {\n  box-shadow: inset 0 2px 4px rgba(0,0,0,0.15);\n  height: 1em;\n  border-radius: 1em;\n  background-color: #eee;\n  padding: 0 0.5em;\n  overflow: hidden;\n}\n\n.slider-fg {\n  padding: 1px 0 2px 0;\n  background-color: #aaa;\n  height: 1em;\n  margin-left: -0.5em;\n  padding-right: 0.5em;\n  border-radius: 1em 0 0 1em;\n}\n\n.slider-fg:after {\n  display: inline-block;\n  border-radius: 1em;\n  background-color: #fff;\n  border:  1px solid #aaa;\n  content: '';\n  float: right;\n  margin-right: -1em;\n  margin-top: -1px;\n  height: 0.9em;\n  width: 0.9em;\n}")},r.extend(o.prototype,e.prototype,{updateDisplay:function(){return this.__foreground.style.width=(this.getValue()-this.__min)/(this.__max-this.__min)*100+"%",o.superclass.prototype.updateDisplay.call(this)}}),o}(dat.controllers.NumberController,dat.dom.dom,dat.utils.css,dat.utils.common),dat.controllers.FunctionController=function(e,t,n){var r=function(e,n,i){r.superclass.call(this,e,n);var o=this;this.__button=document.createElement("div"),this.__button.innerHTML=void 0===i?"Fire":i,t.bind(this.__button,"click",function(e){return e.preventDefault(),o.fire(),!1}),t.addClass(this.__button,"button"),this.domElement.appendChild(this.__button)};return r.superclass=e,n.extend(r.prototype,e.prototype,{fire:function(){this.__onChange&&this.__onChange.call(this),this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.getValue().call(this.object)}}),r}(dat.controllers.Controller,dat.dom.dom,dat.utils.common),dat.controllers.BooleanController=function(e,t,n){var r=function(e,n){r.superclass.call(this,e,n);var i=this;this.__prev=this.getValue(),this.__checkbox=document.createElement("input"),this.__checkbox.setAttribute("type","checkbox"),t.bind(this.__checkbox,"change",function(){i.setValue(!i.__prev)},!1),this.domElement.appendChild(this.__checkbox),this.updateDisplay()};return r.superclass=e,n.extend(r.prototype,e.prototype,{setValue:function(e){return e=r.superclass.prototype.setValue.call(this,e),this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.__prev=this.getValue(),e},updateDisplay:function(){return!0===this.getValue()?(this.__checkbox.setAttribute("checked","checked"),this.__checkbox.checked=!0):this.__checkbox.checked=!1,r.superclass.prototype.updateDisplay.call(this)}}),r}(dat.controllers.Controller,dat.dom.dom,dat.utils.common),dat.color.toString=function(e){return function(t){if(1==t.a||e.isUndefined(t.a)){for(t=t.hex.toString(16);t.length<6;)t="0"+t;return"#"+t}return"rgba("+Math.round(t.r)+","+Math.round(t.g)+","+Math.round(t.b)+","+t.a+")"}}(dat.utils.common),dat.color.interpret=function(e,t){var n,r,i=[{litmus:t.isString,conversions:{THREE_CHAR_HEX:{read:function(e){return null!==(e=e.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i))&&{space:"HEX",hex:parseInt("0x"+e[1].toString()+e[1].toString()+e[2].toString()+e[2].toString()+e[3].toString()+e[3].toString())}},write:e},SIX_CHAR_HEX:{read:function(e){return null!==(e=e.match(/^#([A-F0-9]{6})$/i))&&{space:"HEX",hex:parseInt("0x"+e[1].toString())}},write:e},CSS_RGB:{read:function(e){return null!==(e=e.match(/^rgb\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/))&&{space:"RGB",r:parseFloat(e[1]),g:parseFloat(e[2]),b:parseFloat(e[3])}},write:e},CSS_RGBA:{read:function(e){return null!==(e=e.match(/^rgba\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\,\s*(.+)\s*\)/))&&{space:"RGB",r:parseFloat(e[1]),g:parseFloat(e[2]),b:parseFloat(e[3]),a:parseFloat(e[4])}},write:e}}},{litmus:t.isNumber,conversions:{HEX:{read:function(e){return{space:"HEX",hex:e,conversionName:"HEX"}},write:function(e){return e.hex}}}},{litmus:t.isArray,conversions:{RGB_ARRAY:{read:function(e){return 3==e.length&&{space:"RGB",r:e[0],g:e[1],b:e[2]}},write:function(e){return[e.r,e.g,e.b]}},RGBA_ARRAY:{read:function(e){return 4==e.length&&{space:"RGB",r:e[0],g:e[1],b:e[2],a:e[3]}},write:function(e){return[e.r,e.g,e.b,e.a]}}}},{litmus:t.isObject,conversions:{RGBA_OBJ:{read:function(e){return!!(t.isNumber(e.r)&&t.isNumber(e.g)&&t.isNumber(e.b)&&t.isNumber(e.a))&&{space:"RGB",r:e.r,g:e.g,b:e.b,a:e.a}},write:function(e){return{r:e.r,g:e.g,b:e.b,a:e.a}}},RGB_OBJ:{read:function(e){return!!(t.isNumber(e.r)&&t.isNumber(e.g)&&t.isNumber(e.b))&&{space:"RGB",r:e.r,g:e.g,b:e.b}},write:function(e){return{r:e.r,g:e.g,b:e.b}}},HSVA_OBJ:{read:function(e){return!!(t.isNumber(e.h)&&t.isNumber(e.s)&&t.isNumber(e.v)&&t.isNumber(e.a))&&{space:"HSV",h:e.h,s:e.s,v:e.v,a:e.a}},write:function(e){return{h:e.h,s:e.s,v:e.v,a:e.a}}},HSV_OBJ:{read:function(e){return!!(t.isNumber(e.h)&&t.isNumber(e.s)&&t.isNumber(e.v))&&{space:"HSV",h:e.h,s:e.s,v:e.v}},write:function(e){return{h:e.h,s:e.s,v:e.v}}}}}];return function(){r=!1;var e=arguments.length>1?t.toArray(arguments):arguments[0];return t.each(i,function(i){if(i.litmus(e))return t.each(i.conversions,function(i,o){if(n=i.read(e),!1===r&&!1!==n)return r=n,n.conversionName=o,n.conversion=i,t.BREAK}),t.BREAK}),r}}(dat.color.toString,dat.utils.common),dat.GUI=dat.gui.GUI=function(e,t,n,r,i,o,a,s,l,c,u,h,f,d,p){function m(e,t,n,o){if(void 0===t[n])throw Error("Object "+t+' has no property "'+n+'"');o.color?t=new u(t,n):(t=[t,n].concat(o.factoryArgs),t=r.apply(e,t)),o.before instanceof i&&(o.before=o.before.__li),E(e,t),d.addClass(t.domElement,"c"),n=document.createElement("span"),d.addClass(n,"property-name"),n.innerHTML=t.property;var a=document.createElement("div");return a.appendChild(n),a.appendChild(t.domElement),o=v(e,a,o.before),d.addClass(o,L.CLASS_CONTROLLER_ROW),d.addClass(o,typeof t.getValue()),g(e,o,t),e.__controllers.push(t),t}function v(e,t,n){var r=document.createElement("li");return t&&r.appendChild(t),n?e.__ul.insertBefore(r,params.before):e.__ul.appendChild(r),e.onResize(),r}function g(e,t,n){if(n.__li=t,n.__gui=e,p.extend(n,{options:function(t){return arguments.length>1?(n.remove(),m(e,n.object,n.property,{before:n.__li.nextElementSibling,factoryArgs:[p.toArray(arguments)]})):p.isArray(t)||p.isObject(t)?(n.remove(),m(e,n.object,n.property,{before:n.__li.nextElementSibling,factoryArgs:[t]})):void 0},name:function(e){return n.__li.firstElementChild.firstElementChild.innerHTML=e,n},listen:function(){return n.__gui.listen(n),n},remove:function(){return n.__gui.remove(n),n}}),n instanceof l){var r=new s(n.object,n.property,{min:n.__min,max:n.__max,step:n.__step});p.each(["updateDisplay","onChange","onFinishChange"],function(e){var t=n[e],i=r[e];n[e]=r[e]=function(){var e=Array.prototype.slice.call(arguments);return t.apply(n,e),i.apply(r,e)}}),d.addClass(t,"has-slider"),n.domElement.insertBefore(r.domElement,n.domElement.firstElementChild)}else if(n instanceof s){var i=function(t){return p.isNumber(n.__min)&&p.isNumber(n.__max)?(n.remove(),m(e,n.object,n.property,{before:n.__li.nextElementSibling,factoryArgs:[n.__min,n.__max,n.__step]})):t};n.min=p.compose(i,n.min),n.max=p.compose(i,n.max)}else n instanceof o?(d.bind(t,"click",function(){d.fakeEvent(n.__checkbox,"click")}),d.bind(n.__checkbox,"click",function(e){e.stopPropagation()})):n instanceof a?(d.bind(t,"click",function(){d.fakeEvent(n.__button,"click")}),d.bind(t,"mouseover",function(){d.addClass(n.__button,"hover")}),d.bind(t,"mouseout",function(){d.removeClass(n.__button,"hover")})):n instanceof u&&(d.addClass(t,"color"),n.updateDisplay=p.compose(function(e){return t.style.borderLeftColor=n.__color.toString(),e},n.updateDisplay),n.updateDisplay());n.setValue=p.compose(function(t){return e.getRoot().__preset_select&&n.isModified()&&w(e.getRoot(),!0),t},n.setValue)}function E(e,t){var n=e.getRoot(),r=n.__rememberedObjects.indexOf(t.object);if(-1!=r){var i=n.__rememberedObjectIndecesToControllers[r];if(void 0===i&&(i={},n.__rememberedObjectIndecesToControllers[r]=i),i[t.property]=t,n.load&&n.load.remembered){if(n=n.load.remembered,n[e.preset])n=n[e.preset];else{if(!n[M])return;n=n[M]}n[r]&&void 0!==n[r][t.property]&&(r=n[r][t.property],t.initialValue=r,t.setValue(r))}}}function y(e){var t=e.__save_row=document.createElement("li");d.addClass(e.domElement,"has-save"),e.__ul.insertBefore(t,e.__ul.firstChild),d.addClass(t,"save-row");var n=document.createElement("span");n.innerHTML="&nbsp;",d.addClass(n,"button gears");var r=document.createElement("span");r.innerHTML="Save",d.addClass(r,"button"),d.addClass(r,"save");var i=document.createElement("span");i.innerHTML="New",d.addClass(i,"button"),d.addClass(i,"save-as");var o=document.createElement("span");o.innerHTML="Revert",d.addClass(o,"button"),d.addClass(o,"revert");var a=e.__preset_select=document.createElement("select");if(e.load&&e.load.remembered?p.each(e.load.remembered,function(t,n){R(e,n,n==e.preset)}):R(e,M,!1),d.bind(a,"change",function(){for(var t=0;t<e.__preset_select.length;t++)e.__preset_select[t].innerHTML=e.__preset_select[t].value;e.preset=this.value}),t.appendChild(a),t.appendChild(n),t.appendChild(r),t.appendChild(i),t.appendChild(o),H){var t=document.getElementById("dg-save-locally"),s=document.getElementById("dg-local-explain");t.style.display="block",t=document.getElementById("dg-local-storage"),"true"===localStorage.getItem(document.location.href+".isLocal")&&t.setAttribute("checked","checked");var l=function(){s.style.display=e.useLocalStorage?"block":"none"};l(),d.bind(t,"change",function(){e.useLocalStorage=!e.useLocalStorage,l()})}var c=document.getElementById("dg-new-constructor");d.bind(c,"keydown",function(e){e.metaKey&&(67===e.which||67==e.keyCode)&&S.hide()}),d.bind(n,"click",function(){c.innerHTML=JSON.stringify(e.getSaveObject(),void 0,2),S.show(),c.focus(),c.select()}),d.bind(r,"click",function(){e.save()}),d.bind(i,"click",function(){var t=prompt("Enter a new preset name.");t&&e.saveAs(t)}),d.bind(o,"click",function(){e.revert()})}function x(e){function t(t){return t.preventDefault(),i=t.clientX,d.addClass(e.__closeButton,L.CLASS_DRAG),d.bind(window,"mousemove",n),d.bind(window,"mouseup",r),!1}function n(t){return t.preventDefault(),e.width+=i-t.clientX,e.onResize(),i=t.clientX,!1}function r(){d.removeClass(e.__closeButton,L.CLASS_DRAG),d.unbind(window,"mousemove",n),d.unbind(window,"mouseup",r)}e.__resize_handle=document.createElement("div"),p.extend(e.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"});var i;d.bind(e.__resize_handle,"mousedown",t),d.bind(e.__closeButton,"mousedown",t),e.domElement.insertBefore(e.__resize_handle,e.domElement.firstElementChild)}function T(e,t){e.domElement.style.width=t+"px",e.__save_row&&e.autoPlace&&(e.__save_row.style.width=t+"px"),e.__closeButton&&(e.__closeButton.style.width=t+"px")}function b(e,t){var n={};return p.each(e.__rememberedObjects,function(r,i){var o={};p.each(e.__rememberedObjectIndecesToControllers[i],function(e,n){o[n]=t?e.initialValue:e.getValue()}),n[i]=o}),n}function R(e,t,n){var r=document.createElement("option");r.innerHTML=t,r.value=t,e.__preset_select.appendChild(r),n&&(e.__preset_select.selectedIndex=e.__preset_select.length-1)}function w(e,t){var n=e.__preset_select[e.__preset_select.selectedIndex];n.innerHTML=t?n.value+"*":n.value}function _(e){0!=e.length&&h(function(){_(e)}),p.each(e,function(e){e.updateDisplay()})}e.inject(".dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity 0.1s linear;-o-transition:opacity 0.1s linear;-moz-transition:opacity 0.1s linear;transition:opacity 0.1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity 0.1s linear;-o-transition:opacity 0.1s linear;-moz-transition:opacity 0.1s linear;transition:opacity 0.1s linear;border:0;position:absolute;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-x:hidden}.dg.a.has-save ul{margin-top:27px}.dg.a.has-save ul.closed{margin-top:0}.dg.a .save-row{position:fixed;top:0;z-index:1002}.dg li{-webkit-transition:height 0.1s ease-out;-o-transition:height 0.1s ease-out;-moz-transition:height 0.1s ease-out;transition:height 0.1s ease-out}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;overflow:hidden;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid rgba(0,0,0,0)}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li > *{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .c{float:left;width:60%}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:9px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2fa1d6}.dg .cr.number input[type=text]{color:#2fa1d6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2fa1d6}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}\n");var H,M="Default";try{H="localStorage"in window&&null!==window.localStorage}catch(e){H=!1}var S,C,A=!0,P=!1,D=[],L=function(e){function t(){localStorage.setItem(document.location.href+".gui",JSON.stringify(n.getSaveObject()))}var n=this;this.domElement=document.createElement("div"),this.__ul=document.createElement("ul"),this.domElement.appendChild(this.__ul),d.addClass(this.domElement,"dg"),this.__folders={},this.__controllers=[],this.__rememberedObjects=[],this.__rememberedObjectIndecesToControllers=[],this.__listening=[],e=e||{},e=p.defaults(e,{autoPlace:!0,width:L.DEFAULT_WIDTH}),e=p.defaults(e,{resizable:e.autoPlace,hideable:e.autoPlace}),p.isUndefined(e.load)?e.load={preset:M}:e.preset&&(e.load.preset=e.preset),p.isUndefined(e.parent)&&e.hideable&&D.push(this),e.resizable=p.isUndefined(e.parent)&&e.resizable,e.autoPlace&&p.isUndefined(e.scrollable)&&(e.scrollable=!0);var r=H&&"true"===localStorage.getItem(document.location.href+".isLocal");if(Object.defineProperties(this,{parent:{get:function(){return e.parent}},scrollable:{get:function(){return e.scrollable}},autoPlace:{get:function(){return e.autoPlace}},preset:{get:function(){return n.parent?n.getRoot().preset:e.load.preset},set:function(t){for(n.parent?n.getRoot().preset=t:e.load.preset=t,t=0;t<this.__preset_select.length;t++)this.__preset_select[t].value==this.preset&&(this.__preset_select.selectedIndex=t);n.revert()}},width:{get:function(){return e.width},set:function(t){e.width=t,T(n,t)}},name:{get:function(){return e.name},set:function(t){e.name=t,o&&(o.innerHTML=e.name)}},closed:{get:function(){return e.closed},set:function(t){e.closed=t,e.closed?d.addClass(n.__ul,L.CLASS_CLOSED):d.removeClass(n.__ul,L.CLASS_CLOSED),this.onResize(),n.__closeButton&&(n.__closeButton.innerHTML=t?L.TEXT_OPEN:L.TEXT_CLOSED)}},load:{get:function(){return e.load}},useLocalStorage:{get:function(){return r},set:function(e){H&&((r=e)?d.bind(window,"unload",t):d.unbind(window,"unload",t),localStorage.setItem(document.location.href+".isLocal",e))}}}),p.isUndefined(e.parent)){if(e.closed=!1,d.addClass(this.domElement,L.CLASS_MAIN),d.makeSelectable(this.domElement,!1),H&&r){n.useLocalStorage=!0;var i=localStorage.getItem(document.location.href+".gui");i&&(e.load=JSON.parse(i))}this.__closeButton=document.createElement("div"),this.__closeButton.innerHTML=L.TEXT_CLOSED,d.addClass(this.__closeButton,L.CLASS_CLOSE_BUTTON),this.domElement.appendChild(this.__closeButton),d.bind(this.__closeButton,"click",function(){n.closed=!n.closed})}else{void 0===e.closed&&(e.closed=!0);var o=document.createTextNode(e.name);d.addClass(o,"controller-name"),i=v(n,o),d.addClass(this.__ul,L.CLASS_CLOSED),d.addClass(i,"title"),d.bind(i,"click",function(e){return e.preventDefault(),n.closed=!n.closed,!1}),e.closed||(this.closed=!1)}e.autoPlace&&(p.isUndefined(e.parent)&&(A&&(C=document.createElement("div"),d.addClass(C,"dg"),d.addClass(C,L.CLASS_AUTO_PLACE_CONTAINER),document.body.appendChild(C),A=!1),C.appendChild(this.domElement),d.addClass(this.domElement,L.CLASS_AUTO_PLACE)),this.parent||T(n,e.width)),d.bind(window,"resize",function(){n.onResize()}),d.bind(this.__ul,"webkitTransitionEnd",function(){n.onResize()}),d.bind(this.__ul,"transitionend",function(){n.onResize()}),d.bind(this.__ul,"oTransitionEnd",function(){n.onResize()}),this.onResize(),e.resizable&&x(this),n.getRoot(),e.parent||function(){var e=n.getRoot();e.width+=1,p.defer(function(){e.width-=1})}()};return L.toggleHide=function(){P=!P,p.each(D,function(e){e.domElement.style.zIndex=P?-999:999,e.domElement.style.opacity=P?0:1})},L.CLASS_AUTO_PLACE="a",L.CLASS_AUTO_PLACE_CONTAINER="ac",L.CLASS_MAIN="main",L.CLASS_CONTROLLER_ROW="cr",L.CLASS_TOO_TALL="taller-than-window",L.CLASS_CLOSED="closed",L.CLASS_CLOSE_BUTTON="close-button",L.CLASS_DRAG="drag",L.DEFAULT_WIDTH=245,L.TEXT_CLOSED="Close Controls",L.TEXT_OPEN="Open Controls",d.bind(window,"keydown",function(e){"text"!==document.activeElement.type&&(72===e.which||72==e.keyCode)&&L.toggleHide()},!1),p.extend(L.prototype,{add:function(e,t){return m(this,e,t,{factoryArgs:Array.prototype.slice.call(arguments,2)})},addColor:function(e,t){return m(this,e,t,{color:!0})},remove:function(e){this.__ul.removeChild(e.__li),this.__controllers.slice(this.__controllers.indexOf(e),1);var t=this;p.defer(function(){t.onResize()})},destroy:function(){this.autoPlace&&C.removeChild(this.domElement)},addFolder:function(e){if(void 0!==this.__folders[e])throw Error('You already have a folder in this GUI by the name "'+e+'"');var t={name:e,parent:this};return t.autoPlace=this.autoPlace,this.load&&this.load.folders&&this.load.folders[e]&&(t.closed=this.load.folders[e].closed,t.load=this.load.folders[e]),t=new L(t),this.__folders[e]=t,e=v(this,t.domElement),d.addClass(e,"folder"),t},open:function(){this.closed=!1},close:function(){this.closed=!0},onResize:function(){var e=this.getRoot();if(e.scrollable){var t=d.getOffset(e.__ul).top,n=0;p.each(e.__ul.childNodes,function(t){e.autoPlace&&t===e.__save_row||(n+=d.getHeight(t))}),window.innerHeight-t-20<n?(d.addClass(e.domElement,L.CLASS_TOO_TALL),e.__ul.style.height=window.innerHeight-t-20+"px"):(d.removeClass(e.domElement,L.CLASS_TOO_TALL),e.__ul.style.height="auto")}e.__resize_handle&&p.defer(function(){e.__resize_handle.style.height=e.__ul.offsetHeight+"px"}),e.__closeButton&&(e.__closeButton.style.width=e.width+"px")},remember:function(){if(p.isUndefined(S)&&(S=new f,S.domElement.innerHTML='<div id="dg-save" class="dg dialogue">\n\n  Here\'s the new load parameter for your <code>GUI</code>\'s constructor:\n\n  <textarea id="dg-new-constructor"></textarea>\n\n  <div id="dg-save-locally">\n\n    <input id="dg-local-storage" type="checkbox"/> Automatically save\n    values to <code>localStorage</code> on exit.\n\n    <div id="dg-local-explain">The values saved to <code>localStorage</code> will\n      override those passed to <code>dat.GUI</code>\'s constructor. This makes it\n      easier to work incrementally, but <code>localStorage</code> is fragile,\n      and your friends may not see the same values you do.\n      \n    </div>\n    \n  </div>\n\n</div>'),this.parent)throw Error("You can only call remember on a top level GUI.");var e=this;p.each(Array.prototype.slice.call(arguments),function(t){0==e.__rememberedObjects.length&&y(e),-1==e.__rememberedObjects.indexOf(t)&&e.__rememberedObjects.push(t)}),this.autoPlace&&T(this,this.width)},getRoot:function(){for(var e=this;e.parent;)e=e.parent;return e},getSaveObject:function(){var e=this.load
;return e.closed=this.closed,this.__rememberedObjects.length>0&&(e.preset=this.preset,e.remembered||(e.remembered={}),e.remembered[this.preset]=b(this)),e.folders={},p.each(this.__folders,function(t,n){e.folders[n]=t.getSaveObject()}),e},save:function(){this.load.remembered||(this.load.remembered={}),this.load.remembered[this.preset]=b(this),w(this,!1)},saveAs:function(e){this.load.remembered||(this.load.remembered={},this.load.remembered[M]=b(this,!0)),this.load.remembered[e]=b(this),this.preset=e,R(this,e,!0)},revert:function(e){p.each(this.__controllers,function(t){this.getRoot().load.remembered?E(e||this.getRoot(),t):t.setValue(t.initialValue)},this),p.each(this.__folders,function(e){e.revert(e)}),e||w(this.getRoot(),!1)},listen:function(e){var t=0==this.__listening.length;this.__listening.push(e),t&&_(this.__listening)}}),L}(dat.utils.css,0,0,dat.controllers.factory=function(e,t,n,r,i,o,a){return function(s,l,c,u){var h=s[l];return a.isArray(c)||a.isObject(c)?new e(s,l,c):a.isNumber(h)?a.isNumber(c)&&a.isNumber(u)?new n(s,l,c,u):new t(s,l,{min:c,max:u}):a.isString(h)?new r(s,l):a.isFunction(h)?new i(s,l,""):a.isBoolean(h)?new o(s,l):void 0}}(dat.controllers.OptionController,dat.controllers.NumberControllerBox,dat.controllers.NumberControllerSlider,dat.controllers.StringController=function(e,t,n){var r=function(e,n){function i(){o.setValue(o.__input.value)}r.superclass.call(this,e,n);var o=this;this.__input=document.createElement("input"),this.__input.setAttribute("type","text"),t.bind(this.__input,"keyup",i),t.bind(this.__input,"change",i),t.bind(this.__input,"blur",function(){o.__onFinishChange&&o.__onFinishChange.call(o,o.getValue())}),t.bind(this.__input,"keydown",function(e){13===e.keyCode&&this.blur()}),this.updateDisplay(),this.domElement.appendChild(this.__input)};return r.superclass=e,n.extend(r.prototype,e.prototype,{updateDisplay:function(){return t.isActive(this.__input)||(this.__input.value=this.getValue()),r.superclass.prototype.updateDisplay.call(this)}}),r}(dat.controllers.Controller,dat.dom.dom,dat.utils.common),dat.controllers.FunctionController,dat.controllers.BooleanController,dat.utils.common),dat.controllers.Controller,dat.controllers.BooleanController,dat.controllers.FunctionController,dat.controllers.NumberControllerBox,dat.controllers.NumberControllerSlider,dat.controllers.OptionController,dat.controllers.ColorController=function(e,t,n,r,i){function o(e,t,n,r){e.style.background="",i.each(l,function(i){e.style.cssText+="background: "+i+"linear-gradient("+t+", "+n+" 0%, "+r+" 100%); "})}function a(e){e.style.background="",e.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);",e.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",e.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",e.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",e.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);"}var s=function(e,l){function c(e){d(e),t.bind(window,"mousemove",d),t.bind(window,"mouseup",u)}function u(){t.unbind(window,"mousemove",d),t.unbind(window,"mouseup",u)}function h(){var e=r(this.value);!1!==e?(m.__color.__state=e,m.setValue(m.__color.toOriginal())):this.value=m.__color.toString()}function f(){t.unbind(window,"mousemove",p),t.unbind(window,"mouseup",f)}function d(e){e.preventDefault();var n=t.getWidth(m.__saturation_field),r=t.getOffset(m.__saturation_field),i=(e.clientX-r.left+document.body.scrollLeft)/n,e=1-(e.clientY-r.top+document.body.scrollTop)/n;return e>1?e=1:e<0&&(e=0),i>1?i=1:i<0&&(i=0),m.__color.v=e,m.__color.s=i,m.setValue(m.__color.toOriginal()),!1}function p(e){e.preventDefault();var n=t.getHeight(m.__hue_field),r=t.getOffset(m.__hue_field),e=1-(e.clientY-r.top+document.body.scrollTop)/n;return e>1?e=1:e<0&&(e=0),m.__color.h=360*e,m.setValue(m.__color.toOriginal()),!1}s.superclass.call(this,e,l),this.__color=new n(this.getValue()),this.__temp=new n(0);var m=this;this.domElement=document.createElement("div"),t.makeSelectable(this.domElement,!1),this.__selector=document.createElement("div"),this.__selector.className="selector",this.__saturation_field=document.createElement("div"),this.__saturation_field.className="saturation-field",this.__field_knob=document.createElement("div"),this.__field_knob.className="field-knob",this.__field_knob_border="2px solid ",this.__hue_knob=document.createElement("div"),this.__hue_knob.className="hue-knob",this.__hue_field=document.createElement("div"),this.__hue_field.className="hue-field",this.__input=document.createElement("input"),this.__input.type="text",this.__input_textShadow="0 1px 1px ",t.bind(this.__input,"keydown",function(e){13===e.keyCode&&h.call(this)}),t.bind(this.__input,"blur",h),t.bind(this.__selector,"mousedown",function(){t.addClass(this,"drag").bind(window,"mouseup",function(){t.removeClass(m.__selector,"drag")})});var v=document.createElement("div");i.extend(this.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"}),i.extend(this.__field_knob.style,{position:"absolute",width:"12px",height:"12px",border:this.__field_knob_border+(this.__color.v<.5?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1}),i.extend(this.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1}),i.extend(this.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"}),i.extend(v.style,{width:"100%",height:"100%",background:"none"}),o(v,"top","rgba(0,0,0,0)","#000"),i.extend(this.__hue_field.style,{width:"15px",height:"100px",display:"inline-block",border:"1px solid #555",cursor:"ns-resize"}),a(this.__hue_field),i.extend(this.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:this.__input_textShadow+"rgba(0,0,0,0.7)"}),t.bind(this.__saturation_field,"mousedown",c),t.bind(this.__field_knob,"mousedown",c),t.bind(this.__hue_field,"mousedown",function(e){p(e),t.bind(window,"mousemove",p),t.bind(window,"mouseup",f)}),this.__saturation_field.appendChild(v),this.__selector.appendChild(this.__field_knob),this.__selector.appendChild(this.__saturation_field),this.__selector.appendChild(this.__hue_field),this.__hue_field.appendChild(this.__hue_knob),this.domElement.appendChild(this.__input),this.domElement.appendChild(this.__selector),this.updateDisplay()};s.superclass=e,i.extend(s.prototype,e.prototype,{updateDisplay:function(){var e=r(this.getValue());if(!1!==e){var t=!1;i.each(n.COMPONENTS,function(n){if(!i.isUndefined(e[n])&&!i.isUndefined(this.__color.__state[n])&&e[n]!==this.__color.__state[n])return t=!0,{}},this),t&&i.extend(this.__color.__state,e)}i.extend(this.__temp.__state,this.__color.__state),this.__temp.a=1;var a=this.__color.v<.5||this.__color.s>.5?255:0,s=255-a;i.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toString(),border:this.__field_knob_border+"rgb("+a+","+a+","+a+")"}),this.__hue_knob.style.marginTop=100*(1-this.__color.h/360)+"px",this.__temp.s=1,this.__temp.v=1,o(this.__saturation_field,"left","#fff",this.__temp.toString()),i.extend(this.__input.style,{backgroundColor:this.__input.value=this.__color.toString(),color:"rgb("+a+","+a+","+a+")",textShadow:this.__input_textShadow+"rgba("+s+","+s+","+s+",.7)"})}});var l=["-moz-","-o-","-webkit-","-ms-",""];return s}(dat.controllers.Controller,dat.dom.dom,dat.color.Color=function(e,t,n,r){function i(e,t,n){Object.defineProperty(e,t,{get:function(){return"RGB"===this.__state.space?this.__state[t]:(a(this,t,n),this.__state[t])},set:function(e){"RGB"!==this.__state.space&&(a(this,t,n),this.__state.space="RGB"),this.__state[t]=e}})}function o(e,t){Object.defineProperty(e,t,{get:function(){return"HSV"===this.__state.space?this.__state[t]:(s(this),this.__state[t])},set:function(e){"HSV"!==this.__state.space&&(s(this),this.__state.space="HSV"),this.__state[t]=e}})}function a(e,n,i){if("HEX"===e.__state.space)e.__state[n]=t.component_from_hex(e.__state.hex,i);else{if("HSV"!==e.__state.space)throw"Corrupted color state";r.extend(e.__state,t.hsv_to_rgb(e.__state.h,e.__state.s,e.__state.v))}}function s(e){var n=t.rgb_to_hsv(e.r,e.g,e.b);r.extend(e.__state,{s:n.s,v:n.v}),r.isNaN(n.h)?r.isUndefined(e.__state.h)&&(e.__state.h=0):e.__state.h=n.h}var l=function(){if(this.__state=e.apply(this,arguments),!1===this.__state)throw"Failed to interpret color arguments";this.__state.a=this.__state.a||1};return l.COMPONENTS="r,g,b,h,s,v,hex,a".split(","),r.extend(l.prototype,{toString:function(){return n(this)},toOriginal:function(){return this.__state.conversion.write(this)}}),i(l.prototype,"r",2),i(l.prototype,"g",1),i(l.prototype,"b",0),o(l.prototype,"h"),o(l.prototype,"s"),o(l.prototype,"v"),Object.defineProperty(l.prototype,"a",{get:function(){return this.__state.a},set:function(e){this.__state.a=e}}),Object.defineProperty(l.prototype,"hex",{get:function(){return"HEX"!==!this.__state.space&&(this.__state.hex=t.rgb_to_hex(this.r,this.g,this.b)),this.__state.hex},set:function(e){this.__state.space="HEX",this.__state.hex=e}}),l}(dat.color.interpret,dat.color.math=function(){var e;return{hsv_to_rgb:function(e,t,n){var r=e/60-Math.floor(e/60),i=n*(1-t),o=n*(1-r*t),t=n*(1-(1-r)*t),e=[[n,t,i],[o,n,i],[i,n,t],[i,o,n],[t,i,n],[n,i,o]][Math.floor(e/60)%6];return{r:255*e[0],g:255*e[1],b:255*e[2]}},rgb_to_hsv:function(e,t,n){var r=Math.min(e,t,n),i=Math.max(e,t,n),r=i-r;return 0==i?{h:NaN,s:0,v:0}:(e=e==i?(t-n)/r:t==i?2+(n-e)/r:4+(e-t)/r,e/=6,e<0&&(e+=1),{h:360*e,s:r/i,v:i/255})},rgb_to_hex:function(e,t,n){return e=this.hex_with_component(0,2,e),e=this.hex_with_component(e,1,t),e=this.hex_with_component(e,0,n)},component_from_hex:function(e,t){return e>>8*t&255},hex_with_component:function(t,n,r){return r<<(e=8*n)|t&~(255<<e)}}}(),dat.color.toString,dat.utils.common),dat.color.interpret,dat.utils.common),dat.utils.requestAnimationFrame=function(){return window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)}}(),dat.dom.CenteredDiv=function(e,t){var n=function(){this.backgroundElement=document.createElement("div"),t.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear"}),e.makeFullscreen(this.backgroundElement),this.backgroundElement.style.position="fixed",this.domElement=document.createElement("div"),t.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear"}),document.body.appendChild(this.backgroundElement),document.body.appendChild(this.domElement);var n=this;e.bind(this.backgroundElement,"click",function(){n.hide()})};return n.prototype.show=function(){var e=this;this.backgroundElement.style.display="block",this.domElement.style.display="block",this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)",this.layout(),t.defer(function(){e.backgroundElement.style.opacity=1,e.domElement.style.opacity=1,e.domElement.style.webkitTransform="scale(1)"})},n.prototype.hide=function(){var t=this,n=function(){t.domElement.style.display="none",t.backgroundElement.style.display="none",e.unbind(t.domElement,"webkitTransitionEnd",n),e.unbind(t.domElement,"transitionend",n),e.unbind(t.domElement,"oTransitionEnd",n)};e.bind(this.domElement,"webkitTransitionEnd",n),e.bind(this.domElement,"transitionend",n),e.bind(this.domElement,"oTransitionEnd",n),this.backgroundElement.style.opacity=0,this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)"},n.prototype.layout=function(){this.domElement.style.left=window.innerWidth/2-e.getWidth(this.domElement)/2+"px",this.domElement.style.top=window.innerHeight/2-e.getHeight(this.domElement)/2+"px"},n}(dat.dom.dom,dat.utils.common),dat.dom.dom,dat.utils.common);var THREE=THREE||{REVISION:"49"};self.Int32Array||(self.Int32Array=Array,self.Float32Array=Array),function(){for(var e=0,t=["ms","moz","webkit","o"],n=0;n<t.length&&!window.requestAnimationFrame;++n)window.requestAnimationFrame=window[t[n]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t[n]+"CancelAnimationFrame"]||window[t[n]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(t){var n=Date.now(),r=Math.max(0,16-(n-e)),i=window.setTimeout(function(){t(n+r)},r);return e=n+r,i}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)})}(),THREE.Clock=function(e){this.autoStart=void 0===e||e,this.elapsedTime=this.oldTime=this.startTime=0,this.running=!1},THREE.Clock.prototype.start=function(){this.oldTime=this.startTime=Date.now(),this.running=!0},THREE.Clock.prototype.stop=function(){this.getElapsedTime(),this.running=!1},THREE.Clock.prototype.getElapsedTime=function(){return this.elapsedTime=this.elapsedTime+this.getDelta()},THREE.Clock.prototype.getDelta=function(){var e=0;if(this.autoStart&&!this.running&&this.start(),this.running){var t=Date.now(),e=.001*(t-this.oldTime);this.oldTime=t,this.elapsedTime=this.elapsedTime+e}return e},THREE.Color=function(e){return void 0!==e&&this.setHex(e),this},THREE.Color.prototype={constructor:THREE.Color,r:1,g:1,b:1,copy:function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this},copyGammaToLinear:function(e){return this.r=e.r*e.r,this.g=e.g*e.g,this.b=e.b*e.b,this},copyLinearToGamma:function(e){return this.r=Math.sqrt(e.r),this.g=Math.sqrt(e.g),this.b=Math.sqrt(e.b),this},convertGammaToLinear:function(){var e=this.r,t=this.g,n=this.b;return this.r=e*e,this.g=t*t,this.b=n*n,this},convertLinearToGamma:function(){return this.r=Math.sqrt(this.r),this.g=Math.sqrt(this.g),this.b=Math.sqrt(this.b),this},setRGB:function(e,t,n){return this.r=e,this.g=t,this.b=n,this},setHSV:function(e,t,n){var r,i,o;if(0===n)this.r=this.g=this.b=0;else switch(r=Math.floor(6*e),i=6*e-r,e=n*(1-t),o=n*(1-t*i),t=n*(1-t*(1-i)),r){case 1:this.r=o,this.g=n,this.b=e;break;case 2:this.r=e,this.g=n,this.b=t;break;case 3:this.r=e,this.g=o,this.b=n;break;case 4:this.r=t,this.g=e,this.b=n;break;case 5:this.r=n,this.g=e,this.b=o;break;case 6:case 0:this.r=n,this.g=t,this.b=e}return this},setHex:function(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,this},lerpSelf:function(e,t){return this.r=this.r+(e.r-this.r)*t,this.g=this.g+(e.g-this.g)*t,this.b=this.b+(e.b-this.b)*t,this},getHex:function(){return Math.floor(255*this.r)<<16^Math.floor(255*this.g)<<8^Math.floor(255*this.b)},getContextStyle:function(){return"rgb("+Math.floor(255*this.r)+","+Math.floor(255*this.g)+","+Math.floor(255*this.b)+")"},clone:function(){return(new THREE.Color).setRGB(this.r,this.g,this.b)}},THREE.Vector2=function(e,t){this.x=e||0,this.y=t||0},THREE.Vector2.prototype={constructor:THREE.Vector2,set:function(e,t){return this.x=e,this.y=t,this},copy:function(e){return this.x=e.x,this.y=e.y,this},add:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this},addSelf:function(e){return this.x=this.x+e.x,this.y=this.y+e.y,this},sub:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this},subSelf:function(e){return this.x=this.x-e.x,this.y=this.y-e.y,this},multiplyScalar:function(e){return this.x=this.x*e,this.y=this.y*e,this},divideScalar:function(e){return e?(this.x=this.x/e,this.y=this.y/e):this.set(0,0),this},negate:function(){return this.multiplyScalar(-1)},dot:function(e){return this.x*e.x+this.y*e.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.lengthSq())},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,e=this.y-e.y;return t*t+e*e},setLength:function(e){return this.normalize().multiplyScalar(e)},lerpSelf:function(e,t){return this.x=this.x+(e.x-this.x)*t,this.y=this.y+(e.y-this.y)*t,this},equals:function(e){return e.x===this.x&&e.y===this.y},isZero:function(){return this.lengthSq()<1e-4},clone:function(){return new THREE.Vector2(this.x,this.y)}},THREE.Vector3=function(e,t,n){this.x=e||0,this.y=t||0,this.z=n||0},THREE.Vector3.prototype={constructor:THREE.Vector3,set:function(e,t,n){return this.x=e,this.y=t,this.z=n,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},add:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this},addSelf:function(e){return this.x=this.x+e.x,this.y=this.y+e.y,this.z=this.z+e.z,this},addScalar:function(e){return this.x=this.x+e,this.y=this.y+e,this.z=this.z+e,this},sub:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this},subSelf:function(e){return this.x=this.x-e.x,this.y=this.y-e.y,this.z=this.z-e.z,this},multiply:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this},multiplySelf:function(e){return this.x=this.x*e.x,this.y=this.y*e.y,this.z=this.z*e.z,this},multiplyScalar:function(e){return this.x=this.x*e,this.y=this.y*e,this.z=this.z*e,this},divideSelf:function(e){return this.x=this.x/e.x,this.y=this.y/e.y,this.z=this.z/e.z,this},divideScalar:function(e){return e?(this.x=this.x/e,this.y=this.y/e,this.z=this.z/e):this.z=this.y=this.x=0,this},negate:function(){return this.multiplyScalar(-1)},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.lengthSq())},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},setLength:function(e){return this.normalize().multiplyScalar(e)},lerpSelf:function(e,t){return this.x=this.x+(e.x-this.x)*t,this.y=this.y+(e.y-this.y)*t,this.z=this.z+(e.z-this.z)*t,this},cross:function(e,t){return this.x=e.y*t.z-e.z*t.y,this.y=e.z*t.x-e.x*t.z,this.z=e.x*t.y-e.y*t.x,this},crossSelf:function(e){var t=this.x,n=this.y,r=this.z;return this.x=n*e.z-r*e.y,this.y=r*e.x-t*e.z,this.z=t*e.y-n*e.x,this},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){return(new THREE.Vector3).sub(this,e).lengthSq()},getPositionFromMatrix:function(e){return this.x=e.elements[12],this.y=e.elements[13],this.z=e.elements[14],this},getRotationFromMatrix:function(e,t){var n=t?t.x:1,r=t?t.y:1,i=t?t.z:1,o=e.elements[0]/n,a=e.elements[4]/r,n=e.elements[1]/n,r=e.elements[5]/r,s=e.elements[9]/i,l=e.elements[10]/i;return this.y=Math.asin(e.elements[8]/i),i=Math.cos(this.y),Math.abs(i)>1e-5?(this.x=Math.atan2(-s/i,l/i),this.z=Math.atan2(-a/i,o/i)):(this.x=0,this.z=Math.atan2(n,r)),this},getScaleFromMatrix:function(e){var t=this.set(e.elements[0],e.elements[1],e.elements[2]).length(),n=this.set(e.elements[4],e.elements[5],e.elements[6]).length(),e=this.set(e.elements[8],e.elements[9],e.elements[10]).length();this.x=t,this.y=n,this.z=e},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z},isZero:function(){return this.lengthSq()<1e-4},clone:function(){return new THREE.Vector3(this.x,this.y,this.z)}},THREE.Vector4=function(e,t,n,r){this.x=e||0,this.y=t||0,this.z=n||0,this.w=void 0!==r?r:1},THREE.Vector4.prototype={constructor:THREE.Vector4,set:function(e,t,n,r){return this.x=e,this.y=t,this.z=n,this.w=r,this},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this},add:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this},addSelf:function(e){return this.x=this.x+e.x,this.y=this.y+e.y,this.z=this.z+e.z,this.w=this.w+e.w,this},sub:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this},subSelf:function(e){return this.x=this.x-e.x,this.y=this.y-e.y,this.z=this.z-e.z,this.w=this.w-e.w,this},multiplyScalar:function(e){return this.x=this.x*e,this.y=this.y*e,this.z=this.z*e,this.w=this.w*e,this},divideScalar:function(e){return e?(this.x=this.x/e,this.y=this.y/e,this.z=this.z/e,this.w=this.w/e):(this.z=this.y=this.x=0,this.w=1),this},negate:function(){return this.multiplyScalar(-1)},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w},lengthSq:function(){return this.dot(this)},length:function(){return Math.sqrt(this.lengthSq())},normalize:function(){return this.divideScalar(this.length())},setLength:function(e){return this.normalize().multiplyScalar(e)},lerpSelf:function(e,t){return this.x=this.x+(e.x-this.x)*t,this.y=this.y+(e.y-this.y)*t,this.z=this.z+(e.z-this.z)*t,this.w=this.w+(e.w-this.w)*t,this},clone:function(){return new THREE.Vector4(this.x,this.y,this.z,this.w)}},THREE.Frustum=function(){this.planes=[new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4]},THREE.Frustum.prototype.setFromMatrix=function(e){var t,n=this.planes,r=e.elements,e=r[0];t=r[1];var i=r[2],o=r[3],a=r[4],s=r[5],l=r[6],c=r[7],u=r[8],h=r[9],f=r[10],d=r[11],p=r[12],m=r[13],v=r[14],r=r[15];for(n[0].set(o-e,c-a,d-u,r-p),n[1].set(o+e,c+a,d+u,r+p),n[2].set(o+t,c+s,d+h,r+m),n[3].set(o-t,c-s,d-h,r-m),n[4].set(o-i,c-l,d-f,r-v),n[5].set(o+i,c+l,d+f,r+v),e=0;e<6;e++)t=n[e],t.divideScalar(Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z))},THREE.Frustum.prototype.contains=function(e){for(var t=this.planes,n=e.matrixWorld,r=n.elements,n=-e.geometry.boundingSphere.radius*n.getMaxScaleOnAxis(),i=0;i<6;i++)if((e=t[i].x*r[12]+t[i].y*r[13]+t[i].z*r[14]+t[i].w)<=n)return!1;return!0},THREE.Frustum.__v1=new THREE.Vector3,THREE.Ray=function(e,t){function n(e,t,n){return _.sub(n,e),p=_.dot(t),m=H.add(e,M.copy(t).multiplyScalar(p)),v=n.distanceTo(m)}function r(e,t,n,r){return _.sub(r,t),H.sub(n,t),M.sub(e,t),g=_.dot(_),E=_.dot(H),y=_.dot(M),x=H.dot(H),T=H.dot(M),b=1/(g*x-E*E),R=(x*y-E*T)*b,w=(g*T-E*y)*b,R>=0&&w>=0&&R+w<1}this.origin=e||new THREE.Vector3,this.direction=t||new THREE.Vector3;var i=1e-4;this.setPrecision=function(e){i=e};var o=new THREE.Vector3,a=new THREE.Vector3,s=new THREE.Vector3,l=new THREE.Vector3,c=new THREE.Vector3,u=new THREE.Vector3,h=new THREE.Vector3,f=new THREE.Vector3,d=new THREE.Vector3;this.intersectObject=function(e){var t,p=[];if(e instanceof THREE.Particle){var m=n(this.origin,this.direction,e.matrixWorld.getPosition());if(m>e.scale.x)return[];t={distance:m,point:e.position,face:null,object:e},p.push(t)}else if(e instanceof THREE.Mesh){var m=n(this.origin,this.direction,e.matrixWorld.getPosition()),v=THREE.Frustum.__v1.set(e.matrixWorld.getColumnX().length(),e.matrixWorld.getColumnY().length(),e.matrixWorld.getColumnZ().length());if(m>e.geometry.boundingSphere.radius*Math.max(v.x,Math.max(v.y,v.z)))return p;var g,E,y,x=e.geometry,T=x.vertices;for(e.matrixRotationWorld.extractRotation(e.matrixWorld),m=0,v=x.faces.length;m<v;m++)t=x.faces[m],c.copy(this.origin),u.copy(this.direction),y=e.matrixWorld,h=y.multiplyVector3(h.copy(t.centroid)).subSelf(c),f=e.matrixRotationWorld.multiplyVector3(f.copy(t.normal)),g=u.dot(f),Math.abs(g)<i||(E=f.dot(h)/g)<0||!e.doubleSided&&!(e.flipSided?g>0:g<0)||(d.add(c,u.multiplyScalar(E)),t instanceof THREE.Face3?(o=y.multiplyVector3(o.copy(T[t.a])),a=y.multiplyVector3(a.copy(T[t.b])),s=y.multiplyVector3(s.copy(T[t.c])),r(d,o,a,s)&&(t={distance:c.distanceTo(d),point:d.clone(),face:t,object:e},p.push(t))):t instanceof THREE.Face4&&(o=y.multiplyVector3(o.copy(T[t.a])),a=y.multiplyVector3(a.copy(T[t.b])),s=y.multiplyVector3(s.copy(T[t.c])),l=y.multiplyVector3(l.copy(T[t.d])),(r(d,o,a,l)||r(d,a,s,l))&&(t={distance:c.distanceTo(d),point:d.clone(),face:t,object:e},p.push(t))))}return p},this.intersectObjects=function(e){for(var t=[],n=0,r=e.length;n<r;n++)Array.prototype.push.apply(t,this.intersectObject(e[n]));return t.sort(function(e,t){return e.distance-t.distance}),t};var p,m,v,g,E,y,x,T,b,R,w,_=new THREE.Vector3,H=new THREE.Vector3,M=new THREE.Vector3},THREE.Rectangle=function(){function e(){o=r-t,a=i-n}var t,n,r,i,o,a,s=!0;this.getX=function(){return t},this.getY=function(){return n},this.getWidth=function(){return o},this.getHeight=function(){return a},this.getLeft=function(){return t},this.getTop=function(){return n},this.getRight=function(){return r},this.getBottom=function(){return i},this.set=function(o,a,l,c){s=!1,t=o,n=a,r=l,i=c,e()},this.addPoint=function(o,a){s?(s=!1,t=o,n=a,r=o,i=a):(t=t<o?t:o,n=n<a?n:a,r=r>o?r:o,i=i>a?i:a),e()},this.add3Points=function(o,a,l,c,u,h){s?(s=!1,t=o<l?o<u?o:u:l<u?l:u,n=a<c?a<h?a:h:c<h?c:h,r=o>l?o>u?o:u:l>u?l:u,i=a>c?a>h?a:h:c>h?c:h):(t=o<l?o<u?o<t?o:t:u<t?u:t:l<u?l<t?l:t:u<t?u:t,n=a<c?a<h?a<n?a:n:h<n?h:n:c<h?c<n?c:n:h<n?h:n,r=o>l?o>u?o>r?o:r:u>r?u:r:l>u?l>r?l:r:u>r?u:r,i=a>c?a>h?a>i?a:i:h>i?h:i:c>h?c>i?c:i:h>i?h:i),e()},this.addRectangle=function(o){s?(s=!1,t=o.getLeft(),n=o.getTop(),r=o.getRight(),i=o.getBottom()):(t=t<o.getLeft()?t:o.getLeft(),n=n<o.getTop()?n:o.getTop(),r=r>o.getRight()?r:o.getRight(),i=i>o.getBottom()?i:o.getBottom()),e()},this.inflate=function(o){t-=o,n-=o,r+=o,i+=o,e()},this.minSelf=function(o){t=t>o.getLeft()?t:o.getLeft(),n=n>o.getTop()?n:o.getTop(),r=r<o.getRight()?r:o.getRight(),i=i<o.getBottom()?i:o.getBottom(),e()},this.intersects=function(e){return!(r<e.getLeft()||t>e.getRight()||i<e.getTop()||n>e.getBottom())},this.empty=function(){s=!0,i=r=n=t=0,e()},this.isEmpty=function(){return s}},THREE.Math={clamp:function(e,t,n){return e<t?t:e>n?n:e},clampBottom:function(e,t){return e<t?t:e},mapLinear:function(e,t,n,r,i){return r+(e-t)*(i-r)/(n-t)},random16:function(){return(65280*Math.random()+255*Math.random())/65535},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},sign:function(e){return e<0?-1:e>0?1:0}},THREE.Matrix3=function(){this.elements=new Float32Array(9)},THREE.Matrix3.prototype={constructor:THREE.Matrix3,getInverse:function(e){var t=e.elements,e=t[10]*t[5]-t[6]*t[9],n=-t[10]*t[1]+t[2]*t[9],r=t[6]*t[1]-t[2]*t[5],i=-t[10]*t[4]+t[6]*t[8],o=t[10]*t[0]-t[2]*t[8],a=-t[6]*t[0]+t[2]*t[4],s=t[9]*t[4]-t[5]*t[8],l=-t[9]*t[0]+t[1]*t[8],c=t[5]*t[0]-t[1]*t[4],t=t[0]*e+t[1]*i+t[2]*s;0===t&&console.warn("Matrix3.getInverse(): determinant == 0");var t=1/t,u=this.elements;return u[0]=t*e,u[1]=t*n,u[2]=t*r,u[3]=t*i,u[4]=t*o,u[5]=t*a,u[6]=t*s,u[7]=t*l,u[8]=t*c,this},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this},transposeIntoArray:function(e){var t=this.m;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}},THREE.Matrix4=function(e,t,n,r,i,o,a,s,l,c,u,h,f,d,p,m){this.elements=new Float32Array(16),this.set(void 0!==e?e:1,t||0,n||0,r||0,i||0,void 0!==o?o:1,a||0,s||0,l||0,c||0,void 0!==u?u:1,h||0,f||0,d||0,p||0,void 0!==m?m:1)},THREE.Matrix4.prototype={constructor:THREE.Matrix4,set:function(e,t,n,r,i,o,a,s,l,c,u,h,f,d,p,m){var v=this.elements;return v[0]=e,v[4]=t,v[8]=n,v[12]=r,v[1]=i,v[5]=o,v[9]=a,v[13]=s,v[2]=l,v[6]=c,v[10]=u,v[14]=h,v[3]=f,v[7]=d,v[11]=p,v[15]=m,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},copy:function(e){return e=e.elements,this.set(e[0],e[4],e[8],e[12],e[1],e[5],e[9],e[13],e[2],e[6],e[10],e[14],e[3],e[7],e[11],e[15]),this},lookAt:function(e,t,n){var r=this.elements,i=THREE.Matrix4.__v1,o=THREE.Matrix4.__v2,a=THREE.Matrix4.__v3;return a.sub(e,t).normalize(),0===a.length()&&(a.z=1),i.cross(n,a).normalize(),0===i.length()&&(a.x=a.x+1e-4,i.cross(n,a).normalize()),o.cross(a,i),r[0]=i.x,r[4]=o.x,r[8]=a.x,r[1]=i.y,r[5]=o.y,r[9]=a.y,r[2]=i.z,r[6]=o.z,r[10]=a.z,this},multiply:function(e,t){var n=e.elements,r=t.elements,i=this.elements,o=n[0],a=n[4],s=n[8],l=n[12],c=n[1],u=n[5],h=n[9],f=n[13],d=n[2],p=n[6],m=n[10],v=n[14],g=n[3],E=n[7],y=n[11],n=n[15],x=r[0],T=r[4],b=r[8],R=r[12],w=r[1],_=r[5],H=r[9],M=r[13],S=r[2],C=r[6],A=r[10],P=r[14],D=r[3],L=r[7],N=r[11],r=r[15];return i[0]=o*x+a*w+s*S+l*D,i[4]=o*T+a*_+s*C+l*L,i[8]=o*b+a*H+s*A+l*N,i[12]=o*R+a*M+s*P+l*r,i[1]=c*x+u*w+h*S+f*D,i[5]=c*T+u*_+h*C+f*L,i[9]=c*b+u*H+h*A+f*N,i[13]=c*R+u*M+h*P+f*r,i[2]=d*x+p*w+m*S+v*D,i[6]=d*T+p*_+m*C+v*L,i[10]=d*b+p*H+m*A+v*N,i[14]=d*R+p*M+m*P+v*r,i[3]=g*x+E*w+y*S+n*D,i[7]=g*T+E*_+y*C+n*L,i[11]=g*b+E*H+y*A+n*N,i[15]=g*R+E*M+y*P+n*r,this},multiplySelf:function(e){return this.multiply(this,e)},multiplyToArray:function(e,t,n){var r=this.elements;return this.multiply(e,t),n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=r[3],n[4]=r[4],n[5]=r[5],n[6]=r[6],n[7]=r[7],n[8]=r[8],n[9]=r[9],n[10]=r[10],n[11]=r[11],n[12]=r[12],n[13]=r[13],n[14]=r[14],n[15]=r[15],this},multiplyScalar:function(e){var t=this.elements;return t[0]=t[0]*e,t[4]=t[4]*e,t[8]=t[8]*e,t[12]=t[12]*e,t[1]=t[1]*e,t[5]=t[5]*e,t[9]=t[9]*e,t[13]=t[13]*e,t[2]=t[2]*e,t[6]=t[6]*e,t[10]=t[10]*e,t[14]=t[14]*e,t[3]=t[3]*e,t[7]=t[7]*e,t[11]=t[11]*e,t[15]=t[15]*e,this},multiplyVector3:function(e){var t=this.elements,n=e.x,r=e.y,i=e.z,o=1/(t[3]*n+t[7]*r+t[11]*i+t[15]);return e.x=(t[0]*n+t[4]*r+t[8]*i+t[12])*o,e.y=(t[1]*n+t[5]*r+t[9]*i+t[13])*o,e.z=(t[2]*n+t[6]*r+t[10]*i+t[14])*o,e},multiplyVector4:function(e){var t=this.elements,n=e.x,r=e.y,i=e.z,o=e.w;return e.x=t[0]*n+t[4]*r+t[8]*i+t[12]*o,e.y=t[1]*n+t[5]*r+t[9]*i+t[13]*o,e.z=t[2]*n+t[6]*r+t[10]*i+t[14]*o,e.w=t[3]*n+t[7]*r+t[11]*i+t[15]*o,e},rotateAxis:function(e){var t=this.elements,n=e.x,r=e.y,i=e.z;return e.x=n*t[0]+r*t[4]+i*t[8],e.y=n*t[1]+r*t[5]+i*t[9],e.z=n*t[2]+r*t[6]+i*t[10],e.normalize(),e},crossVector:function(e){var t=this.elements,n=new THREE.Vector4;return n.x=t[0]*e.x+t[4]*e.y+t[8]*e.z+t[12]*e.w,n.y=t[1]*e.x+t[5]*e.y+t[9]*e.z+t[13]*e.w,n.z=t[2]*e.x+t[6]*e.y+t[10]*e.z+t[14]*e.w,n.w=e.w?t[3]*e.x+t[7]*e.y+t[11]*e.z+t[15]*e.w:1,n},determinant:function(){var e=this.elements,t=e[0],n=e[4],r=e[8],i=e[12],o=e[1],a=e[5],s=e[9],l=e[13],c=e[2],u=e[6],h=e[10],f=e[14],d=e[3],p=e[7],m=e[11],e=e[15];return i*s*u*d-r*l*u*d-i*a*h*d+n*l*h*d+r*a*f*d-n*s*f*d-i*s*c*p+r*l*c*p+i*o*h*p-t*l*h*p-r*o*f*p+t*s*f*p+i*a*c*m-n*l*c*m-i*o*u*m+t*l*u*m+n*o*f*m-t*a*f*m-r*a*c*e+n*s*c*e+r*o*u*e-t*s*u*e-n*o*h*e+t*a*h*e},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this},flattenToArray:function(e){var t=this.elements;return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},flattenToArrayOffset:function(e,t){var n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e},getPosition:function(){var e=this.elements;return THREE.Matrix4.__v1.set(e[12],e[13],e[14])},setPosition:function(e){var t=this.elements;return t[12]=e.x,t[13]=e.y,t[14]=e.z,this},getColumnX:function(){var e=this.elements;return THREE.Matrix4.__v1.set(e[0],e[1],e[2])},getColumnY:function(){var e=this.elements;return THREE.Matrix4.__v1.set(e[4],e[5],e[6])},getColumnZ:function(){var e=this.elements;return THREE.Matrix4.__v1.set(e[8],e[9],e[10])},getInverse:function(e){var t=this.elements,n=e.elements,r=n[0],i=n[4],o=n[8],a=n[12],s=n[1],l=n[5],c=n[9],u=n[13],h=n[2],f=n[6],d=n[10],p=n[14],m=n[3],v=n[7],g=n[11],n=n[15]
;return t[0]=c*p*v-u*d*v+u*f*g-l*p*g-c*f*n+l*d*n,t[4]=a*d*v-o*p*v-a*f*g+i*p*g+o*f*n-i*d*n,t[8]=o*u*v-a*c*v+a*l*g-i*u*g-o*l*n+i*c*n,t[12]=a*c*f-o*u*f-a*l*d+i*u*d+o*l*p-i*c*p,t[1]=u*d*m-c*p*m-u*h*g+s*p*g+c*h*n-s*d*n,t[5]=o*p*m-a*d*m+a*h*g-r*p*g-o*h*n+r*d*n,t[9]=a*c*m-o*u*m-a*s*g+r*u*g+o*s*n-r*c*n,t[13]=o*u*h-a*c*h+a*s*d-r*u*d-o*s*p+r*c*p,t[2]=l*p*m-u*f*m+u*h*v-s*p*v-l*h*n+s*f*n,t[6]=a*f*m-i*p*m-a*h*v+r*p*v+i*h*n-r*f*n,t[10]=i*u*m-a*l*m+a*s*v-r*u*v-i*s*n+r*l*n,t[14]=a*l*h-i*u*h-a*s*f+r*u*f+i*s*p-r*l*p,t[3]=c*f*m-l*d*m-c*h*v+s*d*v+l*h*g-s*f*g,t[7]=i*d*m-o*f*m+o*h*v-r*d*v-i*h*g+r*f*g,t[11]=o*l*m-i*c*m-o*s*v+r*c*v+i*s*g-r*l*g,t[15]=i*c*h-o*l*h+o*s*f-r*c*f-i*s*d+r*l*d,this.multiplyScalar(1/e.determinant()),this},setRotationFromEuler:function(e,t){var n=this.elements,r=e.x,i=e.y,o=e.z,a=Math.cos(r),r=Math.sin(r),s=Math.cos(i),i=Math.sin(i),l=Math.cos(o),o=Math.sin(o);switch(t){case"YXZ":var c=s*l,u=s*o,h=i*l,f=i*o;n[0]=c+f*r,n[4]=h*r-u,n[8]=a*i,n[1]=a*o,n[5]=a*l,n[9]=-r,n[2]=u*r-h,n[6]=f+c*r,n[10]=a*s;break;case"ZXY":c=s*l,u=s*o,h=i*l,f=i*o,n[0]=c-f*r,n[4]=-a*o,n[8]=h+u*r,n[1]=u+h*r,n[5]=a*l,n[9]=f-c*r,n[2]=-a*i,n[6]=r,n[10]=a*s;break;case"ZYX":c=a*l,u=a*o,h=r*l,f=r*o,n[0]=s*l,n[4]=h*i-u,n[8]=c*i+f,n[1]=s*o,n[5]=f*i+c,n[9]=u*i-h,n[2]=-i,n[6]=r*s,n[10]=a*s;break;case"YZX":c=a*s,u=a*i,h=r*s,f=r*i,n[0]=s*l,n[4]=f-c*o,n[8]=h*o+u,n[1]=o,n[5]=a*l,n[9]=-r*l,n[2]=-i*l,n[6]=u*o+h,n[10]=c-f*o;break;case"XZY":c=a*s,u=a*i,h=r*s,f=r*i,n[0]=s*l,n[4]=-o,n[8]=i*l,n[1]=c*o+f,n[5]=a*l,n[9]=u*o-h,n[2]=h*o-u,n[6]=r*l,n[10]=f*o+c;break;default:c=a*l,u=a*o,h=r*l,f=r*o,n[0]=s*l,n[4]=-s*o,n[8]=i,n[1]=u+h*i,n[5]=c-f*i,n[9]=-r*s,n[2]=f-c*i,n[6]=h+u*i,n[10]=a*s}return this},setRotationFromQuaternion:function(e){var t=this.elements,n=e.x,r=e.y,i=e.z,o=e.w,a=n+n,s=r+r,l=i+i,e=n*a,c=n*s,n=n*l,u=r*s,r=r*l,i=i*l,a=o*a,s=o*s,o=o*l;return t[0]=1-(u+i),t[4]=c-o,t[8]=n+s,t[1]=c+o,t[5]=1-(e+i),t[9]=r-a,t[2]=n-s,t[6]=r+a,t[10]=1-(e+u),this},compose:function(e,t,n){var r=this.elements,i=THREE.Matrix4.__m1,o=THREE.Matrix4.__m2;return i.identity(),i.setRotationFromQuaternion(t),o.makeScale(n.x,n.y,n.z),this.multiply(i,o),r[12]=e.x,r[13]=e.y,r[14]=e.z,this},decompose:function(e,t,n){var r=this.elements,i=THREE.Matrix4.__v1,o=THREE.Matrix4.__v2,a=THREE.Matrix4.__v3;return i.set(r[0],r[1],r[2]),o.set(r[4],r[5],r[6]),a.set(r[8],r[9],r[10]),e=e instanceof THREE.Vector3?e:new THREE.Vector3,t=t instanceof THREE.Quaternion?t:new THREE.Quaternion,n=n instanceof THREE.Vector3?n:new THREE.Vector3,n.x=i.length(),n.y=o.length(),n.z=a.length(),e.x=r[12],e.y=r[13],e.z=r[14],r=THREE.Matrix4.__m1,r.copy(this),r.elements[0]=r.elements[0]/n.x,r.elements[1]=r.elements[1]/n.x,r.elements[2]=r.elements[2]/n.x,r.elements[4]=r.elements[4]/n.y,r.elements[5]=r.elements[5]/n.y,r.elements[6]=r.elements[6]/n.y,r.elements[8]=r.elements[8]/n.z,r.elements[9]=r.elements[9]/n.z,r.elements[10]=r.elements[10]/n.z,t.setFromRotationMatrix(r),[e,t,n]},extractPosition:function(e){var t=this.elements,e=e.elements;return t[12]=e[12],t[13]=e[13],t[14]=e[14],this},extractRotation:function(e){var t=this.elements,e=e.elements,n=THREE.Matrix4.__v1,r=1/n.set(e[0],e[1],e[2]).length(),i=1/n.set(e[4],e[5],e[6]).length(),n=1/n.set(e[8],e[9],e[10]).length();return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[8]=e[8]*n,t[9]=e[9]*n,t[10]=e[10]*n,this},translate:function(e){var t=this.elements,n=e.x,r=e.y,e=e.z;return t[12]=t[0]*n+t[4]*r+t[8]*e+t[12],t[13]=t[1]*n+t[5]*r+t[9]*e+t[13],t[14]=t[2]*n+t[6]*r+t[10]*e+t[14],t[15]=t[3]*n+t[7]*r+t[11]*e+t[15],this},rotateX:function(e){var t=this.elements,n=t[4],r=t[5],i=t[6],o=t[7],a=t[8],s=t[9],l=t[10],c=t[11],u=Math.cos(e),e=Math.sin(e);return t[4]=u*n+e*a,t[5]=u*r+e*s,t[6]=u*i+e*l,t[7]=u*o+e*c,t[8]=u*a-e*n,t[9]=u*s-e*r,t[10]=u*l-e*i,t[11]=u*c-e*o,this},rotateY:function(e){var t=this.elements,n=t[0],r=t[1],i=t[2],o=t[3],a=t[8],s=t[9],l=t[10],c=t[11],u=Math.cos(e),e=Math.sin(e);return t[0]=u*n-e*a,t[1]=u*r-e*s,t[2]=u*i-e*l,t[3]=u*o-e*c,t[8]=u*a+e*n,t[9]=u*s+e*r,t[10]=u*l+e*i,t[11]=u*c+e*o,this},rotateZ:function(e){var t=this.elements,n=t[0],r=t[1],i=t[2],o=t[3],a=t[4],s=t[5],l=t[6],c=t[7],u=Math.cos(e),e=Math.sin(e);return t[0]=u*n+e*a,t[1]=u*r+e*s,t[2]=u*i+e*l,t[3]=u*o+e*c,t[4]=u*a-e*n,t[5]=u*s-e*r,t[6]=u*l-e*i,t[7]=u*c-e*o,this},rotateByAxis:function(e,t){var n=this.elements;if(1===e.x&&0===e.y&&0===e.z)return this.rotateX(t);if(0===e.x&&1===e.y&&0===e.z)return this.rotateY(t);if(0===e.x&&0===e.y&&1===e.z)return this.rotateZ(t);var r=e.x,i=e.y,o=e.z,a=Math.sqrt(r*r+i*i+o*o),r=r/a,i=i/a,o=o/a,a=r*r,s=i*i,l=o*o,c=Math.cos(t),u=Math.sin(t),h=1-c,f=r*i*h,d=r*o*h,h=i*o*h,r=r*u,p=i*u,u=o*u,o=a+(1-a)*c,a=f+u,i=d-p,f=f-u,s=s+(1-s)*c,u=h+r,d=d+p,h=h-r,l=l+(1-l)*c,c=n[0],r=n[1],p=n[2],m=n[3],v=n[4],g=n[5],E=n[6],y=n[7],x=n[8],T=n[9],b=n[10],R=n[11];return n[0]=o*c+a*v+i*x,n[1]=o*r+a*g+i*T,n[2]=o*p+a*E+i*b,n[3]=o*m+a*y+i*R,n[4]=f*c+s*v+u*x,n[5]=f*r+s*g+u*T,n[6]=f*p+s*E+u*b,n[7]=f*m+s*y+u*R,n[8]=d*c+h*v+l*x,n[9]=d*r+h*g+l*T,n[10]=d*p+h*E+l*b,n[11]=d*m+h*y+l*R,this},scale:function(e){var t=this.elements,n=e.x,r=e.y,e=e.z;return t[0]=t[0]*n,t[4]=t[4]*r,t[8]=t[8]*e,t[1]=t[1]*n,t[5]=t[5]*r,t[9]=t[9]*e,t[2]=t[2]*n,t[6]=t[6]*r,t[10]=t[10]*e,t[3]=t[3]*n,t[7]=t[7]*r,t[11]=t[11]*e,this},getMaxScaleOnAxis:function(){var e=this.elements;return Math.sqrt(Math.max(e[0]*e[0]+e[1]*e[1]+e[2]*e[2],Math.max(e[4]*e[4]+e[5]*e[5]+e[6]*e[6],e[8]*e[8]+e[9]*e[9]+e[10]*e[10])))},makeTranslation:function(e,t,n){return this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this},makeRotationX:function(e){var t=Math.cos(e),e=Math.sin(e);return this.set(1,0,0,0,0,t,-e,0,0,e,t,0,0,0,0,1),this},makeRotationY:function(e){var t=Math.cos(e),e=Math.sin(e);return this.set(t,0,e,0,0,1,0,0,-e,0,t,0,0,0,0,1),this},makeRotationZ:function(e){var t=Math.cos(e),e=Math.sin(e);return this.set(t,-e,0,0,e,t,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(e,t){var n=Math.cos(t),r=Math.sin(t),i=1-n,o=e.x,a=e.y,s=e.z,l=i*o,c=i*a;return this.set(l*o+n,l*a-r*s,l*s+r*a,0,l*a+r*s,c*a+n,c*s-r*o,0,l*s-r*a,c*s+r*o,i*s*s+n,0,0,0,0,1),this},makeScale:function(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this},makeFrustum:function(e,t,n,r,i,o){var a=this.elements;return a[0]=2*i/(t-e),a[4]=0,a[8]=(t+e)/(t-e),a[12]=0,a[1]=0,a[5]=2*i/(r-n),a[9]=(r+n)/(r-n),a[13]=0,a[2]=0,a[6]=0,a[10]=-(o+i)/(o-i),a[14]=-2*o*i/(o-i),a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this},makePerspective:function(e,t,n,r){var e=n*Math.tan(e*Math.PI/360),i=-e;return this.makeFrustum(i*t,e*t,i,e,n,r)},makeOrthographic:function(e,t,n,r,i,o){var a=this.elements,s=t-e,l=n-r,c=o-i;return a[0]=2/s,a[4]=0,a[8]=0,a[12]=-(t+e)/s,a[1]=0,a[5]=2/l,a[9]=0,a[13]=-(n+r)/l,a[2]=0,a[6]=0,a[10]=-2/c,a[14]=-(o+i)/c,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this},clone:function(){var e=this.elements;return new THREE.Matrix4(e[0],e[4],e[8],e[12],e[1],e[5],e[9],e[13],e[2],e[6],e[10],e[14],e[3],e[7],e[11],e[15])}},THREE.Matrix4.__v1=new THREE.Vector3,THREE.Matrix4.__v2=new THREE.Vector3,THREE.Matrix4.__v3=new THREE.Vector3,THREE.Matrix4.__m1=new THREE.Matrix4,THREE.Matrix4.__m2=new THREE.Matrix4,THREE.Object3D=function(){this.id=THREE.Object3DCount++,this.name="",this.parent=void 0,this.children=[],this.up=new THREE.Vector3(0,1,0),this.position=new THREE.Vector3,this.rotation=new THREE.Vector3,this.eulerOrder="XYZ",this.scale=new THREE.Vector3(1,1,1),this.flipSided=this.doubleSided=!1,this.renderDepth=null,this.rotationAutoUpdate=!0,this.matrix=new THREE.Matrix4,this.matrixWorld=new THREE.Matrix4,this.matrixRotationWorld=new THREE.Matrix4,this.matrixWorldNeedsUpdate=this.matrixAutoUpdate=!0,this.quaternion=new THREE.Quaternion,this.useQuaternion=!1,this.boundRadius=0,this.boundRadiusScale=1,this.visible=!0,this.receiveShadow=this.castShadow=!1,this.frustumCulled=!0,this._vector=new THREE.Vector3},THREE.Object3D.prototype={constructor:THREE.Object3D,applyMatrix:function(e){this.matrix.multiply(e,this.matrix),this.scale.getScaleFromMatrix(this.matrix),this.rotation.getRotationFromMatrix(this.matrix,this.scale),this.position.getPositionFromMatrix(this.matrix)},translate:function(e,t){this.matrix.rotateAxis(t),this.position.addSelf(t.multiplyScalar(e))},translateX:function(e){this.translate(e,this._vector.set(1,0,0))},translateY:function(e){this.translate(e,this._vector.set(0,1,0))},translateZ:function(e){this.translate(e,this._vector.set(0,0,1))},lookAt:function(e){this.matrix.lookAt(e,this.position,this.up),this.rotationAutoUpdate&&this.rotation.getRotationFromMatrix(this.matrix)},add:function(e){if(e===this)console.warn("THREE.Object3D.add: An object can't be added as a child of itself.");else if(e instanceof THREE.Object3D){void 0!==e.parent&&e.parent.remove(e),e.parent=this,this.children.push(e);for(var t=this;void 0!==t.parent;)t=t.parent;void 0!==t&&t instanceof THREE.Scene&&t.__addObject(e)}},remove:function(e){var t=this.children.indexOf(e);if(-1!==t){for(e.parent=void 0,this.children.splice(t,1),t=this;void 0!==t.parent;)t=t.parent;void 0!==t&&t instanceof THREE.Scene&&t.__removeObject(e)}},getChildByName:function(e,t){var n,r,i;for(n=0,r=this.children.length;n<r;n++){if(i=this.children[n],i.name===e)return i;if(t&&void 0!==(i=i.getChildByName(e,t)))return i}},updateMatrix:function(){this.matrix.setPosition(this.position),this.useQuaternion?this.matrix.setRotationFromQuaternion(this.quaternion):this.matrix.setRotationFromEuler(this.rotation,this.eulerOrder),1===this.scale.x&&1===this.scale.y&&1===this.scale.z||(this.matrix.scale(this.scale),this.boundRadiusScale=Math.max(this.scale.x,Math.max(this.scale.y,this.scale.z))),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent?this.matrixWorld.multiply(this.parent.matrixWorld,this.matrix):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);for(var t=0,n=this.children.length;t<n;t++)this.children[t].updateMatrixWorld(e)}},THREE.Object3DCount=0,THREE.Projector=function(){function e(){var e=m[o]=m[o]||new THREE.RenderableObject;return o++,e}function t(){var e=v[s]=v[s]||new THREE.RenderableVertex;return s++,e}function n(e,t){return t.z-e.z}function r(e,t){var n=0,r=1,i=e.z+e.w,o=t.z+t.w,a=-e.z+e.w,s=-t.z+t.w;return i>=0&&o>=0&&a>=0&&s>=0||!(i<0&&o<0||a<0&&s<0)&&(i<0?n=Math.max(n,i/(i-o)):o<0&&(r=Math.min(r,i/(i-o))),a<0?n=Math.max(n,a/(a-s)):s<0&&(r=Math.min(r,a/(a-s))),!(r<n)&&(e.lerpSelf(t,n),t.lerpSelf(e,1-r),!0))}var i,o,a,s,l,c,u,h,f,d,p,m=[],v=[],g=[],E=[],y=[],x=[],T={objects:[],sprites:[],lights:[],elements:[]},b=new THREE.Vector3,R=new THREE.Vector4,w=new THREE.Matrix4,_=new THREE.Matrix4,H=new THREE.Frustum,M=new THREE.Vector4,S=new THREE.Vector4;this.projectVector=function(e,t){return t.matrixWorldInverse.getInverse(t.matrixWorld),w.multiply(t.projectionMatrix,t.matrixWorldInverse),w.multiplyVector3(e),e},this.unprojectVector=function(e,t){return t.projectionMatrixInverse.getInverse(t.projectionMatrix),w.multiply(t.matrixWorld,t.projectionMatrixInverse),w.multiplyVector3(e),e},this.pickingRay=function(e,t){var n;return e.z=-1,n=new THREE.Vector3(e.x,e.y,1),this.unprojectVector(e,t),this.unprojectVector(n,t),n.subSelf(e).normalize(),new THREE.Ray(e,n)},this.projectGraph=function(t,r){o=0,T.objects.length=0,T.sprites.length=0,T.lights.length=0;var a=function(t){if(!1!==t.visible){(t instanceof THREE.Mesh||t instanceof THREE.Line)&&(!1===t.frustumCulled||H.contains(t))?(b.copy(t.matrixWorld.getPosition()),w.multiplyVector3(b),i=e(),i.object=t,i.z=b.z,T.objects.push(i)):t instanceof THREE.Sprite||t instanceof THREE.Particle?(b.copy(t.matrixWorld.getPosition()),w.multiplyVector3(b),i=e(),i.object=t,i.z=b.z,T.sprites.push(i)):t instanceof THREE.Light&&T.lights.push(t);for(var n=0,r=t.children.length;n<r;n++)a(t.children[n])}};return a(t),r&&T.objects.sort(n),T},this.projectScene=function(e,i,o){var m,b,C,A,P,D,L,N,k,F,U,B,V,z,I,O=i.near,W=i.far,j=!1;for(p=f=u=c=0,T.elements.length=0,void 0===i.parent&&(console.warn("DEPRECATED: Camera hasn't been added to a Scene. Adding it..."),e.add(i)),e.updateMatrixWorld(),i.matrixWorldInverse.getInverse(i.matrixWorld),w.multiply(i.projectionMatrix,i.matrixWorldInverse),H.setFromMatrix(w),T=this.projectGraph(e,!1),e=0,m=T.objects.length;e<m;e++)if(k=T.objects[e].object,F=k.matrixWorld,s=0,k instanceof THREE.Mesh){for(U=k.geometry,B=k.geometry.materials,A=U.vertices,V=U.faces,z=U.faceVertexUvs,U=k.matrixRotationWorld.extractRotation(F),b=0,C=A.length;b<C;b++)a=t(),a.positionWorld.copy(A[b]),F.multiplyVector3(a.positionWorld),a.positionScreen.copy(a.positionWorld),w.multiplyVector4(a.positionScreen),a.positionScreen.x=a.positionScreen.x/a.positionScreen.w,a.positionScreen.y=a.positionScreen.y/a.positionScreen.w,a.visible=a.positionScreen.z>O&&a.positionScreen.z<W;for(A=0,b=V.length;A<b;A++){if((C=V[A])instanceof THREE.Face3){if(P=v[C.a],D=v[C.b],L=v[C.c],!(P.visible&&D.visible&&L.visible))continue;if(j=(L.positionScreen.x-P.positionScreen.x)*(D.positionScreen.y-P.positionScreen.y)-(L.positionScreen.y-P.positionScreen.y)*(D.positionScreen.x-P.positionScreen.x)<0,!k.doubleSided&&j==k.flipSided)continue;N=g[c]=g[c]||new THREE.RenderableFace3,c++,l=N,l.v1.copy(P),l.v2.copy(D),l.v3.copy(L)}else if(C instanceof THREE.Face4){if(P=v[C.a],D=v[C.b],L=v[C.c],N=v[C.d],!(P.visible&&D.visible&&L.visible&&N.visible))continue;if(j=(N.positionScreen.x-P.positionScreen.x)*(D.positionScreen.y-P.positionScreen.y)-(N.positionScreen.y-P.positionScreen.y)*(D.positionScreen.x-P.positionScreen.x)<0||(D.positionScreen.x-L.positionScreen.x)*(N.positionScreen.y-L.positionScreen.y)-(D.positionScreen.y-L.positionScreen.y)*(N.positionScreen.x-L.positionScreen.x)<0,!k.doubleSided&&j==k.flipSided)continue;I=E[u]=E[u]||new THREE.RenderableFace4,u++,l=I,l.v1.copy(P),l.v2.copy(D),l.v3.copy(L),l.v4.copy(N)}for(l.normalWorld.copy(C.normal),!j&&(k.flipSided||k.doubleSided)&&l.normalWorld.negate(),U.multiplyVector3(l.normalWorld),l.centroidWorld.copy(C.centroid),F.multiplyVector3(l.centroidWorld),l.centroidScreen.copy(l.centroidWorld),w.multiplyVector3(l.centroidScreen),L=C.vertexNormals,P=0,D=L.length;P<D;P++)N=l.vertexNormalsWorld[P],N.copy(L[P]),!j&&(k.flipSided||k.doubleSided)&&N.negate(),U.multiplyVector3(N);for(P=0,D=z.length;P<D;P++)if(I=z[P][A])for(L=0,N=I.length;L<N;L++)l.uvs[P][L]=I[L];l.material=k.material,l.faceMaterial=null!==C.materialIndex?B[C.materialIndex]:null,l.z=l.centroidScreen.z,T.elements.push(l)}}else if(k instanceof THREE.Line)for(_.multiply(w,F),A=k.geometry.vertices,P=t(),P.positionScreen.copy(A[0]),_.multiplyVector4(P.positionScreen),F=k.type===THREE.LinePieces?2:1,b=1,C=A.length;b<C;b++)P=t(),P.positionScreen.copy(A[b]),_.multiplyVector4(P.positionScreen),(b+1)%F>0||(D=v[s-2],M.copy(P.positionScreen),S.copy(D.positionScreen),r(M,S)&&(M.multiplyScalar(1/M.w),S.multiplyScalar(1/S.w),B=y[f]=y[f]||new THREE.RenderableLine,f++,h=B,h.v1.positionScreen.copy(M),h.v2.positionScreen.copy(S),h.z=Math.max(M.z,S.z),h.material=k.material,T.elements.push(h)));for(e=0,m=T.sprites.length;e<m;e++)k=T.sprites[e].object,F=k.matrixWorld,k instanceof THREE.Particle&&(R.set(F.elements[12],F.elements[13],F.elements[14],1),w.multiplyVector4(R),R.z=R.z/R.w,R.z>0&&R.z<1&&(O=x[p]=x[p]||new THREE.RenderableParticle,p++,d=O,d.x=R.x/R.w,d.y=R.y/R.w,d.z=R.z,d.rotation=k.rotation.z,d.scale.x=k.scale.x*Math.abs(d.x-(R.x+i.projectionMatrix.elements[0])/(R.w+i.projectionMatrix.elements[12])),d.scale.y=k.scale.y*Math.abs(d.y-(R.y+i.projectionMatrix.elements[5])/(R.w+i.projectionMatrix.elements[13])),d.material=k.material,T.elements.push(d)));return o&&T.elements.sort(n),T}},THREE.Quaternion=function(e,t,n,r){this.x=e||0,this.y=t||0,this.z=n||0,this.w=void 0!==r?r:1},THREE.Quaternion.prototype={constructor:THREE.Quaternion,set:function(e,t,n,r){return this.x=e,this.y=t,this.z=n,this.w=r,this},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this},setFromEuler:function(e){var t=Math.PI/360,n=e.x*t,r=e.y*t,i=e.z*t,e=Math.cos(r),r=Math.sin(r),t=Math.cos(-i),i=Math.sin(-i),o=Math.cos(n),n=Math.sin(n),a=e*t,s=r*i;return this.w=a*o-s*n,this.x=a*n+s*o,this.y=r*t*o+e*i*n,this.z=e*i*o-r*t*n,this},setFromAxisAngle:function(e,t){var n=t/2,r=Math.sin(n);return this.x=e.x*r,this.y=e.y*r,this.z=e.z*r,this.w=Math.cos(n),this},setFromRotationMatrix:function(e){var t=Math.pow(e.determinant(),1/3);return this.w=Math.sqrt(Math.max(0,t+e.elements[0]+e.elements[5]+e.elements[10]))/2,this.x=Math.sqrt(Math.max(0,t+e.elements[0]-e.elements[5]-e.elements[10]))/2,this.y=Math.sqrt(Math.max(0,t-e.elements[0]+e.elements[5]-e.elements[10]))/2,this.z=Math.sqrt(Math.max(0,t-e.elements[0]-e.elements[5]+e.elements[10]))/2,this.x=e.elements[6]-e.elements[9]<0?-Math.abs(this.x):Math.abs(this.x),this.y=e.elements[8]-e.elements[2]<0?-Math.abs(this.y):Math.abs(this.y),this.z=e.elements[1]-e.elements[4]<0?-Math.abs(this.z):Math.abs(this.z),this.normalize(),this},calculateW:function(){return this.w=-Math.sqrt(Math.abs(1-this.x*this.x-this.y*this.y-this.z*this.z)),this},inverse:function(){return this.x=-1*this.x,this.y=-1*this.y,this.z=-1*this.z,this},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},normalize:function(){var e=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return 0===e?this.w=this.z=this.y=this.x=0:(e=1/e,this.x=this.x*e,this.y=this.y*e,this.z=this.z*e,this.w=this.w*e),this},multiply:function(e,t){return this.x=e.x*t.w+e.y*t.z-e.z*t.y+e.w*t.x,this.y=-e.x*t.z+e.y*t.w+e.z*t.x+e.w*t.y,this.z=e.x*t.y-e.y*t.x+e.z*t.w+e.w*t.z,this.w=-e.x*t.x-e.y*t.y-e.z*t.z+e.w*t.w,this},multiplySelf:function(e){var t=this.x,n=this.y,r=this.z,i=this.w,o=e.x,a=e.y,s=e.z,e=e.w;return this.x=t*e+i*o+n*s-r*a,this.y=n*e+i*a+r*o-t*s,this.z=r*e+i*s+t*a-n*o,this.w=i*e-t*o-n*a-r*s,this},multiplyVector3:function(e,t){t||(t=e);var n=e.x,r=e.y,i=e.z,o=this.x,a=this.y,s=this.z,l=this.w,c=l*n+a*i-s*r,u=l*r+s*n-o*i,h=l*i+o*r-a*n,n=-o*n-a*r-s*i;return t.x=c*l+n*-o+u*-s-h*-a,t.y=u*l+n*-a+h*-o-c*-s,t.z=h*l+n*-s+c*-a-u*-o,t},clone:function(){return new THREE.Quaternion(this.x,this.y,this.z,this.w)}},THREE.Quaternion.slerp=function(e,t,n,r){var i=e.w*t.w+e.x*t.x+e.y*t.y+e.z*t.z;if(i<0?(n.w=-t.w,n.x=-t.x,n.y=-t.y,n.z=-t.z,i=-i):n.copy(t),Math.abs(i)>=1)return n.w=e.w,n.x=e.x,n.y=e.y,n.z=e.z,n;var o=Math.acos(i),i=Math.sqrt(1-i*i);return Math.abs(i)<.001?(n.w=.5*(e.w+t.w),n.x=.5*(e.x+t.x),n.y=.5*(e.y+t.y),n.z=.5*(e.z+t.z),n):(t=Math.sin((1-r)*o)/i,r=Math.sin(r*o)/i,n.w=e.w*t+n.w*r,n.x=e.x*t+n.x*r,n.y=e.y*t+n.y*r,n.z=e.z*t+n.z*r,n)},THREE.Vertex=function(){console.warn("THREE.Vertex has been DEPRECATED. Use THREE.Vector3 instead.")},THREE.Face3=function(e,t,n,r,i,o){this.a=e,this.b=t,this.c=n,this.normal=r instanceof THREE.Vector3?r:new THREE.Vector3,this.vertexNormals=r instanceof Array?r:[],this.color=i instanceof THREE.Color?i:new THREE.Color,this.vertexColors=i instanceof Array?i:[],this.vertexTangents=[],this.materialIndex=o,this.centroid=new THREE.Vector3},THREE.Face3.prototype={constructor:THREE.Face3,clone:function(){var e=new THREE.Face3(this.a,this.b,this.c);e.normal.copy(this.normal),e.color.copy(this.color),e.centroid.copy(this.centroid),e.materialIndex=this.materialIndex;var t,n;for(t=0,n=this.vertexNormals.length;t<n;t++)e.vertexNormals[t]=this.vertexNormals[t].clone();for(t=0,n=this.vertexColors.length;t<n;t++)e.vertexColors[t]=this.vertexColors[t].clone();for(t=0,n=this.vertexTangents.length;t<n;t++)e.vertexTangents[t]=this.vertexTangents[t].clone();return e}},THREE.Face4=function(e,t,n,r,i,o,a){this.a=e,this.b=t,this.c=n,this.d=r,this.normal=i instanceof THREE.Vector3?i:new THREE.Vector3,this.vertexNormals=i instanceof Array?i:[],this.color=o instanceof THREE.Color?o:new THREE.Color,this.vertexColors=o instanceof Array?o:[],this.vertexTangents=[],this.materialIndex=a,this.centroid=new THREE.Vector3},THREE.Face4.prototype={constructor:THREE.Face4,clone:function(){var e=new THREE.Face4(this.a,this.b,this.c,this.d);e.normal.copy(this.normal),e.color.copy(this.color),e.centroid.copy(this.centroid),e.materialIndex=this.materialIndex;var t,n;for(t=0,n=this.vertexNormals.length;t<n;t++)e.vertexNormals[t]=this.vertexNormals[t].clone();for(t=0,n=this.vertexColors.length;t<n;t++)e.vertexColors[t]=this.vertexColors[t].clone();for(t=0,n=this.vertexTangents.length;t<n;t++)e.vertexTangents[t]=this.vertexTangents[t].clone();return e}},THREE.UV=function(e,t){this.u=e||0,this.v=t||0},THREE.UV.prototype={constructor:THREE.UV,set:function(e,t){return this.u=e,this.v=t,this},copy:function(e){return this.u=e.u,this.v=e.v,this},lerpSelf:function(e,t){return this.u=this.u+(e.u-this.u)*t,this.v=this.v+(e.v-this.v)*t,this},clone:function(){return new THREE.UV(this.u,this.v)}},THREE.Geometry=function(){this.id=THREE.GeometryCount++,this.vertices=[],this.colors=[],this.materials=[],this.faces=[],this.faceUvs=[[]],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphColors=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.boundingSphere=this.boundingBox=null,this.dynamic=this.hasTangents=!1},THREE.Geometry.prototype={constructor:THREE.Geometry,applyMatrix:function(e){var t=new THREE.Matrix4;t.extractRotation(e);for(var n=0,r=this.vertices.length;n<r;n++)e.multiplyVector3(this.vertices[n]);for(n=0,r=this.faces.length;n<r;n++){var i=this.faces[n];t.multiplyVector3(i.normal);for(var o=0,a=i.vertexNormals.length;o<a;o++)t.multiplyVector3(i.vertexNormals[o]);e.multiplyVector3(i.centroid)}},computeCentroids:function(){var e,t,n;for(e=0,t=this.faces.length;e<t;e++)n=this.faces[e],n.centroid.set(0,0,0),n instanceof THREE.Face3?(n.centroid.addSelf(this.vertices[n.a]),n.centroid.addSelf(this.vertices[n.b]),n.centroid.addSelf(this.vertices[n.c]),n.centroid.divideScalar(3)):n instanceof THREE.Face4&&(n.centroid.addSelf(this.vertices[n.a]),n.centroid.addSelf(this.vertices[n.b]),n.centroid.addSelf(this.vertices[n.c]),n.centroid.addSelf(this.vertices[n.d]),n.centroid.divideScalar(4))},computeFaceNormals:function(){var e,t,n,r,i,o,a=new THREE.Vector3,s=new THREE.Vector3;for(e=0,t=this.faces.length;e<t;e++)n=this.faces[e],r=this.vertices[n.a],i=this.vertices[n.b],o=this.vertices[n.c],a.sub(o,i),s.sub(r,i),a.crossSelf(s),a.isZero()||a.normalize(),n.normal.copy(a)},computeVertexNormals:function(){var e,t,n,r;if(void 0===this.__tmpVertices){for(r=this.__tmpVertices=Array(this.vertices.length),e=0,t=this.vertices.length;e<t;e++)r[e]=new THREE.Vector3;for(e=0,t=this.faces.length;e<t;e++)n=this.faces[e],n instanceof THREE.Face3?n.vertexNormals=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3]:n instanceof THREE.Face4&&(n.vertexNormals=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3])}else for(r=this.__tmpVertices,e=0,t=this.vertices.length;e<t;e++)r[e].set(0,0,0);for(e=0,t=this.faces.length;e<t;e++)n=this.faces[e],n instanceof THREE.Face3?(r[n.a].addSelf(n.normal),r[n.b].addSelf(n.normal),r[n.c].addSelf(n.normal)):n instanceof THREE.Face4&&(r[n.a].addSelf(n.normal),r[n.b].addSelf(n.normal),r[n.c].addSelf(n.normal),r[n.d].addSelf(n.normal));for(e=0,t=this.vertices.length;e<t;e++)r[e].normalize();for(e=0,t=this.faces.length;e<t;e++)n=this.faces[e],n instanceof THREE.Face3?(n.vertexNormals[0].copy(r[n.a]),n.vertexNormals[1].copy(r[n.b]),n.vertexNormals[2].copy(r[n.c])):n instanceof THREE.Face4&&(n.vertexNormals[0].copy(r[n.a]),n.vertexNormals[1].copy(r[n.b]),n.vertexNormals[2].copy(r[n.c]),n.vertexNormals[3].copy(r[n.d]))},computeMorphNormals:function(){var e,t,n,r,i;for(n=0,r=this.faces.length;n<r;n++)for(i=this.faces[n],i.__originalFaceNormal?i.__originalFaceNormal.copy(i.normal):i.__originalFaceNormal=i.normal.clone(),i.__originalVertexNormals||(i.__originalVertexNormals=[]),e=0,t=i.vertexNormals.length;e<t;e++)i.__originalVertexNormals[e]?i.__originalVertexNormals[e].copy(i.vertexNormals[e]):i.__originalVertexNormals[e]=i.vertexNormals[e].clone();var o=new THREE.Geometry;for(o.faces=this.faces,e=0,t=this.morphTargets.length;e<t;e++){if(!this.morphNormals[e]){this.morphNormals[e]={},this.morphNormals[e].faceNormals=[],this.morphNormals[e].vertexNormals=[];var a,s,l=this.morphNormals[e].faceNormals,c=this.morphNormals[e].vertexNormals;for(n=0,r=this.faces.length;n<r;n++)i=this.faces[n],a=new THREE.Vector3,s=i instanceof THREE.Face3?{a:new THREE.Vector3,b:new THREE.Vector3,c:new THREE.Vector3}:{a:new THREE.Vector3,b:new THREE.Vector3,c:new THREE.Vector3,d:new THREE.Vector3},l.push(a),c.push(s)}for(l=this.morphNormals[e],o.vertices=this.morphTargets[e].vertices,o.computeFaceNormals(),o.computeVertexNormals(),n=0,r=this.faces.length;n<r;n++)i=this.faces[n],a=l.faceNormals[n],s=l.vertexNormals[n],a.copy(i.normal),i instanceof THREE.Face3?(s.a.copy(i.vertexNormals[0]),s.b.copy(i.vertexNormals[1]),s.c.copy(i.vertexNormals[2])):(s.a.copy(i.vertexNormals[0]),s.b.copy(i.vertexNormals[1]),s.c.copy(i.vertexNormals[2]),s.d.copy(i.vertexNormals[3]))}for(n=0,r=this.faces.length;n<r;n++)i=this.faces[n],i.normal=i.__originalFaceNormal,i.vertexNormals=i.__originalVertexNormals},computeTangents:function(){function e(e,t,n,r,i,o,w){s=e.vertices[t],l=e.vertices[n],c=e.vertices[r],u=a[i],h=a[o],f=a[w],d=l.x-s.x,p=c.x-s.x,m=l.y-s.y,v=c.y-s.y,g=l.z-s.z,E=c.z-s.z,y=h.u-u.u,x=f.u-u.u,T=h.v-u.v,b=f.v-u.v,R=1/(y*b-x*T),M.set((b*d-T*p)*R,(b*m-T*v)*R,(b*g-T*E)*R),S.set((y*p-x*d)*R,(y*v-x*m)*R,(y*E-x*g)*R),_[t].addSelf(M),_[n].addSelf(M),_[r].addSelf(M),H[t].addSelf(S),H[n].addSelf(S),H[r].addSelf(S)}var t,n,r,i,o,a,s,l,c,u,h,f,d,p,m,v,g,E,y,x,T,b,R,w,_=[],H=[],M=new THREE.Vector3,S=new THREE.Vector3,C=new THREE.Vector3,A=new THREE.Vector3,P=new THREE.Vector3;for(t=0,n=this.vertices.length;t<n;t++)_[t]=new THREE.Vector3,H[t]=new THREE.Vector3;for(t=0,n=this.faces.length;t<n;t++)o=this.faces[t],a=this.faceVertexUvs[0][t],o instanceof THREE.Face3?e(this,o.a,o.b,o.c,0,1,2):o instanceof THREE.Face4&&(e(this,o.a,o.b,o.d,0,1,3),e(this,o.b,o.c,o.d,1,2,3));var D=["a","b","c","d"];for(t=0,n=this.faces.length;t<n;t++)for(o=this.faces[t],r=0;r<o.vertexNormals.length;r++)P.copy(o.vertexNormals[r]),i=o[D[r]],w=_[i],C.copy(w),C.subSelf(P.multiplyScalar(P.dot(w))).normalize(),A.cross(o.vertexNormals[r],w),i=A.dot(H[i]),i=i<0?-1:1,o.vertexTangents[r]=new THREE.Vector4(C.x,C.y,C.z,i);this.hasTangents=!0},computeBoundingBox:function(){if(this.boundingBox||(this.boundingBox={min:new THREE.Vector3,max:new THREE.Vector3}),this.vertices.length>0){var e;e=this.vertices[0],this.boundingBox.min.copy(e),this.boundingBox.max.copy(e);for(var t=this.boundingBox.min,n=this.boundingBox.max,r=1,i=this.vertices.length;r<i;r++)e=this.vertices[r],e.x<t.x?t.x=e.x:e.x>n.x&&(n.x=e.x),e.y<t.y?t.y=e.y:e.y>n.y&&(n.y=e.y),e.z<t.z?t.z=e.z:e.z>n.z&&(n.z=e.z)}else this.boundingBox.min.set(0,0,0),this.boundingBox.max.set(0,0,0)},computeBoundingSphere:function(){this.boundingSphere||(this.boundingSphere={radius:0});for(var e,t=0,n=0,r=this.vertices.length;n<r;n++)(e=this.vertices[n].length())>t&&(t=e);this.boundingSphere.radius=t},mergeVertices:function(){var e,t,n,r,i={},o=[],a=[],s=Math.pow(10,4);for(t=0,n=this.vertices.length;t<n;t++)e=this.vertices[t],e=[Math.round(e.x*s),Math.round(e.y*s),Math.round(e.z*s)].join("_"),void 0===i[e]?(i[e]=t,o.push(this.vertices[t]),a[t]=o.length-1):a[t]=a[i[e]];for(t=0,n=this.faces.length;t<n;t++)if((s=this.faces[t])instanceof THREE.Face3)s.a=a[s.a],s.b=a[s.b],s.c=a[s.c];else if(s instanceof THREE.Face4)for(s.a=a[s.a],s.b=a[s.b],s.c=a[s.c],s.d=a[s.d],e=[s.a,s.b,s.c,s.d],i=3;i>0;i--)if(e.indexOf(s["abcd"[i]])!=i){for(e.splice(i,1),this.faces[t]=new THREE.Face3(e[0],e[1],e[2]),s=0,e=this.faceVertexUvs.length;s<e;s++)(r=this.faceVertexUvs[s][t])&&r.splice(i,1);break}return a=this.vertices.length-o.length,this.vertices=o,a}},THREE.GeometryCount=0,THREE.Spline=function(e){function t(e,t,n,r,i,o,a){return e=.5*(n-e),r=.5*(r-t),(2*(t-n)+e+r)*a+(-3*(t-n)-2*e-r)*o+e*i+t}this.points=e;var n,r,i,o,a,s,l,c,u,h=[],f={x:0,y:0,z:0};this.initFromArray=function(e){this.points=[];for(var t=0;t<e.length;t++)this.points[t]={x:e[t][0],y:e[t][1],z:e[t][2]}},this.getPoint=function(e){return n=(this.points.length-1)*e,r=Math.floor(n),i=n-r,h[0]=0===r?r:r-1,h[1]=r,h[2]=r>this.points.length-2?this.points.length-1:r+1,h[3]=r>this.points.length-3?this.points.length-1:r+2,s=this.points[h[0]],l=this.points[h[1]],c=this.points[h[2]],u=this.points[h[3]],o=i*i,a=i*o,f.x=t(s.x,l.x,c.x,u.x,i,o,a),f.y=t(s.y,l.y,c.y,u.y,i,o,a),f.z=t(s.z,l.z,c.z,u.z,i,o,a),f},this.getControlPointsArray=function(){var e,t,n=this.points.length,r=[];for(e=0;e<n;e++)t=this.points[e],r[e]=[t.x,t.y,t.z];return r},this.getLength=function(e){var t,n,r,i=t=t=0,o=new THREE.Vector3,a=new THREE.Vector3,s=[],l=0;for(s[0]=0,e||(e=100),n=this.points.length*e,o.copy(this.points[0]),e=1;e<n;e++)t=e/n,r=this.getPoint(t),a.copy(r),l+=a.distanceTo(o),o.copy(r),t=(this.points.length-1)*t,(t=Math.floor(t))!=i&&(s[t]=l,i=t);return s[s.length]=l,{chunks:s,total:l}},this.reparametrizeByArcLength=function(e){var t,n,r,i,o,a,s=[],l=new THREE.Vector3,c=this.getLength();for(s.push(l.copy(this.points[0]).clone()),t=1;t<this.points.length;t++){for(n=c.chunks[t]-c.chunks[t-1],a=Math.ceil(e*n/c.total),i=(t-1)/(this.points.length-1),o=t/(this.points.length-1),n=1;n<a-1;n++)r=i+n*(1/a)*(o-i),r=this.getPoint(r),s.push(l.copy(r).clone());s.push(l.copy(this.points[t]).clone())}this.points=s}},THREE.Camera=function(){THREE.Object3D.call(this),this.matrixWorldInverse=new THREE.Matrix4,this.projectionMatrix=new THREE.Matrix4,this.projectionMatrixInverse=new THREE.Matrix4},THREE.Camera.prototype=new THREE.Object3D,THREE.Camera.prototype.constructor=THREE.Camera,THREE.Camera.prototype.lookAt=function(e){this.matrix.lookAt(this.position,e,this.up),this.rotationAutoUpdate&&this.rotation.getRotationFromMatrix(this.matrix)},THREE.OrthographicCamera=function(e,t,n,r,i,o){THREE.Camera.call(this),this.left=e,this.right=t,this.top=n,this.bottom=r,this.near=void 0!==i?i:.1,this.far=void 0!==o?o:2e3,this.updateProjectionMatrix()},THREE.OrthographicCamera.prototype=new THREE.Camera,THREE.OrthographicCamera.prototype.constructor=THREE.OrthographicCamera,THREE.OrthographicCamera.prototype.updateProjectionMatrix=function(){this.projectionMatrix.makeOrthographic(this.left,this.right,this.top,this.bottom,this.near,this.far)},THREE.PerspectiveCamera=function(e,t,n,r){THREE.Camera.call(this),this.fov=void 0!==e?e:50,this.aspect=void 0!==t?t:1,this.near=void 0!==n?n:.1,this.far=void 0!==r?r:2e3,this.updateProjectionMatrix()},THREE.PerspectiveCamera.prototype=new THREE.Camera,THREE.PerspectiveCamera.prototype.constructor=THREE.PerspectiveCamera,THREE.PerspectiveCamera.prototype.setLens=function(e,t){this.fov=2*Math.atan((void 0!==t?t:24)/(2*e))*(180/Math.PI),this.updateProjectionMatrix()},THREE.PerspectiveCamera.prototype.setViewOffset=function(e,t,n,r,i,o){this.fullWidth=e,this.fullHeight=t,this.x=n,this.y=r,this.width=i,this.height=o,this.updateProjectionMatrix()},THREE.PerspectiveCamera.prototype.updateProjectionMatrix=function(){if(this.fullWidth){var e=this.fullWidth/this.fullHeight,t=Math.tan(this.fov*Math.PI/360)*this.near,n=-t,r=e*n,e=Math.abs(e*t-r),n=Math.abs(t-n);this.projectionMatrix.makeFrustum(r+this.x*e/this.fullWidth,r+(this.x+this.width)*e/this.fullWidth,t-(this.y+this.height)*n/this.fullHeight,t-this.y*n/this.fullHeight,this.near,this.far)}else this.projectionMatrix.makePerspective(this.fov,this.aspect,this.near,this.far)},THREE.Light=function(e){THREE.Object3D.call(this),this.color=new THREE.Color(e)},THREE.Light.prototype=new THREE.Object3D,THREE.Light.prototype.constructor=THREE.Light,THREE.Light.prototype.supr=THREE.Object3D.prototype,THREE.AmbientLight=function(e){THREE.Light.call(this,e)},THREE.AmbientLight.prototype=new THREE.Light,THREE.AmbientLight.prototype.constructor=THREE.AmbientLight,THREE.DirectionalLight=function(e,t,n){THREE.Light.call(this,e),this.position=new THREE.Vector3(0,1,0),this.target=new THREE.Object3D,this.intensity=void 0!==t?t:1,this.distance=void 0!==n?n:0,this.onlyShadow=this.castShadow=!1,this.shadowCameraNear=50,this.shadowCameraFar=5e3,this.shadowCameraLeft=-500,
this.shadowCameraTop=this.shadowCameraRight=500,this.shadowCameraBottom=-500,this.shadowCameraVisible=!1,this.shadowBias=0,this.shadowDarkness=.5,this.shadowMapHeight=this.shadowMapWidth=512,this.shadowCascade=!1,this.shadowCascadeOffset=new THREE.Vector3(0,0,-1e3),this.shadowCascadeCount=2,this.shadowCascadeBias=[0,0,0],this.shadowCascadeWidth=[512,512,512],this.shadowCascadeHeight=[512,512,512],this.shadowCascadeNearZ=[-1,.99,.998],this.shadowCascadeFarZ=[.99,.998,1],this.shadowCascadeArray=[],this.shadowMatrix=this.shadowCamera=this.shadowMapSize=this.shadowMap=null},THREE.DirectionalLight.prototype=new THREE.Light,THREE.DirectionalLight.prototype.constructor=THREE.DirectionalLight,THREE.PointLight=function(e,t,n){THREE.Light.call(this,e),this.position=new THREE.Vector3(0,0,0),this.intensity=void 0!==t?t:1,this.distance=void 0!==n?n:0},THREE.PointLight.prototype=new THREE.Light,THREE.PointLight.prototype.constructor=THREE.PointLight,THREE.SpotLight=function(e,t,n,r,i){THREE.Light.call(this,e),this.position=new THREE.Vector3(0,1,0),this.target=new THREE.Object3D,this.intensity=void 0!==t?t:1,this.distance=void 0!==n?n:0,this.angle=void 0!==r?r:Math.PI/2,this.exponent=void 0!==i?i:10,this.onlyShadow=this.castShadow=!1,this.shadowCameraNear=50,this.shadowCameraFar=5e3,this.shadowCameraFov=50,this.shadowCameraVisible=!1,this.shadowBias=0,this.shadowDarkness=.5,this.shadowMapHeight=this.shadowMapWidth=512,this.shadowMatrix=this.shadowCamera=this.shadowMapSize=this.shadowMap=null},THREE.SpotLight.prototype=new THREE.Light,THREE.SpotLight.prototype.constructor=THREE.SpotLight,THREE.Loader=function(e){this.statusDomElement=(this.showStatus=e)?THREE.Loader.prototype.addStatusElement():null,this.onLoadStart=function(){},this.onLoadProgress=function(){},this.onLoadComplete=function(){}},THREE.Loader.prototype={constructor:THREE.Loader,crossOrigin:"anonymous",addStatusElement:function(){var e=document.createElement("div");return e.style.position="absolute",e.style.right="0px",e.style.top="0px",e.style.fontSize="0.8em",e.style.textAlign="left",e.style.background="rgba(0,0,0,0.25)",e.style.color="#fff",e.style.width="120px",e.style.padding="0.5em 0.5em 0.5em 0.5em",e.style.zIndex=1e3,e.innerHTML="Loading ...",e},updateProgress:function(e){var t="Loaded ",t=e.total?t+((100*e.loaded/e.total).toFixed(0)+"%"):t+((e.loaded/1e3).toFixed(2)+" KB");this.statusDomElement.innerHTML=t},extractUrlBase:function(e){return e=e.split("/"),e.pop(),(e.length<1?".":e.join("/"))+"/"},initMaterials:function(e,t,n){e.materials=[];for(var r=0;r<t.length;++r)e.materials[r]=THREE.Loader.prototype.createMaterial(t[r],n)},hasNormals:function(e){var t,n=e.materials.length;for(t=0;t<n;t++)if(e.materials[t]instanceof THREE.ShaderMaterial)return!0;return!1},createMaterial:function(e,t){function n(e){return e=Math.log(e)/Math.LN2,Math.floor(e)==e}function r(e){return e=Math.log(e)/Math.LN2,Math.pow(2,Math.round(e))}function i(e,t){var i=new Image;i.onload=function(){if(n(this.width)&&n(this.height))e.image=this;else{var t=r(this.width),i=r(this.height);e.image.width=t,e.image.height=i,e.image.getContext("2d").drawImage(this,0,0,t,i)}e.needsUpdate=!0},i.crossOrigin=s.crossOrigin,i.src=t}function o(e,n,r,o,a,s){var l=document.createElement("canvas");e[n]=new THREE.Texture(l),e[n].sourceFile=r,o&&(e[n].repeat.set(o[0],o[1]),1!=o[0]&&(e[n].wrapS=THREE.RepeatWrapping),1!=o[1]&&(e[n].wrapT=THREE.RepeatWrapping)),a&&e[n].offset.set(a[0],a[1]),s&&(o={repeat:THREE.RepeatWrapping,mirror:THREE.MirroredRepeatWrapping},void 0!==o[s[0]]&&(e[n].wrapS=o[s[0]]),void 0!==o[s[1]]&&(e[n].wrapT=o[s[1]])),i(e[n],t+"/"+r)}function a(e){return(255*e[0]<<16)+(255*e[1]<<8)+255*e[2]}var s=this,l="MeshLambertMaterial",c={color:15658734,opacity:1,map:null,lightMap:null,normalMap:null,wireframe:e.wireframe};if(e.shading){var u=e.shading.toLowerCase();"phong"===u?l="MeshPhongMaterial":"basic"===u&&(l="MeshBasicMaterial")}return void 0!==e.blending&&void 0!==THREE[e.blending]&&(c.blending=THREE[e.blending]),(void 0!==e.transparent||e.opacity<1)&&(c.transparent=e.transparent),void 0!==e.depthTest&&(c.depthTest=e.depthTest),void 0!==e.depthWrite&&(c.depthWrite=e.depthWrite),void 0!==e.vertexColors&&("face"==e.vertexColors?c.vertexColors=THREE.FaceColors:e.vertexColors&&(c.vertexColors=THREE.VertexColors)),e.colorDiffuse?c.color=a(e.colorDiffuse):e.DbgColor&&(c.color=e.DbgColor),e.colorSpecular&&(c.specular=a(e.colorSpecular)),e.colorAmbient&&(c.ambient=a(e.colorAmbient)),e.transparency&&(c.opacity=e.transparency),e.specularCoef&&(c.shininess=e.specularCoef),e.mapDiffuse&&t&&o(c,"map",e.mapDiffuse,e.mapDiffuseRepeat,e.mapDiffuseOffset,e.mapDiffuseWrap),e.mapLight&&t&&o(c,"lightMap",e.mapLight,e.mapLightRepeat,e.mapLightOffset,e.mapLightWrap),e.mapNormal&&t&&o(c,"normalMap",e.mapNormal,e.mapNormalRepeat,e.mapNormalOffset,e.mapNormalWrap),e.mapSpecular&&t&&o(c,"specularMap",e.mapSpecular,e.mapSpecularRepeat,e.mapSpecularOffset,e.mapSpecularWrap),e.mapNormal?(l=THREE.ShaderUtils.lib.normal,u=THREE.UniformsUtils.clone(l.uniforms),u.tNormal.texture=c.normalMap,e.mapNormalFactor&&(u.uNormalScale.value=e.mapNormalFactor),c.map&&(u.tDiffuse.texture=c.map,u.enableDiffuse.value=!0),c.specularMap&&(u.tSpecular.texture=c.specularMap,u.enableSpecular.value=!0),c.lightMap&&(u.tAO.texture=c.lightMap,u.enableAO.value=!0),u.uDiffuseColor.value.setHex(c.color),u.uSpecularColor.value.setHex(c.specular),u.uAmbientColor.value.setHex(c.ambient),u.uShininess.value=c.shininess,void 0!==c.opacity&&(u.uOpacity.value=c.opacity),c=new THREE.ShaderMaterial({fragmentShader:l.fragmentShader,vertexShader:l.vertexShader,uniforms:u,lights:!0,fog:!0})):c=new THREE[l](c),void 0!==e.DbgName&&(c.name=e.DbgName),c}},THREE.BinaryLoader=function(e){THREE.Loader.call(this,e)},THREE.BinaryLoader.prototype=new THREE.Loader,THREE.BinaryLoader.prototype.constructor=THREE.BinaryLoader,THREE.BinaryLoader.prototype.load=function(e,t,n,r){var n=n||this.extractUrlBase(e),r=r||this.extractUrlBase(e),i=this.showProgress?THREE.Loader.prototype.updateProgress:null;this.onLoadStart(),this.loadAjaxJSON(this,e,t,n,r,i)},THREE.BinaryLoader.prototype.loadAjaxJSON=function(e,t,n,r,i,o){var a=new XMLHttpRequest;a.onreadystatechange=function(){if(4==a.readyState)if(200==a.status||0==a.status){var s=JSON.parse(a.responseText);e.loadAjaxBuffers(s,n,i,r,o)}else console.error("THREE.BinaryLoader: Couldn't load ["+t+"] ["+a.status+"]")},a.open("GET",t,!0),a.overrideMimeType&&a.overrideMimeType("text/plain; charset=x-user-defined"),a.setRequestHeader("Content-Type","text/plain"),a.send(null)},THREE.BinaryLoader.prototype.loadAjaxBuffers=function(e,t,n,r,i){var o=new XMLHttpRequest,a=n+"/"+e.buffers,s=0;o.onreadystatechange=function(){4==o.readyState?200==o.status||0==o.status?THREE.BinaryLoader.prototype.createBinModel(o.response,t,r,e.materials):console.error("THREE.BinaryLoader: Couldn't load ["+a+"] ["+o.status+"]"):3==o.readyState?i&&(0==s&&(s=o.getResponseHeader("Content-Length")),i({total:s,loaded:o.responseText.length})):2==o.readyState&&(s=o.getResponseHeader("Content-Length"))},o.open("GET",a,!0),o.responseType="arraybuffer",o.send(null)},THREE.BinaryLoader.prototype.createBinModel=function(e,t,n,r){var i=function(t){function n(e){return e%4?4-e%4:0}function i(e,t){return new Uint8Array(e,t,1)[0]}function o(e,t){return new Uint32Array(e,t,1)[0]}function a(t,n){var r,i,o,a,s,l,c,u,h=new Uint32Array(e,n,3*t);for(r=0;r<t;r++){i=h[3*r],o=h[3*r+1],a=h[3*r+2],s=L[2*i],i=L[2*i+1],l=L[2*o],c=L[2*o+1],o=L[2*a],u=L[2*a+1],a=A.faceVertexUvs[0];var f=[];f.push(new THREE.UV(s,i)),f.push(new THREE.UV(l,c)),f.push(new THREE.UV(o,u)),a.push(f)}}function s(t,n){var r,i,o,a,s,l,c,u,h,f,d=new Uint32Array(e,n,4*t);for(r=0;r<t;r++){i=d[4*r],o=d[4*r+1],a=d[4*r+2],s=d[4*r+3],l=L[2*i],i=L[2*i+1],c=L[2*o],h=L[2*o+1],u=L[2*a],f=L[2*a+1],a=L[2*s],o=L[2*s+1],s=A.faceVertexUvs[0];var p=[];p.push(new THREE.UV(l,i)),p.push(new THREE.UV(c,h)),p.push(new THREE.UV(u,f)),p.push(new THREE.UV(a,o)),s.push(p)}}function l(t,n,r){for(var i,o,a,s,n=new Uint32Array(e,n,3*t),l=new Uint16Array(e,r,t),r=0;r<t;r++)i=n[3*r],o=n[3*r+1],a=n[3*r+2],s=l[r],A.faces.push(new THREE.Face3(i,o,a,null,null,s))}function c(t,n,r){for(var i,o,a,s,l,n=new Uint32Array(e,n,4*t),c=new Uint16Array(e,r,t),r=0;r<t;r++)i=n[4*r],o=n[4*r+1],a=n[4*r+2],s=n[4*r+3],l=c[r],A.faces.push(new THREE.Face4(i,o,a,s,null,null,l))}function u(t,n,r,i){for(var o,a,s,l,c,u,h,n=new Uint32Array(e,n,3*t),r=new Uint32Array(e,r,3*t),f=new Uint16Array(e,i,t),i=0;i<t;i++){o=n[3*i],a=n[3*i+1],s=n[3*i+2],c=r[3*i],u=r[3*i+1],h=r[3*i+2],l=f[i];var d=D[3*u],p=D[3*u+1];u=D[3*u+2];var m=D[3*h],v=D[3*h+1];h=D[3*h+2],A.faces.push(new THREE.Face3(o,a,s,[new THREE.Vector3(D[3*c],D[3*c+1],D[3*c+2]),new THREE.Vector3(d,p,u),new THREE.Vector3(m,v,h)],null,l))}}function h(t,n,r,i){for(var o,a,s,l,c,u,h,f,d,n=new Uint32Array(e,n,4*t),r=new Uint32Array(e,r,4*t),p=new Uint16Array(e,i,t),i=0;i<t;i++){o=n[4*i],a=n[4*i+1],s=n[4*i+2],l=n[4*i+3],u=r[4*i],h=r[4*i+1],f=r[4*i+2],d=r[4*i+3],c=p[i];var m=D[3*h],v=D[3*h+1];h=D[3*h+2];var g=D[3*f],E=D[3*f+1];f=D[3*f+2];var y=D[3*d],x=D[3*d+1];d=D[3*d+2],A.faces.push(new THREE.Face4(o,a,s,l,[new THREE.Vector3(D[3*u],D[3*u+1],D[3*u+2]),new THREE.Vector3(m,v,h),new THREE.Vector3(g,E,f),new THREE.Vector3(y,x,d)],null,c))}}var f,d,p,m,v,g,E,y,x,T,b,R,w,_,H,M,S,C,A=this,P=0,D=[],L=[];THREE.Geometry.call(this),THREE.Loader.prototype.initMaterials(A,r,t),function(e,t,n){for(var e=new Uint8Array(e,t,12),r="",i=0;i<12;i++)r+=String.fromCharCode(e[t+i])}(e,P),f=i(e,P+12),i(e,P+13),i(e,P+14),i(e,P+15),d=i(e,P+16),p=i(e,P+17),m=i(e,P+18),v=i(e,P+19),g=o(e,P+20),E=o(e,P+20+4),y=o(e,P+20+8),t=o(e,P+20+12),x=o(e,P+20+16),T=o(e,P+20+20),b=o(e,P+20+24),R=o(e,P+20+28),w=o(e,P+20+32),_=o(e,P+20+36),H=o(e,P+20+40),P+=f,f=3*d+v,C=4*d+v,M=t*f,S=x*(f+3*p),d=T*(f+3*m),v=b*(f+3*p+3*m),f=R*C,p=w*(C+4*p),m=_*(C+4*m),P+=function(t){var n,r,i,o,t=new Float32Array(e,t,3*g);for(n=0;n<g;n++)r=t[3*n],i=t[3*n+1],o=t[3*n+2],A.vertices.push(new THREE.Vector3(r,i,o));return 3*g*Float32Array.BYTES_PER_ELEMENT}(P),P+=function(t){if(E){var n,r,i,o,t=new Int8Array(e,t,3*E);for(n=0;n<E;n++)r=t[3*n],i=t[3*n+1],o=t[3*n+2],D.push(r/127,i/127,o/127)}return 3*E*Int8Array.BYTES_PER_ELEMENT}(P),P+=n(3*E),P+=function(t){if(y){var n,r,i,t=new Float32Array(e,t,2*y);for(n=0;n<y;n++)r=t[2*n],i=t[2*n+1],L.push(r,i)}return 2*y*Float32Array.BYTES_PER_ELEMENT}(P),M=P+M+n(2*t),S=M+S+n(2*x),d=S+d+n(2*T),v=d+v+n(2*b),f=v+f+n(2*R),p=f+p+n(2*w),m=p+m+n(2*_),function(e){if(T){var t=e+T*Uint32Array.BYTES_PER_ELEMENT*3;l(T,e,t+T*Uint32Array.BYTES_PER_ELEMENT*3),a(T,t)}}(S),function(e){if(b){var t=e+b*Uint32Array.BYTES_PER_ELEMENT*3,n=t+b*Uint32Array.BYTES_PER_ELEMENT*3;u(b,e,t,n+b*Uint32Array.BYTES_PER_ELEMENT*3),a(b,n)}}(d),function(e){if(_){var t=e+_*Uint32Array.BYTES_PER_ELEMENT*4;c(_,e,t+_*Uint32Array.BYTES_PER_ELEMENT*4),s(_,t)}}(p),function(e){if(H){var t=e+H*Uint32Array.BYTES_PER_ELEMENT*4,n=t+H*Uint32Array.BYTES_PER_ELEMENT*4;h(H,e,t,n+H*Uint32Array.BYTES_PER_ELEMENT*4),s(H,n)}}(m),t&&l(t,P,P+t*Uint32Array.BYTES_PER_ELEMENT*3),function(e){if(x){var t=e+x*Uint32Array.BYTES_PER_ELEMENT*3;u(x,e,t,t+x*Uint32Array.BYTES_PER_ELEMENT*3)}}(M),R&&c(R,v,v+R*Uint32Array.BYTES_PER_ELEMENT*4),function(e){if(w){var t=e+w*Uint32Array.BYTES_PER_ELEMENT*4;h(w,e,t,t+w*Uint32Array.BYTES_PER_ELEMENT*4)}}(f),this.computeCentroids(),this.computeFaceNormals(),THREE.Loader.prototype.hasNormals(this)&&this.computeTangents()};i.prototype=new THREE.Geometry,i.prototype.constructor=i,t(new i(n))},THREE.JSONLoader=function(e){THREE.Loader.call(this,e)},THREE.JSONLoader.prototype=new THREE.Loader,THREE.JSONLoader.prototype.constructor=THREE.JSONLoader,THREE.JSONLoader.prototype.load=function(e,t,n){n=n||this.extractUrlBase(e),this.onLoadStart(),this.loadAjaxJSON(this,e,t,n)},THREE.JSONLoader.prototype.loadAjaxJSON=function(e,t,n,r,i){var o=new XMLHttpRequest,a=0;o.onreadystatechange=function(){if(o.readyState===o.DONE)if(200===o.status||0===o.status){if(o.responseText){var s=JSON.parse(o.responseText);e.createModel(s,n,r)}else console.warn("THREE.JSONLoader: ["+t+"] seems to be unreachable or file there is empty");e.onLoadComplete()}else console.error("THREE.JSONLoader: Couldn't load ["+t+"] ["+o.status+"]");else o.readyState===o.LOADING?i&&(0===a&&(a=o.getResponseHeader("Content-Length")),i({total:a,loaded:o.responseText.length})):o.readyState===o.HEADERS_RECEIVED&&(a=o.getResponseHeader("Content-Length"))},o.open("GET",t,!0),o.overrideMimeType&&o.overrideMimeType("text/plain; charset=x-user-defined"),o.setRequestHeader("Content-Type","text/plain"),o.send(null)},THREE.JSONLoader.prototype.createModel=function(e,t,n){var r=new THREE.Geometry,i=void 0!==e.scale?1/e.scale:1;this.initMaterials(r,e.materials,n),function(t){var n,i,o,a,s,l,c,u,h,f,d,p,m,v,g=e.faces;l=e.vertices;var E=e.normals,y=e.colors,x=0;for(n=0;n<e.uvs.length;n++)e.uvs[n].length&&x++;for(n=0;n<x;n++)r.faceUvs[n]=[],r.faceVertexUvs[n]=[];for(a=0,s=l.length;a<s;)c=new THREE.Vector3,c.x=l[a++]*t,c.y=l[a++]*t,c.z=l[a++]*t,r.vertices.push(c);for(a=0,s=g.length;a<s;){if(t=g[a++],l=1&t,o=2&t,n=4&t,i=8&t,u=16&t,c=32&t,f=64&t,t&=128,l?(d=new THREE.Face4,d.a=g[a++],d.b=g[a++],d.c=g[a++],d.d=g[a++],l=4):(d=new THREE.Face3,d.a=g[a++],d.b=g[a++],d.c=g[a++],l=3),o&&(o=g[a++],d.materialIndex=o),o=r.faces.length,n)for(n=0;n<x;n++)p=e.uvs[n],h=g[a++],v=p[2*h],h=p[2*h+1],r.faceUvs[n][o]=new THREE.UV(v,h);if(i)for(n=0;n<x;n++){for(p=e.uvs[n],m=[],i=0;i<l;i++)h=g[a++],v=p[2*h],h=p[2*h+1],m[i]=new THREE.UV(v,h);r.faceVertexUvs[n][o]=m}if(u&&(u=3*g[a++],i=new THREE.Vector3,i.x=E[u++],i.y=E[u++],i.z=E[u],d.normal=i),c)for(n=0;n<l;n++)u=3*g[a++],i=new THREE.Vector3,i.x=E[u++],i.y=E[u++],i.z=E[u],d.vertexNormals.push(i);if(f&&(c=g[a++],c=new THREE.Color(y[c]),d.color=c),t)for(n=0;n<l;n++)c=g[a++],c=new THREE.Color(y[c]),d.vertexColors.push(c);r.faces.push(d)}}(i),function(){var t,n,i,o;if(e.skinWeights)for(t=0,n=e.skinWeights.length;t<n;t+=2)i=e.skinWeights[t],o=e.skinWeights[t+1],r.skinWeights.push(new THREE.Vector4(i,o,0,0));if(e.skinIndices)for(t=0,n=e.skinIndices.length;t<n;t+=2)i=e.skinIndices[t],o=e.skinIndices[t+1],r.skinIndices.push(new THREE.Vector4(i,o,0,0));r.bones=e.bones,r.animation=e.animation}(),function(t){if(void 0!==e.morphTargets){var n,i,o,a,s,l;for(n=0,i=e.morphTargets.length;n<i;n++)for(r.morphTargets[n]={},r.morphTargets[n].name=e.morphTargets[n].name,r.morphTargets[n].vertices=[],s=r.morphTargets[n].vertices,l=e.morphTargets[n].vertices,o=0,a=l.length;o<a;o+=3){var c=new THREE.Vector3;c.x=l[o]*t,c.y=l[o+1]*t,c.z=l[o+2]*t,s.push(c)}}if(void 0!==e.morphColors)for(n=0,i=e.morphColors.length;n<i;n++)for(r.morphColors[n]={},r.morphColors[n].name=e.morphColors[n].name,r.morphColors[n].colors=[],a=r.morphColors[n].colors,s=e.morphColors[n].colors,t=0,o=s.length;t<o;t+=3)l=new THREE.Color(16755200),l.setRGB(s[t],s[t+1],s[t+2]),a.push(l)}(i),r.computeCentroids(),r.computeFaceNormals(),this.hasNormals(r)&&r.computeTangents(),t(r)},THREE.SceneLoader=function(){this.onLoadStart=function(){},this.onLoadProgress=function(){},this.onLoadComplete=function(){},this.callbackSync=function(){},this.callbackProgress=function(){}},THREE.SceneLoader.prototype.constructor=THREE.SceneLoader,THREE.SceneLoader.prototype.load=function(e,t){var n=this,r=new XMLHttpRequest;r.onreadystatechange=function(){if(4==r.readyState)if(200==r.status||0==r.status){var i=JSON.parse(r.responseText);n.createScene(i,t,e)}else console.error("THREE.SceneLoader: Couldn't load ["+e+"] ["+r.status+"]")},r.open("GET",e,!0),r.overrideMimeType&&r.overrideMimeType("text/plain; charset=x-user-defined"),r.setRequestHeader("Content-Type","text/plain"),r.send(null)},THREE.SceneLoader.prototype.createScene=function(e,t,n){function r(e,t){return"relativeToHTML"==t?e:F+"/"+e}function i(){var e;for(c in S.objects)N.objects[c]||(p=S.objects[c],void 0!==p.geometry?(w=N.geometries[p.geometry])&&(e=!1,_=N.materials[p.materials[0]],(e=_ instanceof THREE.ShaderMaterial)&&w.computeTangents(),E=p.position,y=p.rotation,x=p.quaternion,T=p.scale,m=p.matrix,x=0,0==p.materials.length&&(_=new THREE.MeshFaceMaterial),p.materials.length>1&&(_=new THREE.MeshFaceMaterial),e=new THREE.Mesh(w,_),e.name=c,m?(e.matrixAutoUpdate=!1,e.matrix.set(m[0],m[1],m[2],m[3],m[4],m[5],m[6],m[7],m[8],m[9],m[10],m[11],m[12],m[13],m[14],m[15])):(e.position.set(E[0],E[1],E[2]),x?(e.quaternion.set(x[0],x[1],x[2],x[3]),e.useQuaternion=!0):e.rotation.set(y[0],y[1],y[2]),e.scale.set(T[0],T[1],T[2])),e.visible=p.visible,e.doubleSided=p.doubleSided,e.castShadow=p.castShadow,e.receiveShadow=p.receiveShadow,N.scene.add(e),N.objects[c]=e):(E=p.position,y=p.rotation,x=p.quaternion,T=p.scale,x=0,e=new THREE.Object3D,e.name=c,e.position.set(E[0],E[1],E[2]),x?(e.quaternion.set(x[0],x[1],x[2],x[3]),e.useQuaternion=!0):e.rotation.set(y[0],y[1],y[2]),e.scale.set(T[0],T[1],T[2]),e.visible=void 0!==p.visible&&p.visible,N.scene.add(e),N.objects[c]=e,N.empties[c]=e))}function o(e){return function(t){N.geometries[e]=t,i(),A-=1,k.onLoadComplete(),a()}}function a(){k.callbackProgress({totalModels:D,totalTextures:L,loadedModels:D-A,loadedTextures:L-P},N),k.onLoadProgress(),0==A&&0==P&&t(N)}var s,l,c,u,h,f,d,p,m,v,g,E,y,x,T,b,R,w,_,H,M,S,C,A,P,D,L,N,k=this,F=THREE.Loader.prototype.extractUrlBase(n);S=e,n=new THREE.BinaryLoader,C=new THREE.JSONLoader,P=A=0,N={scene:new THREE.Scene,geometries:{},materials:{},textures:{},objects:{},cameras:{},lights:{},fogs:{},empties:{}},S.transform&&(e=S.transform.position,v=S.transform.rotation,b=S.transform.scale,e&&N.scene.position.set(e[0],e[1],e[2]),v&&N.scene.rotation.set(v[0],v[1],v[2]),b&&N.scene.scale.set(b[0],b[1],b[2]),(e||v||b)&&(N.scene.updateMatrix(),N.scene.updateMatrixWorld())),e=function(){P-=1,a(),k.onLoadComplete()};for(h in S.cameras)b=S.cameras[h],"perspective"==b.type?H=new THREE.PerspectiveCamera(b.fov,b.aspect,b.near,b.far):"ortho"==b.type&&(H=new THREE.OrthographicCamera(b.left,b.right,b.top,b.bottom,b.near,b.far)),E=b.position,v=b.target,b=b.up,H.position.set(E[0],E[1],E[2]),H.target=new THREE.Vector3(v[0],v[1],v[2]),b&&H.up.set(b[0],b[1],b[2]),N.cameras[h]=H;for(u in S.lights)v=S.lights[u],h=void 0!==v.color?v.color:16777215,H=void 0!==v.intensity?v.intensity:1,"directional"==v.type?(E=v.direction,g=new THREE.DirectionalLight(h,H),g.position.set(E[0],E[1],E[2]),g.position.normalize()):"point"==v.type?(E=v.position,g=v.distance,g=new THREE.PointLight(h,H,g),g.position.set(E[0],E[1],E[2])):"ambient"==v.type&&(g=new THREE.AmbientLight(h)),N.scene.add(g),N.lights[u]=g;for(f in S.fogs)u=S.fogs[f],"linear"==u.type?M=new THREE.Fog(0,u.near,u.far):"exp2"==u.type&&(M=new THREE.FogExp2(0,u.density)),b=u.color,M.color.setRGB(b[0],b[1],b[2]),N.fogs[f]=M;N.cameras&&S.defaults.camera&&(N.currentCamera=N.cameras[S.defaults.camera]),N.fogs&&S.defaults.fog&&(N.scene.fog=N.fogs[S.defaults.fog]),b=S.defaults.bgcolor,N.bgColor=new THREE.Color,N.bgColor.setRGB(b[0],b[1],b[2]),N.bgColorAlpha=S.defaults.bgalpha;for(s in S.geometries)f=S.geometries[s],"bin_mesh"!=f.type&&"ascii_mesh"!=f.type||(A+=1,k.onLoadStart());D=A;for(s in S.geometries)f=S.geometries[s],"cube"==f.type?(w=new THREE.CubeGeometry(f.width,f.height,f.depth,f.segmentsWidth,f.segmentsHeight,f.segmentsDepth,null,f.flipped,f.sides),N.geometries[s]=w):"plane"==f.type?(w=new THREE.PlaneGeometry(f.width,f.height,f.segmentsWidth,f.segmentsHeight),N.geometries[s]=w):"sphere"==f.type?(w=new THREE.SphereGeometry(f.radius,f.segmentsWidth,f.segmentsHeight),N.geometries[s]=w):"cylinder"==f.type?(w=new THREE.CylinderGeometry(f.topRad,f.botRad,f.height,f.radSegs,f.heightSegs),N.geometries[s]=w):"torus"==f.type?(w=new THREE.TorusGeometry(f.radius,f.tube,f.segmentsR,f.segmentsT),N.geometries[s]=w):"icosahedron"==f.type?(w=new THREE.IcosahedronGeometry(f.radius,f.subdivisions),N.geometries[s]=w):"bin_mesh"==f.type?n.load(r(f.url,S.urlBaseType),o(s)):"ascii_mesh"==f.type?C.load(r(f.url,S.urlBaseType),o(s)):"embedded_mesh"==f.type&&(f=S.embeds[f.id],f.metadata=S.metadata,f&&C.createModel(f,function(e){return function(t){N.geometries[e]=t}}(s),""));for(d in S.textures)if(s=S.textures[d],s.url instanceof Array)for(P+=s.url.length,f=0;f<s.url.length;f++)k.onLoadStart();else P+=1,k.onLoadStart();L=P;for(d in S.textures){if(s=S.textures[d],void 0!=s.mapping&&void 0!=THREE[s.mapping]&&(s.mapping=new THREE[s.mapping]),s.url instanceof Array){for(f=[],M=0;M<s.url.length;M++)f[M]=r(s.url[M],S.urlBaseType);f=THREE.ImageUtils.loadTextureCube(f,s.mapping,e)}else f=THREE.ImageUtils.loadTexture(r(s.url,S.urlBaseType),s.mapping,e),void 0!=THREE[s.minFilter]&&(f.minFilter=THREE[s.minFilter]),void 0!=THREE[s.magFilter]&&(f.magFilter=THREE[s.magFilter]),s.repeat&&(f.repeat.set(s.repeat[0],s.repeat[1]),1!=s.repeat[0]&&(f.wrapS=THREE.RepeatWrapping),1!=s.repeat[1]&&(f.wrapT=THREE.RepeatWrapping)),s.offset&&f.offset.set(s.offset[0],s.offset[1]),s.wrap&&(M={repeat:THREE.RepeatWrapping,mirror:THREE.MirroredRepeatWrapping},void 0!==M[s.wrap[0]]&&(f.wrapS=M[s.wrap[0]]),void 0!==M[s.wrap[1]]&&(f.wrapT=M[s.wrap[1]]));N.textures[d]=f}for(l in S.materials){m=S.materials[l];for(R in m.parameters)"envMap"==R||"map"==R||"lightMap"==R?m.parameters[R]=N.textures[m.parameters[R]]:"shading"==R?m.parameters[R]="flat"==m.parameters[R]?THREE.FlatShading:THREE.SmoothShading:"blending"==R?m.parameters[R]=THREE[m.parameters[R]]?THREE[m.parameters[R]]:THREE.NormalBlending:"combine"==R?m.parameters[R]="MixOperation"==m.parameters[R]?THREE.MixOperation:THREE.MultiplyOperation:"vertexColors"==R&&("face"==m.parameters[R]?m.parameters[R]=THREE.FaceColors:m.parameters[R]&&(m.parameters[R]=THREE.VertexColors));void 0!==m.parameters.opacity&&m.parameters.opacity<1&&(m.parameters.transparent=!0),m.parameters.normalMap?(d=THREE.ShaderUtils.lib.normal,e=THREE.UniformsUtils.clone(d.uniforms),s=m.parameters.color,f=m.parameters.specular,M=m.parameters.ambient,n=m.parameters.shininess,e.tNormal.texture=N.textures[m.parameters.normalMap],m.parameters.normalMapFactor&&(e.uNormalScale.value=m.parameters.normalMapFactor),m.parameters.map&&(e.tDiffuse.texture=m.parameters.map,e.enableDiffuse.value=!0),m.parameters.lightMap&&(e.tAO.texture=m.parameters.lightMap,e.enableAO.value=!0),m.parameters.specularMap&&(e.tSpecular.texture=N.textures[m.parameters.specularMap],e.enableSpecular.value=!0),e.uDiffuseColor.value.setHex(s),e.uSpecularColor.value.setHex(f),e.uAmbientColor.value.setHex(M),e.uShininess.value=n,m.parameters.opacity&&(e.uOpacity.value=m.parameters.opacity),_=new THREE.ShaderMaterial({fragmentShader:d.fragmentShader,vertexShader:d.vertexShader,uniforms:e,lights:!0,fog:!0})):_=new THREE[m.type](m.parameters),N.materials[l]=_}i(),k.callbackSync(N),a()},THREE.Material=function(e){e=e||{},this.id=THREE.MaterialCount++,this.name="",this.opacity=void 0!==e.opacity?e.opacity:1,this.transparent=void 0!==e.transparent&&e.transparent,this.blending=void 0!==e.blending?e.blending:THREE.NormalBlending,this.blendSrc=void 0!==e.blendSrc?e.blendSrc:THREE.SrcAlphaFactor,this.blendDst=void 0!==e.blendDst?e.blendDst:THREE.OneMinusSrcAlphaFactor,this.blendEquation=void 0!==e.blendEquation?e.blendEquation:THREE.AddEquation,this.depthTest=void 0===e.depthTest||e.depthTest,this.depthWrite=void 0===e.depthWrite||e.depthWrite,this.polygonOffset=void 0!==e.polygonOffset&&e.polygonOffset,this.polygonOffsetFactor=void 0!==e.polygonOffsetFactor?e.polygonOffsetFactor:0,this.polygonOffsetUnits=void 0!==e.polygonOffsetUnits?e.polygonOffsetUnits:0,this.alphaTest=void 0!==e.alphaTest?e.alphaTest:0,this.overdraw=void 0!==e.overdraw&&e.overdraw,this.needsUpdate=this.visible=!0},THREE.MaterialCount=0,THREE.NoShading=0,THREE.FlatShading=1,THREE.SmoothShading=2,THREE.NoColors=0,THREE.FaceColors=1,THREE.VertexColors=2,THREE.NoBlending=0,THREE.NormalBlending=1,THREE.AdditiveBlending=2,THREE.SubtractiveBlending=3,THREE.MultiplyBlending=4,THREE.AdditiveAlphaBlending=5,THREE.CustomBlending=6,THREE.AddEquation=100,THREE.SubtractEquation=101,THREE.ReverseSubtractEquation=102,THREE.ZeroFactor=200,THREE.OneFactor=201,THREE.SrcColorFactor=202,THREE.OneMinusSrcColorFactor=203,THREE.SrcAlphaFactor=204,THREE.OneMinusSrcAlphaFactor=205,THREE.DstAlphaFactor=206,THREE.OneMinusDstAlphaFactor=207,THREE.DstColorFactor=208,THREE.OneMinusDstColorFactor=209,THREE.SrcAlphaSaturateFactor=210,THREE.LineBasicMaterial=function(e){THREE.Material.call(this,e),e=e||{},this.color=void 0!==e.color?new THREE.Color(e.color):new THREE.Color(16777215),this.linewidth=void 0!==e.linewidth?e.linewidth:1,this.linecap=void 0!==e.linecap?e.linecap:"round",this.linejoin=void 0!==e.linejoin?e.linejoin:"round",this.vertexColors=!!e.vertexColors&&e.vertexColors,this.fog=void 0===e.fog||e.fog},THREE.LineBasicMaterial.prototype=new THREE.Material,THREE.LineBasicMaterial.prototype.constructor=THREE.LineBasicMaterial,THREE.MeshBasicMaterial=function(e){THREE.Material.call(this,e),e=e||{},this.color=void 0!==e.color?new THREE.Color(e.color):new THREE.Color(16777215),this.map=void 0!==e.map?e.map:null,this.lightMap=void 0!==e.lightMap?e.lightMap:null,this.envMap=void 0!==e.envMap?e.envMap:null,this.combine=void 0!==e.combine?e.combine:THREE.MultiplyOperation,this.reflectivity=void 0!==e.reflectivity?e.reflectivity:1,this.refractionRatio=void 0!==e.refractionRatio?e.refractionRatio:.98,this.fog=void 0===e.fog||e.fog,this.shading=void 0!==e.shading?e.shading:THREE.SmoothShading,this.wireframe=void 0!==e.wireframe&&e.wireframe,this.wireframeLinewidth=void 0!==e.wireframeLinewidth?e.wireframeLinewidth:1,this.wireframeLinecap=void 0!==e.wireframeLinecap?e.wireframeLinecap:"round",this.wireframeLinejoin=void 0!==e.wireframeLinejoin?e.wireframeLinejoin:"round",this.vertexColors=void 0!==e.vertexColors?e.vertexColors:THREE.NoColors,this.skinning=void 0!==e.skinning&&e.skinning,this.morphTargets=void 0!==e.morphTargets&&e.morphTargets},THREE.MeshBasicMaterial.prototype=new THREE.Material,THREE.MeshBasicMaterial.prototype.constructor=THREE.MeshBasicMaterial,THREE.MeshLambertMaterial=function(e){THREE.Material.call(this,e),e=e||{},this.color=void 0!==e.color?new THREE.Color(e.color):new THREE.Color(16777215),this.ambient=void 0!==e.ambient?new THREE.Color(e.ambient):new THREE.Color(16777215),this.emissive=void 0!==e.emissive?new THREE.Color(e.emissive):new THREE.Color(0),this.wrapAround=void 0!==e.wrapAround&&e.wrapAround,this.wrapRGB=new THREE.Vector3(1,1,1),this.map=void 0!==e.map?e.map:null,this.lightMap=void 0!==e.lightMap?e.lightMap:null,this.envMap=void 0!==e.envMap?e.envMap:null,this.combine=void 0!==e.combine?e.combine:THREE.MultiplyOperation,this.reflectivity=void 0!==e.reflectivity?e.reflectivity:1,this.refractionRatio=void 0!==e.refractionRatio?e.refractionRatio:.98,this.fog=void 0===e.fog||e.fog,this.shading=void 0!==e.shading?e.shading:THREE.SmoothShading,this.wireframe=void 0!==e.wireframe&&e.wireframe,this.wireframeLinewidth=void 0!==e.wireframeLinewidth?e.wireframeLinewidth:1,this.wireframeLinecap=void 0!==e.wireframeLinecap?e.wireframeLinecap:"round",this.wireframeLinejoin=void 0!==e.wireframeLinejoin?e.wireframeLinejoin:"round",this.vertexColors=void 0!==e.vertexColors?e.vertexColors:THREE.NoColors,this.skinning=void 0!==e.skinning&&e.skinning,this.morphTargets=void 0!==e.morphTargets&&e.morphTargets,this.morphNormals=void 0!==e.morphNormals&&e.morphNormals},THREE.MeshLambertMaterial.prototype=new THREE.Material,THREE.MeshLambertMaterial.prototype.constructor=THREE.MeshLambertMaterial,THREE.MeshPhongMaterial=function(e){THREE.Material.call(this,e),e=e||{},this.color=void 0!==e.color?new THREE.Color(e.color):new THREE.Color(16777215),this.ambient=void 0!==e.ambient?new THREE.Color(e.ambient):new THREE.Color(16777215),this.emissive=void 0!==e.emissive?new THREE.Color(e.emissive):new THREE.Color(0),this.specular=void 0!==e.specular?new THREE.Color(e.specular):new THREE.Color(1118481),this.shininess=void 0!==e.shininess?e.shininess:30,this.metal=void 0!==e.metal&&e.metal,this.perPixel=void 0!==e.perPixel&&e.perPixel,this.wrapAround=void 0!==e.wrapAround&&e.wrapAround,this.wrapRGB=new THREE.Vector3(1,1,1),this.map=void 0!==e.map?e.map:null,this.lightMap=void 0!==e.lightMap?e.lightMap:null,this.envMap=void 0!==e.envMap?e.envMap:null,this.combine=void 0!==e.combine?e.combine:THREE.MultiplyOperation,this.reflectivity=void 0!==e.reflectivity?e.reflectivity:1,this.refractionRatio=void 0!==e.refractionRatio?e.refractionRatio:.98,this.fog=void 0===e.fog||e.fog,this.shading=void 0!==e.shading?e.shading:THREE.SmoothShading,this.wireframe=void 0!==e.wireframe&&e.wireframe,this.wireframeLinewidth=void 0!==e.wireframeLinewidth?e.wireframeLinewidth:1,this.wireframeLinecap=void 0!==e.wireframeLinecap?e.wireframeLinecap:"round",this.wireframeLinejoin=void 0!==e.wireframeLinejoin?e.wireframeLinejoin:"round",this.vertexColors=void 0!==e.vertexColors?e.vertexColors:THREE.NoColors,this.skinning=void 0!==e.skinning&&e.skinning,this.morphTargets=void 0!==e.morphTargets&&e.morphTargets,this.morphNormals=void 0!==e.morphNormals&&e.morphNormals},THREE.MeshPhongMaterial.prototype=new THREE.Material,THREE.MeshPhongMaterial.prototype.constructor=THREE.MeshPhongMaterial,THREE.MeshDepthMaterial=function(e){THREE.Material.call(this,e),e=e||{},this.shading=void 0!==e.shading?e.shading:THREE.SmoothShading,this.wireframe=void 0!==e.wireframe&&e.wireframe,this.wireframeLinewidth=void 0!==e.wireframeLinewidth?e.wireframeLinewidth:1},THREE.MeshDepthMaterial.prototype=new THREE.Material,THREE.MeshDepthMaterial.prototype.constructor=THREE.MeshDepthMaterial,THREE.MeshNormalMaterial=function(e){THREE.Material.call(this,e),e=e||{},this.shading=e.shading?e.shading:THREE.FlatShading,this.wireframe=!!e.wireframe&&e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth?e.wireframeLinewidth:1},THREE.MeshNormalMaterial.prototype=new THREE.Material,THREE.MeshNormalMaterial.prototype.constructor=THREE.MeshNormalMaterial,THREE.MeshFaceMaterial=function(){},THREE.ParticleBasicMaterial=function(e){THREE.Material.call(this,e),e=e||{},this.color=void 0!==e.color?new THREE.Color(e.color):new THREE.Color(16777215),this.map=void 0!==e.map?e.map:null,this.size=void 0!==e.size?e.size:1,this.sizeAttenuation=void 0===e.sizeAttenuation||e.sizeAttenuation,this.vertexColors=void 0!==e.vertexColors&&e.vertexColors,this.fog=void 0===e.fog||e.fog},THREE.ParticleBasicMaterial.prototype=new THREE.Material,THREE.ParticleBasicMaterial.prototype.constructor=THREE.ParticleBasicMaterial,THREE.ParticleCanvasMaterial=function(e){THREE.Material.call(this,e),e=e||{},this.color=void 0!==e.color?new THREE.Color(e.color):new THREE.Color(16777215),this.program=void 0!==e.program?e.program:function(){}},THREE.ParticleCanvasMaterial.prototype=new THREE.Material,THREE.ParticleCanvasMaterial.prototype.constructor=THREE.ParticleCanvasMaterial,THREE.ParticleDOMMaterial=function(e){THREE.Material.call(this),this.domElement=e},THREE.ShaderMaterial=function(e){THREE.Material.call(this,e),e=e||{},this.fragmentShader=void 0!==e.fragmentShader?e.fragmentShader:"void main() {}",this.vertexShader=void 0!==e.vertexShader?e.vertexShader:"void main() {}",this.uniforms=void 0!==e.uniforms?e.uniforms:{},this.attributes=e.attributes,this.shading=void 0!==e.shading?e.shading:THREE.SmoothShading,this.wireframe=void 0!==e.wireframe&&e.wireframe,this.wireframeLinewidth=void 0!==e.wireframeLinewidth?e.wireframeLinewidth:1,this.fog=void 0!==e.fog&&e.fog,this.lights=void 0!==e.lights&&e.lights,this.vertexColors=void 0!==e.vertexColors?e.vertexColors:THREE.NoColors,this.skinning=void 0!==e.skinning&&e.skinning,this.morphTargets=void 0!==e.morphTargets&&e.morphTargets,this.morphNormals=void 0!==e.morphNormals&&e.morphNormals},THREE.ShaderMaterial.prototype=new THREE.Material,THREE.ShaderMaterial.prototype.constructor=THREE.ShaderMaterial,THREE.Texture=function(e,t,n,r,i,o,a,s){this.id=THREE.TextureCount++,this.image=e,this.mapping=void 0!==t?t:new THREE.UVMapping,this.wrapS=void 0!==n?n:THREE.ClampToEdgeWrapping,this.wrapT=void 0!==r?r:THREE.ClampToEdgeWrapping,
this.magFilter=void 0!==i?i:THREE.LinearFilter,this.minFilter=void 0!==o?o:THREE.LinearMipMapLinearFilter,this.format=void 0!==a?a:THREE.RGBAFormat,this.type=void 0!==s?s:THREE.UnsignedByteType,this.offset=new THREE.Vector2(0,0),this.repeat=new THREE.Vector2(1,1),this.generateMipmaps=!0,this.needsUpdate=this.premultiplyAlpha=!1,this.onUpdate=null},THREE.Texture.prototype={constructor:THREE.Texture,clone:function(){var e=new THREE.Texture(this.image,this.mapping,this.wrapS,this.wrapT,this.magFilter,this.minFilter,this.format,this.type);return e.offset.copy(this.offset),e.repeat.copy(this.repeat),e}},THREE.TextureCount=0,THREE.MultiplyOperation=0,THREE.MixOperation=1,THREE.UVMapping=function(){},THREE.CubeReflectionMapping=function(){},THREE.CubeRefractionMapping=function(){},THREE.SphericalReflectionMapping=function(){},THREE.SphericalRefractionMapping=function(){},THREE.RepeatWrapping=0,THREE.ClampToEdgeWrapping=1,THREE.MirroredRepeatWrapping=2,THREE.NearestFilter=3,THREE.NearestMipMapNearestFilter=4,THREE.NearestMipMapLinearFilter=5,THREE.LinearFilter=6,THREE.LinearMipMapNearestFilter=7,THREE.LinearMipMapLinearFilter=8,THREE.ByteType=9,THREE.UnsignedByteType=10,THREE.ShortType=11,THREE.UnsignedShortType=12,THREE.IntType=13,THREE.UnsignedIntType=14,THREE.FloatType=15,THREE.AlphaFormat=16,THREE.RGBFormat=17,THREE.RGBAFormat=18,THREE.LuminanceFormat=19,THREE.LuminanceAlphaFormat=20,THREE.DataTexture=function(e,t,n,r,i,o,a,s,l,c){THREE.Texture.call(this,null,o,a,s,l,c,r,i),this.image={data:e,width:t,height:n}},THREE.DataTexture.prototype=new THREE.Texture,THREE.DataTexture.prototype.constructor=THREE.DataTexture,THREE.DataTexture.prototype.clone=function(){var e=new THREE.DataTexture(this.image.data,this.image.width,this.image.height,this.format,this.type,this.mapping,this.wrapS,this.wrapT,this.magFilter,this.minFilter);return e.offset.copy(this.offset),e.repeat.copy(this.repeat),e},THREE.Particle=function(e){THREE.Object3D.call(this),this.material=e},THREE.Particle.prototype=new THREE.Object3D,THREE.Particle.prototype.constructor=THREE.Particle,THREE.ParticleSystem=function(e,t){THREE.Object3D.call(this),this.geometry=e,this.material=void 0!==t?t:new THREE.ParticleBasicMaterial({color:16777215*Math.random()}),this.sortParticles=!1,this.geometry&&(this.geometry.boundingSphere||this.geometry.computeBoundingSphere(),this.boundRadius=e.boundingSphere.radius),this.frustumCulled=!1},THREE.ParticleSystem.prototype=new THREE.Object3D,THREE.ParticleSystem.prototype.constructor=THREE.ParticleSystem,THREE.Line=function(e,t,n){THREE.Object3D.call(this),this.geometry=e,this.material=void 0!==t?t:new THREE.LineBasicMaterial({color:16777215*Math.random()}),this.type=void 0!==n?n:THREE.LineStrip,this.geometry&&(this.geometry.boundingSphere||this.geometry.computeBoundingSphere())},THREE.LineStrip=0,THREE.LinePieces=1;THREE.Line.prototype=new THREE.Object3D,THREE.Line.prototype.constructor=THREE.Line,THREE.Mesh=function(e,t){if(THREE.Object3D.call(this),this.geometry=e,this.material=void 0!==t?t:new THREE.MeshBasicMaterial({color:16777215*Math.random(),wireframe:!0}),this.geometry&&(this.geometry.boundingSphere||this.geometry.computeBoundingSphere(),this.boundRadius=e.boundingSphere.radius,this.geometry.morphTargets.length)){this.morphTargetBase=-1,this.morphTargetForcedOrder=[],this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var n=0;n<this.geometry.morphTargets.length;n++)this.morphTargetInfluences.push(0),this.morphTargetDictionary[this.geometry.morphTargets[n].name]=n}},THREE.Mesh.prototype=new THREE.Object3D,THREE.Mesh.prototype.constructor=THREE.Mesh,THREE.Mesh.prototype.supr=THREE.Object3D.prototype,THREE.Mesh.prototype.getMorphTargetIndexByName=function(e){return void 0!==this.morphTargetDictionary[e]?this.morphTargetDictionary[e]:(console.log("THREE.Mesh.getMorphTargetIndexByName: morph target "+e+" does not exist. Returning 0."),0)},THREE.Bone=function(e){THREE.Object3D.call(this),this.skin=e,this.skinMatrix=new THREE.Matrix4},THREE.Bone.prototype=new THREE.Object3D,THREE.Bone.prototype.constructor=THREE.Bone,THREE.Bone.prototype.supr=THREE.Object3D.prototype,THREE.Bone.prototype.update=function(e,t){this.matrixAutoUpdate&&(t|=this.updateMatrix()),(t||this.matrixWorldNeedsUpdate)&&(e?this.skinMatrix.multiply(e,this.matrix):this.skinMatrix.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);var n,r=this.children.length;for(n=0;n<r;n++)this.children[n].update(this.skinMatrix,t)},THREE.SkinnedMesh=function(e,t){THREE.Mesh.call(this,e,t),this.identityMatrix=new THREE.Matrix4,this.bones=[],this.boneMatrices=[];var n,r,i,o,a,s;if(void 0!==this.geometry.bones){for(n=0;n<this.geometry.bones.length;n++)i=this.geometry.bones[n],o=i.pos,a=i.rotq,s=i.scl,r=this.addBone(),r.name=i.name,r.position.set(o[0],o[1],o[2]),r.quaternion.set(a[0],a[1],a[2],a[3]),r.useQuaternion=!0,void 0!==s?r.scale.set(s[0],s[1],s[2]):r.scale.set(1,1,1);for(n=0;n<this.bones.length;n++)i=this.geometry.bones[n],r=this.bones[n],-1===i.parent?this.add(r):this.bones[i.parent].add(r);this.boneMatrices=new Float32Array(16*this.bones.length),this.pose()}},THREE.SkinnedMesh.prototype=new THREE.Mesh,THREE.SkinnedMesh.prototype.constructor=THREE.SkinnedMesh,THREE.SkinnedMesh.prototype.addBone=function(e){return void 0===e&&(e=new THREE.Bone(this)),this.bones.push(e),e},THREE.SkinnedMesh.prototype.updateMatrixWorld=function(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent?this.matrixWorld.multiply(this.parent.matrixWorld,this.matrix):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1);for(var e=0,t=this.children.length;e<t;e++){var n=this.children[e];n instanceof THREE.Bone?n.update(this.identityMatrix,!1):n.updateMatrixWorld(!0)}for(var t=this.bones.length,n=this.bones,r=this.boneMatrices,e=0;e<t;e++)n[e].skinMatrix.flattenToArrayOffset(r,16*e)},THREE.SkinnedMesh.prototype.pose=function(){this.updateMatrixWorld(!0);for(var e,t=[],n=0;n<this.bones.length;n++){e=this.bones[n];var r=new THREE.Matrix4;r.getInverse(e.skinMatrix),t.push(r),e.skinMatrix.flattenToArrayOffset(this.boneMatrices,16*n)}if(void 0===this.geometry.skinVerticesA)for(this.geometry.skinVerticesA=[],this.geometry.skinVerticesB=[],e=0;e<this.geometry.skinIndices.length;e++){var n=this.geometry.vertices[e],i=this.geometry.skinIndices[e].x,o=this.geometry.skinIndices[e].y,r=new THREE.Vector3(n.x,n.y,n.z);this.geometry.skinVerticesA.push(t[i].multiplyVector3(r)),r=new THREE.Vector3(n.x,n.y,n.z),this.geometry.skinVerticesB.push(t[o].multiplyVector3(r)),this.geometry.skinWeights[e].x+this.geometry.skinWeights[e].y!==1&&(n=.5*(1-(this.geometry.skinWeights[e].x+this.geometry.skinWeights[e].y)),this.geometry.skinWeights[e].x=this.geometry.skinWeights[e].x+n,this.geometry.skinWeights[e].y=this.geometry.skinWeights[e].y+n)}},THREE.MorphAnimMesh=function(e,t){THREE.Mesh.call(this,e,t),this.duration=1e3,this.mirroredLoop=!1,this.currentKeyframe=this.lastKeyframe=this.time=0,this.direction=1,this.directionBackwards=!1,this.setFrameRange(0,this.geometry.morphTargets.length-1)},THREE.MorphAnimMesh.prototype=new THREE.Mesh,THREE.MorphAnimMesh.prototype.constructor=THREE.MorphAnimMesh,THREE.MorphAnimMesh.prototype.setFrameRange=function(e,t){this.startKeyframe=e,this.endKeyframe=t,this.length=this.endKeyframe-this.startKeyframe+1},THREE.MorphAnimMesh.prototype.setDirectionForward=function(){this.direction=1,this.directionBackwards=!1},THREE.MorphAnimMesh.prototype.setDirectionBackward=function(){this.direction=-1,this.directionBackwards=!0},THREE.MorphAnimMesh.prototype.parseAnimations=function(){var e=this.geometry;e.animations||(e.animations={});for(var t,n=e.animations,r=/([a-z]+)(\d+)/,i=0,o=e.morphTargets.length;i<o;i++){var a=e.morphTargets[i].name.match(r);if(a&&a.length>1){a=a[1],n[a]||(n[a]={start:1/0,end:-1/0});var s=n[a];i<s.start&&(s.start=i),i>s.end&&(s.end=i),t||(t=a)}}e.firstAnimation=t},THREE.MorphAnimMesh.prototype.setAnimationLabel=function(e,t,n){this.geometry.animations||(this.geometry.animations={}),this.geometry.animations[e]={start:t,end:n}},THREE.MorphAnimMesh.prototype.playAnimation=function(e,t){var n=this.geometry.animations[e];n?(this.setFrameRange(n.start,n.end),this.duration=(n.end-n.start)/t*1e3,this.time=0):console.warn("animation["+e+"] undefined")},THREE.MorphAnimMesh.prototype.updateAnimation=function(e){var t=this.duration/this.length;this.time=this.time+this.direction*e,this.mirroredLoop?(this.time>this.duration||this.time<0)&&(this.direction=-1*this.direction,this.time>this.duration&&(this.time=this.duration,this.directionBackwards=!0),this.time<0&&(this.time=0,this.directionBackwards=!1)):(this.time=this.time%this.duration,this.time<0&&(this.time=this.time+this.duration)),e=this.startKeyframe+THREE.Math.clamp(Math.floor(this.time/t),0,this.length-1),e!==this.currentKeyframe&&(this.morphTargetInfluences[this.lastKeyframe]=0,this.morphTargetInfluences[this.currentKeyframe]=1,this.morphTargetInfluences[e]=0,this.lastKeyframe=this.currentKeyframe,this.currentKeyframe=e),t=this.time%t/t,this.directionBackwards&&(t=1-t),this.morphTargetInfluences[this.currentKeyframe]=t,this.morphTargetInfluences[this.lastKeyframe]=1-t},THREE.Ribbon=function(e,t){THREE.Object3D.call(this),this.geometry=e,this.material=t},THREE.Ribbon.prototype=new THREE.Object3D,THREE.Ribbon.prototype.constructor=THREE.Ribbon,THREE.LOD=function(){THREE.Object3D.call(this),this.LODs=[]},THREE.LOD.prototype=new THREE.Object3D,THREE.LOD.prototype.constructor=THREE.LOD,THREE.LOD.prototype.supr=THREE.Object3D.prototype,THREE.LOD.prototype.addLevel=function(e,t){void 0===t&&(t=0);for(var t=Math.abs(t),n=0;n<this.LODs.length&&!(t<this.LODs[n].visibleAtDistance);n++);this.LODs.splice(n,0,{visibleAtDistance:t,object3D:e}),this.add(e)},THREE.LOD.prototype.update=function(e){if(this.LODs.length>1){e.matrixWorldInverse.getInverse(e.matrixWorld),e=e.matrixWorldInverse,e=-(e.elements[2]*this.matrixWorld.elements[12]+e.elements[6]*this.matrixWorld.elements[13]+e.elements[10]*this.matrixWorld.elements[14]+e.elements[14]),this.LODs[0].object3D.visible=!0;for(var t=1;t<this.LODs.length&&e>=this.LODs[t].visibleAtDistance;t++)this.LODs[t-1].object3D.visible=!1,this.LODs[t].object3D.visible=!0;for(;t<this.LODs.length;t++)this.LODs[t].object3D.visible=!1}},THREE.Sprite=function(e){THREE.Object3D.call(this),this.color=void 0!==e.color?new THREE.Color(e.color):new THREE.Color(16777215),this.map=void 0!==e.map?e.map:new THREE.Texture,this.blending=void 0!==e.blending?e.blending:THREE.NormalBlending,this.blendSrc=void 0!==e.blendSrc?e.blendSrc:THREE.SrcAlphaFactor,this.blendDst=void 0!==e.blendDst?e.blendDst:THREE.OneMinusSrcAlphaFactor,this.blendEquation=void 0!==e.blendEquation?e.blendEquation:THREE.AddEquation,this.useScreenCoordinates=void 0===e.useScreenCoordinates||e.useScreenCoordinates,this.mergeWith3D=void 0!==e.mergeWith3D?e.mergeWith3D:!this.useScreenCoordinates,this.affectedByDistance=void 0!==e.affectedByDistance?e.affectedByDistance:!this.useScreenCoordinates,this.scaleByViewport=void 0!==e.scaleByViewport?e.scaleByViewport:!this.affectedByDistance,this.alignment=e.alignment instanceof THREE.Vector2?e.alignment:THREE.SpriteAlignment.center,this.rotation3d=this.rotation,this.rotation=0,this.opacity=1,this.uvOffset=new THREE.Vector2(0,0),this.uvScale=new THREE.Vector2(1,1)},THREE.Sprite.prototype=new THREE.Object3D,THREE.Sprite.prototype.constructor=THREE.Sprite,THREE.Sprite.prototype.updateMatrix=function(){this.matrix.setPosition(this.position),this.rotation3d.set(0,0,this.rotation),this.matrix.setRotationFromEuler(this.rotation3d),1===this.scale.x&&1===this.scale.y||(this.matrix.scale(this.scale),this.boundRadiusScale=Math.max(this.scale.x,this.scale.y)),this.matrixWorldNeedsUpdate=!0},THREE.SpriteAlignment={},THREE.SpriteAlignment.topLeft=new THREE.Vector2(1,-1),THREE.SpriteAlignment.topCenter=new THREE.Vector2(0,-1),THREE.SpriteAlignment.topRight=new THREE.Vector2(-1,-1),THREE.SpriteAlignment.centerLeft=new THREE.Vector2(1,0),THREE.SpriteAlignment.center=new THREE.Vector2(0,0),THREE.SpriteAlignment.centerRight=new THREE.Vector2(-1,0),THREE.SpriteAlignment.bottomLeft=new THREE.Vector2(1,1),THREE.SpriteAlignment.bottomCenter=new THREE.Vector2(0,1),THREE.SpriteAlignment.bottomRight=new THREE.Vector2(-1,1),THREE.Scene=function(){THREE.Object3D.call(this),this.overrideMaterial=this.fog=null,this.matrixAutoUpdate=!1,this.__objects=[],this.__lights=[],this.__objectsAdded=[],this.__objectsRemoved=[]},THREE.Scene.prototype=new THREE.Object3D,THREE.Scene.prototype.constructor=THREE.Scene,THREE.Scene.prototype.__addObject=function(e){if(e instanceof THREE.Light)-1===this.__lights.indexOf(e)&&this.__lights.push(e);else if(!(e instanceof THREE.Camera||e instanceof THREE.Bone)&&-1===this.__objects.indexOf(e)){this.__objects.push(e),this.__objectsAdded.push(e);var t=this.__objectsRemoved.indexOf(e);-1!==t&&this.__objectsRemoved.splice(t,1)}for(t=0;t<e.children.length;t++)this.__addObject(e.children[t])},THREE.Scene.prototype.__removeObject=function(e){if(e instanceof THREE.Light){var t=this.__lights.indexOf(e);-1!==t&&this.__lights.splice(t,1)}else e instanceof THREE.Camera||-1!==(t=this.__objects.indexOf(e))&&(this.__objects.splice(t,1),this.__objectsRemoved.push(e),-1!==(t=this.__objectsAdded.indexOf(e))&&this.__objectsAdded.splice(t,1));for(t=0;t<e.children.length;t++)this.__removeObject(e.children[t])},THREE.Fog=function(e,t,n){this.color=new THREE.Color(e),this.near=void 0!==t?t:1,this.far=void 0!==n?n:1e3},THREE.FogExp2=function(e,t){this.color=new THREE.Color(e),this.density=void 0!==t?t:25e-5},THREE.DOMRenderer=function(){console.log("THREE.DOMRenderer",THREE.REVISION);var e,t,n,r,i,o,a,s=new THREE.Projector;a=function(e){for(var t=document.documentElement,n=0;n<e.length;n++)if("string"==typeof t.style[e[n]])return e[n];return null}(["transform","MozTransform","WebkitTransform","msTransform","OTransform"]),this.domElement=document.createElement("div"),this.setSize=function(e,t){n=e,r=t,i=n/2,o=r/2},this.render=function(n,r){var l,c,u,h,f,d;for(e=s.projectScene(n,r),t=e.elements,l=0,c=t.length;l<c;l++)(u=t[l])instanceof THREE.RenderableParticle&&u.material instanceof THREE.ParticleDOMMaterial&&(h=u.material.domElement,f=u.x*i+i-(h.offsetWidth>>1),d=u.y*o+o-(h.offsetHeight>>1),h.style.left=f+"px",h.style.top=d+"px",h.style.zIndex=Math.abs(Math.floor((1-u.z)*r.far/r.near)),a&&(h.style[a]="scale("+u.scale.x*i+","+u.scale.y*o+")"))}},THREE.CanvasRenderer=function(e){function t(e){$!=e&&(Y.globalAlpha=$=e)}function n(e){if(Q!=e){switch(e){case THREE.NormalBlending:Y.globalCompositeOperation="source-over";break;case THREE.AdditiveBlending:Y.globalCompositeOperation="lighter"}Q=e}}function r(e){Z!=e&&(Y.strokeStyle=Z=e)}function i(e){J!=e&&(Y.fillStyle=J=e)}console.log("THREE.CanvasRenderer",THREE.REVISION);var o,a,s,l,c,u,h,f,d,p,m,v,g,E,y,x,T,b,R,w,_,H,M,S,C,A,P,D,L,N,k,F,U,B,V,z,I,O,W,e=e||{},j=this,G=new THREE.Projector,X=void 0!==e.canvas?e.canvas:document.createElement("canvas"),Y=X.getContext("2d"),q=new THREE.Color(0),K=0,$=1,Q=0,Z=null,J=null,ee=null,te=null,ne=null,re=new THREE.RenderableVertex,ie=new THREE.RenderableVertex,oe=new THREE.Color,ae=new THREE.Color,se=new THREE.Color,le=new THREE.Color,ce=new THREE.Color,ue=[],he=[],fe=new THREE.Rectangle,de=new THREE.Rectangle,pe=new THREE.Rectangle,me=!1,ve=new THREE.Color,ge=new THREE.Color,Ee=new THREE.Color,ye=new THREE.Vector3,e=16;B=document.createElement("canvas"),B.width=B.height=2,V=B.getContext("2d"),V.fillStyle="rgba(0,0,0,1)",V.fillRect(0,0,2,2),z=V.getImageData(0,0,2,2),I=z.data,O=document.createElement("canvas"),O.width=O.height=e,W=O.getContext("2d"),W.translate(-e/2,-e/2),W.scale(e,e),e--,this.domElement=X,this.sortElements=this.sortObjects=this.autoClear=!0,this.info={render:{vertices:0,faces:0}},this.setSize=function(e,t){l=e,c=t,u=Math.floor(l/2),h=Math.floor(c/2),X.width=l,X.height=c,fe.set(-u,-h,u,h),de.set(-u,-h,u,h),$=1,Q=0,ne=te=ee=J=Z=null},this.setClearColor=function(e,t){q.copy(e),K=void 0!==t?t:1,de.set(-u,-h,u,h)},this.setClearColorHex=function(e,t){q.setHex(e),K=void 0!==t?t:1,de.set(-u,-h,u,h)},this.clear=function(){Y.setTransform(1,0,0,-1,u,h),de.isEmpty()||(de.minSelf(fe),de.inflate(2),K<1&&Y.clearRect(Math.floor(de.getX()),Math.floor(de.getY()),Math.floor(de.getWidth()),Math.floor(de.getHeight())),K>0&&(n(THREE.NormalBlending),t(1),i("rgba("+Math.floor(255*q.r)+","+Math.floor(255*q.g)+","+Math.floor(255*q.b)+","+K+")"),Y.fillRect(Math.floor(de.getX()),Math.floor(de.getY()),Math.floor(de.getWidth()),Math.floor(de.getHeight()))),de.empty())},this.render=function(e,l){function c(e,t,n,r){var i,o,a,s,l,c;for(i=0,o=e.length;i<o;i++)a=e[i],s=a.color,a instanceof THREE.DirectionalLight?(l=a.matrixWorld.getPosition(),(c=n.dot(l))<=0||(c*=a.intensity,r.r=r.r+s.r*c,r.g=r.g+s.g*c,r.b=r.b+s.b*c)):a instanceof THREE.PointLight&&(l=a.matrixWorld.getPosition(),(c=n.dot(ye.sub(l,t).normalize()))<=0||0!=(c*=0==a.distance?1:1-Math.min(t.distanceTo(l)/a.distance,1))&&(c*=a.intensity,r.r=r.r+s.r*c,r.g=r.g+s.g*c,r.b=r.b+s.b*c))}function X(e,r,i,o,a,u,h,f){j.info.render.vertices=j.info.render.vertices+3,j.info.render.faces++,t(f.opacity),n(f.blending),v=e.positionScreen.x,g=e.positionScreen.y,E=r.positionScreen.x,y=r.positionScreen.y,x=i.positionScreen.x,T=i.positionScreen.y,q(v,g,E,y,x,T),f instanceof THREE.MeshBasicMaterial?f.map?f.map.mapping instanceof THREE.UVMapping&&(P=h.uvs[0],Z(v,g,E,y,x,T,P[o].u,P[o].v,P[a].u,P[a].v,P[u].u,P[u].v,f.map)):f.envMap?f.envMap.mapping instanceof THREE.SphericalReflectionMapping&&(e=l.matrixWorldInverse,ye.copy(h.vertexNormalsWorld[o]),D=.5*(ye.x*e.elements[0]+ye.y*e.elements[4]+ye.z*e.elements[8])+.5,L=.5*-(ye.x*e.elements[1]+ye.y*e.elements[5]+ye.z*e.elements[9])+.5,ye.copy(h.vertexNormalsWorld[a]),N=.5*(ye.x*e.elements[0]+ye.y*e.elements[4]+ye.z*e.elements[8])+.5,k=.5*-(ye.x*e.elements[1]+ye.y*e.elements[5]+ye.z*e.elements[9])+.5,ye.copy(h.vertexNormalsWorld[u]),F=.5*(ye.x*e.elements[0]+ye.y*e.elements[4]+ye.z*e.elements[8])+.5,U=.5*-(ye.x*e.elements[1]+ye.y*e.elements[5]+ye.z*e.elements[9])+.5,Z(v,g,E,y,x,T,D,L,N,k,F,U,f.envMap)):f.wireframe?$(f.color,f.wireframeLinewidth,f.wireframeLinecap,f.wireframeLinejoin):Q(f.color):f instanceof THREE.MeshLambertMaterial?me?f.wireframe||f.shading!=THREE.SmoothShading||3!=h.vertexNormalsWorld.length?(oe.r=ve.r,oe.g=ve.g,oe.b=ve.b,c(s,h.centroidWorld,h.normalWorld,oe),oe.r=Math.max(0,Math.min(f.color.r*oe.r,1)),oe.g=Math.max(0,Math.min(f.color.g*oe.g,1)),oe.b=Math.max(0,Math.min(f.color.b*oe.b,1)),f.wireframe?$(oe,f.wireframeLinewidth,f.wireframeLinecap,f.wireframeLinejoin):Q(oe)):(ae.r=se.r=le.r=ve.r,ae.g=se.g=le.g=ve.g,ae.b=se.b=le.b=ve.b,c(s,h.v1.positionWorld,h.vertexNormalsWorld[0],ae),c(s,h.v2.positionWorld,h.vertexNormalsWorld[1],se),c(s,h.v3.positionWorld,h.vertexNormalsWorld[2],le),ae.r=Math.max(0,Math.min(f.color.r*ae.r,1)),ae.g=Math.max(0,Math.min(f.color.g*ae.g,1)),ae.b=Math.max(0,Math.min(f.color.b*ae.b,1)),se.r=Math.max(0,Math.min(f.color.r*se.r,1)),se.g=Math.max(0,Math.min(f.color.g*se.g,1)),se.b=Math.max(0,Math.min(f.color.b*se.b,1)),le.r=Math.max(0,Math.min(f.color.r*le.r,1)),le.g=Math.max(0,Math.min(f.color.g*le.g,1)),le.b=Math.max(0,Math.min(f.color.b*le.b,1)),ce.r=.5*(se.r+le.r),ce.g=.5*(se.g+le.g),ce.b=.5*(se.b+le.b),A=xe(ae,se,le,ce),J(v,g,E,y,x,T,0,0,1,0,0,1,A)):f.wireframe?$(f.color,f.wireframeLinewidth,f.wireframeLinecap,f.wireframeLinejoin):Q(f.color):f instanceof THREE.MeshDepthMaterial?(S=l.near,C=l.far,ae.r=ae.g=ae.b=1-Te(e.positionScreen.z,S,C),se.r=se.g=se.b=1-Te(r.positionScreen.z,S,C),le.r=le.g=le.b=1-Te(i.positionScreen.z,S,C),ce.r=.5*(se.r+le.r),ce.g=.5*(se.g+le.g),ce.b=.5*(se.b+le.b),A=xe(ae,se,le,ce),J(v,g,E,y,x,T,0,0,1,0,0,1,A)):f instanceof THREE.MeshNormalMaterial&&(oe.r=be(h.normalWorld.x),oe.g=be(h.normalWorld.y),oe.b=be(h.normalWorld.z),f.wireframe?$(oe,f.wireframeLinewidth,f.wireframeLinecap,f.wireframeLinejoin):Q(oe))}function q(e,t,n,r,i,o){Y.beginPath(),Y.moveTo(e,t),Y.lineTo(n,r),Y.lineTo(i,o),Y.lineTo(e,t),Y.closePath()}function K(e,t,n,r,i,o,a,s){Y.beginPath(),Y.moveTo(e,t),Y.lineTo(n,r),Y.lineTo(i,o),Y.lineTo(a,s),Y.lineTo(e,t),Y.closePath()}function $(e,t,n,i){ee!=t&&(Y.lineWidth=ee=t),te!=n&&(Y.lineCap=te=n),ne!=i&&(Y.lineJoin=ne=i),r(e.getContextStyle()),Y.stroke(),pe.inflate(2*t)}function Q(e){i(e.getContextStyle()),Y.fill()}function Z(e,t,n,r,o,a,s,l,c,u,h,f,d){if(0!=d.image.width){if(1==d.needsUpdate||void 0==ue[d.id]){var p=d.wrapS==THREE.RepeatWrapping,m=d.wrapT==THREE.RepeatWrapping;ue[d.id]=Y.createPattern(d.image,p&&m?"repeat":p&&!m?"repeat-x":!p&&m?"repeat-y":"no-repeat"),d.needsUpdate=!1}i(ue[d.id]);var p=d.offset.x/d.repeat.x,m=d.offset.y/d.repeat.y,v=d.image.width*d.repeat.x,g=d.image.height*d.repeat.y,s=(s+p)*v,l=(l+m)*g,n=n-e,r=r-t,o=o-e,a=a-t,c=(c+p)*v-s,u=(u+m)*g-l,h=(h+p)*v-s,f=(f+m)*g-l,p=c*f-h*u;0==p?(void 0===he[d.id]&&(t=document.createElement("canvas"),t.width=d.image.width,t.height=d.image.height,t=t.getContext("2d"),t.drawImage(d.image,0,0),he[d.id]=t.getImageData(0,0,d.image.width,d.image.height).data),t=he[d.id],s=4*(Math.floor(s)+Math.floor(l)*d.image.width),oe.setRGB(t[s]/255,t[s+1]/255,t[s+2]/255),Q(oe)):(p=1/p,d=(f*n-u*o)*p,u=(f*r-u*a)*p,n=(c*o-h*n)*p,r=(c*a-h*r)*p,e=e-d*s-n*l,s=t-u*s-r*l,Y.save(),Y.transform(d,u,n,r,e,s),Y.fill(),Y.restore())}}function J(e,t,n,r,i,o,a,s,l,c,u,h,f){var d,p;d=f.width-1,p=f.height-1,a*=d,s*=p,n-=e,r-=t,i-=e,o-=t,l=l*d-a,c=c*p-s,u=u*d-a,h=h*p-s,p=1/(l*h-u*c),d=(h*n-c*i)*p,c=(h*r-c*o)*p,n=(l*i-u*n)*p,r=(l*o-u*r)*p,e=e-d*a-n*s,t=t-c*a-r*s,Y.save(),Y.transform(d,c,n,r,e,t),Y.clip(),Y.drawImage(f,0,0),Y.restore()}function xe(e,t,n,r){var i=~~(255*e.r),o=~~(255*e.g),e=~~(255*e.b),a=~~(255*t.r),s=~~(255*t.g),t=~~(255*t.b),l=~~(255*n.r),c=~~(255*n.g),n=~~(255*n.b),u=~~(255*r.r),h=~~(255*r.g),r=~~(255*r.b);return I[0]=i<0?0:i>255?255:i,I[1]=o<0?0:o>255?255:o,I[2]=e<0?0:e>255?255:e,I[4]=a<0?0:a>255?255:a,I[5]=s<0?0:s>255?255:s,I[6]=t<0?0:t>255?255:t,I[8]=l<0?0:l>255?255:l,I[9]=c<0?0:c>255?255:c,I[10]=n<0?0:n>255?255:n,I[12]=u<0?0:u>255?255:u,I[13]=h<0?0:h>255?255:h,I[14]=r<0?0:r>255?255:r,V.putImageData(z,0,0),W.drawImage(B,0,0),O}function Te(e,t,n){return(e=(e-t)/(n-t))*e*(3-2*e)}function be(e){return e=.5*(e+1),e<0?0:e>1?1:e}function Re(e,t){var n=t.x-e.x,r=t.y-e.y,i=n*n+r*r;0!=i&&(i=1/Math.sqrt(i),n*=i,r*=i,t.x=t.x+n,t.y=t.y+r,e.x=e.x-n,e.y=e.y-r)}var we,_e,He,Me;for(this.autoClear?this.clear():Y.setTransform(1,0,0,-1,u,h),j.info.render.vertices=0,j.info.render.faces=0,o=G.projectScene(e,l,this.sortElements),a=o.elements,s=o.lights,(me=s.length>0)&&function(e){var t,n,r,i;for(ve.setRGB(0,0,0),ge.setRGB(0,0,0),Ee.setRGB(0,0,0),t=0,n=e.length;t<n;t++)r=e[t],i=r.color,r instanceof THREE.AmbientLight?(ve.r=ve.r+i.r,ve.g=ve.g+i.g,ve.b=ve.b+i.b):r instanceof THREE.DirectionalLight?(ge.r=ge.r+i.r,ge.g=ge.g+i.g,ge.b=ge.b+i.b):r instanceof THREE.PointLight&&(Ee.r=Ee.r+i.r,Ee.g=Ee.g+i.g,Ee.b=Ee.b+i.b)}(s),we=0,_e=a.length;we<_e;we++)He=a[we],Me=He.material,void 0!==(Me=Me instanceof THREE.MeshFaceMaterial?He.faceMaterial:Me)&&!1!==Me.visible&&(pe.empty(),He instanceof THREE.RenderableParticle?(f=He,f.x=f.x*u,f.y=f.y*h,function(e,o,a){t(a.opacity),n(a.blending);var s,l,c,f,d,p;a instanceof THREE.ParticleBasicMaterial?a.map&&(f=a.map.image,d=f.width>>1,p=f.height>>1,a=o.scale.x*u,c=o.scale.y*h,s=a*d,l=c*p,pe.set(e.x-s,e.y-l,e.x+s,e.y+l),fe.intersects(pe)&&(Y.save(),Y.translate(e.x,e.y),Y.rotate(-o.rotation),Y.scale(a,-c),Y.translate(-d,-p),Y.drawImage(f,0,0),Y.restore())):a instanceof THREE.ParticleCanvasMaterial&&(s=o.scale.x*u,l=o.scale.y*h,pe.set(e.x-s,e.y-l,e.x+s,e.y+l),fe.intersects(pe)&&(r(a.color.getContextStyle()),i(a.color.getContextStyle()),Y.save(),Y.translate(e.x,e.y),Y.rotate(-o.rotation),Y.scale(s,l),a.program(Y),Y.restore()))}(f,He,Me)):He instanceof THREE.RenderableLine?(f=He.v1,d=He.v2,f.positionScreen.x=f.positionScreen.x*u,f.positionScreen.y=f.positionScreen.y*h,d.positionScreen.x=d.positionScreen.x*u,d.positionScreen.y=d.positionScreen.y*h,pe.addPoint(f.positionScreen.x,f.positionScreen.y),pe.addPoint(d.positionScreen.x,d.positionScreen.y),fe.intersects(pe)&&function(e,i,o,a){t(a.opacity),n(a.blending),Y.beginPath(),Y.moveTo(e.positionScreen.x,e.positionScreen.y),Y.lineTo(i.positionScreen.x,i.positionScreen.y),Y.closePath(),a instanceof THREE.LineBasicMaterial&&(e=a.linewidth,ee!=e&&(Y.lineWidth=ee=e),e=a.linecap,te!=e&&(Y.lineCap=te=e),e=a.linejoin,ne!=e&&(Y.lineJoin=ne=e),r(a.color.getContextStyle()),Y.stroke(),pe.inflate(2*a.linewidth))}(f,d,He,Me)):He instanceof THREE.RenderableFace3?(f=He.v1,d=He.v2,p=He.v3,f.positionScreen.x=f.positionScreen.x*u,f.positionScreen.y=f.positionScreen.y*h,d.positionScreen.x=d.positionScreen.x*u,d.positionScreen.y=d.positionScreen.y*h,p.positionScreen.x=p.positionScreen.x*u,p.positionScreen.y=p.positionScreen.y*h,Me.overdraw&&(Re(f.positionScreen,d.positionScreen),Re(d.positionScreen,p.positionScreen),Re(p.positionScreen,f.positionScreen)),pe.add3Points(f.positionScreen.x,f.positionScreen.y,d.positionScreen.x,d.positionScreen.y,p.positionScreen.x,p.positionScreen.y),fe.intersects(pe)&&X(f,d,p,0,1,2,He,Me,e)):He instanceof THREE.RenderableFace4&&(f=He.v1,d=He.v2,p=He.v3,m=He.v4,f.positionScreen.x=f.positionScreen.x*u,f.positionScreen.y=f.positionScreen.y*h,d.positionScreen.x=d.positionScreen.x*u,d.positionScreen.y=d.positionScreen.y*h,p.positionScreen.x=p.positionScreen.x*u,p.positionScreen.y=p.positionScreen.y*h,m.positionScreen.x=m.positionScreen.x*u,m.positionScreen.y=m.positionScreen.y*h,re.positionScreen.copy(d.positionScreen),ie.positionScreen.copy(m.positionScreen),Me.overdraw&&(Re(f.positionScreen,d.positionScreen),Re(d.positionScreen,m.positionScreen),Re(m.positionScreen,f.positionScreen),Re(p.positionScreen,re.positionScreen),Re(p.positionScreen,ie.positionScreen)),pe.addPoint(f.positionScreen.x,f.positionScreen.y),pe.addPoint(d.positionScreen.x,d.positionScreen.y),pe.addPoint(p.positionScreen.x,p.positionScreen.y),pe.addPoint(m.positionScreen.x,m.positionScreen.y),fe.intersects(pe)&&function(e,r,i,o,a,u,h,f,d){j.info.render.vertices=j.info.render.vertices+4,j.info.render.faces++,t(f.opacity),n(f.blending),f.map||f.envMap?(X(e,r,o,0,1,3,h,f,d),X(a,i,u,1,2,3,h,f,d)):(v=e.positionScreen.x,g=e.positionScreen.y,E=r.positionScreen.x,y=r.positionScreen.y,x=i.positionScreen.x,T=i.positionScreen.y,b=o.positionScreen.x,R=o.positionScreen.y,w=a.positionScreen.x,_=a.positionScreen.y,H=u.positionScreen.x,M=u.positionScreen.y,f instanceof THREE.MeshBasicMaterial?(K(v,g,E,y,x,T,b,R),f.wireframe?$(f.color,f.wireframeLinewidth,f.wireframeLinecap,f.wireframeLinejoin):Q(f.color)):f instanceof THREE.MeshLambertMaterial?me?f.wireframe||f.shading!=THREE.SmoothShading||4!=h.vertexNormalsWorld.length?(oe.r=ve.r,oe.g=ve.g,oe.b=ve.b,c(s,h.centroidWorld,h.normalWorld,oe),oe.r=Math.max(0,Math.min(f.color.r*oe.r,1)),oe.g=Math.max(0,Math.min(f.color.g*oe.g,1)),oe.b=Math.max(0,Math.min(f.color.b*oe.b,1)),K(v,g,E,y,x,T,b,R),f.wireframe?$(oe,f.wireframeLinewidth,f.wireframeLinecap,f.wireframeLinejoin):Q(oe)):(ae.r=se.r=le.r=ce.r=ve.r,ae.g=se.g=le.g=ce.g=ve.g,ae.b=se.b=le.b=ce.b=ve.b,c(s,h.v1.positionWorld,h.vertexNormalsWorld[0],ae),c(s,h.v2.positionWorld,h.vertexNormalsWorld[1],se),c(s,h.v4.positionWorld,h.vertexNormalsWorld[3],le),c(s,h.v3.positionWorld,h.vertexNormalsWorld[2],ce),ae.r=Math.max(0,Math.min(f.color.r*ae.r,1)),ae.g=Math.max(0,Math.min(f.color.g*ae.g,1)),ae.b=Math.max(0,Math.min(f.color.b*ae.b,1)),se.r=Math.max(0,Math.min(f.color.r*se.r,1)),se.g=Math.max(0,Math.min(f.color.g*se.g,1)),se.b=Math.max(0,Math.min(f.color.b*se.b,1)),le.r=Math.max(0,Math.min(f.color.r*le.r,1)),le.g=Math.max(0,Math.min(f.color.g*le.g,1)),le.b=Math.max(0,Math.min(f.color.b*le.b,1)),ce.r=Math.max(0,Math.min(f.color.r*ce.r,1)),ce.g=Math.max(0,Math.min(f.color.g*ce.g,1)),ce.b=Math.max(0,Math.min(f.color.b*ce.b,1)),A=xe(ae,se,le,ce),q(v,g,E,y,b,R),J(v,g,E,y,b,R,0,0,1,0,0,1,A),q(w,_,x,T,H,M),J(w,_,x,T,H,M,1,0,1,1,0,1,A)):(K(v,g,E,y,x,T,b,R),f.wireframe?$(f.color,f.wireframeLinewidth,f.wireframeLinecap,f.wireframeLinejoin):Q(f.color)):f instanceof THREE.MeshNormalMaterial?(oe.r=be(h.normalWorld.x),oe.g=be(h.normalWorld.y),oe.b=be(h.normalWorld.z),K(v,g,E,y,x,T,b,R),f.wireframe?$(oe,f.wireframeLinewidth,f.wireframeLinecap,f.wireframeLinejoin):Q(oe)):f instanceof THREE.MeshDepthMaterial&&(S=l.near,C=l.far,ae.r=ae.g=ae.b=1-Te(e.positionScreen.z,S,C),se.r=se.g=se.b=1-Te(r.positionScreen.z,S,C),le.r=le.g=le.b=1-Te(o.positionScreen.z,S,C),ce.r=ce.g=ce.b=1-Te(i.positionScreen.z,S,C),A=xe(ae,se,le,ce),q(v,g,E,y,b,R),J(v,g,E,y,b,R,0,0,1,0,0,1,A),q(w,_,x,T,H,M),J(w,_,x,T,H,M,1,0,1,1,0,1,A)))}(f,d,p,m,re,ie,He,Me,e)),de.addRectangle(pe));Y.setTransform(1,0,0,1,0,0)}},THREE.SVGRenderer=function(){function e(e,t,n,r){var i,o,a,s,l,c;for(i=0,o=e.length;i<o;i++)a=e[i],s=a.color,a instanceof THREE.DirectionalLight?(l=a.matrixWorld.getPosition(),(c=n.dot(l))<=0||(c*=a.intensity,r.r=r.r+s.r*c,r.g=r.g+s.g*c,r.b=r.b+s.b*c)):a instanceof THREE.PointLight&&(l=a.matrixWorld.getPosition(),(c=n.dot(S.sub(l,t).normalize()))<=0||0!=(c*=0==a.distance?1:1-Math.min(t.distanceTo(l)/a.distance,1))&&(c*=a.intensity,r.r=r.r+s.r*c,r.g=r.g+s.g*c,r.b=r.b+s.b*c))}function t(e){return null==C[e]&&(C[e]=document.createElementNS("http://www.w3.org/2000/svg","path"),0==P&&C[e].setAttribute("shape-rendering","crispEdges")),C[e]}function n(e){return e=.5*(e+1),e<0?0:e>1?1:e}console.log("THREE.SVGRenderer",THREE.REVISION);var r,i,o,a,s,l,c,u,h,f,d,p,m,v,g,E=this,y=new THREE.Projector,x=document.createElementNS("http://www.w3.org/2000/svg","svg"),T=new THREE.Rectangle,b=new THREE.Rectangle,R=!1,w=new THREE.Color,_=new THREE.Color,H=new THREE.Color,M=new THREE.Color,S=new THREE.Vector3,C=[],A=[],P=1;this.domElement=x,this.sortElements=this.sortObjects=this.autoClear=!0,this.info={render:{vertices:0,faces:0}},this.setQuality=function(e){switch(e){case"high":P=1;break;case"low":P=0}},this.setSize=function(e,t){a=e,s=t,l=a/2,c=s/2,x.setAttribute("viewBox",-l+" "+-c+" "+a+" "+s),x.setAttribute("width",a),x.setAttribute("height",s),T.set(-l,-c,l,c)},this.clear=function(){for(;x.childNodes.length>0;)x.removeChild(x.childNodes[0])},this.render=function(a,s){var S,C,D,L;if(this.autoClear&&this.clear(),E.info.render.vertices=0,E.info.render.faces=0,r=y.projectScene(a,s,this.sortElements),i=r.elements,o=r.lights,g=v=0,R=o.length>0)for(_.setRGB(0,0,0),H.setRGB(0,0,0),M.setRGB(0,0,0),S=0,C=o.length;S<C;S++)L=o[S],D=L.color,L instanceof THREE.AmbientLight?(_.r=_.r+D.r,_.g=_.g+D.g,_.b=_.b+D.b):L instanceof THREE.DirectionalLight?(H.r=H.r+D.r,H.g=H.g+D.g,H.b=H.b+D.b):L instanceof THREE.PointLight&&(M.r=M.r+D.r,M.g=M.g+D.g,M.b=M.b+D.b);for(S=0,C=i.length;S<C;S++)if(D=i[S],L=D.material,void 0!==(L=L instanceof THREE.MeshFaceMaterial?D.faceMaterial:L)&&!1!==L.visible)if(b.empty(),D instanceof THREE.RenderableParticle)u=D,u.x=u.x*l,u.y=u.y*-c;else if(D instanceof THREE.RenderableLine){if(u=D.v1,h=D.v2,u.positionScreen.x=u.positionScreen.x*l,u.positionScreen.y=u.positionScreen.y*-c,h.positionScreen.x=h.positionScreen.x*l,h.positionScreen.y=h.positionScreen.y*-c,b.addPoint(u.positionScreen.x,u.positionScreen.y),b.addPoint(h.positionScreen.x,h.positionScreen.y),T.intersects(b)){D=u;var N=h,k=g++;null==A[k]&&(A[k]=document.createElementNS("http://www.w3.org/2000/svg","line"),0==P&&A[k].setAttribute("shape-rendering","crispEdges")),m=A[k],m.setAttribute("x1",D.positionScreen.x),m.setAttribute("y1",D.positionScreen.y),m.setAttribute("x2",N.positionScreen.x),m.setAttribute("y2",N.positionScreen.y),L instanceof THREE.LineBasicMaterial&&(m.setAttribute("style","fill: none; stroke: "+L.color.getContextStyle()+"; stroke-width: "+L.linewidth+"; stroke-opacity: "+L.opacity+"; stroke-linecap: "+L.linecap+"; stroke-linejoin: "+L.linejoin),x.appendChild(m))}}else if(D instanceof THREE.RenderableFace3){if(u=D.v1,h=D.v2,f=D.v3,u.positionScreen.x=u.positionScreen.x*l,u.positionScreen.y=u.positionScreen.y*-c,h.positionScreen.x=h.positionScreen.x*l,
h.positionScreen.y=h.positionScreen.y*-c,f.positionScreen.x=f.positionScreen.x*l,f.positionScreen.y=f.positionScreen.y*-c,b.addPoint(u.positionScreen.x,u.positionScreen.y),b.addPoint(h.positionScreen.x,h.positionScreen.y),b.addPoint(f.positionScreen.x,f.positionScreen.y),T.intersects(b)){var N=u,k=h,F=f;E.info.render.vertices=E.info.render.vertices+3,E.info.render.faces++,m=t(v++),m.setAttribute("d","M "+N.positionScreen.x+" "+N.positionScreen.y+" L "+k.positionScreen.x+" "+k.positionScreen.y+" L "+F.positionScreen.x+","+F.positionScreen.y+"z"),L instanceof THREE.MeshBasicMaterial?w.copy(L.color):L instanceof THREE.MeshLambertMaterial?R?(w.r=_.r,w.g=_.g,w.b=_.b,e(o,D.centroidWorld,D.normalWorld,w),w.r=Math.max(0,Math.min(L.color.r*w.r,1)),w.g=Math.max(0,Math.min(L.color.g*w.g,1)),w.b=Math.max(0,Math.min(L.color.b*w.b,1))):w.copy(L.color):L instanceof THREE.MeshDepthMaterial?(p=1-L.__2near/(L.__farPlusNear-D.z*L.__farMinusNear),w.setRGB(p,p,p)):L instanceof THREE.MeshNormalMaterial&&w.setRGB(n(D.normalWorld.x),n(D.normalWorld.y),n(D.normalWorld.z)),L.wireframe?m.setAttribute("style","fill: none; stroke: "+w.getContextStyle()+"; stroke-width: "+L.wireframeLinewidth+"; stroke-opacity: "+L.opacity+"; stroke-linecap: "+L.wireframeLinecap+"; stroke-linejoin: "+L.wireframeLinejoin):m.setAttribute("style","fill: "+w.getContextStyle()+"; fill-opacity: "+L.opacity),x.appendChild(m)}}else if(D instanceof THREE.RenderableFace4&&(u=D.v1,h=D.v2,f=D.v3,d=D.v4,u.positionScreen.x=u.positionScreen.x*l,u.positionScreen.y=u.positionScreen.y*-c,h.positionScreen.x=h.positionScreen.x*l,h.positionScreen.y=h.positionScreen.y*-c,f.positionScreen.x=f.positionScreen.x*l,f.positionScreen.y=f.positionScreen.y*-c,d.positionScreen.x=d.positionScreen.x*l,d.positionScreen.y=d.positionScreen.y*-c,b.addPoint(u.positionScreen.x,u.positionScreen.y),b.addPoint(h.positionScreen.x,h.positionScreen.y),b.addPoint(f.positionScreen.x,f.positionScreen.y),b.addPoint(d.positionScreen.x,d.positionScreen.y),T.intersects(b))){var N=u,k=h,F=f,U=d;E.info.render.vertices=E.info.render.vertices+4,E.info.render.faces++,m=t(v++),m.setAttribute("d","M "+N.positionScreen.x+" "+N.positionScreen.y+" L "+k.positionScreen.x+" "+k.positionScreen.y+" L "+F.positionScreen.x+","+F.positionScreen.y+" L "+U.positionScreen.x+","+U.positionScreen.y+"z"),L instanceof THREE.MeshBasicMaterial?w.copy(L.color):L instanceof THREE.MeshLambertMaterial?R?(w.r=_.r,w.g=_.g,w.b=_.b,e(o,D.centroidWorld,D.normalWorld,w),w.r=Math.max(0,Math.min(L.color.r*w.r,1)),w.g=Math.max(0,Math.min(L.color.g*w.g,1)),w.b=Math.max(0,Math.min(L.color.b*w.b,1))):w.copy(L.color):L instanceof THREE.MeshDepthMaterial?(p=1-L.__2near/(L.__farPlusNear-D.z*L.__farMinusNear),w.setRGB(p,p,p)):L instanceof THREE.MeshNormalMaterial&&w.setRGB(n(D.normalWorld.x),n(D.normalWorld.y),n(D.normalWorld.z)),L.wireframe?m.setAttribute("style","fill: none; stroke: "+w.getContextStyle()+"; stroke-width: "+L.wireframeLinewidth+"; stroke-opacity: "+L.opacity+"; stroke-linecap: "+L.wireframeLinecap+"; stroke-linejoin: "+L.wireframeLinejoin):m.setAttribute("style","fill: "+w.getContextStyle()+"; fill-opacity: "+L.opacity),x.appendChild(m)}}},THREE.ShaderChunk={fog_pars_fragment:"#ifdef USE_FOG\nuniform vec3 fogColor;\n#ifdef FOG_EXP2\nuniform float fogDensity;\n#else\nuniform float fogNear;\nuniform float fogFar;\n#endif\n#endif",fog_fragment:"#ifdef USE_FOG\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\n#ifdef FOG_EXP2\nconst float LOG2 = 1.442695;\nfloat fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );\nfogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );\n#else\nfloat fogFactor = smoothstep( fogNear, fogFar, depth );\n#endif\ngl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\nvarying vec3 vReflect;\nuniform float reflectivity;\nuniform samplerCube envMap;\nuniform float flipEnvMap;\nuniform int combine;\n#endif",envmap_fragment:"#ifdef USE_ENVMAP\n#ifdef DOUBLE_SIDED\nfloat flipNormal = ( -1.0 + 2.0 * float( gl_FrontFacing ) );\nvec4 cubeColor = textureCube( envMap, flipNormal * vec3( flipEnvMap * vReflect.x, vReflect.yz ) );\n#else\nvec4 cubeColor = textureCube( envMap, vec3( flipEnvMap * vReflect.x, vReflect.yz ) );\n#endif\n#ifdef GAMMA_INPUT\ncubeColor.xyz *= cubeColor.xyz;\n#endif\nif ( combine == 1 ) {\ngl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, reflectivity );\n} else {\ngl_FragColor.xyz = gl_FragColor.xyz * cubeColor.xyz;\n}\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\nvarying vec3 vReflect;\nuniform float refractionRatio;\nuniform bool useRefract;\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\nvec3 nWorld = mat3( objectMatrix[ 0 ].xyz, objectMatrix[ 1 ].xyz, objectMatrix[ 2 ].xyz ) * normal;\nif ( useRefract ) {\nvReflect = refract( normalize( mPosition.xyz - cameraPosition ), normalize( nWorld.xyz ), refractionRatio );\n} else {\nvReflect = reflect( normalize( mPosition.xyz - cameraPosition ), normalize( nWorld.xyz ) );\n}\n#endif",map_particle_pars_fragment:"#ifdef USE_MAP\nuniform sampler2D map;\n#endif",map_particle_fragment:"#ifdef USE_MAP\ngl_FragColor = gl_FragColor * texture2D( map, gl_PointCoord );\n#endif",map_pars_vertex:"#ifdef USE_MAP\nvarying vec2 vUv;\nuniform vec4 offsetRepeat;\n#endif",map_pars_fragment:"#ifdef USE_MAP\nvarying vec2 vUv;\nuniform sampler2D map;\n#endif",map_vertex:"#ifdef USE_MAP\nvUv = uv * offsetRepeat.zw + offsetRepeat.xy;\n#endif",map_fragment:"#ifdef USE_MAP\n#ifdef GAMMA_INPUT\nvec4 texelColor = texture2D( map, vUv );\ntexelColor.xyz *= texelColor.xyz;\ngl_FragColor = gl_FragColor * texelColor;\n#else\ngl_FragColor = gl_FragColor * texture2D( map, vUv );\n#endif\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\nvarying vec2 vUv2;\nuniform sampler2D lightMap;\n#endif",lightmap_pars_vertex:"#ifdef USE_LIGHTMAP\nvarying vec2 vUv2;\n#endif",lightmap_fragment:"#ifdef USE_LIGHTMAP\ngl_FragColor = gl_FragColor * texture2D( lightMap, vUv2 );\n#endif",lightmap_vertex:"#ifdef USE_LIGHTMAP\nvUv2 = uv2;\n#endif",lights_lambert_pars_vertex:"uniform vec3 ambient;\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 ambientLightColor;\n#if MAX_DIR_LIGHTS > 0\nuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\nuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\nuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n#endif\n#if MAX_SPOT_LIGHTS > 0\nuniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\nuniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\nuniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\nuniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\nuniform float spotLightAngle[ MAX_SPOT_LIGHTS ];\nuniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\n#endif\n#ifdef WRAP_AROUND\nuniform vec3 wrapRGB;\n#endif",lights_lambert_vertex:"vLightFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\nvLightBack = vec3( 0.0 );\n#endif\ntransformedNormal = normalize( transformedNormal );\n#if MAX_DIR_LIGHTS > 0\nfor( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\nvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\nvec3 dirVector = normalize( lDirection.xyz );\nfloat dotProduct = dot( transformedNormal, dirVector );\nvec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );\n#ifdef DOUBLE_SIDED\nvec3 directionalLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n#ifdef WRAP_AROUND\nvec3 directionalLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n#endif\n#endif\n#ifdef WRAP_AROUND\nvec3 directionalLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\ndirectionalLightWeighting = mix( directionalLightWeighting, directionalLightWeightingHalf, wrapRGB );\n#ifdef DOUBLE_SIDED\ndirectionalLightWeightingBack = mix( directionalLightWeightingBack, directionalLightWeightingHalfBack, wrapRGB );\n#endif\n#endif\nvLightFront += directionalLightColor[ i ] * directionalLightWeighting;\n#ifdef DOUBLE_SIDED\nvLightBack += directionalLightColor[ i ] * directionalLightWeightingBack;\n#endif\n}\n#endif\n#if MAX_POINT_LIGHTS > 0\nfor( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\nvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz - mvPosition.xyz;\nfloat lDistance = 1.0;\nif ( pointLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\nlVector = normalize( lVector );\nfloat dotProduct = dot( transformedNormal, lVector );\nvec3 pointLightWeighting = vec3( max( dotProduct, 0.0 ) );\n#ifdef DOUBLE_SIDED\nvec3 pointLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n#ifdef WRAP_AROUND\nvec3 pointLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n#endif\n#endif\n#ifdef WRAP_AROUND\nvec3 pointLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\npointLightWeighting = mix( pointLightWeighting, pointLightWeightingHalf, wrapRGB );\n#ifdef DOUBLE_SIDED\npointLightWeightingBack = mix( pointLightWeightingBack, pointLightWeightingHalfBack, wrapRGB );\n#endif\n#endif\nvLightFront += pointLightColor[ i ] * pointLightWeighting * lDistance;\n#ifdef DOUBLE_SIDED\nvLightBack += pointLightColor[ i ] * pointLightWeightingBack * lDistance;\n#endif\n}\n#endif\n#if MAX_SPOT_LIGHTS > 0\nfor( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\nvec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz - mvPosition.xyz;\nlVector = normalize( lVector );\nfloat spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - mPosition.xyz ) );\nif ( spotEffect > spotLightAngle[ i ] ) {\nspotEffect = pow( spotEffect, spotLightExponent[ i ] );\nfloat lDistance = 1.0;\nif ( spotLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );\nfloat dotProduct = dot( transformedNormal, lVector );\nvec3 spotLightWeighting = vec3( max( dotProduct, 0.0 ) );\n#ifdef DOUBLE_SIDED\nvec3 spotLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n#ifdef WRAP_AROUND\nvec3 spotLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n#endif\n#endif\n#ifdef WRAP_AROUND\nvec3 spotLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\nspotLightWeighting = mix( spotLightWeighting, spotLightWeightingHalf, wrapRGB );\n#ifdef DOUBLE_SIDED\nspotLightWeightingBack = mix( spotLightWeightingBack, spotLightWeightingHalfBack, wrapRGB );\n#endif\n#endif\nvLightFront += spotLightColor[ i ] * spotLightWeighting * lDistance * spotEffect;\n#ifdef DOUBLE_SIDED\nvLightBack += spotLightColor[ i ] * spotLightWeightingBack * lDistance * spotEffect;\n#endif\n}\n}\n#endif\nvLightFront = vLightFront * diffuse + ambient * ambientLightColor + emissive;\n#ifdef DOUBLE_SIDED\nvLightBack = vLightBack * diffuse + ambient * ambientLightColor + emissive;\n#endif",lights_phong_pars_vertex:"#ifndef PHONG_PER_PIXEL\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\nuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\nvarying vec4 vPointLight[ MAX_POINT_LIGHTS ];\n#endif\n#if MAX_SPOT_LIGHTS > 0\nuniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\nuniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\nvarying vec4 vSpotLight[ MAX_SPOT_LIGHTS ];\n#endif\n#endif\n#if MAX_SPOT_LIGHTS > 0\nvarying vec3 vWorldPosition;\n#endif",lights_phong_vertex:"#ifndef PHONG_PER_PIXEL\n#if MAX_POINT_LIGHTS > 0\nfor( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\nvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz - mvPosition.xyz;\nfloat lDistance = 1.0;\nif ( pointLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\nvPointLight[ i ] = vec4( lVector, lDistance );\n}\n#endif\n#if MAX_SPOT_LIGHTS > 0\nfor( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\nvec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz - mvPosition.xyz;\nfloat lDistance = 1.0;\nif ( spotLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );\nvSpotLight[ i ] = vec4( lVector, lDistance );\n}\n#endif\n#endif\n#if MAX_SPOT_LIGHTS > 0\nvWorldPosition = mPosition.xyz;\n#endif",lights_phong_pars_fragment:"uniform vec3 ambientLightColor;\n#if MAX_DIR_LIGHTS > 0\nuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\n#ifdef PHONG_PER_PIXEL\nuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\nuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n#else\nvarying vec4 vPointLight[ MAX_POINT_LIGHTS ];\n#endif\n#endif\n#if MAX_SPOT_LIGHTS > 0\nuniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\nuniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\nuniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\nuniform float spotLightAngle[ MAX_SPOT_LIGHTS ];\nuniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\n#ifdef PHONG_PER_PIXEL\nuniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\n#else\nvarying vec4 vSpotLight[ MAX_SPOT_LIGHTS ];\n#endif\nvarying vec3 vWorldPosition;\n#endif\n#ifdef WRAP_AROUND\nuniform vec3 wrapRGB;\n#endif\nvarying vec3 vViewPosition;\nvarying vec3 vNormal;",lights_phong_fragment:"vec3 normal = normalize( vNormal );\nvec3 viewPosition = normalize( vViewPosition );\n#ifdef DOUBLE_SIDED\nnormal = normal * ( -1.0 + 2.0 * float( gl_FrontFacing ) );\n#endif\n#if MAX_POINT_LIGHTS > 0\nvec3 pointDiffuse  = vec3( 0.0 );\nvec3 pointSpecular = vec3( 0.0 );\nfor ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\n#ifdef PHONG_PER_PIXEL\nvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz + vViewPosition.xyz;\nfloat lDistance = 1.0;\nif ( pointLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\nlVector = normalize( lVector );\n#else\nvec3 lVector = normalize( vPointLight[ i ].xyz );\nfloat lDistance = vPointLight[ i ].w;\n#endif\nfloat dotProduct = dot( normal, lVector );\n#ifdef WRAP_AROUND\nfloat pointDiffuseWeightFull = max( dotProduct, 0.0 );\nfloat pointDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\nvec3 pointDiffuseWeight = mix( vec3 ( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );\n#else\nfloat pointDiffuseWeight = max( dotProduct, 0.0 );\n#endif\npointDiffuse  += diffuse * pointLightColor[ i ] * pointDiffuseWeight * lDistance;\nvec3 pointHalfVector = normalize( lVector + viewPosition );\nfloat pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );\nfloat pointSpecularWeight = max( pow( pointDotNormalHalf, shininess ), 0.0 );\n#ifdef PHYSICALLY_BASED_SHADING\nfloat specularNormalization = ( shininess + 2.0001 ) / 8.0;\nvec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVector, pointHalfVector ), 5.0 );\npointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * lDistance * specularNormalization;\n#else\npointSpecular += specular * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * lDistance;\n#endif\n}\n#endif\n#if MAX_SPOT_LIGHTS > 0\nvec3 spotDiffuse  = vec3( 0.0 );\nvec3 spotSpecular = vec3( 0.0 );\nfor ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\n#ifdef PHONG_PER_PIXEL\nvec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz + vViewPosition.xyz;\nfloat lDistance = 1.0;\nif ( spotLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );\nlVector = normalize( lVector );\n#else\nvec3 lVector = normalize( vSpotLight[ i ].xyz );\nfloat lDistance = vSpotLight[ i ].w;\n#endif\nfloat spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );\nif ( spotEffect > spotLightAngle[ i ] ) {\nspotEffect = pow( spotEffect, spotLightExponent[ i ] );\nfloat dotProduct = dot( normal, lVector );\n#ifdef WRAP_AROUND\nfloat spotDiffuseWeightFull = max( dotProduct, 0.0 );\nfloat spotDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\nvec3 spotDiffuseWeight = mix( vec3 ( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );\n#else\nfloat spotDiffuseWeight = max( dotProduct, 0.0 );\n#endif\nspotDiffuse += diffuse * spotLightColor[ i ] * spotDiffuseWeight * lDistance * spotEffect;\nvec3 spotHalfVector = normalize( lVector + viewPosition );\nfloat spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );\nfloat spotSpecularWeight = max( pow( spotDotNormalHalf, shininess ), 0.0 );\n#ifdef PHYSICALLY_BASED_SHADING\nfloat specularNormalization = ( shininess + 2.0001 ) / 8.0;\nvec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVector, spotHalfVector ), 5.0 );\nspotSpecular += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * lDistance * specularNormalization * spotEffect;\n#else\nspotSpecular += specular * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * lDistance * spotEffect;\n#endif\n}\n}\n#endif\n#if MAX_DIR_LIGHTS > 0\nvec3 dirDiffuse  = vec3( 0.0 );\nvec3 dirSpecular = vec3( 0.0 );\nfor( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\nvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\nvec3 dirVector = normalize( lDirection.xyz );\nfloat dotProduct = dot( normal, dirVector );\n#ifdef WRAP_AROUND\nfloat dirDiffuseWeightFull = max( dotProduct, 0.0 );\nfloat dirDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\nvec3 dirDiffuseWeight = mix( vec3( dirDiffuseWeightFull ), vec3( dirDiffuseWeightHalf ), wrapRGB );\n#else\nfloat dirDiffuseWeight = max( dotProduct, 0.0 );\n#endif\ndirDiffuse  += diffuse * directionalLightColor[ i ] * dirDiffuseWeight;\nvec3 dirHalfVector = normalize( dirVector + viewPosition );\nfloat dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );\nfloat dirSpecularWeight = max( pow( dirDotNormalHalf, shininess ), 0.0 );\n#ifdef PHYSICALLY_BASED_SHADING\nfloat specularNormalization = ( shininess + 2.0001 ) / 8.0;\nvec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( dirVector, dirHalfVector ), 5.0 );\ndirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;\n#else\ndirSpecular += specular * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight;\n#endif\n}\n#endif\nvec3 totalDiffuse = vec3( 0.0 );\nvec3 totalSpecular = vec3( 0.0 );\n#if MAX_DIR_LIGHTS > 0\ntotalDiffuse += dirDiffuse;\ntotalSpecular += dirSpecular;\n#endif\n#if MAX_POINT_LIGHTS > 0\ntotalDiffuse += pointDiffuse;\ntotalSpecular += pointSpecular;\n#endif\n#if MAX_SPOT_LIGHTS > 0\ntotalDiffuse += spotDiffuse;\ntotalSpecular += spotSpecular;\n#endif\n#ifdef METAL\ngl_FragColor.xyz = gl_FragColor.xyz * ( emissive + totalDiffuse + ambientLightColor * ambient + totalSpecular );\n#else\ngl_FragColor.xyz = gl_FragColor.xyz * ( emissive + totalDiffuse + ambientLightColor * ambient ) + totalSpecular;\n#endif",color_pars_fragment:"#ifdef USE_COLOR\nvarying vec3 vColor;\n#endif",color_fragment:"#ifdef USE_COLOR\ngl_FragColor = gl_FragColor * vec4( vColor, opacity );\n#endif",color_pars_vertex:"#ifdef USE_COLOR\nvarying vec3 vColor;\n#endif",color_vertex:"#ifdef USE_COLOR\n#ifdef GAMMA_INPUT\nvColor = color * color;\n#else\nvColor = color;\n#endif\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\nuniform mat4 boneGlobalMatrices[ MAX_BONES ];\n#endif",skinning_vertex:"#ifdef USE_SKINNING\ngl_Position  = ( boneGlobalMatrices[ int( skinIndex.x ) ] * skinVertexA ) * skinWeight.x;\ngl_Position += ( boneGlobalMatrices[ int( skinIndex.y ) ] * skinVertexB ) * skinWeight.y;\ngl_Position  = projectionMatrix * modelViewMatrix * gl_Position;\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n#ifndef USE_MORPHNORMALS\nuniform float morphTargetInfluences[ 8 ];\n#else\nuniform float morphTargetInfluences[ 4 ];\n#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\nvec3 morphed = vec3( 0.0 );\nmorphed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\nmorphed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\nmorphed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\nmorphed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\n#ifndef USE_MORPHNORMALS\nmorphed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\nmorphed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\nmorphed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\nmorphed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\n#endif\nmorphed += position;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( morphed, 1.0 );\n#endif",default_vertex:"#ifndef USE_MORPHTARGETS\n#ifndef USE_SKINNING\ngl_Position = projectionMatrix * mvPosition;\n#endif\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\nvec3 morphedNormal = vec3( 0.0 );\nmorphedNormal +=  ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\nmorphedNormal +=  ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\nmorphedNormal +=  ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\nmorphedNormal +=  ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\nmorphedNormal += normal;\nvec3 transformedNormal = normalMatrix * morphedNormal;\n#else\nvec3 transformedNormal = normalMatrix * normal;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\nuniform sampler2D shadowMap[ MAX_SHADOWS ];\nuniform vec2 shadowMapSize[ MAX_SHADOWS ];\nuniform float shadowDarkness[ MAX_SHADOWS ];\nuniform float shadowBias[ MAX_SHADOWS ];\nvarying vec4 vShadowCoord[ MAX_SHADOWS ];\nfloat unpackDepth( const in vec4 rgba_depth ) {\nconst vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );\nfloat depth = dot( rgba_depth, bit_shift );\nreturn depth;\n}\n#endif",shadowmap_fragment:"#ifdef USE_SHADOWMAP\n#ifdef SHADOWMAP_DEBUG\nvec3 frustumColors[3];\nfrustumColors[0] = vec3( 1.0, 0.5, 0.0 );\nfrustumColors[1] = vec3( 0.0, 1.0, 0.8 );\nfrustumColors[2] = vec3( 0.0, 0.5, 1.0 );\n#endif\n#ifdef SHADOWMAP_CASCADE\nint inFrustumCount = 0;\n#endif\nfloat fDepth;\nvec3 shadowColor = vec3( 1.0 );\nfor( int i = 0; i < MAX_SHADOWS; i ++ ) {\nvec3 shadowCoord = vShadowCoord[ i ].xyz / vShadowCoord[ i ].w;\nbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\nbool inFrustum = all( inFrustumVec );\n#ifdef SHADOWMAP_CASCADE\ninFrustumCount += int( inFrustum );\nbvec3 frustumTestVec = bvec3( inFrustum, inFrustumCount == 1, shadowCoord.z <= 1.0 );\n#else\nbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n#endif\nbool frustumTest = all( frustumTestVec );\nif ( frustumTest ) {\nshadowCoord.z += shadowBias[ i ];\n#ifdef SHADOWMAP_SOFT\nfloat shadow = 0.0;\nconst float shadowDelta = 1.0 / 9.0;\nfloat xPixelOffset = 1.0 / shadowMapSize[ i ].x;\nfloat yPixelOffset = 1.0 / shadowMapSize[ i ].y;\nfloat dx0 = -1.25 * xPixelOffset;\nfloat dy0 = -1.25 * yPixelOffset;\nfloat dx1 = 1.25 * xPixelOffset;\nfloat dy1 = 1.25 * yPixelOffset;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nshadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );\n#else\nvec4 rgbaDepth = texture2D( shadowMap[ i ], shadowCoord.xy );\nfloat fDepth = unpackDepth( rgbaDepth );\nif ( fDepth < shadowCoord.z )\nshadowColor = shadowColor * vec3( 1.0 - shadowDarkness[ i ] );\n#endif\n}\n#ifdef SHADOWMAP_DEBUG\n#ifdef SHADOWMAP_CASCADE\nif ( inFrustum && inFrustumCount == 1 ) gl_FragColor.xyz *= frustumColors[ i ];\n#else\nif ( inFrustum ) gl_FragColor.xyz *= frustumColors[ i ];\n#endif\n#endif\n}\n#ifdef GAMMA_OUTPUT\nshadowColor *= shadowColor;\n#endif\ngl_FragColor.xyz = gl_FragColor.xyz * shadowColor;\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\nvarying vec4 vShadowCoord[ MAX_SHADOWS ];\nuniform mat4 shadowMatrix[ MAX_SHADOWS ];\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\nfor( int i = 0; i < MAX_SHADOWS; i ++ ) {\n#ifdef USE_MORPHTARGETS\nvShadowCoord[ i ] = shadowMatrix[ i ] * objectMatrix * vec4( morphed, 1.0 );\n#else\nvShadowCoord[ i ] = shadowMatrix[ i ] * objectMatrix * vec4( position, 1.0 );\n#endif\n}\n#endif",alphatest_fragment:"#ifdef ALPHATEST\nif ( gl_FragColor.a < ALPHATEST ) discard;\n#endif",linear_to_gamma_fragment:"#ifdef GAMMA_OUTPUT\ngl_FragColor.xyz = sqrt( gl_FragColor.xyz );\n#endif"},THREE.UniformsUtils={merge:function(e){var t,n,r,i={};for(t=0;t<e.length;t++){r=this.clone(e[t]);for(n in r)i[n]=r[n]}return i},clone:function(e){var t,n,r,i={};for(t in e){i[t]={};for(n in e[t])r=e[t][n],i[t][n]=r instanceof THREE.Color||r instanceof THREE.Vector2||r instanceof THREE.Vector3||r instanceof THREE.Vector4||r instanceof THREE.Matrix4||r instanceof THREE.Texture?r.clone():r instanceof Array?r.slice():r}return i}},THREE.UniformsLib={common:{diffuse:{type:"c",value:new THREE.Color(15658734)},opacity:{type:"f",value:1},map:{type:"t",value:0,texture:null},offsetRepeat:{type:"v4",value:new THREE.Vector4(0,0,1,1)},lightMap:{type:"t",value:2,texture:null},envMap:{type:"t",value:1,texture:null},flipEnvMap:{type:"f",value:-1},useRefract:{type:"i",value:0},reflectivity:{type:"f",value:1},refractionRatio:{type:"f",value:.98},combine:{type:"i",value:0},morphTargetInfluences:{type:"f",value:0}},fog:{fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new THREE.Color(16777215)}},lights:{ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]},spotLightColor:{type:"fv",value:[]},spotLightPosition:{type:"fv",value:[]},spotLightDirection:{type:"fv",value:[]},spotLightDistance:{type:"fv1",value:[]},spotLightAngle:{type:"fv1",value:[]},spotLightExponent:{type:"fv1",value:[]}},particle:{psColor:{type:"c",value:new THREE.Color(15658734)},opacity:{type:"f",value:1},size:{type:"f",value:1},scale:{type:"f",value:1},map:{type:"t",value:0,texture:null},fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new THREE.Color(16777215)}},shadowmap:{shadowMap:{type:"tv",value:6,texture:[]},shadowMapSize:{type:"v2v",value:[]},shadowBias:{type:"fv1",value:[]},shadowDarkness:{type:"fv1",value:[]},shadowMatrix:{type:"m4v",value:[]}}},THREE.ShaderLib={depth:{uniforms:{mNear:{type:"f",value:1},mFar:{type:"f",value:2e3},opacity:{type:"f",value:1}},vertexShader:"void main() {\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform float mNear;\nuniform float mFar;\nuniform float opacity;\nvoid main() {\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\nfloat color = 1.0 - smoothstep( mNear, mFar, depth );\ngl_FragColor = vec4( vec3( color ), opacity );\n}"},normal:{uniforms:{opacity:{type:"f",value:1}},vertexShader:"varying vec3 vNormal;\nvoid main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\nvNormal = normalMatrix * normal;\ngl_Position = projectionMatrix * mvPosition;\n}",fragmentShader:"uniform float opacity;\nvarying vec3 vNormal;\nvoid main() {\ngl_FragColor = vec4( 0.5 * normalize( vNormal ) + 0.5, opacity );\n}"},basic:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.fog,THREE.UniformsLib.shadowmap]),vertexShader:[THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,"void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.color_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.default_vertex,THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;\nuniform float opacity;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,"void main() {\ngl_FragColor = vec4( diffuse, opacity );",THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.linear_to_gamma_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n")},lambert:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.fog,THREE.UniformsLib.lights,THREE.UniformsLib.shadowmap,{ambient:{type:"c",value:new THREE.Color(16777215)},emissive:{type:"c",value:new THREE.Color(0)},wrapRGB:{type:"v3",value:new THREE.Vector3(1,1,1)}}]),vertexShader:["varying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\nvarying vec3 vLightBack;\n#endif",THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.lights_lambert_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,"void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.color_vertex,THREE.ShaderChunk.morphnormal_vertex,"#ifndef USE_ENVMAP\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\n#endif",THREE.ShaderChunk.lights_lambert_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.default_vertex,THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),
fragmentShader:["uniform float opacity;\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\nvarying vec3 vLightBack;\n#endif",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,"void main() {\ngl_FragColor = vec4( vec3 ( 1.0 ), opacity );",THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.alphatest_fragment,"#ifdef DOUBLE_SIDED\nif ( gl_FrontFacing )\ngl_FragColor.xyz *= vLightFront;\nelse\ngl_FragColor.xyz *= vLightBack;\n#else\ngl_FragColor.xyz *= vLightFront;\n#endif",THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.linear_to_gamma_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n")},phong:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.fog,THREE.UniformsLib.lights,THREE.UniformsLib.shadowmap,{ambient:{type:"c",value:new THREE.Color(16777215)},emissive:{type:"c",value:new THREE.Color(0)},specular:{type:"c",value:new THREE.Color(1118481)},shininess:{type:"f",value:30},wrapRGB:{type:"v3",value:new THREE.Vector3(1,1,1)}}]),vertexShader:["varying vec3 vViewPosition;\nvarying vec3 vNormal;",THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.lights_phong_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,"void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.color_vertex,"#ifndef USE_ENVMAP\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\n#endif\nvViewPosition = -mvPosition.xyz;",THREE.ShaderChunk.morphnormal_vertex,"vNormal = transformedNormal;",THREE.ShaderChunk.lights_phong_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.default_vertex,THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;\nuniform float opacity;\nuniform vec3 ambient;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.lights_phong_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,"void main() {\ngl_FragColor = vec4( vec3 ( 1.0 ), opacity );",THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.lights_phong_fragment,THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.linear_to_gamma_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n")},particle_basic:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.particle,THREE.UniformsLib.shadowmap]),vertexShader:["uniform float size;\nuniform float scale;",THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,"void main() {",THREE.ShaderChunk.color_vertex,"vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n#ifdef USE_SIZEATTENUATION\ngl_PointSize = size * ( scale / length( mvPosition.xyz ) );\n#else\ngl_PointSize = size;\n#endif\ngl_Position = projectionMatrix * mvPosition;",THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 psColor;\nuniform float opacity;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_particle_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,"void main() {\ngl_FragColor = vec4( psColor, opacity );",THREE.ShaderChunk.map_particle_fragment,THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n")},depthRGBA:{uniforms:{},vertexShader:[THREE.ShaderChunk.morphtarget_pars_vertex,"void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.default_vertex,"}"].join("\n"),fragmentShader:"vec4 pack_depth( const in float depth ) {\nconst vec4 bit_shift = vec4( 256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0 );\nconst vec4 bit_mask  = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );\nvec4 res = fract( depth * bit_shift );\nres -= res.xxyz * bit_mask;\nreturn res;\n}\nvoid main() {\ngl_FragData[ 0 ] = pack_depth( gl_FragCoord.z );\n}"}},THREE.WebGLRenderer=function(e){function t(e,t){var n=e.vertices.length,r=t.material;if(r.attributes){void 0===e.__webglCustomAttributesList&&(e.__webglCustomAttributesList=[]);for(var i in r.attributes){var o=r.attributes[i];if(!o.__webglInitialized||o.createUniqueBuffers){o.__webglInitialized=!0;var a=1;"v2"===o.type?a=2:"v3"===o.type?a=3:"v4"===o.type?a=4:"c"===o.type&&(a=3),o.size=a,o.array=new Float32Array(n*a),o.buffer=L.createBuffer(),o.buffer.belongsToAttribute=i,o.needsUpdate=!0}e.__webglCustomAttributesList.push(o)}}}function n(e,t){return!e.material||e.material instanceof THREE.MeshFaceMaterial?t.materialIndex>=0?e.geometry.materials[t.materialIndex]:void 0:e.material}function r(e){return!(e instanceof THREE.MeshBasicMaterial&&!e.envMap||e instanceof THREE.MeshDepthMaterial)&&(e&&void 0!==e.shading&&e.shading===THREE.SmoothShading?THREE.SmoothShading:THREE.FlatShading)}function i(e){return!!(e.map||e.lightMap||e instanceof THREE.ShaderMaterial)}function o(e,t,n){var r,i,o,a,s=e.vertices;a=s.length;var l=e.colors,c=l.length,u=e.__vertexArray,h=e.__colorArray,f=e.__sortArray,d=e.verticesNeedUpdate,p=e.colorsNeedUpdate,m=e.__webglCustomAttributesList;if(n.sortParticles){for(le.copy(se),le.multiplySelf(n.matrixWorld),r=0;r<a;r++)i=s[r],ce.copy(i),le.multiplyVector3(ce),f[r]=[ce.z,r];for(f.sort(function(e,t){return t[0]-e[0]}),r=0;r<a;r++)i=s[f[r][1]],o=3*r,u[o]=i.x,u[o+1]=i.y,u[o+2]=i.z;for(r=0;r<c;r++)o=3*r,i=l[f[r][1]],h[o]=i.r,h[o+1]=i.g,h[o+2]=i.b;if(m)for(l=0,c=m.length;l<c;l++)if(s=m[l],void 0===s.boundTo||"vertices"===s.boundTo)if(o=0,i=s.value.length,1===s.size)for(r=0;r<i;r++)a=f[r][1],s.array[r]=s.value[a];else if(2===s.size)for(r=0;r<i;r++)a=f[r][1],a=s.value[a],s.array[o]=a.x,s.array[o+1]=a.y,o+=2;else if(3===s.size)if("c"===s.type)for(r=0;r<i;r++)a=f[r][1],a=s.value[a],s.array[o]=a.r,s.array[o+1]=a.g,s.array[o+2]=a.b,o+=3;else for(r=0;r<i;r++)a=f[r][1],a=s.value[a],s.array[o]=a.x,s.array[o+1]=a.y,s.array[o+2]=a.z,o+=3;else if(4===s.size)for(r=0;r<i;r++)a=f[r][1],a=s.value[a],s.array[o]=a.x,s.array[o+1]=a.y,s.array[o+2]=a.z,s.array[o+3]=a.w,o+=4}else{if(d)for(r=0;r<a;r++)i=s[r],o=3*r,u[o]=i.x,u[o+1]=i.y,u[o+2]=i.z;if(p)for(r=0;r<c;r++)i=l[r],o=3*r,h[o]=i.r,h[o+1]=i.g,h[o+2]=i.b;if(m)for(l=0,c=m.length;l<c;l++)if(s=m[l],s.needsUpdate&&(void 0===s.boundTo||"vertices"===s.boundTo))if(i=s.value.length,o=0,1===s.size)for(r=0;r<i;r++)s.array[r]=s.value[r];else if(2===s.size)for(r=0;r<i;r++)a=s.value[r],s.array[o]=a.x,s.array[o+1]=a.y,o+=2;else if(3===s.size)if("c"===s.type)for(r=0;r<i;r++)a=s.value[r],s.array[o]=a.r,s.array[o+1]=a.g,s.array[o+2]=a.b,o+=3;else for(r=0;r<i;r++)a=s.value[r],s.array[o]=a.x,s.array[o+1]=a.y,s.array[o+2]=a.z,o+=3;else if(4===s.size)for(r=0;r<i;r++)a=s.value[r],s.array[o]=a.x,s.array[o+1]=a.y,s.array[o+2]=a.z,s.array[o+3]=a.w,o+=4}if((d||n.sortParticles)&&(L.bindBuffer(L.ARRAY_BUFFER,e.__webglVertexBuffer),L.bufferData(L.ARRAY_BUFFER,u,t)),(p||n.sortParticles)&&(L.bindBuffer(L.ARRAY_BUFFER,e.__webglColorBuffer),L.bufferData(L.ARRAY_BUFFER,h,t)),m)for(l=0,c=m.length;l<c;l++)s=m[l],(s.needsUpdate||n.sortParticles)&&(L.bindBuffer(L.ARRAY_BUFFER,s.buffer),L.bufferData(L.ARRAY_BUFFER,s.array,t))}function a(e,t){return t.z-e.z}function s(e,t,n){if(e.length)for(var r=0,i=e.length;r<i;r++)z=F=null,B=V=W=O=K=q=j=-1,he=!0,e[r].render(t,n,ie,oe),z=F=null,B=V=W=O=K=q=j=-1,he=!0}function l(e,t,n,r,i,o,a,s){var l,c,u,h;t?(c=e.length-1,h=t=-1):(c=0,t=e.length,h=1);for(var f=c;f!==t;f+=h)if(l=e[f],l.render){if(c=l.object,u=l.buffer,s)l=s;else{if(!(l=l[n]))continue;a&&N.setBlending(l.blending,l.blendEquation,l.blendSrc,l.blendDst),N.setDepthTest(l.depthTest),N.setDepthWrite(l.depthWrite),g(l.polygonOffset,l.polygonOffsetFactor,l.polygonOffsetUnits)}N.setObjectFaces(c),u instanceof THREE.BufferGeometry?N.renderBufferDirect(r,i,o,l,u,c):N.renderBuffer(r,i,o,l,u,c)}}function c(e,t,n,r,i,o,a){for(var s,l,c=0,u=e.length;c<u;c++)if(s=e[c],l=s.object,l.visible){if(a)s=a;else{if(!(s=s[t]))continue;o&&N.setBlending(s.blending,s.blendEquation,s.blendSrc,s.blendDst),N.setDepthTest(s.depthTest),N.setDepthWrite(s.depthWrite),g(s.polygonOffset,s.polygonOffsetFactor,s.polygonOffsetUnits)}N.renderImmediateObject(n,r,i,s,l)}}function u(e,t,n){e.push({buffer:t,object:n,opaque:null,transparent:null})}function h(e){for(var t in e.attributes)if(e.attributes[t].needsUpdate)return!0;return!1}function f(e){for(var t in e.attributes)e.attributes[t].needsUpdate=!1}function d(e,t){for(var n=e.length-1;n>=0;n--)e[n].object===t&&e.splice(n,1)}function p(e,t){for(var n=e.length-1;n>=0;n--)e[n]===t&&e.splice(n,1)}function m(e,t,n,r,i){if(r.program&&!r.needsUpdate||(N.initMaterial(r,t,n,i),r.needsUpdate=!1),r.morphTargets&&!i.__webglMorphTargetInfluences){i.__webglMorphTargetInfluences=new Float32Array(N.maxMorphTargets);for(var o=0,a=N.maxMorphTargets;o<a;o++)i.__webglMorphTargetInfluences[o]=0}var s=!1,o=r.program,a=o.uniforms,l=r.uniforms;if(o!==F&&(L.useProgram(o),F=o,s=!0),r.id!==B&&(B=r.id,s=!0),(s||e!==z)&&(L.uniformMatrix4fv(a.projectionMatrix,!1,e._projectionMatrixArray),e!==z&&(z=e)),s){if(n&&r.fog&&(l.fogColor.value=n.color,n instanceof THREE.Fog?(l.fogNear.value=n.near,l.fogFar.value=n.far):n instanceof THREE.FogExp2&&(l.fogDensity.value=n.density)),r instanceof THREE.MeshPhongMaterial||r instanceof THREE.MeshLambertMaterial||r.lights){if(he){for(var c,u,h,f,d=0,p=0,m=0,v=fe,g=v.directional.colors,E=v.directional.positions,x=v.point.colors,T=v.point.positions,w=v.point.distances,_=v.spot.colors,H=v.spot.positions,M=v.spot.distances,S=v.spot.directions,C=v.spot.angles,A=v.spot.exponents,P=0,D=0,k=0,U=f=0,n=U=0,s=t.length;n<s;n++)c=t[n],c.onlyShadow||(u=c.color,h=c.intensity,f=c.distance,c instanceof THREE.AmbientLight?N.gammaInput?(d+=u.r*u.r,p+=u.g*u.g,m+=u.b*u.b):(d+=u.r,p+=u.g,m+=u.b):c instanceof THREE.DirectionalLight?(f=3*P,N.gammaInput?(g[f]=u.r*u.r*h*h,g[f+1]=u.g*u.g*h*h,g[f+2]=u.b*u.b*h*h):(g[f]=u.r*h,g[f+1]=u.g*h,g[f+2]=u.b*h),ue.copy(c.matrixWorld.getPosition()),ue.subSelf(c.target.matrixWorld.getPosition()),ue.normalize(),E[f]=ue.x,E[f+1]=ue.y,E[f+2]=ue.z,P+=1):c instanceof THREE.PointLight?(U=3*D,N.gammaInput?(x[U]=u.r*u.r*h*h,x[U+1]=u.g*u.g*h*h,x[U+2]=u.b*u.b*h*h):(x[U]=u.r*h,x[U+1]=u.g*h,x[U+2]=u.b*h),u=c.matrixWorld.getPosition(),T[U]=u.x,T[U+1]=u.y,T[U+2]=u.z,w[D]=f,D+=1):c instanceof THREE.SpotLight&&(U=3*k,N.gammaInput?(_[U]=u.r*u.r*h*h,_[U+1]=u.g*u.g*h*h,_[U+2]=u.b*u.b*h*h):(_[U]=u.r*h,_[U+1]=u.g*h,_[U+2]=u.b*h),u=c.matrixWorld.getPosition(),H[U]=u.x,H[U+1]=u.y,H[U+2]=u.z,M[k]=f,ue.copy(u),ue.subSelf(c.target.matrixWorld.getPosition()),ue.normalize(),S[U]=ue.x,S[U+1]=ue.y,S[U+2]=ue.z,C[k]=Math.cos(c.angle),A[k]=c.exponent,k+=1));for(n=3*P,s=g.length;n<s;n++)g[n]=0;for(n=3*D,s=x.length;n<s;n++)x[n]=0;for(n=3*k,s=_.length;n<s;n++)_[n]=0;v.directional.length=P,v.point.length=D,v.spot.length=k,v.ambient[0]=d,v.ambient[1]=p,v.ambient[2]=m,he=!1}n=fe,l.ambientLightColor.value=n.ambient,l.directionalLightColor.value=n.directional.colors,l.directionalLightDirection.value=n.directional.positions,l.pointLightColor.value=n.point.colors,l.pointLightPosition.value=n.point.positions,l.pointLightDistance.value=n.point.distances,l.spotLightColor.value=n.spot.colors,l.spotLightPosition.value=n.spot.positions,l.spotLightDistance.value=n.spot.distances,l.spotLightDirection.value=n.spot.directions,l.spotLightAngle.value=n.spot.angles,l.spotLightExponent.value=n.spot.exponents}if((r instanceof THREE.MeshBasicMaterial||r instanceof THREE.MeshLambertMaterial||r instanceof THREE.MeshPhongMaterial)&&(l.opacity.value=r.opacity,N.gammaInput?l.diffuse.value.copyGammaToLinear(r.color):l.diffuse.value=r.color,(l.map.texture=r.map)&&l.offsetRepeat.value.set(r.map.offset.x,r.map.offset.y,r.map.repeat.x,r.map.repeat.y),l.lightMap.texture=r.lightMap,l.envMap.texture=r.envMap,l.flipEnvMap.value=r.envMap instanceof THREE.WebGLRenderTargetCube?1:-1,l.reflectivity.value=r.reflectivity,l.refractionRatio.value=r.refractionRatio,l.combine.value=r.combine,l.useRefract.value=r.envMap&&r.envMap.mapping instanceof THREE.CubeRefractionMapping),r instanceof THREE.LineBasicMaterial?(l.diffuse.value=r.color,l.opacity.value=r.opacity):r instanceof THREE.ParticleBasicMaterial?(l.psColor.value=r.color,l.opacity.value=r.opacity,l.size.value=r.size,l.scale.value=R.height/2,l.map.texture=r.map):r instanceof THREE.MeshPhongMaterial?(l.shininess.value=r.shininess,N.gammaInput?(l.ambient.value.copyGammaToLinear(r.ambient),l.emissive.value.copyGammaToLinear(r.emissive),l.specular.value.copyGammaToLinear(r.specular)):(l.ambient.value=r.ambient,l.emissive.value=r.emissive,l.specular.value=r.specular),r.wrapAround&&l.wrapRGB.value.copy(r.wrapRGB)):r instanceof THREE.MeshLambertMaterial?(N.gammaInput?(l.ambient.value.copyGammaToLinear(r.ambient),l.emissive.value.copyGammaToLinear(r.emissive)):(l.ambient.value=r.ambient,l.emissive.value=r.emissive),r.wrapAround&&l.wrapRGB.value.copy(r.wrapRGB)):r instanceof THREE.MeshDepthMaterial?(l.mNear.value=e.near,l.mFar.value=e.far,l.opacity.value=r.opacity):r instanceof THREE.MeshNormalMaterial&&(l.opacity.value=r.opacity),i.receiveShadow&&!r._shadowPass&&l.shadowMatrix)for(s=n=0,c=t.length;s<c;s++)d=t[s],d.castShadow&&(d instanceof THREE.SpotLight||d instanceof THREE.DirectionalLight&&!d.shadowCascade)&&(l.shadowMap.texture[n]=d.shadowMap,l.shadowMapSize.value[n]=d.shadowMapSize,l.shadowMatrix.value[n]=d.shadowMatrix,l.shadowDarkness.value[n]=d.shadowDarkness,l.shadowBias.value[n]=d.shadowBias,n++);for(t=r.uniformsList,l=0,n=t.length;l<n;l++)if(d=o.uniforms[t[l][1]])switch(s=t[l][0],p=s.type,c=s.value,p){case"i":L.uniform1i(d,c);break;case"f":L.uniform1f(d,c);break;case"v2":L.uniform2f(d,c.x,c.y);break;case"v3":L.uniform3f(d,c.x,c.y,c.z);break;case"v4":L.uniform4f(d,c.x,c.y,c.z,c.w);break;case"c":L.uniform3f(d,c.r,c.g,c.b);break;case"fv1":L.uniform1fv(d,c);break;case"fv":L.uniform3fv(d,c);break;case"v2v":for(s._array||(s._array=new Float32Array(2*c.length)),p=0,m=c.length;p<m;p++)v=2*p,s._array[v]=c[p].x,s._array[v+1]=c[p].y;L.uniform2fv(d,s._array);break;case"v3v":for(s._array||(s._array=new Float32Array(3*c.length)),p=0,m=c.length;p<m;p++)v=3*p,s._array[v]=c[p].x,s._array[v+1]=c[p].y,s._array[v+2]=c[p].z;L.uniform3fv(d,s._array);break;case"v4v":for(s._array||(s._array=new Float32Array(4*c.length)),p=0,m=c.length;p<m;p++)v=4*p,s._array[v]=c[p].x,s._array[v+1]=c[p].y,s._array[v+2]=c[p].z,s._array[v+3]=c[p].w;L.uniform4fv(d,s._array);break;case"m4":s._array||(s._array=new Float32Array(16)),c.flattenToArray(s._array),L.uniformMatrix4fv(d,!1,s._array);break;case"m4v":for(s._array||(s._array=new Float32Array(16*c.length)),p=0,m=c.length;p<m;p++)c[p].flattenToArrayOffset(s._array,16*p);L.uniformMatrix4fv(d,!1,s._array);break;case"t":if(L.uniform1i(d,c),!(d=s.texture))continue;if(d.image instanceof Array&&6===d.image.length){if(s=d,6===s.image.length)if(s.needsUpdate){for(s.image.__webglTextureCube||(s.image.__webglTextureCube=L.createTexture()),L.activeTexture(L.TEXTURE0+c),L.bindTexture(L.TEXTURE_CUBE_MAP,s.image.__webglTextureCube),c=[],d=0;d<6;d++)p=c,m=d,N.autoScaleCubemaps?(v=s.image[d],E=pe,v.width<=E&&v.height<=E||(x=Math.max(v.width,v.height),g=Math.floor(v.width*E/x),E=Math.floor(v.height*E/x),x=document.createElement("canvas"),x.width=g,x.height=E,x.getContext("2d").drawImage(v,0,0,v.width,v.height,0,0,g,E),v=x)):v=s.image[d],p[m]=v;for(d=c[0],p=0==(d.width&d.width-1)&&0==(d.height&d.height-1),m=b(s.format),v=b(s.type),y(L.TEXTURE_CUBE_MAP,s,p),d=0;d<6;d++)L.texImage2D(L.TEXTURE_CUBE_MAP_POSITIVE_X+d,0,m,m,v,c[d]);s.generateMipmaps&&p&&L.generateMipmap(L.TEXTURE_CUBE_MAP),s.needsUpdate=!1,s.onUpdate&&s.onUpdate()}else L.activeTexture(L.TEXTURE0+c),L.bindTexture(L.TEXTURE_CUBE_MAP,s.image.__webglTextureCube)}else d instanceof THREE.WebGLRenderTargetCube?(s=d,L.activeTexture(L.TEXTURE0+c),L.bindTexture(L.TEXTURE_CUBE_MAP,s.__webglTexture)):N.setTexture(d,c);break;case"tv":if(!s._array)for(s._array=[],p=0,m=s.texture.length;p<m;p++)s._array[p]=c+p;for(L.uniform1iv(d,s._array),p=0,m=s.texture.length;p<m;p++)(d=s.texture[p])&&N.setTexture(d,s._array[p])}(r instanceof THREE.ShaderMaterial||r instanceof THREE.MeshPhongMaterial||r.envMap)&&null!==a.cameraPosition&&(t=e.matrixWorld.getPosition(),L.uniform3f(a.cameraPosition,t.x,t.y,t.z)),(r instanceof THREE.MeshPhongMaterial||r instanceof THREE.MeshLambertMaterial||r instanceof THREE.ShaderMaterial||r.skinning)&&null!==a.viewMatrix&&L.uniformMatrix4fv(a.viewMatrix,!1,e._viewMatrixArray),r.skinning&&L.uniformMatrix4fv(a.boneGlobalMatrices,!1,i.boneMatrices)}return L.uniformMatrix4fv(a.modelViewMatrix,!1,i._modelViewMatrix.elements),a.normalMatrix&&L.uniformMatrix3fv(a.normalMatrix,!1,i._normalMatrix.elements),null!==a.objectMatrix&&L.uniformMatrix4fv(a.objectMatrix,!1,i.matrixWorld.elements),o}function v(e,t){e._modelViewMatrix.multiply(t.matrixWorldInverse,e.matrixWorld),e._normalMatrix.getInverse(e._modelViewMatrix),e._normalMatrix.transpose()}function g(e,t,n){$!==e&&(e?L.enable(L.POLYGON_OFFSET_FILL):L.disable(L.POLYGON_OFFSET_FILL),$=e),!e||Q===t&&Z===n||(L.polygonOffset(t,n),Q=t,Z=n)}function E(e,t){var n;return"fragment"===e?n=L.createShader(L.FRAGMENT_SHADER):"vertex"===e&&(n=L.createShader(L.VERTEX_SHADER)),L.shaderSource(n,t),L.compileShader(n),L.getShaderParameter(n,L.COMPILE_STATUS)?n:(console.error(L.getShaderInfoLog(n)),console.error(t),null)}function y(e,t,n){n?(L.texParameteri(e,L.TEXTURE_WRAP_S,b(t.wrapS)),L.texParameteri(e,L.TEXTURE_WRAP_T,b(t.wrapT)),L.texParameteri(e,L.TEXTURE_MAG_FILTER,b(t.magFilter)),L.texParameteri(e,L.TEXTURE_MIN_FILTER,b(t.minFilter))):(L.texParameteri(e,L.TEXTURE_WRAP_S,L.CLAMP_TO_EDGE),L.texParameteri(e,L.TEXTURE_WRAP_T,L.CLAMP_TO_EDGE),L.texParameteri(e,L.TEXTURE_MAG_FILTER,T(t.magFilter)),L.texParameteri(e,L.TEXTURE_MIN_FILTER,T(t.minFilter)))}function x(e,t){L.bindRenderbuffer(L.RENDERBUFFER,e),t.depthBuffer&&!t.stencilBuffer?(L.renderbufferStorage(L.RENDERBUFFER,L.DEPTH_COMPONENT16,t.width,t.height),L.framebufferRenderbuffer(L.FRAMEBUFFER,L.DEPTH_ATTACHMENT,L.RENDERBUFFER,e)):t.depthBuffer&&t.stencilBuffer?(L.renderbufferStorage(L.RENDERBUFFER,L.DEPTH_STENCIL,t.width,t.height),L.framebufferRenderbuffer(L.FRAMEBUFFER,L.DEPTH_STENCIL_ATTACHMENT,L.RENDERBUFFER,e)):L.renderbufferStorage(L.RENDERBUFFER,L.RGBA4,t.width,t.height)}function T(e){switch(e){case THREE.NearestFilter:case THREE.NearestMipMapNearestFilter:case THREE.NearestMipMapLinearFilter:return L.NEAREST;default:return L.LINEAR}}function b(e){switch(e){case THREE.RepeatWrapping:return L.REPEAT;case THREE.ClampToEdgeWrapping:return L.CLAMP_TO_EDGE;case THREE.MirroredRepeatWrapping:return L.MIRRORED_REPEAT;case THREE.NearestFilter:return L.NEAREST;case THREE.NearestMipMapNearestFilter:return L.NEAREST_MIPMAP_NEAREST;case THREE.NearestMipMapLinearFilter:return L.NEAREST_MIPMAP_LINEAR;case THREE.LinearFilter:return L.LINEAR;case THREE.LinearMipMapNearestFilter:return L.LINEAR_MIPMAP_NEAREST;case THREE.LinearMipMapLinearFilter:return L.LINEAR_MIPMAP_LINEAR;case THREE.ByteType:return L.BYTE;case THREE.UnsignedByteType:return L.UNSIGNED_BYTE;case THREE.ShortType:return L.SHORT;case THREE.UnsignedShortType:return L.UNSIGNED_SHORT;case THREE.IntType:return L.INT;case THREE.UnsignedIntType:return L.UNSIGNED_INT;case THREE.FloatType:return L.FLOAT;case THREE.AlphaFormat:return L.ALPHA;case THREE.RGBFormat:return L.RGB;case THREE.RGBAFormat:return L.RGBA;case THREE.LuminanceFormat:return L.LUMINANCE;case THREE.LuminanceAlphaFormat:return L.LUMINANCE_ALPHA;case THREE.AddEquation:return L.FUNC_ADD;case THREE.SubtractEquation:return L.FUNC_SUBTRACT;case THREE.ReverseSubtractEquation:return L.FUNC_REVERSE_SUBTRACT;case THREE.ZeroFactor:return L.ZERO;case THREE.OneFactor:return L.ONE;case THREE.SrcColorFactor:return L.SRC_COLOR;case THREE.OneMinusSrcColorFactor:return L.ONE_MINUS_SRC_COLOR;case THREE.SrcAlphaFactor:return L.SRC_ALPHA;case THREE.OneMinusSrcAlphaFactor:return L.ONE_MINUS_SRC_ALPHA;case THREE.DstAlphaFactor:return L.DST_ALPHA;case THREE.OneMinusDstAlphaFactor:return L.ONE_MINUS_DST_ALPHA;case THREE.DstColorFactor:return L.DST_COLOR;case THREE.OneMinusDstColorFactor:return L.ONE_MINUS_DST_COLOR;case THREE.SrcAlphaSaturateFactor:return L.SRC_ALPHA_SATURATE}return 0}console.log("THREE.WebGLRenderer",THREE.REVISION);var e=e||{},R=void 0!==e.canvas?e.canvas:document.createElement("canvas"),w=void 0!==e.precision?e.precision:"highp",_=void 0===e.alpha||e.alpha,H=void 0===e.premultipliedAlpha||e.premultipliedAlpha,M=void 0!==e.antialias&&e.antialias,S=void 0===e.stencil||e.stencil,C=void 0!==e.preserveDrawingBuffer&&e.preserveDrawingBuffer,A=void 0!==e.clearColor?new THREE.Color(e.clearColor):new THREE.Color(0),P=void 0!==e.clearAlpha?e.clearAlpha:0,D=void 0!==e.maxLights?e.maxLights:4;this.domElement=R,this.context=null,this.autoUpdateScene=this.autoUpdateObjects=this.sortObjects=this.autoClearStencil=this.autoClearDepth=this.autoClearColor=this.autoClear=!0,this.shadowMapEnabled=this.physicallyBasedShading=this.gammaOutput=this.gammaInput=!1,this.shadowMapCullFrontFaces=this.shadowMapSoft=this.shadowMapAutoUpdate=!0,this.shadowMapCascade=this.shadowMapDebug=!1,this.maxMorphTargets=8,this.maxMorphNormals=4,this.autoScaleCubemaps=!0,this.renderPluginsPre=[],this.renderPluginsPost=[],this.info={memory:{programs:0,geometries:0,textures:0},render:{calls:0,vertices:0,faces:0,points:0}};var L,N=this,k=[],F=null,U=null,B=-1,V=null,z=null,I=0,O=-1,W=-1,j=-1,G=-1,X=-1,Y=-1,q=-1,K=-1,$=null,Q=null,Z=null,J=null,ee=0,te=0,ne=0,re=0,ie=0,oe=0,ae=new THREE.Frustum,se=new THREE.Matrix4,le=new THREE.Matrix4,ce=new THREE.Vector4,ue=new THREE.Vector3,he=!0,fe={ambient:[0,0,0],directional:{length:0,colors:[],positions:[]},point:{length:0,colors:[],positions:[],distances:[]},spot:{length:0,colors:[],positions:[],distances:[],directions:[],angles:[],exponents:[]}};L=function(){var e;try{if(!(e=R.getContext("experimental-webgl",{alpha:_,premultipliedAlpha:H,antialias:M,stencil:S,preserveDrawingBuffer:C})))throw"Error creating WebGL context."}catch(e){console.error(e)}return e.getExtension("OES_texture_float")||console.log("THREE.WebGLRenderer: Float textures not supported."),e}(),L.clearColor(0,0,0,1),L.clearDepth(1),L.clearStencil(0),L.enable(L.DEPTH_TEST),L.depthFunc(L.LEQUAL),L.frontFace(L.CCW),L.cullFace(L.BACK),L.enable(L.CULL_FACE),L.enable(L.BLEND),L.blendEquation(L.FUNC_ADD),L.blendFunc(L.SRC_ALPHA,L.ONE_MINUS_SRC_ALPHA),L.clearColor(A.r,A.g,A.b,P),this.context=L;var de=L.getParameter(L.MAX_VERTEX_TEXTURE_IMAGE_UNITS);L.getParameter(L.MAX_TEXTURE_SIZE);var pe=L.getParameter(L.MAX_CUBE_MAP_TEXTURE_SIZE);this.getContext=function(){return L},this.supportsVertexTextures=function(){return de>0},this.setSize=function(e,t){R.width=e,R.height=t,this.setViewport(0,0,R.width,R.height)},this.setViewport=function(e,t,n,r){ee=e,te=t,ne=n,re=r,L.viewport(ee,te,ne,re)},this.setScissor=function(e,t,n,r){L.scissor(e,t,n,r)},this.enableScissorTest=function(e){e?L.enable(L.SCISSOR_TEST):L.disable(L.SCISSOR_TEST)},this.setClearColorHex=function(e,t){A.setHex(e),P=t,L.clearColor(A.r,A.g,A.b,P)},this.setClearColor=function(e,t){A.copy(e),P=t,L.clearColor(A.r,A.g,A.b,P)},this.getClearColor=function(){return A},this.getClearAlpha=function(){return P},this.clear=function(e,t,n){var r=0;(void 0===e||e)&&(r|=L.COLOR_BUFFER_BIT),(void 0===t||t)&&(r|=L.DEPTH_BUFFER_BIT),(void 0===n||n)&&(r|=L.STENCIL_BUFFER_BIT),L.clear(r)},this.clearTarget=function(e,t,n,r){this.setRenderTarget(e),this.clear(t,n,r)},this.addPostPlugin=function(e){e.init(this),this.renderPluginsPost.push(e)},this.addPrePlugin=function(e){e.init(this),this.renderPluginsPre.push(e)},this.deallocateObject=function(e){if(e.__webglInit)if(e.__webglInit=!1,delete e._modelViewMatrix,delete e._normalMatrix,delete e._normalMatrixArray,delete e._modelViewMatrixArray,delete e._objectMatrixArray,e instanceof THREE.Mesh)for(var t in e.geometry.geometryGroups){var n=e.geometry.geometryGroups[t];L.deleteBuffer(n.__webglVertexBuffer),L.deleteBuffer(n.__webglNormalBuffer),L.deleteBuffer(n.__webglTangentBuffer),L.deleteBuffer(n.__webglColorBuffer),L.deleteBuffer(n.__webglUVBuffer),L.deleteBuffer(n.__webglUV2Buffer),L.deleteBuffer(n.__webglSkinVertexABuffer),L.deleteBuffer(n.__webglSkinVertexBBuffer),L.deleteBuffer(n.__webglSkinIndicesBuffer),L.deleteBuffer(n.__webglSkinWeightsBuffer),L.deleteBuffer(n.__webglFaceBuffer),L.deleteBuffer(n.__webglLineBuffer);var r=void 0,i=void 0;if(n.numMorphTargets)for(r=0,i=n.numMorphTargets;r<i;r++)L.deleteBuffer(n.__webglMorphTargetsBuffers[r]);if(n.numMorphNormals)for(r=0,i=n.numMorphNormals;r<i;r++)L.deleteBuffer(n.__webglMorphNormalsBuffers[r]);if(n.__webglCustomAttributesList){r=void 0;for(r in n.__webglCustomAttributesList)L.deleteBuffer(n.__webglCustomAttributesList[r].buffer)}N.info.memory.geometries--}else e instanceof THREE.Ribbon?(e=e.geometry,L.deleteBuffer(e.__webglVertexBuffer),L.deleteBuffer(e.__webglColorBuffer),N.info.memory.geometries--):e instanceof THREE.Line?(e=e.geometry,L.deleteBuffer(e.__webglVertexBuffer),L.deleteBuffer(e.__webglColorBuffer),N.info.memory.geometries--):e instanceof THREE.ParticleSystem&&(e=e.geometry,L.deleteBuffer(e.__webglVertexBuffer),L.deleteBuffer(e.__webglColorBuffer),N.info.memory.geometries--)},this.deallocateTexture=function(e){e.__webglInit&&(e.__webglInit=!1,L.deleteTexture(e.__webglTexture),N.info.memory.textures--)},this.deallocateRenderTarget=function(e){if(e&&e.__webglTexture)if(L.deleteTexture(e.__webglTexture),e instanceof THREE.WebGLRenderTargetCube)for(var t=0;t<6;t++)L.deleteFramebuffer(e.__webglFramebuffer[t]),L.deleteRenderbuffer(e.__webglRenderbuffer[t]);else L.deleteFramebuffer(e.__webglFramebuffer),L.deleteRenderbuffer(e.__webglRenderbuffer)},this.updateShadowMap=function(e,t){F=null,B=V=K=q=j=-1,he=!0,W=O=-1,this.shadowMapPlugin.update(e,t)},this.renderBufferImmediate=function(e,t,n){if(e.__webglVertexBuffer||(e.__webglVertexBuffer=L.createBuffer()),e.__webglNormalBuffer||(e.__webglNormalBuffer=L.createBuffer()),e.hasPos&&(L.bindBuffer(L.ARRAY_BUFFER,e.__webglVertexBuffer),L.bufferData(L.ARRAY_BUFFER,e.positionArray,L.DYNAMIC_DRAW),L.enableVertexAttribArray(t.attributes.position),L.vertexAttribPointer(t.attributes.position,3,L.FLOAT,!1,0,0)),e.hasNormal){if(L.bindBuffer(L.ARRAY_BUFFER,e.__webglNormalBuffer),n===THREE.FlatShading){var r,i,o,a,s,l,c,u,h,f,d=3*e.count;for(f=0;f<d;f+=9)n=e.normalArray,r=n[f],i=n[f+1],o=n[f+2],a=n[f+3],l=n[f+4],u=n[f+5],s=n[f+6],c=n[f+7],h=n[f+8],r=(r+a+s)/3,i=(i+l+c)/3,o=(o+u+h)/3,n[f]=r,n[f+1]=i,n[f+2]=o,n[f+3]=r,n[f+4]=i,n[f+5]=o,n[f+6]=r,n[f+7]=i,n[f+8]=o}L.bufferData(L.ARRAY_BUFFER,e.normalArray,L.DYNAMIC_DRAW),L.enableVertexAttribArray(t.attributes.normal),L.vertexAttribPointer(t.attributes.normal,3,L.FLOAT,!1,0,0)}L.drawArrays(L.TRIANGLES,0,e.count),e.count=0},this.renderBufferDirect=function(e,t,n,r,i,o){if(!1!==r.visible&&(n=m(e,t,n,r,o),e=n.attributes,t=!1,r=16777215*i.id+2*n.id+(r.wireframe?1:0),r!==V&&(V=r,t=!0),o instanceof THREE.Mesh))for(o=i.offsets,r=0,n=o.length;r<n;++r)t&&(L.bindBuffer(L.ARRAY_BUFFER,i.vertexPositionBuffer),L.vertexAttribPointer(e.position,i.vertexPositionBuffer.itemSize,L.FLOAT,!1,0,12*o[r].index),e.normal>=0&&i.vertexNormalBuffer&&(L.bindBuffer(L.ARRAY_BUFFER,i.vertexNormalBuffer),L.vertexAttribPointer(e.normal,i.vertexNormalBuffer.itemSize,L.FLOAT,!1,0,12*o[r].index)),e.uv>=0&&i.vertexUvBuffer&&(i.vertexUvBuffer?(L.bindBuffer(L.ARRAY_BUFFER,i.vertexUvBuffer),L.vertexAttribPointer(e.uv,i.vertexUvBuffer.itemSize,L.FLOAT,!1,0,8*o[r].index),L.enableVertexAttribArray(e.uv)):L.disableVertexAttribArray(e.uv)),e.color>=0&&i.vertexColorBuffer&&(L.bindBuffer(L.ARRAY_BUFFER,i.vertexColorBuffer),L.vertexAttribPointer(e.color,i.vertexColorBuffer.itemSize,L.FLOAT,!1,0,16*o[r].index)),L.bindBuffer(L.ELEMENT_ARRAY_BUFFER,i.vertexIndexBuffer)),L.drawElements(L.TRIANGLES,o[r].count,L.UNSIGNED_SHORT,2*o[r].start),N.info.render.calls++,N.info.render.vertices=N.info.render.vertices+o[r].count,N.info.render.faces=N.info.render.faces+o[r].count/3},this.renderBuffer=function(e,t,n,r,i,o){if(!1!==r.visible){var a,s,n=m(e,t,n,r,o),t=n.attributes,e=!1,n=16777215*i.id+2*n.id+(r.wireframe?1:0);if(n!==V&&(V=n,e=!0),!r.morphTargets&&t.position>=0)e&&(L.bindBuffer(L.ARRAY_BUFFER,i.__webglVertexBuffer),L.vertexAttribPointer(t.position,3,L.FLOAT,!1,0,0));else if(o.morphTargetBase){if(n=r.program.attributes,-1!==o.morphTargetBase?(L.bindBuffer(L.ARRAY_BUFFER,i.__webglMorphTargetsBuffers[o.morphTargetBase]),L.vertexAttribPointer(n.position,3,L.FLOAT,!1,0,0)):n.position>=0&&(L.bindBuffer(L.ARRAY_BUFFER,i.__webglVertexBuffer),L.vertexAttribPointer(n.position,3,L.FLOAT,!1,0,0)),o.morphTargetForcedOrder.length){a=0;var l=o.morphTargetForcedOrder;for(s=o.morphTargetInfluences;a<r.numSupportedMorphTargets&&a<l.length;)L.bindBuffer(L.ARRAY_BUFFER,i.__webglMorphTargetsBuffers[l[a]]),L.vertexAttribPointer(n["morphTarget"+a],3,L.FLOAT,!1,0,0),r.morphNormals&&(L.bindBuffer(L.ARRAY_BUFFER,i.__webglMorphNormalsBuffers[l[a]]),L.vertexAttribPointer(n["morphNormal"+a],3,L.FLOAT,!1,0,0)),o.__webglMorphTargetInfluences[a]=s[l[a]],a++}else{var l=[],c=-1,u=0;s=o.morphTargetInfluences;var h,f=s.length;for(a=0,-1!==o.morphTargetBase&&(l[o.morphTargetBase]=!0);a<r.numSupportedMorphTargets;){for(h=0;h<f;h++)!l[h]&&s[h]>c&&(u=h,c=s[u]);L.bindBuffer(L.ARRAY_BUFFER,i.__webglMorphTargetsBuffers[u]),L.vertexAttribPointer(n["morphTarget"+a],3,L.FLOAT,!1,0,0),r.morphNormals&&(L.bindBuffer(L.ARRAY_BUFFER,i.__webglMorphNormalsBuffers[u]),L.vertexAttribPointer(n["morphNormal"+a],3,L.FLOAT,!1,0,0)),o.__webglMorphTargetInfluences[a]=c,l[u]=1,c=-1,a++}}null!==r.program.uniforms.morphTargetInfluences&&L.uniform1fv(r.program.uniforms.morphTargetInfluences,o.__webglMorphTargetInfluences)}if(e){if(i.__webglCustomAttributesList)for(a=0,s=i.__webglCustomAttributesList.length;a<s;a++)n=i.__webglCustomAttributesList[a],t[n.buffer.belongsToAttribute]>=0&&(L.bindBuffer(L.ARRAY_BUFFER,n.buffer),L.vertexAttribPointer(t[n.buffer.belongsToAttribute],n.size,L.FLOAT,!1,0,0));t.color>=0&&(L.bindBuffer(L.ARRAY_BUFFER,i.__webglColorBuffer),L.vertexAttribPointer(t.color,3,L.FLOAT,!1,0,0)),t.normal>=0&&(L.bindBuffer(L.ARRAY_BUFFER,i.__webglNormalBuffer),L.vertexAttribPointer(t.normal,3,L.FLOAT,!1,0,0)),t.tangent>=0&&(L.bindBuffer(L.ARRAY_BUFFER,i.__webglTangentBuffer),L.vertexAttribPointer(t.tangent,4,L.FLOAT,!1,0,0)),t.uv>=0&&(i.__webglUVBuffer?(L.bindBuffer(L.ARRAY_BUFFER,i.__webglUVBuffer),L.vertexAttribPointer(t.uv,2,L.FLOAT,!1,0,0),L.enableVertexAttribArray(t.uv)):L.disableVertexAttribArray(t.uv)),t.uv2>=0&&(i.__webglUV2Buffer?(L.bindBuffer(L.ARRAY_BUFFER,i.__webglUV2Buffer),L.vertexAttribPointer(t.uv2,2,L.FLOAT,!1,0,0),L.enableVertexAttribArray(t.uv2)):L.disableVertexAttribArray(t.uv2)),r.skinning&&t.skinVertexA>=0&&t.skinVertexB>=0&&t.skinIndex>=0&&t.skinWeight>=0&&(L.bindBuffer(L.ARRAY_BUFFER,i.__webglSkinVertexABuffer),L.vertexAttribPointer(t.skinVertexA,4,L.FLOAT,!1,0,0),L.bindBuffer(L.ARRAY_BUFFER,i.__webglSkinVertexBBuffer),L.vertexAttribPointer(t.skinVertexB,4,L.FLOAT,!1,0,0),L.bindBuffer(L.ARRAY_BUFFER,i.__webglSkinIndicesBuffer),L.vertexAttribPointer(t.skinIndex,4,L.FLOAT,!1,0,0),L.bindBuffer(L.ARRAY_BUFFER,i.__webglSkinWeightsBuffer),L.vertexAttribPointer(t.skinWeight,4,L.FLOAT,!1,0,0))}
o instanceof THREE.Mesh?(r.wireframe?(r=r.wireframeLinewidth,r!==J&&(L.lineWidth(r),J=r),e&&L.bindBuffer(L.ELEMENT_ARRAY_BUFFER,i.__webglLineBuffer),L.drawElements(L.LINES,i.__webglLineCount,L.UNSIGNED_SHORT,0)):(e&&L.bindBuffer(L.ELEMENT_ARRAY_BUFFER,i.__webglFaceBuffer),L.drawElements(L.TRIANGLES,i.__webglFaceCount,L.UNSIGNED_SHORT,0)),N.info.render.calls++,N.info.render.vertices=N.info.render.vertices+i.__webglFaceCount,N.info.render.faces=N.info.render.faces+i.__webglFaceCount/3):o instanceof THREE.Line?(o=o.type===THREE.LineStrip?L.LINE_STRIP:L.LINES,r=r.linewidth,r!==J&&(L.lineWidth(r),J=r),L.drawArrays(o,0,i.__webglLineCount),N.info.render.calls++):o instanceof THREE.ParticleSystem?(L.drawArrays(L.POINTS,0,i.__webglParticleCount),N.info.render.calls++,N.info.render.points=N.info.render.points+i.__webglParticleCount):o instanceof THREE.Ribbon&&(L.drawArrays(L.TRIANGLE_STRIP,0,i.__webglVertexCount),N.info.render.calls++)}},this.render=function(e,t,n,r){var i,o,u,h,f=e.__lights,d=e.fog;for(B=-1,he=!0,void 0===t.parent&&(console.warn("DEPRECATED: Camera hasn't been added to a Scene. Adding it..."),e.add(t)),this.autoUpdateScene&&e.updateMatrixWorld(),t._viewMatrixArray||(t._viewMatrixArray=new Float32Array(16)),t._projectionMatrixArray||(t._projectionMatrixArray=new Float32Array(16)),t.matrixWorldInverse.getInverse(t.matrixWorld),t.matrixWorldInverse.flattenToArray(t._viewMatrixArray),t.projectionMatrix.flattenToArray(t._projectionMatrixArray),se.multiply(t.projectionMatrix,t.matrixWorldInverse),ae.setFromMatrix(se),this.autoUpdateObjects&&this.initWebGLObjects(e),s(this.renderPluginsPre,e,t),N.info.render.calls=0,N.info.render.vertices=0,N.info.render.faces=0,N.info.render.points=0,this.setRenderTarget(n),(this.autoClear||r)&&this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil),h=e.__webglObjects,r=0,i=h.length;r<i;r++)if(o=h[r],u=o.object,o.render=!1,u.visible&&(!(u instanceof THREE.Mesh||u instanceof THREE.ParticleSystem)||!u.frustumCulled||ae.contains(u))){v(u,t);var p=o,m=p.object,E=p.buffer,y=void 0,y=y=void 0,y=m.material;y instanceof THREE.MeshFaceMaterial?(y=E.materialIndex)>=0&&(y=m.geometry.materials[y],y.transparent?(p.transparent=y,p.opaque=null):(p.opaque=y,p.transparent=null)):y&&(y.transparent?(p.transparent=y,p.opaque=null):(p.opaque=y,p.transparent=null)),o.render=!0,this.sortObjects&&(u.renderDepth?o.z=u.renderDepth:(ce.copy(u.matrixWorld.getPosition()),se.multiplyVector3(ce),o.z=ce.z))}for(this.sortObjects&&h.sort(a),h=e.__webglObjectsImmediate,r=0,i=h.length;r<i;r++)o=h[r],u=o.object,u.visible&&(v(u,t),u=o.object.material,u.transparent?(o.transparent=u,o.opaque=null):(o.opaque=u,o.transparent=null));e.overrideMaterial?(r=e.overrideMaterial,this.setBlending(r.blending,r.blendEquation,r.blendSrc,r.blendDst),this.setDepthTest(r.depthTest),this.setDepthWrite(r.depthWrite),g(r.polygonOffset,r.polygonOffsetFactor,r.polygonOffsetUnits),l(e.__webglObjects,!1,"",t,f,d,!0,r),c(e.__webglObjectsImmediate,"",t,f,d,!1,r)):(this.setBlending(THREE.NormalBlending),l(e.__webglObjects,!0,"opaque",t,f,d,!1),c(e.__webglObjectsImmediate,"opaque",t,f,d,!1),l(e.__webglObjects,!1,"transparent",t,f,d,!0),c(e.__webglObjectsImmediate,"transparent",t,f,d,!0)),s(this.renderPluginsPost,e,t),n&&n.generateMipmaps&&n.minFilter!==THREE.NearestFilter&&n.minFilter!==THREE.LinearFilter&&(n instanceof THREE.WebGLRenderTargetCube?(L.bindTexture(L.TEXTURE_CUBE_MAP,n.__webglTexture),L.generateMipmap(L.TEXTURE_CUBE_MAP),L.bindTexture(L.TEXTURE_CUBE_MAP,null)):(L.bindTexture(L.TEXTURE_2D,n.__webglTexture),L.generateMipmap(L.TEXTURE_2D),L.bindTexture(L.TEXTURE_2D,null))),this.setDepthTest(!0),this.setDepthWrite(!0)},this.renderImmediateObject=function(e,t,n,r,i){var o=m(e,t,n,r,i);V=-1,N.setObjectFaces(i),i.immediateRenderCallback?i.immediateRenderCallback(o,L,ae):i.render(function(e){N.renderBufferImmediate(e,o,r.shading)})},this.initWebGLObjects=function(e){for(e.__webglObjects||(e.__webglObjects=[],e.__webglObjectsImmediate=[],e.__webglSprites=[],e.__webglFlares=[]);e.__objectsAdded.length;){var a=e.__objectsAdded[0],s=e,l=void 0,c=void 0,m=void 0;if(!a.__webglInit)if(a.__webglInit=!0,a._modelViewMatrix=new THREE.Matrix4,a._normalMatrix=new THREE.Matrix3,a instanceof THREE.Mesh){if((c=a.geometry)instanceof THREE.Geometry){if(void 0===c.geometryGroups){var v=c,g=void 0,E=void 0,y=void 0,x=void 0,T=void 0,b=void 0,R=void 0,w={},_=v.morphTargets.length,H=v.morphNormals.length;for(v.geometryGroups={},g=0,E=v.faces.length;g<E;g++)y=v.faces[g],x=y.materialIndex,b=void 0!==x?x:-1,void 0===w[b]&&(w[b]={hash:b,counter:0}),R=w[b].hash+"_"+w[b].counter,void 0===v.geometryGroups[R]&&(v.geometryGroups[R]={faces3:[],faces4:[],materialIndex:x,vertices:0,numMorphTargets:_,numMorphNormals:H}),T=y instanceof THREE.Face3?3:4,v.geometryGroups[R].vertices+T>65535&&(w[b].counter=w[b].counter+1,R=w[b].hash+"_"+w[b].counter,void 0===v.geometryGroups[R]&&(v.geometryGroups[R]={faces3:[],faces4:[],materialIndex:x,vertices:0,numMorphTargets:_,numMorphNormals:H})),y instanceof THREE.Face3?v.geometryGroups[R].faces3.push(g):v.geometryGroups[R].faces4.push(g),v.geometryGroups[R].vertices=v.geometryGroups[R].vertices+T;v.geometryGroupsList=[];var M=void 0;for(M in v.geometryGroups)v.geometryGroups[M].id=I++,v.geometryGroupsList.push(v.geometryGroups[M])}for(l in c.geometryGroups)if(m=c.geometryGroups[l],!m.__webglVertexBuffer){var S=m;S.__webglVertexBuffer=L.createBuffer(),S.__webglNormalBuffer=L.createBuffer(),S.__webglTangentBuffer=L.createBuffer(),S.__webglColorBuffer=L.createBuffer(),S.__webglUVBuffer=L.createBuffer(),S.__webglUV2Buffer=L.createBuffer(),S.__webglSkinVertexABuffer=L.createBuffer(),S.__webglSkinVertexBBuffer=L.createBuffer(),S.__webglSkinIndicesBuffer=L.createBuffer(),S.__webglSkinWeightsBuffer=L.createBuffer(),S.__webglFaceBuffer=L.createBuffer(),S.__webglLineBuffer=L.createBuffer();var C=void 0,A=void 0;if(S.numMorphTargets)for(S.__webglMorphTargetsBuffers=[],C=0,A=S.numMorphTargets;C<A;C++)S.__webglMorphTargetsBuffers.push(L.createBuffer());if(S.numMorphNormals)for(S.__webglMorphNormalsBuffers=[],C=0,A=S.numMorphNormals;C<A;C++)S.__webglMorphNormalsBuffers.push(L.createBuffer());N.info.memory.geometries++;var P=m,D=a,k=D.geometry,F=P.faces3,U=P.faces4,B=3*F.length+4*U.length,V=1*F.length+2*U.length,z=3*F.length+4*U.length,O=n(D,P),W=i(O),j=r(O),G=!!O.vertexColors&&O.vertexColors;P.__vertexArray=new Float32Array(3*B),j&&(P.__normalArray=new Float32Array(3*B)),k.hasTangents&&(P.__tangentArray=new Float32Array(4*B)),G&&(P.__colorArray=new Float32Array(3*B)),W&&((k.faceUvs.length>0||k.faceVertexUvs.length>0)&&(P.__uvArray=new Float32Array(2*B)),(k.faceUvs.length>1||k.faceVertexUvs.length>1)&&(P.__uv2Array=new Float32Array(2*B))),D.geometry.skinWeights.length&&D.geometry.skinIndices.length&&(P.__skinVertexAArray=new Float32Array(4*B),P.__skinVertexBArray=new Float32Array(4*B),P.__skinIndexArray=new Float32Array(4*B),P.__skinWeightArray=new Float32Array(4*B)),P.__faceArray=new Uint16Array(3*V),P.__lineArray=new Uint16Array(2*z);var X=void 0,Y=void 0;if(P.numMorphTargets)for(P.__morphTargetsArrays=[],X=0,Y=P.numMorphTargets;X<Y;X++)P.__morphTargetsArrays.push(new Float32Array(3*B));if(P.numMorphNormals)for(P.__morphNormalsArrays=[],X=0,Y=P.numMorphNormals;X<Y;X++)P.__morphNormalsArrays.push(new Float32Array(3*B));if(P.__webglFaceCount=3*V,P.__webglLineCount=2*z,O.attributes){void 0===P.__webglCustomAttributesList&&(P.__webglCustomAttributesList=[]);var q=void 0;for(q in O.attributes){var K,$=O.attributes[q],Q={};for(K in $)Q[K]=$[K];if(!Q.__webglInitialized||Q.createUniqueBuffers){Q.__webglInitialized=!0;var Z=1;"v2"===Q.type?Z=2:"v3"===Q.type?Z=3:"v4"===Q.type?Z=4:"c"===Q.type&&(Z=3),Q.size=Z,Q.array=new Float32Array(B*Z),Q.buffer=L.createBuffer(),Q.buffer.belongsToAttribute=q,$.needsUpdate=!0,Q.__original=$}P.__webglCustomAttributesList.push(Q)}}P.__inittedArrays=!0,c.verticesNeedUpdate=!0,c.morphTargetsNeedUpdate=!0,c.elementsNeedUpdate=!0,c.uvsNeedUpdate=!0,c.normalsNeedUpdate=!0,c.tangetsNeedUpdate=!0,c.colorsNeedUpdate=!0}}}else if(a instanceof THREE.Ribbon){if(c=a.geometry,!c.__webglVertexBuffer){var J=c;J.__webglVertexBuffer=L.createBuffer(),J.__webglColorBuffer=L.createBuffer(),N.info.memory.geometries++;var ee=c,te=ee.vertices.length;ee.__vertexArray=new Float32Array(3*te),ee.__colorArray=new Float32Array(3*te),ee.__webglVertexCount=te,c.verticesNeedUpdate=!0,c.colorsNeedUpdate=!0}}else if(a instanceof THREE.Line){if(c=a.geometry,!c.__webglVertexBuffer){var ne=c;ne.__webglVertexBuffer=L.createBuffer(),ne.__webglColorBuffer=L.createBuffer(),N.info.memory.geometries++;var re=c,ie=a,oe=re.vertices.length;re.__vertexArray=new Float32Array(3*oe),re.__colorArray=new Float32Array(3*oe),re.__webglLineCount=oe,t(re,ie),c.verticesNeedUpdate=!0,c.colorsNeedUpdate=!0}}else if(a instanceof THREE.ParticleSystem&&(c=a.geometry,!c.__webglVertexBuffer)){var ae=c;ae.__webglVertexBuffer=L.createBuffer(),ae.__webglColorBuffer=L.createBuffer(),N.info.geometries++;var se=c,le=a,ce=se.vertices.length;se.__vertexArray=new Float32Array(3*ce),se.__colorArray=new Float32Array(3*ce),se.__sortArray=[],se.__webglParticleCount=ce,t(se,le),c.verticesNeedUpdate=!0,c.colorsNeedUpdate=!0}if(!a.__webglActive){if(a instanceof THREE.Mesh)if((c=a.geometry)instanceof THREE.BufferGeometry)u(s.__webglObjects,c,a);else for(l in c.geometryGroups)m=c.geometryGroups[l],u(s.__webglObjects,m,a);else a instanceof THREE.Ribbon||a instanceof THREE.Line||a instanceof THREE.ParticleSystem?(c=a.geometry,u(s.__webglObjects,c,a)):a instanceof THREE.ImmediateRenderObject||a.immediateRenderCallback?s.__webglObjectsImmediate.push({object:a,opaque:null,transparent:null}):a instanceof THREE.Sprite?s.__webglSprites.push(a):a instanceof THREE.LensFlare&&s.__webglFlares.push(a);a.__webglActive=!0}e.__objectsAdded.splice(0,1)}for(;e.__objectsRemoved.length;){var ue=e.__objectsRemoved[0],he=e;ue instanceof THREE.Mesh||ue instanceof THREE.ParticleSystem||ue instanceof THREE.Ribbon||ue instanceof THREE.Line?d(he.__webglObjects,ue):ue instanceof THREE.Sprite?p(he.__webglSprites,ue):ue instanceof THREE.LensFlare?p(he.__webglFlares,ue):(ue instanceof THREE.ImmediateRenderObject||ue.immediateRenderCallback)&&d(he.__webglObjectsImmediate,ue),ue.__webglActive=!1,e.__objectsRemoved.splice(0,1)}for(var fe=0,de=e.__webglObjects.length;fe<de;fe++){var pe=e.__webglObjects[fe].object,me=pe.geometry,ve=void 0,ge=void 0,Ee=void 0;if(pe instanceof THREE.Mesh)if(me instanceof THREE.BufferGeometry)me.verticesNeedUpdate=!1,me.elementsNeedUpdate=!1,me.uvsNeedUpdate=!1,me.normalsNeedUpdate=!1,me.colorsNeedUpdate=!1;else{for(var ye=0,xe=me.geometryGroupsList.length;ye<xe;ye++)if(ve=me.geometryGroupsList[ye],Ee=n(pe,ve),ge=Ee.attributes&&h(Ee),me.verticesNeedUpdate||me.morphTargetsNeedUpdate||me.elementsNeedUpdate||me.uvsNeedUpdate||me.normalsNeedUpdate||me.colorsNeedUpdate||me.tangetsNeedUpdate||ge){var Te=ve,be=pe,Re=L.DYNAMIC_DRAW,we=!me.dynamic,_e=Ee;if(Te.__inittedArrays){var He=r(_e),Me=!!_e.vertexColors&&_e.vertexColors,Se=i(_e),Ce=He===THREE.SmoothShading,Ae=void 0,Pe=void 0,De=void 0,Le=void 0,Ne=void 0,ke=void 0,Fe=void 0,Ue=void 0,Be=void 0,Ve=void 0,ze=void 0,Ie=void 0,Oe=void 0,We=void 0,je=void 0,Ge=void 0,Xe=void 0,Ye=void 0,qe=void 0,Ke=void 0,$e=void 0,Qe=void 0,Ze=void 0,Je=void 0,et=void 0,tt=void 0,nt=void 0,rt=void 0,it=void 0,ot=void 0,at=void 0,st=void 0,lt=void 0,ct=void 0,ut=void 0,ht=void 0,ft=void 0,dt=void 0,pt=void 0,mt=void 0,vt=void 0,gt=void 0,Et=void 0,yt=void 0,xt=void 0,Tt=void 0,bt=void 0,Rt=void 0,wt=void 0,_t=void 0,Ht=void 0,Mt=void 0,St=void 0,Ct=void 0,At=0,Pt=0,Dt=0,Lt=0,Nt=0,kt=0,Ft=0,Ut=0,Bt=0,Vt=0,zt=0,It=0,Ot=void 0,Wt=Te.__vertexArray,jt=Te.__uvArray,Gt=Te.__uv2Array,Xt=Te.__normalArray,Yt=Te.__tangentArray,qt=Te.__colorArray,Kt=Te.__skinVertexAArray,$t=Te.__skinVertexBArray,Qt=Te.__skinIndexArray,Zt=Te.__skinWeightArray,Jt=Te.__morphTargetsArrays,en=Te.__morphNormalsArrays,tn=Te.__webglCustomAttributesList,nn=void 0,rn=Te.__faceArray,on=Te.__lineArray,an=be.geometry,sn=an.elementsNeedUpdate,ln=an.uvsNeedUpdate,cn=an.normalsNeedUpdate,un=an.tangetsNeedUpdate,hn=an.colorsNeedUpdate,fn=an.morphTargetsNeedUpdate,dn=an.vertices,pn=Te.faces3,mn=Te.faces4,vn=an.faces,gn=an.faceVertexUvs[0],En=an.faceVertexUvs[1],yn=an.skinVerticesA,xn=an.skinVerticesB,Tn=an.skinIndices,bn=an.skinWeights,Rn=an.morphTargets,wn=an.morphNormals;if(an.verticesNeedUpdate){for(Ae=0,Pe=pn.length;Ae<Pe;Ae++)Le=vn[pn[Ae]],Ie=dn[Le.a],Oe=dn[Le.b],We=dn[Le.c],Wt[Pt]=Ie.x,Wt[Pt+1]=Ie.y,Wt[Pt+2]=Ie.z,Wt[Pt+3]=Oe.x,Wt[Pt+4]=Oe.y,Wt[Pt+5]=Oe.z,Wt[Pt+6]=We.x,Wt[Pt+7]=We.y,Wt[Pt+8]=We.z,Pt+=9;for(Ae=0,Pe=mn.length;Ae<Pe;Ae++)Le=vn[mn[Ae]],Ie=dn[Le.a],Oe=dn[Le.b],We=dn[Le.c],je=dn[Le.d],Wt[Pt]=Ie.x,Wt[Pt+1]=Ie.y,Wt[Pt+2]=Ie.z,Wt[Pt+3]=Oe.x,Wt[Pt+4]=Oe.y,Wt[Pt+5]=Oe.z,Wt[Pt+6]=We.x,Wt[Pt+7]=We.y,Wt[Pt+8]=We.z,Wt[Pt+9]=je.x,Wt[Pt+10]=je.y,Wt[Pt+11]=je.z,Pt+=12;L.bindBuffer(L.ARRAY_BUFFER,Te.__webglVertexBuffer),L.bufferData(L.ARRAY_BUFFER,Wt,Re)}if(fn)for(wt=0,_t=Rn.length;wt<_t;wt++){for(Ae=zt=0,Pe=pn.length;Ae<Pe;Ae++)St=pn[Ae],Le=vn[St],Ie=Rn[wt].vertices[Le.a],Oe=Rn[wt].vertices[Le.b],We=Rn[wt].vertices[Le.c],Ht=Jt[wt],Ht[zt]=Ie.x,Ht[zt+1]=Ie.y,Ht[zt+2]=Ie.z,Ht[zt+3]=Oe.x,Ht[zt+4]=Oe.y,Ht[zt+5]=Oe.z,Ht[zt+6]=We.x,Ht[zt+7]=We.y,Ht[zt+8]=We.z,_e.morphNormals&&(Ce?(Ct=wn[wt].vertexNormals[St],Ke=Ct.a,$e=Ct.b,Qe=Ct.c):Qe=$e=Ke=wn[wt].faceNormals[St],Mt=en[wt],Mt[zt]=Ke.x,Mt[zt+1]=Ke.y,Mt[zt+2]=Ke.z,Mt[zt+3]=$e.x,Mt[zt+4]=$e.y,Mt[zt+5]=$e.z,Mt[zt+6]=Qe.x,Mt[zt+7]=Qe.y,Mt[zt+8]=Qe.z),zt+=9;for(Ae=0,Pe=mn.length;Ae<Pe;Ae++)St=mn[Ae],Le=vn[St],Ie=Rn[wt].vertices[Le.a],Oe=Rn[wt].vertices[Le.b],We=Rn[wt].vertices[Le.c],je=Rn[wt].vertices[Le.d],Ht=Jt[wt],Ht[zt]=Ie.x,Ht[zt+1]=Ie.y,Ht[zt+2]=Ie.z,Ht[zt+3]=Oe.x,Ht[zt+4]=Oe.y,Ht[zt+5]=Oe.z,Ht[zt+6]=We.x,Ht[zt+7]=We.y,Ht[zt+8]=We.z,Ht[zt+9]=je.x,Ht[zt+10]=je.y,Ht[zt+11]=je.z,_e.morphNormals&&(Ce?(Ct=wn[wt].vertexNormals[St],Ke=Ct.a,$e=Ct.b,Qe=Ct.c,Ze=Ct.d):Ze=Qe=$e=Ke=wn[wt].faceNormals[St],Mt=en[wt],Mt[zt]=Ke.x,Mt[zt+1]=Ke.y,Mt[zt+2]=Ke.z,Mt[zt+3]=$e.x,Mt[zt+4]=$e.y,Mt[zt+5]=$e.z,Mt[zt+6]=Qe.x,Mt[zt+7]=Qe.y,Mt[zt+8]=Qe.z,Mt[zt+9]=Ze.x,Mt[zt+10]=Ze.y,Mt[zt+11]=Ze.z),zt+=12;L.bindBuffer(L.ARRAY_BUFFER,Te.__webglMorphTargetsBuffers[wt]),L.bufferData(L.ARRAY_BUFFER,Jt[wt],Re),_e.morphNormals&&(L.bindBuffer(L.ARRAY_BUFFER,Te.__webglMorphNormalsBuffers[wt]),L.bufferData(L.ARRAY_BUFFER,en[wt],Re))}if(bn.length){for(Ae=0,Pe=pn.length;Ae<Pe;Ae++)Le=vn[pn[Ae]],rt=bn[Le.a],it=bn[Le.b],ot=bn[Le.c],Zt[Vt]=rt.x,Zt[Vt+1]=rt.y,Zt[Vt+2]=rt.z,Zt[Vt+3]=rt.w,Zt[Vt+4]=it.x,Zt[Vt+5]=it.y,Zt[Vt+6]=it.z,Zt[Vt+7]=it.w,Zt[Vt+8]=ot.x,Zt[Vt+9]=ot.y,Zt[Vt+10]=ot.z,Zt[Vt+11]=ot.w,st=Tn[Le.a],lt=Tn[Le.b],ct=Tn[Le.c],Qt[Vt]=st.x,Qt[Vt+1]=st.y,Qt[Vt+2]=st.z,Qt[Vt+3]=st.w,Qt[Vt+4]=lt.x,Qt[Vt+5]=lt.y,Qt[Vt+6]=lt.z,Qt[Vt+7]=lt.w,Qt[Vt+8]=ct.x,Qt[Vt+9]=ct.y,Qt[Vt+10]=ct.z,Qt[Vt+11]=ct.w,ht=yn[Le.a],ft=yn[Le.b],dt=yn[Le.c],Kt[Vt]=ht.x,Kt[Vt+1]=ht.y,Kt[Vt+2]=ht.z,Kt[Vt+3]=1,Kt[Vt+4]=ft.x,Kt[Vt+5]=ft.y,Kt[Vt+6]=ft.z,Kt[Vt+7]=1,Kt[Vt+8]=dt.x,Kt[Vt+9]=dt.y,Kt[Vt+10]=dt.z,Kt[Vt+11]=1,mt=xn[Le.a],vt=xn[Le.b],gt=xn[Le.c],$t[Vt]=mt.x,$t[Vt+1]=mt.y,$t[Vt+2]=mt.z,$t[Vt+3]=1,$t[Vt+4]=vt.x,$t[Vt+5]=vt.y,$t[Vt+6]=vt.z,$t[Vt+7]=1,$t[Vt+8]=gt.x,$t[Vt+9]=gt.y,$t[Vt+10]=gt.z,$t[Vt+11]=1,Vt+=12;for(Ae=0,Pe=mn.length;Ae<Pe;Ae++)Le=vn[mn[Ae]],rt=bn[Le.a],it=bn[Le.b],ot=bn[Le.c],at=bn[Le.d],Zt[Vt]=rt.x,Zt[Vt+1]=rt.y,Zt[Vt+2]=rt.z,Zt[Vt+3]=rt.w,Zt[Vt+4]=it.x,Zt[Vt+5]=it.y,Zt[Vt+6]=it.z,Zt[Vt+7]=it.w,Zt[Vt+8]=ot.x,Zt[Vt+9]=ot.y,Zt[Vt+10]=ot.z,Zt[Vt+11]=ot.w,Zt[Vt+12]=at.x,Zt[Vt+13]=at.y,Zt[Vt+14]=at.z,Zt[Vt+15]=at.w,st=Tn[Le.a],lt=Tn[Le.b],ct=Tn[Le.c],ut=Tn[Le.d],Qt[Vt]=st.x,Qt[Vt+1]=st.y,Qt[Vt+2]=st.z,Qt[Vt+3]=st.w,Qt[Vt+4]=lt.x,Qt[Vt+5]=lt.y,Qt[Vt+6]=lt.z,Qt[Vt+7]=lt.w,Qt[Vt+8]=ct.x,Qt[Vt+9]=ct.y,Qt[Vt+10]=ct.z,Qt[Vt+11]=ct.w,Qt[Vt+12]=ut.x,Qt[Vt+13]=ut.y,Qt[Vt+14]=ut.z,Qt[Vt+15]=ut.w,ht=yn[Le.a],ft=yn[Le.b],dt=yn[Le.c],pt=yn[Le.d],Kt[Vt]=ht.x,Kt[Vt+1]=ht.y,Kt[Vt+2]=ht.z,Kt[Vt+3]=1,Kt[Vt+4]=ft.x,Kt[Vt+5]=ft.y,Kt[Vt+6]=ft.z,Kt[Vt+7]=1,Kt[Vt+8]=dt.x,Kt[Vt+9]=dt.y,Kt[Vt+10]=dt.z,Kt[Vt+11]=1,Kt[Vt+12]=pt.x,Kt[Vt+13]=pt.y,Kt[Vt+14]=pt.z,Kt[Vt+15]=1,mt=xn[Le.a],vt=xn[Le.b],gt=xn[Le.c],Et=xn[Le.d],$t[Vt]=mt.x,$t[Vt+1]=mt.y,$t[Vt+2]=mt.z,$t[Vt+3]=1,$t[Vt+4]=vt.x,$t[Vt+5]=vt.y,$t[Vt+6]=vt.z,$t[Vt+7]=1,$t[Vt+8]=gt.x,$t[Vt+9]=gt.y,$t[Vt+10]=gt.z,$t[Vt+11]=1,$t[Vt+12]=Et.x,$t[Vt+13]=Et.y,$t[Vt+14]=Et.z,$t[Vt+15]=1,Vt+=16;Vt>0&&(L.bindBuffer(L.ARRAY_BUFFER,Te.__webglSkinVertexABuffer),L.bufferData(L.ARRAY_BUFFER,Kt,Re),L.bindBuffer(L.ARRAY_BUFFER,Te.__webglSkinVertexBBuffer),L.bufferData(L.ARRAY_BUFFER,$t,Re),L.bindBuffer(L.ARRAY_BUFFER,Te.__webglSkinIndicesBuffer),L.bufferData(L.ARRAY_BUFFER,Qt,Re),L.bindBuffer(L.ARRAY_BUFFER,Te.__webglSkinWeightsBuffer),L.bufferData(L.ARRAY_BUFFER,Zt,Re))}if(hn&&Me){for(Ae=0,Pe=pn.length;Ae<Pe;Ae++)Le=vn[pn[Ae]],Fe=Le.vertexColors,Ue=Le.color,3===Fe.length&&Me===THREE.VertexColors?(Je=Fe[0],et=Fe[1],tt=Fe[2]):tt=et=Je=Ue,qt[Bt]=Je.r,qt[Bt+1]=Je.g,qt[Bt+2]=Je.b,qt[Bt+3]=et.r,qt[Bt+4]=et.g,qt[Bt+5]=et.b,qt[Bt+6]=tt.r,qt[Bt+7]=tt.g,qt[Bt+8]=tt.b,Bt+=9;for(Ae=0,Pe=mn.length;Ae<Pe;Ae++)Le=vn[mn[Ae]],Fe=Le.vertexColors,Ue=Le.color,4===Fe.length&&Me===THREE.VertexColors?(Je=Fe[0],et=Fe[1],tt=Fe[2],nt=Fe[3]):nt=tt=et=Je=Ue,qt[Bt]=Je.r,qt[Bt+1]=Je.g,qt[Bt+2]=Je.b,qt[Bt+3]=et.r,qt[Bt+4]=et.g,qt[Bt+5]=et.b,qt[Bt+6]=tt.r,qt[Bt+7]=tt.g,qt[Bt+8]=tt.b,qt[Bt+9]=nt.r,qt[Bt+10]=nt.g,qt[Bt+11]=nt.b,Bt+=12;Bt>0&&(L.bindBuffer(L.ARRAY_BUFFER,Te.__webglColorBuffer),L.bufferData(L.ARRAY_BUFFER,qt,Re))}if(un&&an.hasTangents){for(Ae=0,Pe=pn.length;Ae<Pe;Ae++)Le=vn[pn[Ae]],Be=Le.vertexTangents,Ge=Be[0],Xe=Be[1],Ye=Be[2],Yt[Ft]=Ge.x,Yt[Ft+1]=Ge.y,Yt[Ft+2]=Ge.z,Yt[Ft+3]=Ge.w,Yt[Ft+4]=Xe.x,Yt[Ft+5]=Xe.y,Yt[Ft+6]=Xe.z,Yt[Ft+7]=Xe.w,Yt[Ft+8]=Ye.x,Yt[Ft+9]=Ye.y,Yt[Ft+10]=Ye.z,Yt[Ft+11]=Ye.w,Ft+=12;for(Ae=0,Pe=mn.length;Ae<Pe;Ae++)Le=vn[mn[Ae]],Be=Le.vertexTangents,Ge=Be[0],Xe=Be[1],Ye=Be[2],qe=Be[3],Yt[Ft]=Ge.x,Yt[Ft+1]=Ge.y,Yt[Ft+2]=Ge.z,Yt[Ft+3]=Ge.w,Yt[Ft+4]=Xe.x,Yt[Ft+5]=Xe.y,Yt[Ft+6]=Xe.z,Yt[Ft+7]=Xe.w,Yt[Ft+8]=Ye.x,Yt[Ft+9]=Ye.y,Yt[Ft+10]=Ye.z,Yt[Ft+11]=Ye.w,Yt[Ft+12]=qe.x,Yt[Ft+13]=qe.y,Yt[Ft+14]=qe.z,Yt[Ft+15]=qe.w,Ft+=16;L.bindBuffer(L.ARRAY_BUFFER,Te.__webglTangentBuffer),L.bufferData(L.ARRAY_BUFFER,Yt,Re)}if(cn&&He){for(Ae=0,Pe=pn.length;Ae<Pe;Ae++)if(Le=vn[pn[Ae]],Ne=Le.vertexNormals,ke=Le.normal,3===Ne.length&&Ce)for(yt=0;yt<3;yt++)Tt=Ne[yt],Xt[kt]=Tt.x,Xt[kt+1]=Tt.y,Xt[kt+2]=Tt.z,kt+=3;else for(yt=0;yt<3;yt++)Xt[kt]=ke.x,Xt[kt+1]=ke.y,Xt[kt+2]=ke.z,kt+=3;for(Ae=0,Pe=mn.length;Ae<Pe;Ae++)if(Le=vn[mn[Ae]],Ne=Le.vertexNormals,ke=Le.normal,4===Ne.length&&Ce)for(yt=0;yt<4;yt++)Tt=Ne[yt],Xt[kt]=Tt.x,Xt[kt+1]=Tt.y,Xt[kt+2]=Tt.z,kt+=3;else for(yt=0;yt<4;yt++)Xt[kt]=ke.x,Xt[kt+1]=ke.y,Xt[kt+2]=ke.z,kt+=3;L.bindBuffer(L.ARRAY_BUFFER,Te.__webglNormalBuffer),L.bufferData(L.ARRAY_BUFFER,Xt,Re)}if(ln&&gn&&Se){for(Ae=0,Pe=pn.length;Ae<Pe;Ae++)if(De=pn[Ae],Le=vn[De],void 0!==(Ve=gn[De]))for(yt=0;yt<3;yt++)bt=Ve[yt],jt[Dt]=bt.u,jt[Dt+1]=bt.v,Dt+=2;for(Ae=0,Pe=mn.length;Ae<Pe;Ae++)if(De=mn[Ae],Le=vn[De],void 0!==(Ve=gn[De]))for(yt=0;yt<4;yt++)bt=Ve[yt],jt[Dt]=bt.u,jt[Dt+1]=bt.v,Dt+=2;Dt>0&&(L.bindBuffer(L.ARRAY_BUFFER,Te.__webglUVBuffer),L.bufferData(L.ARRAY_BUFFER,jt,Re))}if(ln&&En&&Se){for(Ae=0,Pe=pn.length;Ae<Pe;Ae++)if(De=pn[Ae],Le=vn[De],void 0!==(ze=En[De]))for(yt=0;yt<3;yt++)Rt=ze[yt],Gt[Lt]=Rt.u,Gt[Lt+1]=Rt.v,Lt+=2;for(Ae=0,Pe=mn.length;Ae<Pe;Ae++)if(De=mn[Ae],Le=vn[De],void 0!==(ze=En[De]))for(yt=0;yt<4;yt++)Rt=ze[yt],Gt[Lt]=Rt.u,Gt[Lt+1]=Rt.v,Lt+=2;Lt>0&&(L.bindBuffer(L.ARRAY_BUFFER,Te.__webglUV2Buffer),L.bufferData(L.ARRAY_BUFFER,Gt,Re))}if(sn){for(Ae=0,Pe=pn.length;Ae<Pe;Ae++)Le=vn[pn[Ae]],rn[Nt]=At,rn[Nt+1]=At+1,rn[Nt+2]=At+2,Nt+=3,on[Ut]=At,on[Ut+1]=At+1,on[Ut+2]=At,on[Ut+3]=At+2,on[Ut+4]=At+1,on[Ut+5]=At+2,Ut+=6,At+=3;for(Ae=0,Pe=mn.length;Ae<Pe;Ae++)Le=vn[mn[Ae]],rn[Nt]=At,rn[Nt+1]=At+1,rn[Nt+2]=At+3,rn[Nt+3]=At+1,rn[Nt+4]=At+2,rn[Nt+5]=At+3,Nt+=6,on[Ut]=At,on[Ut+1]=At+1,on[Ut+2]=At,on[Ut+3]=At+3,on[Ut+4]=At+1,on[Ut+5]=At+2,on[Ut+6]=At+2,on[Ut+7]=At+3,Ut+=8,At+=4;L.bindBuffer(L.ELEMENT_ARRAY_BUFFER,Te.__webglFaceBuffer),L.bufferData(L.ELEMENT_ARRAY_BUFFER,rn,Re),L.bindBuffer(L.ELEMENT_ARRAY_BUFFER,Te.__webglLineBuffer),L.bufferData(L.ELEMENT_ARRAY_BUFFER,on,Re)}if(tn)for(yt=0,xt=tn.length;yt<xt;yt++)if(nn=tn[yt],nn.__original.needsUpdate){if(It=0,1===nn.size){if(void 0===nn.boundTo||"vertices"===nn.boundTo){for(Ae=0,Pe=pn.length;Ae<Pe;Ae++)Le=vn[pn[Ae]],nn.array[It]=nn.value[Le.a],nn.array[It+1]=nn.value[Le.b],nn.array[It+2]=nn.value[Le.c],It+=3;for(Ae=0,Pe=mn.length;Ae<Pe;Ae++)Le=vn[mn[Ae]],nn.array[It]=nn.value[Le.a],nn.array[It+1]=nn.value[Le.b],nn.array[It+2]=nn.value[Le.c],nn.array[It+3]=nn.value[Le.d],It+=4}else if("faces"===nn.boundTo){for(Ae=0,Pe=pn.length;Ae<Pe;Ae++)Ot=nn.value[pn[Ae]],nn.array[It]=Ot,nn.array[It+1]=Ot,nn.array[It+2]=Ot,It+=3;for(Ae=0,Pe=mn.length;Ae<Pe;Ae++)Ot=nn.value[mn[Ae]],nn.array[It]=Ot,nn.array[It+1]=Ot,nn.array[It+2]=Ot,nn.array[It+3]=Ot,It+=4}}else if(2===nn.size){if(void 0===nn.boundTo||"vertices"===nn.boundTo){for(Ae=0,Pe=pn.length;Ae<Pe;Ae++)Le=vn[pn[Ae]],Ie=nn.value[Le.a],Oe=nn.value[Le.b],We=nn.value[Le.c],nn.array[It]=Ie.x,nn.array[It+1]=Ie.y,nn.array[It+2]=Oe.x,nn.array[It+3]=Oe.y,nn.array[It+4]=We.x,nn.array[It+5]=We.y,It+=6;for(Ae=0,Pe=mn.length;Ae<Pe;Ae++)Le=vn[mn[Ae]],Ie=nn.value[Le.a],Oe=nn.value[Le.b],We=nn.value[Le.c],je=nn.value[Le.d],nn.array[It]=Ie.x,nn.array[It+1]=Ie.y,nn.array[It+2]=Oe.x,nn.array[It+3]=Oe.y,nn.array[It+4]=We.x,nn.array[It+5]=We.y,nn.array[It+6]=je.x,nn.array[It+7]=je.y,It+=8}else if("faces"===nn.boundTo){for(Ae=0,Pe=pn.length;Ae<Pe;Ae++)We=Oe=Ie=Ot=nn.value[pn[Ae]],nn.array[It]=Ie.x,nn.array[It+1]=Ie.y,nn.array[It+2]=Oe.x,nn.array[It+3]=Oe.y,nn.array[It+4]=We.x,nn.array[It+5]=We.y,It+=6;for(Ae=0,Pe=mn.length;Ae<Pe;Ae++)je=We=Oe=Ie=Ot=nn.value[mn[Ae]],nn.array[It]=Ie.x,nn.array[It+1]=Ie.y,nn.array[It+2]=Oe.x,nn.array[It+3]=Oe.y,nn.array[It+4]=We.x,nn.array[It+5]=We.y,nn.array[It+6]=je.x,nn.array[It+7]=je.y,It+=8}}else if(3===nn.size){var _n;if(_n="c"===nn.type?["r","g","b"]:["x","y","z"],void 0===nn.boundTo||"vertices"===nn.boundTo){for(Ae=0,Pe=pn.length;Ae<Pe;Ae++)Le=vn[pn[Ae]],Ie=nn.value[Le.a],Oe=nn.value[Le.b],We=nn.value[Le.c],nn.array[It]=Ie[_n[0]],nn.array[It+1]=Ie[_n[1]],nn.array[It+2]=Ie[_n[2]],nn.array[It+3]=Oe[_n[0]],nn.array[It+4]=Oe[_n[1]],nn.array[It+5]=Oe[_n[2]],nn.array[It+6]=We[_n[0]],nn.array[It+7]=We[_n[1]],nn.array[It+8]=We[_n[2]],It+=9;for(Ae=0,Pe=mn.length;Ae<Pe;Ae++)Le=vn[mn[Ae]],Ie=nn.value[Le.a],Oe=nn.value[Le.b],We=nn.value[Le.c],je=nn.value[Le.d],nn.array[It]=Ie[_n[0]],nn.array[It+1]=Ie[_n[1]],nn.array[It+2]=Ie[_n[2]],nn.array[It+3]=Oe[_n[0]],nn.array[It+4]=Oe[_n[1]],nn.array[It+5]=Oe[_n[2]],nn.array[It+6]=We[_n[0]],nn.array[It+7]=We[_n[1]],nn.array[It+8]=We[_n[2]],nn.array[It+9]=je[_n[0]],nn.array[It+10]=je[_n[1]],nn.array[It+11]=je[_n[2]],It+=12}else if("faces"===nn.boundTo){for(Ae=0,Pe=pn.length;Ae<Pe;Ae++)We=Oe=Ie=Ot=nn.value[pn[Ae]],nn.array[It]=Ie[_n[0]],nn.array[It+1]=Ie[_n[1]],nn.array[It+2]=Ie[_n[2]],nn.array[It+3]=Oe[_n[0]],nn.array[It+4]=Oe[_n[1]],nn.array[It+5]=Oe[_n[2]],nn.array[It+6]=We[_n[0]],nn.array[It+7]=We[_n[1]],nn.array[It+8]=We[_n[2]],It+=9;for(Ae=0,Pe=mn.length;Ae<Pe;Ae++)je=We=Oe=Ie=Ot=nn.value[mn[Ae]],nn.array[It]=Ie[_n[0]],nn.array[It+1]=Ie[_n[1]],nn.array[It+2]=Ie[_n[2]],nn.array[It+3]=Oe[_n[0]],nn.array[It+4]=Oe[_n[1]],nn.array[It+5]=Oe[_n[2]],nn.array[It+6]=We[_n[0]],nn.array[It+7]=We[_n[1]],nn.array[It+8]=We[_n[2]],nn.array[It+9]=je[_n[0]],nn.array[It+10]=je[_n[1]],nn.array[It+11]=je[_n[2]],It+=12}}else if(4===nn.size)if(void 0===nn.boundTo||"vertices"===nn.boundTo){for(Ae=0,Pe=pn.length;Ae<Pe;Ae++)Le=vn[pn[Ae]],Ie=nn.value[Le.a],Oe=nn.value[Le.b],We=nn.value[Le.c],nn.array[It]=Ie.x,nn.array[It+1]=Ie.y,nn.array[It+2]=Ie.z,nn.array[It+3]=Ie.w,nn.array[It+4]=Oe.x,nn.array[It+5]=Oe.y,nn.array[It+6]=Oe.z,nn.array[It+7]=Oe.w,nn.array[It+8]=We.x,nn.array[It+9]=We.y,nn.array[It+10]=We.z,nn.array[It+11]=We.w,It+=12;for(Ae=0,Pe=mn.length;Ae<Pe;Ae++)Le=vn[mn[Ae]],Ie=nn.value[Le.a],Oe=nn.value[Le.b],We=nn.value[Le.c],je=nn.value[Le.d],nn.array[It]=Ie.x,nn.array[It+1]=Ie.y,nn.array[It+2]=Ie.z,nn.array[It+3]=Ie.w,nn.array[It+4]=Oe.x,nn.array[It+5]=Oe.y,nn.array[It+6]=Oe.z,nn.array[It+7]=Oe.w,nn.array[It+8]=We.x,nn.array[It+9]=We.y,nn.array[It+10]=We.z,nn.array[It+11]=We.w,nn.array[It+12]=je.x,nn.array[It+13]=je.y,nn.array[It+14]=je.z,nn.array[It+15]=je.w,It+=16}else if("faces"===nn.boundTo){for(Ae=0,Pe=pn.length;Ae<Pe;Ae++)We=Oe=Ie=Ot=nn.value[pn[Ae]],nn.array[It]=Ie.x,nn.array[It+1]=Ie.y,nn.array[It+2]=Ie.z,nn.array[It+3]=Ie.w,nn.array[It+4]=Oe.x,nn.array[It+5]=Oe.y,nn.array[It+6]=Oe.z,nn.array[It+7]=Oe.w,nn.array[It+8]=We.x,nn.array[It+9]=We.y,nn.array[It+10]=We.z,nn.array[It+11]=We.w,It+=12;for(Ae=0,Pe=mn.length;Ae<Pe;Ae++)je=We=Oe=Ie=Ot=nn.value[mn[Ae]],nn.array[It]=Ie.x,nn.array[It+1]=Ie.y,nn.array[It+2]=Ie.z,nn.array[It+3]=Ie.w,nn.array[It+4]=Oe.x,nn.array[It+5]=Oe.y,nn.array[It+6]=Oe.z,nn.array[It+7]=Oe.w,nn.array[It+8]=We.x,nn.array[It+9]=We.y,nn.array[It+10]=We.z,nn.array[It+11]=We.w,nn.array[It+12]=je.x,nn.array[It+13]=je.y,nn.array[It+14]=je.z,nn.array[It+15]=je.w,It+=16}L.bindBuffer(L.ARRAY_BUFFER,nn.buffer),L.bufferData(L.ARRAY_BUFFER,nn.array,Re)}we&&(delete Te.__inittedArrays,delete Te.__colorArray,delete Te.__normalArray,delete Te.__tangentArray,delete Te.__uvArray,delete Te.__uv2Array,delete Te.__faceArray,delete Te.__vertexArray,delete Te.__lineArray,delete Te.__skinVertexAArray,delete Te.__skinVertexBArray,delete Te.__skinIndexArray,delete Te.__skinWeightArray)}}me.verticesNeedUpdate=!1,me.morphTargetsNeedUpdate=!1,me.elementsNeedUpdate=!1,me.uvsNeedUpdate=!1,me.normalsNeedUpdate=!1,me.colorsNeedUpdate=!1,me.tangetsNeedUpdate=!1,Ee.attributes&&f(Ee)}else if(pe instanceof THREE.Ribbon){if(me.verticesNeedUpdate||me.colorsNeedUpdate){var Hn=me,Mn=L.DYNAMIC_DRAW,Sn=void 0,Cn=void 0,An=void 0,Pn=void 0,Dn=void 0,Ln=Hn.vertices,Nn=Hn.colors,kn=Ln.length,Fn=Nn.length,Un=Hn.__vertexArray,Bn=Hn.__colorArray,Vn=Hn.colorsNeedUpdate;if(Hn.verticesNeedUpdate){for(Sn=0;Sn<kn;Sn++)An=Ln[Sn],Pn=3*Sn,Un[Pn]=An.x,Un[Pn+1]=An.y,Un[Pn+2]=An.z;L.bindBuffer(L.ARRAY_BUFFER,Hn.__webglVertexBuffer),L.bufferData(L.ARRAY_BUFFER,Un,Mn)}if(Vn){for(Cn=0;Cn<Fn;Cn++)Dn=Nn[Cn],Pn=3*Cn,Bn[Pn]=Dn.r,Bn[Pn+1]=Dn.g,Bn[Pn+2]=Dn.b;L.bindBuffer(L.ARRAY_BUFFER,Hn.__webglColorBuffer),L.bufferData(L.ARRAY_BUFFER,Bn,Mn)}}me.verticesNeedUpdate=!1,me.colorsNeedUpdate=!1}else if(pe instanceof THREE.Line){if(Ee=n(pe,ve),ge=Ee.attributes&&h(Ee),me.verticesNeedUpdate||me.colorsNeedUpdate||ge){var zn=me,In=L.DYNAMIC_DRAW,On=void 0,Wn=void 0,jn=void 0,Gn=void 0,Xn=void 0,Yn=zn.vertices,qn=zn.colors,Kn=Yn.length,$n=qn.length,Qn=zn.__vertexArray,Zn=zn.__colorArray,Jn=zn.colorsNeedUpdate,er=zn.__webglCustomAttributesList,tr=void 0,nr=void 0,rr=void 0,ir=void 0,or=void 0,ar=void 0;if(zn.verticesNeedUpdate){for(On=0;On<Kn;On++)jn=Yn[On],Gn=3*On,Qn[Gn]=jn.x,Qn[Gn+1]=jn.y,Qn[Gn+2]=jn.z;L.bindBuffer(L.ARRAY_BUFFER,zn.__webglVertexBuffer),L.bufferData(L.ARRAY_BUFFER,Qn,In)}if(Jn){for(Wn=0;Wn<$n;Wn++)Xn=qn[Wn],Gn=3*Wn,Zn[Gn]=Xn.r,Zn[Gn+1]=Xn.g,Zn[Gn+2]=Xn.b;L.bindBuffer(L.ARRAY_BUFFER,zn.__webglColorBuffer),L.bufferData(L.ARRAY_BUFFER,Zn,In)}if(er)for(tr=0,nr=er.length;tr<nr;tr++)if(ar=er[tr],ar.needsUpdate&&(void 0===ar.boundTo||"vertices"===ar.boundTo)){if(Gn=0,ir=ar.value.length,1===ar.size)for(rr=0;rr<ir;rr++)ar.array[rr]=ar.value[rr];else if(2===ar.size)for(rr=0;rr<ir;rr++)or=ar.value[rr],ar.array[Gn]=or.x,ar.array[Gn+1]=or.y,Gn+=2;else if(3===ar.size)if("c"===ar.type)for(rr=0;rr<ir;rr++)or=ar.value[rr],ar.array[Gn]=or.r,ar.array[Gn+1]=or.g,ar.array[Gn+2]=or.b,Gn+=3;else for(rr=0;rr<ir;rr++)or=ar.value[rr],ar.array[Gn]=or.x,ar.array[Gn+1]=or.y,ar.array[Gn+2]=or.z,Gn+=3;else if(4===ar.size)for(rr=0;rr<ir;rr++)or=ar.value[rr],ar.array[Gn]=or.x,ar.array[Gn+1]=or.y,ar.array[Gn+2]=or.z,ar.array[Gn+3]=or.w,Gn+=4;L.bindBuffer(L.ARRAY_BUFFER,ar.buffer),L.bufferData(L.ARRAY_BUFFER,ar.array,In)}}me.verticesNeedUpdate=!1,me.colorsNeedUpdate=!1,Ee.attributes&&f(Ee)}else pe instanceof THREE.ParticleSystem&&(Ee=n(pe,ve),ge=Ee.attributes&&h(Ee),(me.verticesNeedUpdate||me.colorsNeedUpdate||pe.sortParticles||ge)&&o(me,L.DYNAMIC_DRAW,pe),me.verticesNeedUpdate=!1,me.colorsNeedUpdate=!1,Ee.attributes&&f(Ee))}},this.initMaterial=function(e,t,n,r){var i,o,a;if(e instanceof THREE.MeshDepthMaterial?a="depth":e instanceof THREE.MeshNormalMaterial?a="normal":e instanceof THREE.MeshBasicMaterial?a="basic":e instanceof THREE.MeshLambertMaterial?a="lambert":e instanceof THREE.MeshPhongMaterial?a="phong":e instanceof THREE.LineBasicMaterial?a="basic":e instanceof THREE.ParticleBasicMaterial&&(a="particle_basic"),a){var s=THREE.ShaderLib[a];e.uniforms=THREE.UniformsUtils.clone(s.uniforms),e.vertexShader=s.vertexShader,e.fragmentShader=s.fragmentShader}var l,c,u,h,f;for(l=h=f=s=0,c=t.length;l<c;l++)u=t[l],u.onlyShadow||(u instanceof THREE.DirectionalLight&&h++,u instanceof THREE.PointLight&&f++,u instanceof THREE.SpotLight&&s++);f+s+h<=D?(c=h,u=f,h=s):(c=Math.ceil(D*h/(f+h)),h=u=D-c);var d=0,s=0;for(f=t.length;s<f;s++)l=t[s],l.castShadow&&(l instanceof THREE.SpotLight&&d++,l instanceof THREE.DirectionalLight&&!l.shadowCascade&&d++);var p=50;void 0!==r&&r instanceof THREE.SkinnedMesh&&(p=r.bones.length);var m;e:{f=e.fragmentShader,l=e.vertexShader;var v,s=e.uniforms,t=e.attributes,n={map:!!e.map,envMap:!!e.envMap,lightMap:!!e.lightMap,vertexColors:e.vertexColors,fog:n,useFog:e.fog,sizeAttenuation:e.sizeAttenuation,skinning:e.skinning,maxBones:p,morphTargets:e.morphTargets,morphNormals:e.morphNormals,maxMorphTargets:this.maxMorphTargets,maxMorphNormals:this.maxMorphNormals,maxDirLights:c,maxPointLights:u,maxSpotLights:h,maxShadows:d,shadowMapEnabled:this.shadowMapEnabled&&r.receiveShadow,shadowMapSoft:this.shadowMapSoft,shadowMapDebug:this.shadowMapDebug,shadowMapCascade:this.shadowMapCascade,alphaTest:e.alphaTest,metal:e.metal,perPixel:e.perPixel,wrapAround:e.wrapAround,doubleSided:r&&r.doubleSided},r=[];a?r.push(a):(r.push(f),r.push(l));for(v in n)r.push(v),r.push(n[v]);for(a=r.join(),v=0,r=k.length;v<r;v++)if(k[v].code===a){m=k[v].program;break e}v=L.createProgram(),
r=["precision "+w+" float;",de>0?"#define VERTEX_TEXTURES":"",N.gammaInput?"#define GAMMA_INPUT":"",N.gammaOutput?"#define GAMMA_OUTPUT":"",N.physicallyBasedShading?"#define PHYSICALLY_BASED_SHADING":"","#define MAX_DIR_LIGHTS "+n.maxDirLights,"#define MAX_POINT_LIGHTS "+n.maxPointLights,"#define MAX_SPOT_LIGHTS "+n.maxSpotLights,"#define MAX_SHADOWS "+n.maxShadows,"#define MAX_BONES "+n.maxBones,n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.lightMap?"#define USE_LIGHTMAP":"",n.vertexColors?"#define USE_COLOR":"",n.skinning?"#define USE_SKINNING":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals?"#define USE_MORPHNORMALS":"",n.perPixel?"#define PHONG_PER_PIXEL":"",n.wrapAround?"#define WRAP_AROUND":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapSoft?"#define SHADOWMAP_SOFT":"",n.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",n.shadowMapCascade?"#define SHADOWMAP_CASCADE":"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"","uniform mat4 objectMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 viewMatrix;\nuniform mat3 normalMatrix;\nuniform vec3 cameraPosition;\nattribute vec3 position;\nattribute vec3 normal;\nattribute vec2 uv;\nattribute vec2 uv2;\n#ifdef USE_COLOR\nattribute vec3 color;\n#endif\n#ifdef USE_MORPHTARGETS\nattribute vec3 morphTarget0;\nattribute vec3 morphTarget1;\nattribute vec3 morphTarget2;\nattribute vec3 morphTarget3;\n#ifdef USE_MORPHNORMALS\nattribute vec3 morphNormal0;\nattribute vec3 morphNormal1;\nattribute vec3 morphNormal2;\nattribute vec3 morphNormal3;\n#else\nattribute vec3 morphTarget4;\nattribute vec3 morphTarget5;\nattribute vec3 morphTarget6;\nattribute vec3 morphTarget7;\n#endif\n#endif\n#ifdef USE_SKINNING\nattribute vec4 skinVertexA;\nattribute vec4 skinVertexB;\nattribute vec4 skinIndex;\nattribute vec4 skinWeight;\n#endif\n"].join("\n"),c=["precision "+w+" float;","#define MAX_DIR_LIGHTS "+n.maxDirLights,"#define MAX_POINT_LIGHTS "+n.maxPointLights,"#define MAX_SPOT_LIGHTS "+n.maxSpotLights,"#define MAX_SHADOWS "+n.maxShadows,n.alphaTest?"#define ALPHATEST "+n.alphaTest:"",N.gammaInput?"#define GAMMA_INPUT":"",N.gammaOutput?"#define GAMMA_OUTPUT":"",N.physicallyBasedShading?"#define PHYSICALLY_BASED_SHADING":"",n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fog instanceof THREE.FogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.lightMap?"#define USE_LIGHTMAP":"",n.vertexColors?"#define USE_COLOR":"",n.metal?"#define METAL":"",n.perPixel?"#define PHONG_PER_PIXEL":"",n.wrapAround?"#define WRAP_AROUND":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapSoft?"#define SHADOWMAP_SOFT":"",n.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",n.shadowMapCascade?"#define SHADOWMAP_CASCADE":"","uniform mat4 viewMatrix;\nuniform vec3 cameraPosition;\n"].join("\n"),L.attachShader(v,E("fragment",c+f)),L.attachShader(v,E("vertex",r+l)),L.linkProgram(v),L.getProgramParameter(v,L.LINK_STATUS)||console.error("Could not initialise shader\nVALIDATE_STATUS: "+L.getProgramParameter(v,L.VALIDATE_STATUS)+", gl error ["+L.getError()+"]"),v.uniforms={},v.attributes={};var g,r=["viewMatrix","modelViewMatrix","projectionMatrix","normalMatrix","objectMatrix","cameraPosition","boneGlobalMatrices","morphTargetInfluences"];for(g in s)r.push(g);for(g=r,r=0,s=g.length;r<s;r++)f=g[r],v.uniforms[f]=L.getUniformLocation(v,f);for(r=["position","normal","uv","uv2","tangent","color","skinVertexA","skinVertexB","skinIndex","skinWeight"],g=0;g<n.maxMorphTargets;g++)r.push("morphTarget"+g);for(g=0;g<n.maxMorphNormals;g++)r.push("morphNormal"+g);for(m in t)r.push(m);for(m=r,g=0,t=m.length;g<t;g++)n=m[g],v.attributes[n]=L.getAttribLocation(v,n);v.id=k.length,k.push({program:v,code:a}),N.info.memory.programs=k.length,m=v}if(e.program=m,m=e.program.attributes,m.position>=0&&L.enableVertexAttribArray(m.position),m.color>=0&&L.enableVertexAttribArray(m.color),m.normal>=0&&L.enableVertexAttribArray(m.normal),m.tangent>=0&&L.enableVertexAttribArray(m.tangent),e.skinning&&m.skinVertexA>=0&&m.skinVertexB>=0&&m.skinIndex>=0&&m.skinWeight>=0&&(L.enableVertexAttribArray(m.skinVertexA),L.enableVertexAttribArray(m.skinVertexB),L.enableVertexAttribArray(m.skinIndex),L.enableVertexAttribArray(m.skinWeight)),e.attributes)for(o in e.attributes)void 0!==m[o]&&m[o]>=0&&L.enableVertexAttribArray(m[o]);if(e.morphTargets)for(e.numSupportedMorphTargets=0,v="morphTarget",o=0;o<this.maxMorphTargets;o++)g=v+o,m[g]>=0&&(L.enableVertexAttribArray(m[g]),e.numSupportedMorphTargets++);if(e.morphNormals)for(e.numSupportedMorphNormals=0,v="morphNormal",o=0;o<this.maxMorphNormals;o++)g=v+o,m[g]>=0&&(L.enableVertexAttribArray(m[g]),e.numSupportedMorphNormals++);e.uniformsList=[];for(i in e.uniforms)e.uniformsList.push([e.uniforms[i],i])},this.setFaceCulling=function(e,t){e?(t&&"ccw"!==t?L.frontFace(L.CW):L.frontFace(L.CCW),"back"===e?L.cullFace(L.BACK):"front"===e?L.cullFace(L.FRONT):L.cullFace(L.FRONT_AND_BACK),L.enable(L.CULL_FACE)):L.disable(L.CULL_FACE)},this.setObjectFaces=function(e){O!==e.doubleSided&&(e.doubleSided?L.disable(L.CULL_FACE):L.enable(L.CULL_FACE),O=e.doubleSided),W!==e.flipSided&&(e.flipSided?L.frontFace(L.CW):L.frontFace(L.CCW),W=e.flipSided)},this.setDepthTest=function(e){q!==e&&(e?L.enable(L.DEPTH_TEST):L.disable(L.DEPTH_TEST),q=e)},this.setDepthWrite=function(e){K!==e&&(L.depthMask(e),K=e)},this.setBlending=function(e,t,n,r){if(e!==j){switch(e){case THREE.NoBlending:L.disable(L.BLEND);break;case THREE.AdditiveBlending:L.enable(L.BLEND),L.blendEquation(L.FUNC_ADD),L.blendFunc(L.SRC_ALPHA,L.ONE);break;case THREE.SubtractiveBlending:L.enable(L.BLEND),L.blendEquation(L.FUNC_ADD),L.blendFunc(L.ZERO,L.ONE_MINUS_SRC_COLOR);break;case THREE.MultiplyBlending:L.enable(L.BLEND),L.blendEquation(L.FUNC_ADD),L.blendFunc(L.ZERO,L.SRC_COLOR);break;case THREE.CustomBlending:L.enable(L.BLEND);break;default:L.enable(L.BLEND),L.blendEquationSeparate(L.FUNC_ADD,L.FUNC_ADD),L.blendFuncSeparate(L.SRC_ALPHA,L.ONE_MINUS_SRC_ALPHA,L.ONE,L.ONE_MINUS_SRC_ALPHA)}j=e}e===THREE.CustomBlending?(t!==G&&(L.blendEquation(b(t)),G=t),n===X&&r===Y||(L.blendFunc(b(n),b(r)),X=n,Y=r)):Y=X=G=null},this.setTexture=function(e,t){if(e.needsUpdate){e.__webglInit||(e.__webglInit=!0,e.__webglTexture=L.createTexture(),N.info.memory.textures++),L.activeTexture(L.TEXTURE0+t),L.bindTexture(L.TEXTURE_2D,e.__webglTexture),L.pixelStorei(L.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.premultiplyAlpha);var n=e.image,r=0==(n.width&n.width-1)&&0==(n.height&n.height-1),i=b(e.format),o=b(e.type);y(L.TEXTURE_2D,e,r),e instanceof THREE.DataTexture?L.texImage2D(L.TEXTURE_2D,0,i,n.width,n.height,0,i,o,n.data):L.texImage2D(L.TEXTURE_2D,0,i,i,o,e.image),e.generateMipmaps&&r&&L.generateMipmap(L.TEXTURE_2D),e.needsUpdate=!1,e.onUpdate&&e.onUpdate()}else L.activeTexture(L.TEXTURE0+t),L.bindTexture(L.TEXTURE_2D,e.__webglTexture)},this.setRenderTarget=function(e){var t=e instanceof THREE.WebGLRenderTargetCube;if(e&&!e.__webglFramebuffer){void 0===e.depthBuffer&&(e.depthBuffer=!0),void 0===e.stencilBuffer&&(e.stencilBuffer=!0),e.__webglTexture=L.createTexture();var n=0==(e.width&e.width-1)&&0==(e.height&e.height-1),r=b(e.format),i=b(e.type);if(t){e.__webglFramebuffer=[],e.__webglRenderbuffer=[],L.bindTexture(L.TEXTURE_CUBE_MAP,e.__webglTexture),y(L.TEXTURE_CUBE_MAP,e,n);for(var o=0;o<6;o++){e.__webglFramebuffer[o]=L.createFramebuffer(),e.__webglRenderbuffer[o]=L.createRenderbuffer(),L.texImage2D(L.TEXTURE_CUBE_MAP_POSITIVE_X+o,0,r,e.width,e.height,0,r,i,null);var a=e,s=L.TEXTURE_CUBE_MAP_POSITIVE_X+o;L.bindFramebuffer(L.FRAMEBUFFER,e.__webglFramebuffer[o]),L.framebufferTexture2D(L.FRAMEBUFFER,L.COLOR_ATTACHMENT0,s,a.__webglTexture,0),x(e.__webglRenderbuffer[o],e)}n&&L.generateMipmap(L.TEXTURE_CUBE_MAP)}else e.__webglFramebuffer=L.createFramebuffer(),e.__webglRenderbuffer=L.createRenderbuffer(),L.bindTexture(L.TEXTURE_2D,e.__webglTexture),y(L.TEXTURE_2D,e,n),L.texImage2D(L.TEXTURE_2D,0,r,e.width,e.height,0,r,i,null),r=L.TEXTURE_2D,L.bindFramebuffer(L.FRAMEBUFFER,e.__webglFramebuffer),L.framebufferTexture2D(L.FRAMEBUFFER,L.COLOR_ATTACHMENT0,r,e.__webglTexture,0),x(e.__webglRenderbuffer,e),n&&L.generateMipmap(L.TEXTURE_2D);t?L.bindTexture(L.TEXTURE_CUBE_MAP,null):L.bindTexture(L.TEXTURE_2D,null),L.bindRenderbuffer(L.RENDERBUFFER,null),L.bindFramebuffer(L.FRAMEBUFFER,null)}e?(t=t?e.__webglFramebuffer[e.activeCubeFace]:e.__webglFramebuffer,n=e.width,e=e.height,i=r=0):(t=null,n=ne,e=re,r=ee,i=te),t!==U&&(L.bindFramebuffer(L.FRAMEBUFFER,t),L.viewport(r,i,n,e),U=t),ie=n,oe=e},this.shadowMapPlugin=new THREE.ShadowMapPlugin,this.addPrePlugin(this.shadowMapPlugin),this.addPostPlugin(new THREE.SpritePlugin),this.addPostPlugin(new THREE.LensFlarePlugin)},THREE.WebGLRenderTarget=function(e,t,n){this.width=e,this.height=t,n=n||{},this.wrapS=void 0!==n.wrapS?n.wrapS:THREE.ClampToEdgeWrapping,this.wrapT=void 0!==n.wrapT?n.wrapT:THREE.ClampToEdgeWrapping,this.magFilter=void 0!==n.magFilter?n.magFilter:THREE.LinearFilter,this.minFilter=void 0!==n.minFilter?n.minFilter:THREE.LinearMipMapLinearFilter,this.offset=new THREE.Vector2(0,0),this.repeat=new THREE.Vector2(1,1),this.format=void 0!==n.format?n.format:THREE.RGBAFormat,this.type=void 0!==n.type?n.type:THREE.UnsignedByteType,this.depthBuffer=void 0===n.depthBuffer||n.depthBuffer,this.stencilBuffer=void 0===n.stencilBuffer||n.stencilBuffer,this.generateMipmaps=!0},THREE.WebGLRenderTarget.prototype.clone=function(){var e=new THREE.WebGLRenderTarget(this.width,this.height);return e.wrapS=this.wrapS,e.wrapT=this.wrapT,e.magFilter=this.magFilter,e.minFilter=this.minFilter,e.offset.copy(this.offset),e.repeat.copy(this.repeat),e.format=this.format,e.type=this.type,e.depthBuffer=this.depthBuffer,e.stencilBuffer=this.stencilBuffer,e},THREE.WebGLRenderTargetCube=function(e,t,n){THREE.WebGLRenderTarget.call(this,e,t,n),this.activeCubeFace=0},THREE.WebGLRenderTargetCube.prototype=new THREE.WebGLRenderTarget,THREE.WebGLRenderTargetCube.prototype.constructor=THREE.WebGLRenderTargetCube,THREE.RenderableVertex=function(){this.positionWorld=new THREE.Vector3,this.positionScreen=new THREE.Vector4,this.visible=!0},THREE.RenderableVertex.prototype.copy=function(e){this.positionWorld.copy(e.positionWorld),this.positionScreen.copy(e.positionScreen)},THREE.RenderableFace3=function(){this.v1=new THREE.RenderableVertex,this.v2=new THREE.RenderableVertex,this.v3=new THREE.RenderableVertex,this.centroidWorld=new THREE.Vector3,this.centroidScreen=new THREE.Vector3,this.normalWorld=new THREE.Vector3,this.vertexNormalsWorld=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3],this.faceMaterial=this.material=null,this.uvs=[[]],this.z=null},THREE.RenderableFace4=function(){this.v1=new THREE.RenderableVertex,this.v2=new THREE.RenderableVertex,this.v3=new THREE.RenderableVertex,this.v4=new THREE.RenderableVertex,this.centroidWorld=new THREE.Vector3,this.centroidScreen=new THREE.Vector3,this.normalWorld=new THREE.Vector3,this.vertexNormalsWorld=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3],this.faceMaterial=this.material=null,this.uvs=[[]],this.z=null},THREE.RenderableObject=function(){this.z=this.object=null},THREE.RenderableParticle=function(){this.rotation=this.z=this.y=this.x=null,this.scale=new THREE.Vector2,this.material=null},THREE.RenderableLine=function(){this.z=null,this.v1=new THREE.RenderableVertex,this.v2=new THREE.RenderableVertex,this.material=null},THREE.ColorUtils={adjustHSV:function(e,t,n,r){var i=THREE.ColorUtils.__hsv;THREE.ColorUtils.rgbToHsv(e,i),i.h=THREE.Math.clamp(i.h+t,0,1),i.s=THREE.Math.clamp(i.s+n,0,1),i.v=THREE.Math.clamp(i.v+r,0,1),e.setHSV(i.h,i.s,i.v)},rgbToHsv:function(e,t){var n=e.r,r=e.g,i=e.b,o=Math.max(Math.max(n,r),i),a=Math.min(Math.min(n,r),i);if(a===o)a=n=0;else{var s=o-a,a=s/o,n=(n===o?(r-i)/s:r===o?2+(i-n)/s:4+(n-r)/s)/6;n<0&&(n+=1),n>1&&(n-=1)}return void 0===t&&(t={h:0,s:0,v:0}),t.h=n,t.s=a,t.v=o,t}},THREE.ColorUtils.__hsv={h:0,s:0,v:0},THREE.GeometryUtils={merge:function(e,t){for(var n,r,i=e.vertices.length,o=t instanceof THREE.Mesh?t.geometry:t,a=e.vertices,s=o.vertices,l=e.faces,c=o.faces,u=e.faceVertexUvs[0],h=o.faceVertexUvs[0],f={},d=0;d<e.materials.length;d++)f[e.materials[d].id]=d;t instanceof THREE.Mesh&&(t.matrixAutoUpdate&&t.updateMatrix(),n=t.matrix,r=new THREE.Matrix4,r.extractRotation(n,t.scale));for(var d=0,p=s.length;d<p;d++){var m=s[d].clone();n&&n.multiplyVector3(m),a.push(m)}for(d=0,p=c.length;d<p;d++){var v,g,a=c[d],E=a.vertexNormals,y=a.vertexColors;for(a instanceof THREE.Face3?v=new THREE.Face3(a.a+i,a.b+i,a.c+i):a instanceof THREE.Face4&&(v=new THREE.Face4(a.a+i,a.b+i,a.c+i,a.d+i)),v.normal.copy(a.normal),r&&r.multiplyVector3(v.normal),s=0,m=E.length;s<m;s++)g=E[s].clone(),r&&r.multiplyVector3(g),v.vertexNormals.push(g);for(v.color.copy(a.color),s=0,m=y.length;s<m;s++)g=y[s],v.vertexColors.push(g.clone());void 0!==a.materialIndex&&(s=o.materials[a.materialIndex],m=s.id,y=f[m],void 0===y&&(y=e.materials.length,f[m]=y,e.materials.push(s)),v.materialIndex=y),v.centroid.copy(a.centroid),n&&n.multiplyVector3(v.centroid),l.push(v)}for(d=0,p=h.length;d<p;d++){for(n=h[d],r=[],s=0,m=n.length;s<m;s++)r.push(new THREE.UV(n[s].u,n[s].v));u.push(r)}},clone:function(e){var t,n=new THREE.Geometry,r=e.vertices,i=e.faces,o=e.faceVertexUvs[0];for(e.materials&&(n.materials=e.materials.slice()),e=0,t=r.length;e<t;e++)n.vertices.push(r[e].clone());for(e=0,t=i.length;e<t;e++)n.faces.push(i[e].clone());for(e=0,t=o.length;e<t;e++){for(var r=o[e],i=[],a=0,s=r.length;a<s;a++)i.push(new THREE.UV(r[a].u,r[a].v));n.faceVertexUvs[0].push(i)}return n},randomPointInTriangle:function(e,t,n){var r,i,o,a=new THREE.Vector3,s=THREE.GeometryUtils.__v1;return r=THREE.GeometryUtils.random(),i=THREE.GeometryUtils.random(),r+i>1&&(r=1-r,i=1-i),o=1-r-i,a.copy(e),a.multiplyScalar(r),s.copy(t),s.multiplyScalar(i),a.addSelf(s),s.copy(n),s.multiplyScalar(o),a.addSelf(s),a},randomPointInFace:function(e,t,n){var r,i,o;if(e instanceof THREE.Face3)return r=t.vertices[e.a],i=t.vertices[e.b],o=t.vertices[e.c],THREE.GeometryUtils.randomPointInTriangle(r,i,o);if(e instanceof THREE.Face4){r=t.vertices[e.a],i=t.vertices[e.b],o=t.vertices[e.c];var a,t=t.vertices[e.d];return n?e._area1&&e._area2?(n=e._area1,a=e._area2):(n=THREE.GeometryUtils.triangleArea(r,i,t),a=THREE.GeometryUtils.triangleArea(i,o,t),e._area1=n,e._area2=a):(n=THREE.GeometryUtils.triangleArea(r,i,t),a=THREE.GeometryUtils.triangleArea(i,o,t)),THREE.GeometryUtils.random()*(n+a)<n?THREE.GeometryUtils.randomPointInTriangle(r,i,t):THREE.GeometryUtils.randomPointInTriangle(i,o,t)}},randomPointsInGeometry:function(e,t){var n,r,i,o,a,s,l=e.faces,c=e.vertices,u=l.length,h=0,f=[];for(r=0;r<u;r++)n=l[r],n instanceof THREE.Face3?(i=c[n.a],o=c[n.b],a=c[n.c],n._area=THREE.GeometryUtils.triangleArea(i,o,a)):n instanceof THREE.Face4&&(i=c[n.a],o=c[n.b],a=c[n.c],s=c[n.d],n._area1=THREE.GeometryUtils.triangleArea(i,o,s),n._area2=THREE.GeometryUtils.triangleArea(o,a,s),n._area=n._area1+n._area2),h+=n._area,f[r]=h;for(n=[],r=0;r<t;r++)c=THREE.GeometryUtils.random()*h,c=function(e){function t(n,r){if(r<n)return n;var i=n+Math.floor((r-n)/2);return f[i]>e?t(n,i-1):f[i]<e?t(i+1,r):i}return t(0,f.length-1)}(c),n[r]=THREE.GeometryUtils.randomPointInFace(l[c],e,!0);return n},triangleArea:function(e,t,n){var r,i=THREE.GeometryUtils.__v1;return i.sub(e,t),r=i.length(),i.sub(e,n),e=i.length(),i.sub(t,n),n=i.length(),t=.5*(r+e+n),Math.sqrt(t*(t-r)*(t-e)*(t-n))},center:function(e){e.computeBoundingBox();var t=e.boundingBox,n=new THREE.Vector3;return n.add(t.min,t.max),n.multiplyScalar(-.5),e.applyMatrix((new THREE.Matrix4).makeTranslation(n.x,n.y,n.z)),e.computeBoundingBox(),n},normalizeUVs:function(e){for(var e=e.faceVertexUvs[0],t=0,n=e.length;t<n;t++)for(var r=e[t],i=0,o=r.length;i<o;i++)1!==r[i].u&&(r[i].u=r[i].u-Math.floor(r[i].u)),1!==r[i].v&&(r[i].v=r[i].v-Math.floor(r[i].v))},triangulateQuads:function(e){var t,n,r,i,o=[],a=[],s=[];for(t=0,n=e.faceUvs.length;t<n;t++)a[t]=[];for(t=0,n=e.faceVertexUvs.length;t<n;t++)s[t]=[];for(t=0,n=e.faces.length;t<n;t++)if((r=e.faces[t])instanceof THREE.Face4){i=r.a;var l=r.b,c=r.c,u=r.d,h=new THREE.Face3,f=new THREE.Face3;for(h.color.copy(r.color),f.color.copy(r.color),h.materialIndex=r.materialIndex,f.materialIndex=r.materialIndex,h.a=i,h.b=l,h.c=u,f.a=l,f.b=c,f.c=u,4===r.vertexColors.length&&(h.vertexColors[0]=r.vertexColors[0].clone(),h.vertexColors[1]=r.vertexColors[1].clone(),h.vertexColors[2]=r.vertexColors[3].clone(),f.vertexColors[0]=r.vertexColors[1].clone(),f.vertexColors[1]=r.vertexColors[2].clone(),f.vertexColors[2]=r.vertexColors[3].clone()),o.push(h,f),r=0,i=e.faceVertexUvs.length;r<i;r++)e.faceVertexUvs[r].length&&(h=e.faceVertexUvs[r][t],l=h[1],c=h[2],u=h[3],h=[h[0].clone(),l.clone(),u.clone()],l=[l.clone(),c.clone(),u.clone()],s[r].push(h,l));for(r=0,i=e.faceUvs.length;r<i;r++)e.faceUvs[r].length&&(l=e.faceUvs[r][t],a[r].push(l,l))}else{for(o.push(r),r=0,i=e.faceUvs.length;r<i;r++)a[r].push(e.faceUvs[r]);for(r=0,i=e.faceVertexUvs.length;r<i;r++)s[r].push(e.faceVertexUvs[r])}e.faces=o,e.faceUvs=a,e.faceVertexUvs=s,e.computeCentroids(),e.computeFaceNormals(),e.computeVertexNormals(),e.hasTangents&&e.computeTangents()},explode:function(e){for(var t=[],n=0,r=e.faces.length;n<r;n++){var i=t.length,o=e.faces[n];if(o instanceof THREE.Face4){var a=o.a,s=o.b,l=o.c,a=e.vertices[a],s=e.vertices[s],l=e.vertices[l],c=e.vertices[o.d];t.push(a.clone()),t.push(s.clone()),t.push(l.clone()),t.push(c.clone()),o.a=i,o.b=i+1,o.c=i+2,o.d=i+3}else a=o.a,s=o.b,l=o.c,a=e.vertices[a],s=e.vertices[s],l=e.vertices[l],t.push(a.clone()),t.push(s.clone()),t.push(l.clone()),o.a=i,o.b=i+1,o.c=i+2}e.vertices=t,delete e.__tmpVertices},tessellate:function(e,t){var n,r,i,o,a,s,l,c,u,h,f,d,p,m,v,g,E,y,x,T=[],b=[];for(n=0,r=e.faceVertexUvs.length;n<r;n++)b[n]=[];for(n=0,r=e.faces.length;n<r;n++)if((i=e.faces[n])instanceof THREE.Face3)if(o=i.a,a=i.b,s=i.c,c=e.vertices[o],u=e.vertices[a],h=e.vertices[s],d=c.distanceTo(u),p=u.distanceTo(h),f=c.distanceTo(h),d>t||p>t||f>t)for(l=e.vertices.length,y=i.clone(),x=i.clone(),d>=p&&d>=f?(c=c.clone(),c.lerpSelf(u,.5),y.a=o,y.b=l,y.c=s,x.a=l,x.b=a,x.c=s,3===i.vertexNormals.length&&(o=i.vertexNormals[0].clone(),o.lerpSelf(i.vertexNormals[1],.5),y.vertexNormals[1].copy(o),x.vertexNormals[0].copy(o)),3===i.vertexColors.length&&(o=i.vertexColors[0].clone(),o.lerpSelf(i.vertexColors[1],.5),y.vertexColors[1].copy(o),x.vertexColors[0].copy(o)),i=0):p>=d&&p>=f?(c=u.clone(),c.lerpSelf(h,.5),y.a=o,y.b=a,y.c=l,x.a=l,x.b=s,x.c=o,3===i.vertexNormals.length&&(o=i.vertexNormals[1].clone(),o.lerpSelf(i.vertexNormals[2],.5),y.vertexNormals[2].copy(o),x.vertexNormals[0].copy(o),x.vertexNormals[1].copy(i.vertexNormals[2]),x.vertexNormals[2].copy(i.vertexNormals[0])),3===i.vertexColors.length&&(o=i.vertexColors[1].clone(),o.lerpSelf(i.vertexColors[2],.5),y.vertexColors[2].copy(o),x.vertexColors[0].copy(o),x.vertexColors[1].copy(i.vertexColors[2]),x.vertexColors[2].copy(i.vertexColors[0])),i=1):(c=c.clone(),c.lerpSelf(h,.5),y.a=o,y.b=a,y.c=l,x.a=l,x.b=a,x.c=s,3===i.vertexNormals.length&&(o=i.vertexNormals[0].clone(),o.lerpSelf(i.vertexNormals[2],.5),y.vertexNormals[2].copy(o),x.vertexNormals[0].copy(o)),3===i.vertexColors.length&&(o=i.vertexColors[0].clone(),o.lerpSelf(i.vertexColors[2],.5),y.vertexColors[2].copy(o),x.vertexColors[0].copy(o)),i=2),T.push(y,x),e.vertices.push(c),o=0,a=e.faceVertexUvs.length;o<a;o++)e.faceVertexUvs[o].length&&(c=e.faceVertexUvs[o][n],x=c[0],s=c[1],y=c[2],0===i?(u=x.clone(),u.lerpSelf(s,.5),c=[x.clone(),u.clone(),y.clone()],s=[u.clone(),s.clone(),y.clone()]):1===i?(u=s.clone(),u.lerpSelf(y,.5),c=[x.clone(),s.clone(),u.clone()],s=[u.clone(),y.clone(),x.clone()]):(u=x.clone(),u.lerpSelf(y,.5),c=[x.clone(),s.clone(),u.clone()],s=[u.clone(),s.clone(),y.clone()]),b[o].push(c,s));else for(T.push(i),o=0,a=e.faceVertexUvs.length;o<a;o++)b[o].push(e.faceVertexUvs[o][n]);else if(o=i.a,a=i.b,s=i.c,l=i.d,c=e.vertices[o],u=e.vertices[a],h=e.vertices[s],f=e.vertices[l],d=c.distanceTo(u),p=u.distanceTo(h),m=h.distanceTo(f),v=c.distanceTo(f),d>t||p>t||m>t||v>t)for(g=e.vertices.length,E=e.vertices.length+1,y=i.clone(),x=i.clone(),d>=p&&d>=m&&d>=v||m>=p&&m>=d&&m>=v?(d=c.clone(),d.lerpSelf(u,.5),u=h.clone(),u.lerpSelf(f,.5),y.a=o,y.b=g,y.c=E,y.d=l,x.a=g,x.b=a,x.c=s,x.d=E,4===i.vertexNormals.length&&(o=i.vertexNormals[0].clone(),o.lerpSelf(i.vertexNormals[1],.5),a=i.vertexNormals[2].clone(),a.lerpSelf(i.vertexNormals[3],.5),y.vertexNormals[1].copy(o),y.vertexNormals[2].copy(a),x.vertexNormals[0].copy(o),x.vertexNormals[3].copy(a)),4===i.vertexColors.length&&(o=i.vertexColors[0].clone(),o.lerpSelf(i.vertexColors[1],.5),a=i.vertexColors[2].clone(),a.lerpSelf(i.vertexColors[3],.5),y.vertexColors[1].copy(o),y.vertexColors[2].copy(a),x.vertexColors[0].copy(o),x.vertexColors[3].copy(a)),i=0):(d=u.clone(),d.lerpSelf(h,.5),u=f.clone(),u.lerpSelf(c,.5),y.a=o,y.b=a,y.c=g,y.d=E,x.a=E,x.b=g,x.c=s,x.d=l,4===i.vertexNormals.length&&(o=i.vertexNormals[1].clone(),o.lerpSelf(i.vertexNormals[2],.5),a=i.vertexNormals[3].clone(),a.lerpSelf(i.vertexNormals[0],.5),y.vertexNormals[2].copy(o),y.vertexNormals[3].copy(a),x.vertexNormals[0].copy(a),x.vertexNormals[1].copy(o)),4===i.vertexColors.length&&(o=i.vertexColors[1].clone(),o.lerpSelf(i.vertexColors[2],.5),a=i.vertexColors[3].clone(),a.lerpSelf(i.vertexColors[0],.5),y.vertexColors[2].copy(o),y.vertexColors[3].copy(a),x.vertexColors[0].copy(a),x.vertexColors[1].copy(o)),i=1),T.push(y,x),e.vertices.push(d,u),o=0,a=e.faceVertexUvs.length;o<a;o++)e.faceVertexUvs[o].length&&(c=e.faceVertexUvs[o][n],x=c[0],s=c[1],y=c[2],c=c[3],0===i?(u=x.clone(),u.lerpSelf(s,.5),h=y.clone(),h.lerpSelf(c,.5),x=[x.clone(),u.clone(),h.clone(),c.clone()],s=[u.clone(),s.clone(),y.clone(),h.clone()]):(u=s.clone(),u.lerpSelf(y,.5),h=c.clone(),h.lerpSelf(x,.5),x=[x.clone(),s.clone(),u.clone(),h.clone()],s=[h.clone(),u.clone(),y.clone(),c.clone()]),b[o].push(x,s));else for(T.push(i),o=0,a=e.faceVertexUvs.length;o<a;o++)b[o].push(e.faceVertexUvs[o][n]);e.faces=T,e.faceVertexUvs=b}},THREE.GeometryUtils.random=THREE.Math.random16,THREE.GeometryUtils.__v1=new THREE.Vector3,THREE.ImageUtils={crossOrigin:"anonymous",loadTexture:function(e,t,n){var r=new Image,i=new THREE.Texture(r,t);return r.onload=function(){i.needsUpdate=!0,n&&n(this)},r.crossOrigin=this.crossOrigin,r.src=e,i},loadTextureCube:function(e,t,n){var r,i=[],o=new THREE.Texture(i,t),t=i.loadCount=0;for(r=e.length;t<r;++t)i[t]=new Image,i[t].onload=function(){i.loadCount=i.loadCount+1,6===i.loadCount&&(o.needsUpdate=!0),n&&n(this)},i[t].crossOrigin=this.crossOrigin,i[t].src=e[t];return o},getNormalMap:function(e,t){var t=1|t,n=e.width,r=e.height,i=document.createElement("canvas");i.width=n,i.height=r;var o=i.getContext("2d");o.drawImage(e,0,0);for(var a=o.getImageData(0,0,n,r).data,s=o.createImageData(n,r),l=s.data,c=0;c<n;c++)for(var u=0;u<r;u++){var h=u-1<0?0:u-1,f=u+1>r-1?r-1:u+1,d=c-1<0?0:c-1,p=c+1>n-1?n-1:c+1,m=[],v=[0,0,a[4*(u*n+c)]/255*t];for(m.push([-1,0,a[4*(u*n+d)]/255*t]),m.push([-1,-1,a[4*(h*n+d)]/255*t]),m.push([0,-1,a[4*(h*n+c)]/255*t]),m.push([1,-1,a[4*(h*n+p)]/255*t]),m.push([1,0,a[4*(u*n+p)]/255*t]),m.push([1,1,a[4*(f*n+p)]/255*t]),m.push([0,1,a[4*(f*n+c)]/255*t]),m.push([-1,1,a[4*(f*n+d)]/255*t]),h=[],d=m.length,f=0;f<d;f++){var p=m[f],g=m[(f+1)%d],p=[p[0]-v[0],p[1]-v[1],p[2]-v[2]],g=[g[0]-v[0],g[1]-v[1],g[2]-v[2]];h.push(function(e){var t=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);return[e[0]/t,e[1]/t,e[2]/t]}([p[1]*g[2]-p[2]*g[1],p[2]*g[0]-p[0]*g[2],p[0]*g[1]-p[1]*g[0]]))}for(m=[0,0,0],f=0;f<h.length;f++)m[0]=m[0]+h[f][0],m[1]=m[1]+h[f][1],m[2]=m[2]+h[f][2];m[0]=m[0]/h.length,m[1]=m[1]/h.length,m[2]=m[2]/h.length,v=4*(u*n+c),l[v]=(m[0]+1)/2*255|0,l[v+1]=255*(m[1]+.5)|0,l[v+2]=255*m[2]|0,l[v+3]=255}return o.putImageData(s,0,0),i},generateDataTexture:function(e,t,n){for(var r=e*t,i=new Uint8Array(3*r),o=Math.floor(255*n.r),a=Math.floor(255*n.g),n=Math.floor(255*n.b),s=0;s<r;s++)i[3*s]=o,i[3*s+1]=a,i[3*s+2]=n;return e=new THREE.DataTexture(i,e,t,THREE.RGBFormat),e.needsUpdate=!0,e}},THREE.SceneUtils={showHierarchy:function(e,t){THREE.SceneUtils.traverseHierarchy(e,function(e){e.visible=t})},traverseHierarchy:function(e,t){var n,r,i=e.children.length;for(r=0;r<i;r++)n=e.children[r],t(n),THREE.SceneUtils.traverseHierarchy(n,t)},createMultiMaterialObject:function(e,t){var n,r=t.length,i=new THREE.Object3D;for(n=0;n<r;n++){var o=new THREE.Mesh(e,t[n]);i.add(o)}return i},cloneObject:function(e){var t;e instanceof THREE.MorphAnimMesh?(t=new THREE.MorphAnimMesh(e.geometry,e.material),t.duration=e.duration,t.mirroredLoop=e.mirroredLoop,t.time=e.time,t.lastKeyframe=e.lastKeyframe,t.currentKeyframe=e.currentKeyframe,t.direction=e.direction,t.directionBackwards=e.directionBackwards):e instanceof THREE.SkinnedMesh?t=new THREE.SkinnedMesh(e.geometry,e.material):e instanceof THREE.Mesh?t=new THREE.Mesh(e.geometry,e.material):e instanceof THREE.Line?t=new THREE.Line(e.geometry,e.material,e.type):e instanceof THREE.Ribbon?t=new THREE.Ribbon(e.geometry,e.material):e instanceof THREE.ParticleSystem?(t=new THREE.ParticleSystem(e.geometry,e.material),t.sortParticles=e.sortParticles):e instanceof THREE.Particle?t=new THREE.Particle(e.material):e instanceof THREE.Sprite?(t=new THREE.Sprite({}),t.color.copy(e.color),t.map=e.map,t.blending=e.blending,t.useScreenCoordinates=e.useScreenCoordinates,t.mergeWith3D=e.mergeWith3D,t.affectedByDistance=e.affectedByDistance,t.scaleByViewport=e.scaleByViewport,t.alignment=e.alignment,t.rotation3d.copy(e.rotation3d),t.rotation=e.rotation,t.opacity=e.opacity,t.uvOffset.copy(e.uvOffset),t.uvScale.copy(e.uvScale)):e instanceof THREE.LOD?t=new THREE.LOD:e instanceof THREE.Object3D&&(t=new THREE.Object3D),t.name=e.name,t.parent=e.parent,t.up.copy(e.up),t.position.copy(e.position),t.rotation instanceof THREE.Vector3&&t.rotation.copy(e.rotation),t.eulerOrder=e.eulerOrder,t.scale.copy(e.scale),t.dynamic=e.dynamic,t.doubleSided=e.doubleSided,t.flipSided=e.flipSided,t.renderDepth=e.renderDepth,t.rotationAutoUpdate=e.rotationAutoUpdate,t.matrix.copy(e.matrix),t.matrixWorld.copy(e.matrixWorld),t.matrixRotationWorld.copy(e.matrixRotationWorld),t.matrixAutoUpdate=e.matrixAutoUpdate,t.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,t.quaternion.copy(e.quaternion),t.useQuaternion=e.useQuaternion,t.boundRadius=e.boundRadius,t.boundRadiusScale=e.boundRadiusScale,t.visible=e.visible,t.castShadow=e.castShadow,t.receiveShadow=e.receiveShadow,t.frustumCulled=e.frustumCulled;for(var n=0;n<e.children.length;n++){var r=THREE.SceneUtils.cloneObject(e.children[n]);t.children[n]=r,r.parent=t}if(e instanceof THREE.LOD)for(n=0;n<e.LODs.length;n++)t.LODs[n]={visibleAtDistance:e.LODs[n].visibleAtDistance,object3D:t.children[n]};return t},detach:function(e,t,n){e.applyMatrix(t.matrixWorld),t.remove(e),n.add(e)},attach:function(e,t,n){var r=new THREE.Matrix4;r.getInverse(n.matrixWorld),e.applyMatrix(r),t.remove(e),n.add(e)}},THREE.WebGLRenderer&&(THREE.ShaderUtils={lib:{fresnel:{uniforms:{mRefractionRatio:{type:"f",value:1.02},mFresnelBias:{type:"f",value:.1},mFresnelPower:{type:"f",value:2},mFresnelScale:{type:"f",value:1},tCube:{type:"t",value:1,texture:null}},fragmentShader:"uniform samplerCube tCube;\nvarying vec3 vReflect;\nvarying vec3 vRefract[3];\nvarying float vReflectionFactor;\nvoid main() {\nvec4 reflectedColor = textureCube( tCube, vec3( -vReflect.x, vReflect.yz ) );\nvec4 refractedColor = vec4( 1.0, 1.0, 1.0, 1.0 );\nrefractedColor.r = textureCube( tCube, vec3( -vRefract[0].x, vRefract[0].yz ) ).r;\nrefractedColor.g = textureCube( tCube, vec3( -vRefract[1].x, vRefract[1].yz ) ).g;\nrefractedColor.b = textureCube( tCube, vec3( -vRefract[2].x, vRefract[2].yz ) ).b;\nrefractedColor.a = 1.0;\ngl_FragColor = mix( refractedColor, reflectedColor, clamp( vReflectionFactor, 0.0, 1.0 ) );\n}",vertexShader:"uniform float mRefractionRatio;\nuniform float mFresnelBias;\nuniform float mFresnelScale;\nuniform float mFresnelPower;\nvarying vec3 vReflect;\nvarying vec3 vRefract[3];\nvarying float vReflectionFactor;\nvoid main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\nvec3 nWorld = normalize ( mat3( objectMatrix[0].xyz, objectMatrix[1].xyz, objectMatrix[2].xyz ) * normal );\nvec3 I = mPosition.xyz - cameraPosition;\nvReflect = reflect( I, nWorld );\nvRefract[0] = refract( normalize( I ), nWorld, mRefractionRatio );\nvRefract[1] = refract( normalize( I ), nWorld, mRefractionRatio * 0.99 );\nvRefract[2] = refract( normalize( I ), nWorld, mRefractionRatio * 0.98 );\nvReflectionFactor = mFresnelBias + mFresnelScale * pow( 1.0 + dot( normalize( I ), nWorld ), mFresnelPower );\ngl_Position = projectionMatrix * mvPosition;\n}"},normal:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.fog,THREE.UniformsLib.lights,THREE.UniformsLib.shadowmap,{enableAO:{type:"i",value:0},enableDiffuse:{type:"i",value:0},enableSpecular:{type:"i",value:0},enableReflection:{type:"i",value:0},tDiffuse:{type:"t",value:0,texture:null},tCube:{type:"t",value:1,texture:null},tNormal:{type:"t",value:2,texture:null},tSpecular:{type:"t",value:3,texture:null},tAO:{type:"t",value:4,texture:null},tDisplacement:{type:"t",value:5,texture:null},uNormalScale:{type:"f",value:1},uDisplacementBias:{type:"f",value:0},uDisplacementScale:{type:"f",value:1},uDiffuseColor:{type:"c",value:new THREE.Color(16777215)},uSpecularColor:{type:"c",value:new THREE.Color(1118481)},uAmbientColor:{type:"c",value:new THREE.Color(16777215)},uShininess:{type:"f",value:30},uOpacity:{type:"f",value:1},uReflectivity:{type:"f",value:.5},uOffset:{type:"v2",value:new THREE.Vector2(0,0)},uRepeat:{type:"v2",value:new THREE.Vector2(1,1)},wrapRGB:{type:"v3",value:new THREE.Vector3(1,1,1)}}]),
fragmentShader:["uniform vec3 uAmbientColor;\nuniform vec3 uDiffuseColor;\nuniform vec3 uSpecularColor;\nuniform float uShininess;\nuniform float uOpacity;\nuniform bool enableDiffuse;\nuniform bool enableSpecular;\nuniform bool enableAO;\nuniform bool enableReflection;\nuniform sampler2D tDiffuse;\nuniform sampler2D tNormal;\nuniform sampler2D tSpecular;\nuniform sampler2D tAO;\nuniform samplerCube tCube;\nuniform float uNormalScale;\nuniform float uReflectivity;\nvarying vec3 vTangent;\nvarying vec3 vBinormal;\nvarying vec3 vNormal;\nvarying vec2 vUv;\nuniform vec3 ambientLightColor;\n#if MAX_DIR_LIGHTS > 0\nuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\nvarying vec4 vPointLight[ MAX_POINT_LIGHTS ];\n#endif\n#ifdef WRAP_AROUND\nuniform vec3 wrapRGB;\n#endif\nvarying vec3 vViewPosition;",THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,"void main() {\ngl_FragColor = vec4( vec3( 1.0 ), uOpacity );\nvec3 specularTex = vec3( 1.0 );\nvec3 normalTex = texture2D( tNormal, vUv ).xyz * 2.0 - 1.0;\nnormalTex.xy *= uNormalScale;\nnormalTex = normalize( normalTex );\nif( enableDiffuse ) {\n#ifdef GAMMA_INPUT\nvec4 texelColor = texture2D( tDiffuse, vUv );\ntexelColor.xyz *= texelColor.xyz;\ngl_FragColor = gl_FragColor * texelColor;\n#else\ngl_FragColor = gl_FragColor * texture2D( tDiffuse, vUv );\n#endif\n}\nif( enableAO ) {\n#ifdef GAMMA_INPUT\nvec4 aoColor = texture2D( tAO, vUv );\naoColor.xyz *= aoColor.xyz;\ngl_FragColor.xyz = gl_FragColor.xyz * aoColor.xyz;\n#else\ngl_FragColor.xyz = gl_FragColor.xyz * texture2D( tAO, vUv ).xyz;\n#endif\n}\nif( enableSpecular )\nspecularTex = texture2D( tSpecular, vUv ).xyz;\nmat3 tsb = mat3( normalize( vTangent ), normalize( vBinormal ), normalize( vNormal ) );\nvec3 finalNormal = tsb * normalTex;\nvec3 normal = normalize( finalNormal );\nvec3 viewPosition = normalize( vViewPosition );\n#if MAX_POINT_LIGHTS > 0\nvec3 pointDiffuse = vec3( 0.0 );\nvec3 pointSpecular = vec3( 0.0 );\nfor ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\nvec3 pointVector = normalize( vPointLight[ i ].xyz );\nfloat pointDistance = vPointLight[ i ].w;\n#ifdef WRAP_AROUND\nfloat pointDiffuseWeightFull = max( dot( normal, pointVector ), 0.0 );\nfloat pointDiffuseWeightHalf = max( 0.5 * dot( normal, pointVector ) + 0.5, 0.0 );\nvec3 pointDiffuseWeight = mix( vec3 ( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );\n#else\nfloat pointDiffuseWeight = max( dot( normal, pointVector ), 0.0 );\n#endif\npointDiffuse += pointDistance * pointLightColor[ i ] * uDiffuseColor * pointDiffuseWeight;\nvec3 pointHalfVector = normalize( pointVector + viewPosition );\nfloat pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );\nfloat pointSpecularWeight = specularTex.r * max( pow( pointDotNormalHalf, uShininess ), 0.0 );\n#ifdef PHYSICALLY_BASED_SHADING\nfloat specularNormalization = ( uShininess + 2.0001 ) / 8.0;\nvec3 schlick = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( pointVector, pointHalfVector ), 5.0 );\npointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * pointDistance * specularNormalization;\n#else\npointSpecular += pointDistance * pointLightColor[ i ] * uSpecularColor * pointSpecularWeight * pointDiffuseWeight;\n#endif\n}\n#endif\n#if MAX_DIR_LIGHTS > 0\nvec3 dirDiffuse = vec3( 0.0 );\nvec3 dirSpecular = vec3( 0.0 );\nfor( int i = 0; i < MAX_DIR_LIGHTS; i++ ) {\nvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\nvec3 dirVector = normalize( lDirection.xyz );\n#ifdef WRAP_AROUND\nfloat directionalLightWeightingFull = max( dot( normal, dirVector ), 0.0 );\nfloat directionalLightWeightingHalf = max( 0.5 * dot( normal, dirVector ) + 0.5, 0.0 );\nvec3 dirDiffuseWeight = mix( vec3( directionalLightWeightingFull ), vec3( directionalLightWeightingHalf ), wrapRGB );\n#else\nfloat dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );\n#endif\ndirDiffuse += directionalLightColor[ i ] * uDiffuseColor * dirDiffuseWeight;\nvec3 dirHalfVector = normalize( dirVector + viewPosition );\nfloat dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );\nfloat dirSpecularWeight = specularTex.r * max( pow( dirDotNormalHalf, uShininess ), 0.0 );\n#ifdef PHYSICALLY_BASED_SHADING\nfloat specularNormalization = ( uShininess + 2.0001 ) / 8.0;\nvec3 schlick = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( dirVector, dirHalfVector ), 5.0 );\ndirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;\n#else\ndirSpecular += directionalLightColor[ i ] * uSpecularColor * dirSpecularWeight * dirDiffuseWeight;\n#endif\n}\n#endif\nvec3 totalDiffuse = vec3( 0.0 );\nvec3 totalSpecular = vec3( 0.0 );\n#if MAX_DIR_LIGHTS > 0\ntotalDiffuse += dirDiffuse;\ntotalSpecular += dirSpecular;\n#endif\n#if MAX_POINT_LIGHTS > 0\ntotalDiffuse += pointDiffuse;\ntotalSpecular += pointSpecular;\n#endif\ngl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * uAmbientColor) + totalSpecular;\nif ( enableReflection ) {\nvec3 wPos = cameraPosition - vViewPosition;\nvec3 vReflect = reflect( normalize( wPos ), normal );\nvec4 cubeColor = textureCube( tCube, vec3( -vReflect.x, vReflect.yz ) );\n#ifdef GAMMA_INPUT\ncubeColor.xyz *= cubeColor.xyz;\n#endif\ngl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, specularTex.r * uReflectivity );\n}",THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.linear_to_gamma_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n"),vertexShader:["attribute vec4 tangent;\nuniform vec2 uOffset;\nuniform vec2 uRepeat;\n#ifdef VERTEX_TEXTURES\nuniform sampler2D tDisplacement;\nuniform float uDisplacementScale;\nuniform float uDisplacementBias;\n#endif\nvarying vec3 vTangent;\nvarying vec3 vBinormal;\nvarying vec3 vNormal;\nvarying vec2 vUv;\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\nuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\nvarying vec4 vPointLight[ MAX_POINT_LIGHTS ];\n#endif\nvarying vec3 vViewPosition;",THREE.ShaderChunk.shadowmap_pars_vertex,"void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\nvViewPosition = -mvPosition.xyz;\nvNormal = normalMatrix * normal;\nvTangent = normalMatrix * tangent.xyz;\nvBinormal = cross( vNormal, vTangent ) * tangent.w;\nvUv = uv * uRepeat + uOffset;\n#if MAX_POINT_LIGHTS > 0\nfor( int i = 0; i < MAX_POINT_LIGHTS; i++ ) {\nvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz - mvPosition.xyz;\nfloat lDistance = 1.0;\nif ( pointLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\nlVector = normalize( lVector );\nvPointLight[ i ] = vec4( lVector, lDistance );\n}\n#endif\n#ifdef VERTEX_TEXTURES\nvec3 dv = texture2D( tDisplacement, uv ).xyz;\nfloat df = uDisplacementScale * dv.x + uDisplacementBias;\nvec4 displacedPosition = vec4( normalize( vNormal.xyz ) * df, 0.0 ) + mvPosition;\ngl_Position = projectionMatrix * displacedPosition;\n#else\ngl_Position = projectionMatrix * mvPosition;\n#endif",THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n")},cube:{uniforms:{tCube:{type:"t",value:1,texture:null},tFlip:{type:"f",value:-1}},vertexShader:"varying vec3 vViewPosition;\nvoid main() {\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\nvViewPosition = cameraPosition - mPosition.xyz;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform samplerCube tCube;\nuniform float tFlip;\nvarying vec3 vViewPosition;\nvoid main() {\nvec3 wPos = cameraPosition - vViewPosition;\ngl_FragColor = textureCube( tCube, vec3( tFlip * wPos.x, wPos.yz ) );\n}"}}}),THREE.BufferGeometry=function(){this.id=THREE.GeometryCount++,this.vertexColorArray=this.vertexUvArray=this.vertexNormalArray=this.vertexPositionArray=this.vertexIndexArray=this.vertexColorBuffer=this.vertexUvBuffer=this.vertexNormalBuffer=this.vertexPositionBuffer=this.vertexIndexBuffer=null,this.dynamic=!1,this.boundingSphere=this.boundingBox=null,this.morphTargets=[]},THREE.BufferGeometry.prototype={constructor:THREE.BufferGeometry,computeBoundingBox:function(){},computeBoundingSphere:function(){}},THREE.Curve=function(){},THREE.Curve.prototype.getPoint=function(){return console.log("Warning, getPoint() not implemented!"),null},THREE.Curve.prototype.getPointAt=function(e){return this.getPoint(this.getUtoTmapping(e))},THREE.Curve.prototype.getPoints=function(e){e||(e=5);var t,n=[];for(t=0;t<=e;t++)n.push(this.getPoint(t/e));return n},THREE.Curve.prototype.getSpacedPoints=function(e){e||(e=5);var t,n=[];for(t=0;t<=e;t++)n.push(this.getPointAt(t/e));return n},THREE.Curve.prototype.getLength=function(){var e=this.getLengths();return e[e.length-1]},THREE.Curve.prototype.getLengths=function(e){if(e||(e=this.__arcLengthDivisions?this.__arcLengthDivisions:200),this.cacheArcLengths&&this.cacheArcLengths.length==e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var t,n,r=[],i=this.getPoint(0),o=0;for(r.push(0),n=1;n<=e;n++)t=this.getPoint(n/e),o+=t.distanceTo(i),r.push(o),i=t;return this.cacheArcLengths=r},THREE.Curve.prototype.updateArcLengths=function(){this.needsUpdate=!0,this.getLengths()},THREE.Curve.prototype.getUtoTmapping=function(e,t){var n,r=this.getLengths(),i=0,o=r.length;n=t||e*r[o-1];for(var a,s=0,l=o-1;s<=l;)if(i=Math.floor(s+(l-s)/2),(a=r[i]-n)<0)s=i+1;else{if(!(a>0)){l=i;break}l=i-1}return i=l,r[i]==n?i/(o-1):(s=r[i],r=(i+(n-s)/(r[i+1]-s))/(o-1))},THREE.Curve.prototype.getNormalVector=function(e){return e=this.getTangent(e),new THREE.Vector2(-e.y,e.x)},THREE.Curve.prototype.getTangent=function(e){var t=e-1e-4,e=e+1e-4;return t<0&&(t=0),e>1&&(e=1),t=this.getPoint(t),this.getPoint(e).clone().subSelf(t).normalize()},THREE.Curve.prototype.getTangentAt=function(e){return this.getTangent(this.getUtoTmapping(e))},THREE.LineCurve=function(e,t){this.v1=e,this.v2=t},THREE.LineCurve.prototype=new THREE.Curve,THREE.LineCurve.prototype.constructor=THREE.LineCurve,THREE.LineCurve.prototype.getPoint=function(e){var t=this.v2.clone().subSelf(this.v1);return t.multiplyScalar(e).addSelf(this.v1),t},THREE.LineCurve.prototype.getPointAt=function(e){return this.getPoint(e)},THREE.LineCurve.prototype.getTangent=function(){return this.v2.clone().subSelf(this.v1).normalize()},THREE.QuadraticBezierCurve=function(e,t,n){this.v0=e,this.v1=t,this.v2=n},THREE.QuadraticBezierCurve.prototype=new THREE.Curve,THREE.QuadraticBezierCurve.prototype.constructor=THREE.QuadraticBezierCurve,THREE.QuadraticBezierCurve.prototype.getPoint=function(e){var t;return t=THREE.Shape.Utils.b2(e,this.v0.x,this.v1.x,this.v2.x),e=THREE.Shape.Utils.b2(e,this.v0.y,this.v1.y,this.v2.y),new THREE.Vector2(t,e)},THREE.QuadraticBezierCurve.prototype.getTangent=function(e){var t;return t=THREE.Curve.Utils.tangentQuadraticBezier(e,this.v0.x,this.v1.x,this.v2.x),e=THREE.Curve.Utils.tangentQuadraticBezier(e,this.v0.y,this.v1.y,this.v2.y),t=new THREE.Vector2(t,e),t.normalize(),t},THREE.CubicBezierCurve=function(e,t,n,r){this.v0=e,this.v1=t,this.v2=n,this.v3=r},THREE.CubicBezierCurve.prototype=new THREE.Curve,THREE.CubicBezierCurve.prototype.constructor=THREE.CubicBezierCurve,THREE.CubicBezierCurve.prototype.getPoint=function(e){var t;return t=THREE.Shape.Utils.b3(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),e=THREE.Shape.Utils.b3(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y),new THREE.Vector2(t,e)},THREE.CubicBezierCurve.prototype.getTangent=function(e){var t;return t=THREE.Curve.Utils.tangentCubicBezier(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),e=THREE.Curve.Utils.tangentCubicBezier(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y),t=new THREE.Vector2(t,e),t.normalize(),t},THREE.SplineCurve=function(e){this.points=void 0==e?[]:e},THREE.SplineCurve.prototype=new THREE.Curve,THREE.SplineCurve.prototype.constructor=THREE.SplineCurve,THREE.SplineCurve.prototype.getPoint=function(e){var t,n=new THREE.Vector2,r=[],i=this.points;return t=(i.length-1)*e,e=Math.floor(t),t-=e,r[0]=0==e?e:e-1,r[1]=e,r[2]=e>i.length-2?i.length-1:e+1,r[3]=e>i.length-3?i.length-1:e+2,n.x=THREE.Curve.Utils.interpolate(i[r[0]].x,i[r[1]].x,i[r[2]].x,i[r[3]].x,t),n.y=THREE.Curve.Utils.interpolate(i[r[0]].y,i[r[1]].y,i[r[2]].y,i[r[3]].y,t),n},THREE.ArcCurve=function(e,t,n,r,i,o){this.aX=e,this.aY=t,this.aRadius=n,this.aStartAngle=r,this.aEndAngle=i,this.aClockwise=o},THREE.ArcCurve.prototype=new THREE.Curve,THREE.ArcCurve.prototype.constructor=THREE.ArcCurve,THREE.ArcCurve.prototype.getPoint=function(e){var t=this.aEndAngle-this.aStartAngle;return this.aClockwise||(e=1-e),t=this.aStartAngle+e*t,e=this.aX+this.aRadius*Math.cos(t),t=this.aY+this.aRadius*Math.sin(t),new THREE.Vector2(e,t)},THREE.Curve.Utils={tangentQuadraticBezier:function(e,t,n,r){return 2*(1-e)*(n-t)+2*e*(r-n)},tangentCubicBezier:function(e,t,n,r,i){return-3*t*(1-e)*(1-e)+3*n*(1-e)*(1-e)-6*e*n*(1-e)+6*e*r*(1-e)-3*e*e*r+3*e*e*i},tangentSpline:function(e){return 6*e*e-6*e+(3*e*e-4*e+1)+(-6*e*e+6*e)+(3*e*e-2*e)},interpolate:function(e,t,n,r,i){var e=.5*(n-e),r=.5*(r-t),o=i*i;return(2*t-2*n+e+r)*i*o+(-3*t+3*n-2*e-r)*o+e*i+t}},THREE.Curve.create=function(e,t){return e.prototype=new THREE.Curve,e.prototype.constructor=e,e.prototype.getPoint=t,e},THREE.LineCurve3=THREE.Curve.create(function(e,t){this.v1=e,this.v2=t},function(e){var t=new THREE.Vector3;return t.sub(this.v2,this.v1),t.multiplyScalar(e),t.addSelf(this.v1),t}),THREE.QuadraticBezierCurve3=THREE.Curve.create(function(e,t,n){this.v0=e,this.v1=t,this.v2=n},function(e){var t,n;return t=THREE.Shape.Utils.b2(e,this.v0.x,this.v1.x,this.v2.x),n=THREE.Shape.Utils.b2(e,this.v0.y,this.v1.y,this.v2.y),e=THREE.Shape.Utils.b2(e,this.v0.z,this.v1.z,this.v2.z),new THREE.Vector3(t,n,e)}),THREE.CubicBezierCurve3=THREE.Curve.create(function(e,t,n,r){this.v0=e,this.v1=t,this.v2=n,this.v3=r},function(e){var t,n;return t=THREE.Shape.Utils.b3(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),n=THREE.Shape.Utils.b3(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y),e=THREE.Shape.Utils.b3(e,this.v0.z,this.v1.z,this.v2.z,this.v3.z),new THREE.Vector3(t,n,e)}),THREE.SplineCurve3=THREE.Curve.create(function(e){this.points=void 0==e?[]:e},function(e){var t,n=new THREE.Vector3,r=[],i=this.points,e=(i.length-1)*e;t=Math.floor(e),e-=t,r[0]=0==t?t:t-1,r[1]=t,r[2]=t>i.length-2?i.length-1:t+1,r[3]=t>i.length-3?i.length-1:t+2,t=i[r[0]];var o=i[r[1]],a=i[r[2]],r=i[r[3]];return n.x=THREE.Curve.Utils.interpolate(t.x,o.x,a.x,r.x,e),n.y=THREE.Curve.Utils.interpolate(t.y,o.y,a.y,r.y,e),n.z=THREE.Curve.Utils.interpolate(t.z,o.z,a.z,r.z,e),n}),THREE.ClosedSplineCurve3=THREE.Curve.create(function(e){this.points=void 0==e?[]:e},function(e){var t,n=new THREE.Vector3,r=[],i=this.points;return t=(i.length-0)*e,e=Math.floor(t),t-=e,e+=e>0?0:(Math.floor(Math.abs(e)/i.length)+1)*i.length,r[0]=(e-1)%i.length,r[1]=e%i.length,r[2]=(e+1)%i.length,r[3]=(e+2)%i.length,n.x=THREE.Curve.Utils.interpolate(i[r[0]].x,i[r[1]].x,i[r[2]].x,i[r[3]].x,t),n.y=THREE.Curve.Utils.interpolate(i[r[0]].y,i[r[1]].y,i[r[2]].y,i[r[3]].y,t),n.z=THREE.Curve.Utils.interpolate(i[r[0]].z,i[r[1]].z,i[r[2]].z,i[r[3]].z,t),n}),THREE.CurvePath=function(){this.curves=[],this.bends=[],this.autoClose=!1},THREE.CurvePath.prototype=new THREE.Curve,THREE.CurvePath.prototype.constructor=THREE.CurvePath,THREE.CurvePath.prototype.add=function(e){this.curves.push(e)},THREE.CurvePath.prototype.checkConnection=function(){},THREE.CurvePath.prototype.closePath=function(){var e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new THREE.LineCurve(t,e))},THREE.CurvePath.prototype.getPoint=function(e){for(var t=e*this.getLength(),n=this.getCurveLengths(),e=0;e<n.length;){if(n[e]>=t)return t=n[e]-t,e=this.curves[e],t=1-t/e.getLength(),e.getPointAt(t);e++}return null},THREE.CurvePath.prototype.getLength=function(){var e=this.getCurveLengths();return e[e.length-1]},THREE.CurvePath.prototype.getCurveLengths=function(){if(this.cacheLengths&&this.cacheLengths.length==this.curves.length)return this.cacheLengths;var e,t=[],n=0,r=this.curves.length;for(e=0;e<r;e++)n+=this.curves[e].getLength(),t.push(n);return this.cacheLengths=t},THREE.CurvePath.prototype.getBoundingBox=function(){var e,t,n,r,i=this.getPoints();e=t=Number.NEGATIVE_INFINITY,n=r=Number.POSITIVE_INFINITY;var o,a,s,l;for(l=new THREE.Vector2,a=0,s=i.length;a<s;a++)o=i[a],o.x>e?e=o.x:o.x<n&&(n=o.x),o.y>t?t=o.y:o.y<t&&(r=o.y),l.addSelf(o.x,o.y);return{minX:n,minY:r,maxX:e,maxY:t,centroid:l.divideScalar(s)}},THREE.CurvePath.prototype.createPointsGeometry=function(e){return this.createGeometry(this.getPoints(e,!0))},THREE.CurvePath.prototype.createSpacedPointsGeometry=function(e){return this.createGeometry(this.getSpacedPoints(e,!0))},THREE.CurvePath.prototype.createGeometry=function(e){for(var t=new THREE.Geometry,n=0;n<e.length;n++)t.vertices.push(new THREE.Vector3(e[n].x,e[n].y,0));return t},THREE.CurvePath.prototype.addWrapPath=function(e){this.bends.push(e)},THREE.CurvePath.prototype.getTransformedPoints=function(e,t){var n,r,i=this.getPoints(e);for(t||(t=this.bends),n=0,r=t.length;n<r;n++)i=this.getWrapPoints(i,t[n]);return i},THREE.CurvePath.prototype.getTransformedSpacedPoints=function(e,t){var n,r,i=this.getSpacedPoints(e);for(t||(t=this.bends),n=0,r=t.length;n<r;n++)i=this.getWrapPoints(i,t[n]);return i},THREE.CurvePath.prototype.getWrapPoints=function(e,t){var n,r,i,o,a,s,l=this.getBoundingBox();for(n=0,r=e.length;n<r;n++)i=e[n],o=i.x,a=i.y,s=o/l.maxX,s=t.getUtoTmapping(s,o),o=t.getPoint(s),a=t.getNormalVector(s).multiplyScalar(a),i.x=o.x+a.x,i.y=o.y+a.y;return e},THREE.EventTarget=function(){var e={};this.addEventListener=function(t,n){void 0==e[t]&&(e[t]=[]),-1===e[t].indexOf(n)&&e[t].push(n)},this.dispatchEvent=function(t){for(var n in e[t.type])e[t.type][n](t)},this.removeEventListener=function(t,n){var r=e[t].indexOf(n);-1!==r&&e[t].splice(r,1)}},THREE.Gyroscope=function(){THREE.Object3D.call(this)},THREE.Gyroscope.prototype=new THREE.Object3D,THREE.Gyroscope.prototype.constructor=THREE.Gyroscope,THREE.Gyroscope.prototype.updateMatrixWorld=function(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent?(this.matrixWorld.multiply(this.parent.matrixWorld,this.matrix),this.matrixWorld.decompose(this.translationWorld,this.rotationWorld,this.scaleWorld),this.matrix.decompose(this.translationObject,this.rotationObject,this.scaleObject),this.matrixWorld.compose(this.translationWorld,this.rotationObject,this.scaleWorld)):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);for(var t=0,n=this.children.length;t<n;t++)this.children[t].updateMatrixWorld(e)},THREE.Gyroscope.prototype.translationWorld=new THREE.Vector3,THREE.Gyroscope.prototype.translationObject=new THREE.Vector3,THREE.Gyroscope.prototype.rotationWorld=new THREE.Quaternion,THREE.Gyroscope.prototype.rotationObject=new THREE.Quaternion,THREE.Gyroscope.prototype.scaleWorld=new THREE.Vector3,THREE.Gyroscope.prototype.scaleObject=new THREE.Vector3,THREE.Path=function(e){THREE.CurvePath.call(this),this.actions=[],e&&this.fromPoints(e)},THREE.Path.prototype=new THREE.CurvePath,THREE.Path.prototype.constructor=THREE.Path,THREE.PathActions={MOVE_TO:"moveTo",LINE_TO:"lineTo",QUADRATIC_CURVE_TO:"quadraticCurveTo",BEZIER_CURVE_TO:"bezierCurveTo",CSPLINE_THRU:"splineThru",ARC:"arc"},THREE.Path.prototype.fromPoints=function(e){this.moveTo(e[0].x,e[0].y);for(var t=1,n=e.length;t<n;t++)this.lineTo(e[t].x,e[t].y)},THREE.Path.prototype.moveTo=function(e,t){var n=Array.prototype.slice.call(arguments);this.actions.push({action:THREE.PathActions.MOVE_TO,args:n})},THREE.Path.prototype.lineTo=function(e,t){var n=Array.prototype.slice.call(arguments),r=this.actions[this.actions.length-1].args;this.curves.push(new THREE.LineCurve(new THREE.Vector2(r[r.length-2],r[r.length-1]),new THREE.Vector2(e,t))),this.actions.push({action:THREE.PathActions.LINE_TO,args:n})},THREE.Path.prototype.quadraticCurveTo=function(e,t,n,r){var i=Array.prototype.slice.call(arguments),o=this.actions[this.actions.length-1].args;this.curves.push(new THREE.QuadraticBezierCurve(new THREE.Vector2(o[o.length-2],o[o.length-1]),new THREE.Vector2(e,t),new THREE.Vector2(n,r))),this.actions.push({action:THREE.PathActions.QUADRATIC_CURVE_TO,args:i})},THREE.Path.prototype.bezierCurveTo=function(e,t,n,r,i,o){var a=Array.prototype.slice.call(arguments),s=this.actions[this.actions.length-1].args;this.curves.push(new THREE.CubicBezierCurve(new THREE.Vector2(s[s.length-2],s[s.length-1]),new THREE.Vector2(e,t),new THREE.Vector2(n,r),new THREE.Vector2(i,o))),this.actions.push({action:THREE.PathActions.BEZIER_CURVE_TO,args:a})},THREE.Path.prototype.splineThru=function(e){var t=Array.prototype.slice.call(arguments),n=this.actions[this.actions.length-1].args,n=[new THREE.Vector2(n[n.length-2],n[n.length-1])];Array.prototype.push.apply(n,e),this.curves.push(new THREE.SplineCurve(n)),this.actions.push({action:THREE.PathActions.CSPLINE_THRU,args:t})},THREE.Path.prototype.arc=function(e,t,n,r,i,o){var a=Array.prototype.slice.call(arguments),s=this.actions[this.actions.length-1],s=new THREE.ArcCurve(s.x+e,s.y+t,n,r,i,o);this.curves.push(s),s=s.getPoint(o?1:0),a.push(s.x),a.push(s.y),this.actions.push({action:THREE.PathActions.ARC,args:a})},THREE.Path.prototype.absarc=function(e,t,n,r,i,o){var a=Array.prototype.slice.call(arguments),s=new THREE.ArcCurve(e,t,n,r,i,o);this.curves.push(s),s=s.getPoint(o?1:0),a.push(s.x),a.push(s.y),this.actions.push({action:THREE.PathActions.ARC,args:a})},THREE.Path.prototype.getSpacedPoints=function(e){e||(e=40);for(var t=[],n=0;n<e;n++)t.push(this.getPoint(n/e));return t},THREE.Path.prototype.getPoints=function(e,t){if(this.useSpacedPoints)return console.log("tata"),this.getSpacedPoints(e,t);var n,r,i,o,a,s,l,c,u,h,f,d,p,e=e||12,m=[];for(n=0,r=this.actions.length;n<r;n++)switch(i=this.actions[n],o=i.action,i=i.args,o){case THREE.PathActions.MOVE_TO:case THREE.PathActions.LINE_TO:m.push(new THREE.Vector2(i[0],i[1]));break;case THREE.PathActions.QUADRATIC_CURVE_TO:for(a=i[2],s=i[3],u=i[0],h=i[1],m.length>0?(o=m[m.length-1],f=o.x,d=o.y):(o=this.actions[n-1].args,f=o[o.length-2],d=o[o.length-1]),i=1;i<=e;i++)p=i/e,o=THREE.Shape.Utils.b2(p,f,u,a),p=THREE.Shape.Utils.b2(p,d,h,s),m.push(new THREE.Vector2(o,p));break;case THREE.PathActions.BEZIER_CURVE_TO:for(a=i[4],s=i[5],u=i[0],h=i[1],l=i[2],c=i[3],m.length>0?(o=m[m.length-1],f=o.x,d=o.y):(o=this.actions[n-1].args,f=o[o.length-2],d=o[o.length-1]),i=1;i<=e;i++)p=i/e,o=THREE.Shape.Utils.b3(p,f,u,l,a),p=THREE.Shape.Utils.b3(p,d,h,c,s),m.push(new THREE.Vector2(o,p));break;case THREE.PathActions.CSPLINE_THRU:for(o=this.actions[n-1].args,p=[new THREE.Vector2(o[o.length-2],o[o.length-1])],o=e*i[0].length,p=p.concat(i[0]),p=new THREE.SplineCurve(p),i=1;i<=o;i++)m.push(p.getPointAt(i/o));break;case THREE.PathActions.ARC:for(a=i[0],s=i[1],l=i[2],u=i[3],h=!!i[5],c=i[4]-u,f=2*e,i=1;i<=f;i++)p=i/f,h||(p=1-p),p=u+p*c,o=a+l*Math.cos(p),p=s+l*Math.sin(p),m.push(new THREE.Vector2(o,p))}return n=m[m.length-1],Math.abs(n.x-m[0].x)<1e-10&&Math.abs(n.y-m[0].y)<1e-10&&m.splice(m.length-1,1),t&&m.push(m[0]),m},THREE.Path.prototype.transform=function(e,t){return this.getBoundingBox(),this.getWrapPoints(this.getPoints(t),e)},THREE.Path.prototype.nltransform=function(e,t,n,r,i,o){var a,s,l,c,u,h=this.getPoints();for(a=0,s=h.length;a<s;a++)l=h[a],c=l.x,u=l.y,l.x=e*c+t*u+n,l.y=r*u+i*c+o;return h},THREE.Path.prototype.debug=function(e){var t=this.getBoundingBox();e||(e=document.createElement("canvas"),e.setAttribute("width",t.maxX+100),e.setAttribute("height",t.maxY+100),document.body.appendChild(e)),t=e.getContext("2d"),t.fillStyle="white",t.fillRect(0,0,e.width,e.height),t.strokeStyle="black",t.beginPath();var n,r,i,e=0;for(n=this.actions.length;e<n;e++)r=this.actions[e],i=r.args,(r=r.action)!=THREE.PathActions.CSPLINE_THRU&&t[r].apply(t,i);for(t.stroke(),t.closePath(),t.strokeStyle="red",r=this.getPoints(),e=0,n=r.length;e<n;e++)i=r[e],t.beginPath(),t.arc(i.x,i.y,1.5,0,2*Math.PI,!1),t.stroke(),t.closePath()},THREE.Path.prototype.toShapes=function(){var e,t,n,r,i=[],o=new THREE.Path;for(e=0,t=this.actions.length;e<t;e++)n=this.actions[e],r=n.args,n=n.action,n==THREE.PathActions.MOVE_TO&&0!=o.actions.length&&(i.push(o),o=new THREE.Path),o[n].apply(o,r);if(0!=o.actions.length&&i.push(o),0==i.length)return[];var a;if(r=[],e=!THREE.Shape.Utils.isClockWise(i[0].getPoints()),1==i.length)return o=i[0],a=new THREE.Shape,a.actions=o.actions,a.curves=o.curves,r.push(a),r;if(e)for(a=new THREE.Shape,e=0,t=i.length;e<t;e++)o=i[e],THREE.Shape.Utils.isClockWise(o.getPoints())?(a.actions=o.actions,a.curves=o.curves,r.push(a),a=new THREE.Shape):a.holes.push(o);else{for(e=0,t=i.length;e<t;e++)o=i[e],THREE.Shape.Utils.isClockWise(o.getPoints())?(a&&r.push(a),a=new THREE.Shape,a.actions=o.actions,a.curves=o.curves):a.holes.push(o);r.push(a)}return r},THREE.Shape=function(){THREE.Path.apply(this,arguments),this.holes=[]},THREE.Shape.prototype=new THREE.Path,THREE.Shape.prototype.constructor=THREE.Path,THREE.Shape.prototype.extrude=function(e){return new THREE.ExtrudeGeometry(this,e)},THREE.Shape.prototype.getPointsHoles=function(e){var t,n=this.holes.length,r=[];for(t=0;t<n;t++)r[t]=this.holes[t].getTransformedPoints(e,this.bends);return r},THREE.Shape.prototype.getSpacedPointsHoles=function(e){var t,n=this.holes.length,r=[];for(t=0;t<n;t++)r[t]=this.holes[t].getTransformedSpacedPoints(e,this.bends);return r},THREE.Shape.prototype.extractAllPoints=function(e){return{shape:this.getTransformedPoints(e),holes:this.getPointsHoles(e)}},THREE.Shape.prototype.extractPoints=function(e){return this.useSpacedPoints?this.extractAllSpacedPoints(e):this.extractAllPoints(e)},THREE.Shape.prototype.extractAllSpacedPoints=function(e){return{shape:this.getTransformedSpacedPoints(e),holes:this.getSpacedPointsHoles(e)}},THREE.Shape.Utils={removeHoles:function(e,t){var n,r,i,o,a,s,l,c,u,h,f=e.concat(),d=f.concat(),p=[];for(a=0;a<t.length;a++){for(s=t[a],Array.prototype.push.apply(d,s),r=Number.POSITIVE_INFINITY,n=0;n<s.length;n++)for(u=s[n],h=[],c=0;c<f.length;c++)l=f[c],l=u.distanceToSquared(l),h.push(l),l<r&&(r=l,i=n,o=c);n=o-1>=0?o-1:f.length-1,r=i-1>=0?i-1:s.length-1;var m=[s[i],f[o],f[n]];c=THREE.FontUtils.Triangulate.area(m);var v=[s[i],s[r],f[o]];u=THREE.FontUtils.Triangulate.area(v),h=o,l=i,o+=1,i+=-1,o<0&&(o+=f.length),o%=f.length,i<0&&(i+=s.length),i%=s.length,n=o-1>=0?o-1:f.length-1,r=i-1>=0?i-1:s.length-1,m=[s[i],f[o],f[n]],m=THREE.FontUtils.Triangulate.area(m),v=[s[i],s[r],f[o]],v=THREE.FontUtils.Triangulate.area(v),c+u>m+v&&(o=h,i=l,o<0&&(o+=f.length),o%=f.length,i<0&&(i+=s.length),i%=s.length,n=o-1>=0?o-1:f.length-1,r=i-1>=0?i-1:s.length-1),c=f.slice(0,o),u=f.slice(o),h=s.slice(i),l=s.slice(0,i),r=[s[i],s[r],f[o]],p.push([s[i],f[o],f[n]]),p.push(r),f=c.concat(h).concat(l).concat(u)}return{shape:f,isolatedPts:p,allpoints:d}},triangulateShape:function(e,t){var n,r,i,o,a=THREE.Shape.Utils.removeHoles(e,t),s=a.allpoints,l=a.isolatedPts,a=THREE.FontUtils.Triangulate(a.shape,!1),c={};for(n=0,r=s.length;n<r;n++)o=s[n].x+":"+s[n].y,void 0!==c[o]&&console.log("Duplicate point",o),c[o]=n;for(n=0,r=a.length;n<r;n++)for(i=a[n],s=0;s<3;s++)o=i[s].x+":"+i[s].y,void 0!==(o=c[o])&&(i[s]=o);for(n=0,r=l.length;n<r;n++)for(i=l[n],s=0;s<3;s++)o=i[s].x+":"+i[s].y,void 0!==(o=c[o])&&(i[s]=o);return a.concat(l)},isClockWise:function(e){return THREE.FontUtils.Triangulate.area(e)<0},b2p0:function(e,t){var n=1-e;return n*n*t},b2p1:function(e,t){return 2*(1-e)*e*t},b2p2:function(e,t){return e*e*t},b2:function(e,t,n,r){return this.b2p0(e,t)+this.b2p1(e,n)+this.b2p2(e,r)},b3p0:function(e,t){var n=1-e;return n*n*n*t},b3p1:function(e,t){var n=1-e;return 3*n*n*e*t},b3p2:function(e,t){return 3*(1-e)*e*e*t},b3p3:function(e,t){return e*e*e*t},b3:function(e,t,n,r,i){return this.b3p0(e,t)+this.b3p1(e,n)+this.b3p2(e,r)+this.b3p3(e,i)}},THREE.TextPath=function(e,t){THREE.Path.call(this),this.parameters=t||{},this.set(e)},THREE.TextPath.prototype.set=function(e,t){t=t||this.parameters,this.text=e;var n=void 0!==t.curveSegments?t.curveSegments:4,r=void 0!==t.font?t.font:"helvetiker",i=void 0!==t.weight?t.weight:"normal",o=void 0!==t.style?t.style:"normal";THREE.FontUtils.size=void 0!==t.size?t.size:100,THREE.FontUtils.divisions=n,THREE.FontUtils.face=r,THREE.FontUtils.weight=i,THREE.FontUtils.style=o},THREE.TextPath.prototype.toShapes=function(){for(var e=THREE.FontUtils.drawText(this.text).paths,t=[],n=0,r=e.length;n<r;n++)Array.prototype.push.apply(t,e[n].toShapes());return t},THREE.AnimationHandler=function(){var e=[],t={},n={update:function(t){for(var n=0;n<e.length;n++)e[n].update(t)},addToUpdate:function(t){-1===e.indexOf(t)&&e.push(t)},removeFromUpdate:function(t){-1!==(t=e.indexOf(t))&&e.splice(t,1)},add:function(e){if(void 0!==t[e.name]&&console.log("THREE.AnimationHandler.add: Warning! "+e.name+" already exists in library. Overwriting."),t[e.name]=e,!0!==e.initialized){for(var n=0;n<e.hierarchy.length;n++){for(var r=0;r<e.hierarchy[n].keys.length;r++)if(e.hierarchy[n].keys[r].time<0&&(e.hierarchy[n].keys[r].time=0),void 0!==e.hierarchy[n].keys[r].rot&&!(e.hierarchy[n].keys[r].rot instanceof THREE.Quaternion)){var i=e.hierarchy[n].keys[r].rot;e.hierarchy[n].keys[r].rot=new THREE.Quaternion(i[0],i[1],i[2],i[3])}if(e.hierarchy[n].keys.length&&void 0!==e.hierarchy[n].keys[0].morphTargets){for(i={},r=0;r<e.hierarchy[n].keys.length;r++)for(var o=0;o<e.hierarchy[n].keys[r].morphTargets.length;o++){var a=e.hierarchy[n].keys[r].morphTargets[o];i[a]=-1}for(e.hierarchy[n].usedMorphTargets=i,r=0;r<e.hierarchy[n].keys.length;r++){var s={};for(a in i){for(o=0;o<e.hierarchy[n].keys[r].morphTargets.length;o++)if(e.hierarchy[n].keys[r].morphTargets[o]===a){s[a]=e.hierarchy[n].keys[r].morphTargetsInfluences[o];break}o===e.hierarchy[n].keys[r].morphTargets.length&&(s[a]=0)}e.hierarchy[n].keys[r].morphTargetsInfluences=s}}for(r=1;r<e.hierarchy[n].keys.length;r++)e.hierarchy[n].keys[r].time===e.hierarchy[n].keys[r-1].time&&(e.hierarchy[n].keys.splice(r,1),r--);for(r=0;r<e.hierarchy[n].keys.length;r++)e.hierarchy[n].keys[r].index=r}for(r=parseInt(e.length*e.fps,10),e.JIT={},e.JIT.hierarchy=[],n=0;n<e.hierarchy.length;n++)e.JIT.hierarchy.push(Array(r));e.initialized=!0}},get:function(e){if("string"==typeof e)return t[e]?t[e]:(console.log("THREE.AnimationHandler.get: Couldn't find animation "+e),null)},parse:function(e){var t=[];if(e instanceof THREE.SkinnedMesh)for(var n=0;n<e.bones.length;n++)t.push(e.bones[n]);else r(e,t);return t}},r=function(e,t){t.push(e);for(var n=0;n<e.children.length;n++)r(e.children[n],t)};return n.LINEAR=0,n.CATMULLROM=1,n.CATMULLROM_FORWARD=2,n}(),THREE.Animation=function(e,t,n,r){this.root=e,this.data=THREE.AnimationHandler.get(t),this.hierarchy=THREE.AnimationHandler.parse(e),this.currentTime=0,this.timeScale=1,this.isPlaying=!1,this.loop=this.isPaused=!0,this.interpolationType=void 0!==n?n:THREE.AnimationHandler.LINEAR,this.JITCompile=void 0===r||r,this.points=[],this.target=new THREE.Vector3},THREE.Animation.prototype.play=function(e,t){if(!this.isPlaying){this.isPlaying=!0,this.loop=void 0===e||e,this.currentTime=void 0!==t?t:0;var n,r,i=this.hierarchy.length;for(n=0;n<i;n++){r=this.hierarchy[n],this.interpolationType!==THREE.AnimationHandler.CATMULLROM_FORWARD&&(r.useQuaternion=!0),r.matrixAutoUpdate=!0,void 0===r.animationCache&&(r.animationCache={},r.animationCache.prevKey={pos:0,rot:0,scl:0},r.animationCache.nextKey={pos:0,rot:0,scl:0},r.animationCache.originalMatrix=r instanceof THREE.Bone?r.skinMatrix:r.matrix);var o=r.animationCache.prevKey;r=r.animationCache.nextKey,o.pos=this.data.hierarchy[n].keys[0],o.rot=this.data.hierarchy[n].keys[0],o.scl=this.data.hierarchy[n].keys[0],r.pos=this.getNextKeyWith("pos",n,1),r.rot=this.getNextKeyWith("rot",n,1),
r.scl=this.getNextKeyWith("scl",n,1)}this.update(0)}this.isPaused=!1,THREE.AnimationHandler.addToUpdate(this)},THREE.Animation.prototype.pause=function(){this.isPaused?THREE.AnimationHandler.addToUpdate(this):THREE.AnimationHandler.removeFromUpdate(this),this.isPaused=!this.isPaused},THREE.Animation.prototype.stop=function(){this.isPaused=this.isPlaying=!1,THREE.AnimationHandler.removeFromUpdate(this);for(var e=0;e<this.hierarchy.length;e++)void 0!==this.hierarchy[e].animationCache&&(this.hierarchy[e]instanceof THREE.Bone?this.hierarchy[e].skinMatrix=this.hierarchy[e].animationCache.originalMatrix:this.hierarchy[e].matrix=this.hierarchy[e].animationCache.originalMatrix,delete this.hierarchy[e].animationCache)},THREE.Animation.prototype.update=function(e){if(this.isPlaying){var t,n,r,i,o,a,s,l,c,u,h=["pos","rot","scl"],f=this.data.JIT.hierarchy;u=this.currentTime=this.currentTime+e*this.timeScale,c=this.currentTime=this.currentTime%this.data.length,l=parseInt(Math.min(c*this.data.fps,this.data.length*this.data.fps),10);for(var d=0,p=this.hierarchy.length;d<p;d++)if(e=this.hierarchy[d],s=e.animationCache,this.JITCompile&&void 0!==f[d][l])e instanceof THREE.Bone?(e.skinMatrix=f[d][l],e.matrixAutoUpdate=!1,e.matrixWorldNeedsUpdate=!1):(e.matrix=f[d][l],e.matrixAutoUpdate=!1,e.matrixWorldNeedsUpdate=!0);else{this.JITCompile&&(e instanceof THREE.Bone?e.skinMatrix=e.animationCache.originalMatrix:e.matrix=e.animationCache.originalMatrix);for(var m=0;m<3;m++){if(t=h[m],o=s.prevKey[t],a=s.nextKey[t],a.time<=u){if(c<u){if(!this.loop)return void this.stop();for(o=this.data.hierarchy[d].keys[0],a=this.getNextKeyWith(t,d,1);a.time<c;)o=a,a=this.getNextKeyWith(t,d,a.index+1)}else do{o=a,a=this.getNextKeyWith(t,d,a.index+1)}while(a.time<c);s.prevKey[t]=o,s.nextKey[t]=a}e.matrixAutoUpdate=!0,e.matrixWorldNeedsUpdate=!0,n=(c-o.time)/(a.time-o.time),r=o[t],i=a[t],(n<0||n>1)&&(console.log("THREE.Animation.update: Warning! Scale out of bounds:"+n+" on bone "+d),n=n<0?0:1),"pos"===t?(t=e.position,this.interpolationType===THREE.AnimationHandler.LINEAR?(t.x=r[0]+(i[0]-r[0])*n,t.y=r[1]+(i[1]-r[1])*n,t.z=r[2]+(i[2]-r[2])*n):this.interpolationType!==THREE.AnimationHandler.CATMULLROM&&this.interpolationType!==THREE.AnimationHandler.CATMULLROM_FORWARD||(this.points[0]=this.getPrevKeyWith("pos",d,o.index-1).pos,this.points[1]=r,this.points[2]=i,this.points[3]=this.getNextKeyWith("pos",d,a.index+1).pos,n=.33*n+.33,r=this.interpolateCatmullRom(this.points,n),t.x=r[0],t.y=r[1],t.z=r[2],this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD&&(n=this.interpolateCatmullRom(this.points,1.01*n),this.target.set(n[0],n[1],n[2]),this.target.subSelf(t),this.target.y=0,this.target.normalize(),n=Math.atan2(this.target.x,this.target.z),e.rotation.set(0,n,0)))):"rot"===t?THREE.Quaternion.slerp(r,i,e.quaternion,n):"scl"===t&&(t=e.scale,t.x=r[0]+(i[0]-r[0])*n,t.y=r[1]+(i[1]-r[1])*n,t.z=r[2]+(i[2]-r[2])*n)}}if(this.JITCompile&&void 0===f[0][l])for(this.hierarchy[0].updateMatrixWorld(!0),d=0;d<this.hierarchy.length;d++)f[d][l]=this.hierarchy[d]instanceof THREE.Bone?this.hierarchy[d].skinMatrix.clone():this.hierarchy[d].matrix.clone()}},THREE.Animation.prototype.interpolateCatmullRom=function(e,t){var n,r,i,o,a,s,l=[],c=[];return n=(e.length-1)*t,r=Math.floor(n),n-=r,l[0]=0===r?r:r-1,l[1]=r,l[2]=r>e.length-2?r:r+1,l[3]=r>e.length-3?r:r+2,r=e[l[0]],o=e[l[1]],a=e[l[2]],s=e[l[3]],l=n*n,i=n*l,c[0]=this.interpolate(r[0],o[0],a[0],s[0],n,l,i),c[1]=this.interpolate(r[1],o[1],a[1],s[1],n,l,i),c[2]=this.interpolate(r[2],o[2],a[2],s[2],n,l,i),c},THREE.Animation.prototype.interpolate=function(e,t,n,r,i,o,a){return e=.5*(n-e),r=.5*(r-t),(2*(t-n)+e+r)*a+(-3*(t-n)-2*e-r)*o+e*i+t},THREE.Animation.prototype.getNextKeyWith=function(e,t,n){for(var r=this.data.hierarchy[t].keys,n=this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD?n<r.length-1?n:r.length-1:n%r.length;n<r.length;n++)if(void 0!==r[n][e])return r[n];return this.data.hierarchy[t].keys[0]},THREE.Animation.prototype.getPrevKeyWith=function(e,t,n){for(var r=this.data.hierarchy[t].keys,n=this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD?n>0?n:0:n>=0?n:n+r.length;n>=0;n--)if(void 0!==r[n][e])return r[n];return this.data.hierarchy[t].keys[r.length-1]};THREE.KeyFrameAnimation=function(e,t,n){for(this.root=e,this.data=THREE.AnimationHandler.get(t),this.hierarchy=THREE.AnimationHandler.parse(e),this.currentTime=0,this.timeScale=.001,this.isPlaying=!1,this.loop=this.isPaused=!0,this.JITCompile=void 0===n||n,e=0,t=this.hierarchy.length;e<t;e++){var n=this.data.hierarchy[e].sids,r=this.hierarchy[e];if(this.data.hierarchy[e].keys.length&&n){for(var i=0;i<n.length;i++){var o=n[i],a=this.getNextKeyWith(o,e,0);a&&a.apply(o)}r.matrixAutoUpdate=!1,this.data.hierarchy[e].node.updateMatrix(),r.matrixWorldNeedsUpdate=!0}}},THREE.KeyFrameAnimation.prototype.play=function(e,t){if(!this.isPlaying){this.isPlaying=!0,this.loop=void 0===e||e,this.currentTime=void 0!==t?t:0,this.startTimeMs=t,this.startTime=1e7,this.endTime=-this.startTime;var n,r,i,o=this.hierarchy.length;for(n=0;n<o;n++)r=this.hierarchy[n],i=this.data.hierarchy[n],r.useQuaternion=!0,void 0===i.animationCache&&(i.animationCache={},i.animationCache.prevKey=null,i.animationCache.nextKey=null,i.animationCache.originalMatrix=r instanceof THREE.Bone?r.skinMatrix:r.matrix),r=this.data.hierarchy[n].keys,r.length&&(i.animationCache.prevKey=r[0],i.animationCache.nextKey=r[1],this.startTime=Math.min(r[0].time,this.startTime),this.endTime=Math.max(r[r.length-1].time,this.endTime));this.update(0)}this.isPaused=!1,THREE.AnimationHandler.addToUpdate(this)},THREE.KeyFrameAnimation.prototype.pause=function(){this.isPaused?THREE.AnimationHandler.addToUpdate(this):THREE.AnimationHandler.removeFromUpdate(this),this.isPaused=!this.isPaused},THREE.KeyFrameAnimation.prototype.stop=function(){this.isPaused=this.isPlaying=!1,THREE.AnimationHandler.removeFromUpdate(this);for(var e=0;e<this.data.hierarchy.length;e++){var t=this.hierarchy[e],n=this.data.hierarchy[e];if(void 0!==n.animationCache){var r=n.animationCache.originalMatrix;t instanceof THREE.Bone?(r.copy(t.skinMatrix),t.skinMatrix=r):(r.copy(t.matrix),t.matrix=r),delete n.animationCache}}},THREE.KeyFrameAnimation.prototype.update=function(e){if(this.isPlaying){var t,n,r,i,o,a,s,l=this.data.JIT.hierarchy;if(a=this.currentTime=this.currentTime+e*this.timeScale,o=this.currentTime=this.currentTime%this.data.length,o<this.startTimeMs&&(o=this.currentTime=this.startTimeMs+o),i=parseInt(Math.min(o*this.data.fps,this.data.length*this.data.fps),10),(s=o<a)&&!this.loop){for(var e=0,c=this.hierarchy.length;e<c;e++){var u=this.data.hierarchy[e].keys,l=this.data.hierarchy[e].sids;if(r=u.length-1,i=this.hierarchy[e],u.length){for(u=0;u<l.length;u++)o=l[u],(a=this.getPrevKeyWith(o,e,r))&&a.apply(o);this.data.hierarchy[e].node.updateMatrix(),i.matrixWorldNeedsUpdate=!0}}this.stop()}else if(!(o<this.startTime)){for(e=0,c=this.hierarchy.length;e<c;e++){r=this.hierarchy[e],t=this.data.hierarchy[e];var u=t.keys,h=t.animationCache;if(this.JITCompile&&void 0!==l[e][i])r instanceof THREE.Bone?(r.skinMatrix=l[e][i],r.matrixWorldNeedsUpdate=!1):(r.matrix=l[e][i],r.matrixWorldNeedsUpdate=!0);else if(u.length){if(this.JITCompile&&h&&(r instanceof THREE.Bone?r.skinMatrix=h.originalMatrix:r.matrix=h.originalMatrix),t=h.prevKey,n=h.nextKey,t&&n){if(n.time<=a){if(s&&this.loop)for(t=u[0],n=u[1];n.time<o;)t=n,n=u[t.index+1];else if(!s)for(var f=u.length-1;n.time<o&&n.index!==f;)t=n,n=u[t.index+1];h.prevKey=t,h.nextKey=n}n.time>=o?t.interpolate(n,o):t.interpolate(n,n.time)}this.data.hierarchy[e].node.updateMatrix(),r.matrixWorldNeedsUpdate=!0}}if(this.JITCompile&&void 0===l[0][i])for(this.hierarchy[0].updateMatrixWorld(!0),e=0;e<this.hierarchy.length;e++)l[e][i]=this.hierarchy[e]instanceof THREE.Bone?this.hierarchy[e].skinMatrix.clone():this.hierarchy[e].matrix.clone()}}},THREE.KeyFrameAnimation.prototype.getNextKeyWith=function(e,t,n){for(t=this.data.hierarchy[t].keys,n%=t.length;n<t.length;n++)if(t[n].hasTarget(e))return t[n];return t[0]},THREE.KeyFrameAnimation.prototype.getPrevKeyWith=function(e,t,n){for(t=this.data.hierarchy[t].keys,n=n>=0?n:n+t.length;n>=0;n--)if(t[n].hasTarget(e))return t[n];return t[t.length-1]},THREE.CubeCamera=function(e,t,n){THREE.Object3D.call(this);var r=new THREE.PerspectiveCamera(90,1,e,t);r.up.set(0,-1,0),r.lookAt(new THREE.Vector3(1,0,0)),this.add(r);var i=new THREE.PerspectiveCamera(90,1,e,t);i.up.set(0,-1,0),i.lookAt(new THREE.Vector3(-1,0,0)),this.add(i);var o=new THREE.PerspectiveCamera(90,1,e,t);o.up.set(0,0,1),o.lookAt(new THREE.Vector3(0,1,0)),this.add(o);var a=new THREE.PerspectiveCamera(90,1,e,t);a.up.set(0,0,-1),a.lookAt(new THREE.Vector3(0,-1,0)),this.add(a);var s=new THREE.PerspectiveCamera(90,1,e,t);s.up.set(0,-1,0),s.lookAt(new THREE.Vector3(0,0,1)),this.add(s);var l=new THREE.PerspectiveCamera(90,1,e,t);l.up.set(0,-1,0),l.lookAt(new THREE.Vector3(0,0,-1)),this.add(l),this.renderTarget=new THREE.WebGLRenderTargetCube(n,n,{format:THREE.RGBFormat,magFilter:THREE.LinearFilter,minFilter:THREE.LinearFilter}),this.updateCubeMap=function(e,t){var n=this.renderTarget,c=n.generateMipmaps;n.generateMipmaps=!1,n.activeCubeFace=0,e.render(t,r,n),n.activeCubeFace=1,e.render(t,i,n),n.activeCubeFace=2,e.render(t,o,n),n.activeCubeFace=3,e.render(t,a,n),n.activeCubeFace=4,e.render(t,s,n),n.generateMipmaps=c,n.activeCubeFace=5,e.render(t,l,n)}},THREE.CubeCamera.prototype=new THREE.Object3D,THREE.CubeCamera.prototype.constructor=THREE.CubeCamera,THREE.CombinedCamera=function(e,t,n,r,i,o,a){THREE.Camera.call(this),this.fov=n,this.left=-e/2,this.right=e/2,this.top=t/2,this.bottom=-t/2,this.cameraO=new THREE.OrthographicCamera(e/-2,e/2,t/2,t/-2,o,a),this.cameraP=new THREE.PerspectiveCamera(n,e/t,r,i),this.zoom=1,this.toPerspective()},THREE.CombinedCamera.prototype=new THREE.Camera,THREE.CombinedCamera.prototype.constructor=THREE.CombinedCamera,THREE.CombinedCamera.prototype.toPerspective=function(){this.near=this.cameraP.near,this.far=this.cameraP.far,this.cameraP.fov=this.fov/this.zoom,this.cameraP.updateProjectionMatrix(),this.projectionMatrix=this.cameraP.projectionMatrix,this.inPersepectiveMode=!0,this.inOrthographicMode=!1},THREE.CombinedCamera.prototype.toOrthographic=function(){var e=this.cameraP.aspect,t=(this.cameraP.near+this.cameraP.far)/2,t=Math.tan(this.fov/2)*t,e=2*t*e/2,t=t/this.zoom,e=e/this.zoom;this.cameraO.left=-e,this.cameraO.right=e,this.cameraO.top=t,this.cameraO.bottom=-t,this.cameraO.updateProjectionMatrix(),this.near=this.cameraO.near,this.far=this.cameraO.far,this.projectionMatrix=this.cameraO.projectionMatrix,this.inPersepectiveMode=!1,this.inOrthographicMode=!0},THREE.CombinedCamera.prototype.setSize=function(e,t){this.cameraP.aspect=e/t,this.left=-e/2,this.right=e/2,this.top=t/2,this.bottom=-t/2},THREE.CombinedCamera.prototype.setFov=function(e){this.fov=e,this.inPersepectiveMode?this.toPerspective():this.toOrthographic()},THREE.CombinedCamera.prototype.updateProjectionMatrix=function(){this.inPersepectiveMode?this.toPerspective():(this.toPerspective(),this.toOrthographic())},THREE.CombinedCamera.prototype.setLens=function(e,t){var n=2*Math.atan((void 0!==t?t:24)/(2*e))*(180/Math.PI);return this.setFov(n),n},THREE.CombinedCamera.prototype.setZoom=function(e){this.zoom=e,this.inPersepectiveMode?this.toPerspective():this.toOrthographic()},THREE.CombinedCamera.prototype.toFrontView=function(){this.rotation.x=0,this.rotation.y=0,this.rotation.z=0,this.rotationAutoUpdate=!1},THREE.CombinedCamera.prototype.toBackView=function(){this.rotation.x=0,this.rotation.y=Math.PI,this.rotation.z=0,this.rotationAutoUpdate=!1},THREE.CombinedCamera.prototype.toLeftView=function(){this.rotation.x=0,this.rotation.y=-Math.PI/2,this.rotation.z=0,this.rotationAutoUpdate=!1},THREE.CombinedCamera.prototype.toRightView=function(){this.rotation.x=0,this.rotation.y=Math.PI/2,this.rotation.z=0,this.rotationAutoUpdate=!1},THREE.CombinedCamera.prototype.toTopView=function(){this.rotation.x=-Math.PI/2,this.rotation.y=0,this.rotation.z=0,this.rotationAutoUpdate=!1},THREE.CombinedCamera.prototype.toBottomView=function(){this.rotation.x=Math.PI/2,this.rotation.y=0,this.rotation.z=0,this.rotationAutoUpdate=!1},THREE.FirstPersonControls=function(e,t){function n(e,t){return function(){t.apply(e,arguments)}}this.object=e,this.target=new THREE.Vector3(0,0,0),this.domElement=void 0!==t?t:document,this.movementSpeed=1,this.lookSpeed=.005,this.noFly=!1,this.lookVertical=!0,this.autoForward=!1,this.activeLook=!0,this.heightSpeed=!1,this.heightCoef=1,this.heightMin=0,this.constrainVertical=!1,this.verticalMin=0,this.verticalMax=Math.PI,this.theta=this.phi=this.lon=this.lat=this.mouseY=this.mouseX=this.autoSpeedFactor=0,this.mouseDragOn=this.freeze=this.moveRight=this.moveLeft=this.moveBackward=this.moveForward=!1,this.domElement===document?(this.viewHalfX=window.innerWidth/2,this.viewHalfY=window.innerHeight/2):(this.viewHalfX=this.domElement.offsetWidth/2,this.viewHalfY=this.domElement.offsetHeight/2,this.domElement.setAttribute("tabindex",-1)),this.onMouseDown=function(e){if(this.domElement!==document&&this.domElement.focus(),e.preventDefault(),e.stopPropagation(),this.activeLook)switch(e.button){case 0:this.moveForward=!0;break;case 2:this.moveBackward=!0}this.mouseDragOn=!0},this.onMouseUp=function(e){if(e.preventDefault(),e.stopPropagation(),this.activeLook)switch(e.button){case 0:this.moveForward=!1;break;case 2:this.moveBackward=!1}this.mouseDragOn=!1},this.onMouseMove=function(e){this.domElement===document?(this.mouseX=e.pageX-this.viewHalfX,this.mouseY=e.pageY-this.viewHalfY):(this.mouseX=e.pageX-this.domElement.offsetLeft-this.viewHalfX,this.mouseY=e.pageY-this.domElement.offsetTop-this.viewHalfY)},this.onKeyDown=function(e){switch(e.keyCode){case 38:case 87:this.moveForward=!0;break;case 37:case 65:this.moveLeft=!0;break;case 40:case 83:this.moveBackward=!0;break;case 39:case 68:this.moveRight=!0;break;case 82:this.moveUp=!0;break;case 70:this.moveDown=!0;break;case 81:this.freeze=!this.freeze}},this.onKeyUp=function(e){switch(e.keyCode){case 38:case 87:this.moveForward=!1;break;case 37:case 65:this.moveLeft=!1;break;case 40:case 83:this.moveBackward=!1;break;case 39:case 68:this.moveRight=!1;break;case 82:this.moveUp=!1;break;case 70:this.moveDown=!1}},this.update=function(e){var t=0;if(!this.freeze){this.heightSpeed?(t=THREE.Math.clamp(this.object.position.y,this.heightMin,this.heightMax)-this.heightMin,this.autoSpeedFactor=e*t*this.heightCoef):this.autoSpeedFactor=0,t=e*this.movementSpeed,(this.moveForward||this.autoForward&&!this.moveBackward)&&this.object.translateZ(-(t+this.autoSpeedFactor)),this.moveBackward&&this.object.translateZ(t),this.moveLeft&&this.object.translateX(-t),this.moveRight&&this.object.translateX(t),this.moveUp&&this.object.translateY(t),this.moveDown&&this.object.translateY(-t),e*=this.lookSpeed,this.activeLook||(e=0),this.lon=this.lon+this.mouseX*e,this.lookVertical&&(this.lat=this.lat-this.mouseY*e),this.lat=Math.max(-85,Math.min(85,this.lat)),this.phi=(90-this.lat)*Math.PI/180,this.theta=this.lon*Math.PI/180;var t=this.target,n=this.object.position;t.x=n.x+100*Math.sin(this.phi)*Math.cos(this.theta),t.y=n.y+100*Math.cos(this.phi),t.z=n.z+100*Math.sin(this.phi)*Math.sin(this.theta),t=1,this.constrainVertical&&(t=Math.PI/(this.verticalMax-this.verticalMin)),this.lon=this.lon+this.mouseX*e,this.lookVertical&&(this.lat=this.lat-this.mouseY*e*t),this.lat=Math.max(-85,Math.min(85,this.lat)),this.phi=(90-this.lat)*Math.PI/180,this.theta=this.lon*Math.PI/180,this.constrainVertical&&(this.phi=THREE.Math.mapLinear(this.phi,0,Math.PI,this.verticalMin,this.verticalMax)),t=this.target,n=this.object.position,t.x=n.x+100*Math.sin(this.phi)*Math.cos(this.theta),t.y=n.y+100*Math.cos(this.phi),t.z=n.z+100*Math.sin(this.phi)*Math.sin(this.theta),this.object.lookAt(t)}},this.domElement.addEventListener("contextmenu",function(e){e.preventDefault()},!1),this.domElement.addEventListener("mousemove",n(this,this.onMouseMove),!1),this.domElement.addEventListener("mousedown",n(this,this.onMouseDown),!1),this.domElement.addEventListener("mouseup",n(this,this.onMouseUp),!1),this.domElement.addEventListener("keydown",n(this,this.onKeyDown),!1),this.domElement.addEventListener("keyup",n(this,this.onKeyUp),!1)},THREE.PathControls=function(e,t){function n(e){return(e*=2)<1?.5*e*e:-.5*(--e*(e-2)-1)}function r(e,t){return function(){t.apply(e,arguments)}}function i(e,t,n,r){var i,o={name:n,fps:.6,length:r,hierarchy:[]},a=t.getControlPointsArray(),s=t.getLength(),l=a.length,c=0;for(i=l-1,t={parent:-1,keys:[]},t.keys[0]={time:0,pos:a[0],rot:[0,0,0,1],scl:[1,1,1]},t.keys[i]={time:r,pos:a[i],rot:[0,0,0,1],scl:[1,1,1]},i=1;i<l-1;i++)c=r*s.chunks[i]/s.total,t.keys[i]={time:c,pos:a[i]};return o.hierarchy[0]=t,THREE.AnimationHandler.add(o),new THREE.Animation(e,n,THREE.AnimationHandler.CATMULLROM_FORWARD,!1)}function o(e,t){var n,r,i=new THREE.Geometry;for(n=0;n<e.points.length*t;n++)r=n/(e.points.length*t),r=e.getPoint(r),i.vertices[n]=new THREE.Vector3(r.x,r.y,r.z);return i}this.object=e,this.domElement=void 0!==t?t:document,this.id="PathControls"+THREE.PathControlsIdCounter++,this.duration=1e4,this.waypoints=[],this.useConstantSpeed=!0,this.resamplingCoef=50,this.debugPath=new THREE.Object3D,this.debugDummy=new THREE.Object3D,this.animationParent=new THREE.Object3D,this.lookSpeed=.005,this.lookHorizontal=this.lookVertical=!0,this.verticalAngleMap={srcRange:[0,2*Math.PI],dstRange:[0,2*Math.PI]},this.horizontalAngleMap={srcRange:[0,2*Math.PI],dstRange:[0,2*Math.PI]},this.target=new THREE.Object3D,this.theta=this.phi=this.lon=this.lat=this.mouseY=this.mouseX=0,this.domElement===document?(this.viewHalfX=window.innerWidth/2,this.viewHalfY=window.innerHeight/2):(this.viewHalfX=this.domElement.offsetWidth/2,this.viewHalfY=this.domElement.offsetHeight/2,this.domElement.setAttribute("tabindex",-1));var a=2*Math.PI,s=Math.PI/180;this.update=function(e){var t;this.lookHorizontal&&(this.lon=this.lon+this.mouseX*this.lookSpeed*e),this.lookVertical&&(this.lat=this.lat-this.mouseY*this.lookSpeed*e),this.lon=Math.max(0,Math.min(360,this.lon)),this.lat=Math.max(-85,Math.min(85,this.lat)),this.phi=(90-this.lat)*s,this.theta=this.lon*s,e=this.phi%a,this.phi=e>=0?e:e+a,t=this.verticalAngleMap.srcRange,e=this.verticalAngleMap.dstRange,t=THREE.Math.mapLinear(this.phi,t[0],t[1],e[0],e[1]);var r=e[1]-e[0];this.phi=n((t-e[0])/r)*r+e[0],t=this.horizontalAngleMap.srcRange,e=this.horizontalAngleMap.dstRange,t=THREE.Math.mapLinear(this.theta,t[0],t[1],e[0],e[1]),r=e[1]-e[0],this.theta=n((t-e[0])/r)*r+e[0],e=this.target.position,e.x=100*Math.sin(this.phi)*Math.cos(this.theta),e.y=100*Math.cos(this.phi),e.z=100*Math.sin(this.phi)*Math.sin(this.theta),this.object.lookAt(this.target.position)},this.onMouseMove=function(e){this.domElement===document?(this.mouseX=e.pageX-this.viewHalfX,this.mouseY=e.pageY-this.viewHalfY):(this.mouseX=e.pageX-this.domElement.offsetLeft-this.viewHalfX,this.mouseY=e.pageY-this.domElement.offsetTop-this.viewHalfY)},this.init=function(){if(this.spline=new THREE.Spline,this.spline.initFromArray(this.waypoints),this.useConstantSpeed&&this.spline.reparametrizeByArcLength(this.resamplingCoef),this.createDebugDummy){var e=new THREE.MeshLambertMaterial({color:30719}),t=new THREE.MeshLambertMaterial({color:65280}),n=new THREE.CubeGeometry(10,10,20),a=new THREE.CubeGeometry(2,2,10);this.animationParent=new THREE.Mesh(n,e),e=new THREE.Mesh(a,t),e.position.set(0,10,0),this.animation=i(this.animationParent,this.spline,this.id,this.duration),this.animationParent.add(this.object),this.animationParent.add(this.target),this.animationParent.add(e)}else this.animation=i(this.animationParent,this.spline,this.id,this.duration),this.animationParent.add(this.target),this.animationParent.add(this.object);if(this.createDebugPath){var e=this.debugPath,t=this.spline,a=o(t,10),n=o(t,10),s=new THREE.LineBasicMaterial({color:16711680,linewidth:3}),a=new THREE.Line(a,s),n=new THREE.ParticleSystem(n,new THREE.ParticleBasicMaterial({color:16755200,size:3}));a.scale.set(1,1,1),e.add(a),n.scale.set(1,1,1),e.add(n);for(var a=new THREE.SphereGeometry(1,16,8),s=new THREE.MeshBasicMaterial({color:65280}),l=0;l<t.points.length;l++)n=new THREE.Mesh(a,s),n.position.copy(t.points[l]),e.add(n)}this.domElement.addEventListener("mousemove",r(this,this.onMouseMove),!1)}},THREE.PathControlsIdCounter=0,THREE.FlyControls=function(e,t){function n(e,t){return function(){t.apply(e,arguments)}}this.object=e,this.domElement=void 0!==t?t:document,t&&this.domElement.setAttribute("tabindex",-1),this.movementSpeed=1,this.rollSpeed=.005,this.autoForward=this.dragToLook=!1,this.object.useQuaternion=!0,this.tmpQuaternion=new THREE.Quaternion,this.mouseStatus=0,this.moveState={up:0,down:0,left:0,right:0,forward:0,back:0,pitchUp:0,pitchDown:0,yawLeft:0,yawRight:0,rollLeft:0,rollRight:0},this.moveVector=new THREE.Vector3(0,0,0),this.rotationVector=new THREE.Vector3(0,0,0),this.handleEvent=function(e){"function"==typeof this[e.type]&&this[e.type](e)},this.keydown=function(e){if(!e.altKey){switch(e.keyCode){case 16:this.movementSpeedMultiplier=.1;break;case 87:this.moveState.forward=1;break;case 83:this.moveState.back=1;break;case 65:this.moveState.left=1;break;case 68:this.moveState.right=1;break;case 82:this.moveState.up=1;break;case 70:this.moveState.down=1;break;case 38:this.moveState.pitchUp=1;break;case 40:this.moveState.pitchDown=1;break;case 37:this.moveState.yawLeft=1;break;case 39:this.moveState.yawRight=1;break;case 81:this.moveState.rollLeft=1;break;case 69:this.moveState.rollRight=1}this.updateMovementVector(),this.updateRotationVector()}},this.keyup=function(e){switch(e.keyCode){case 16:this.movementSpeedMultiplier=1;break;case 87:this.moveState.forward=0;break;case 83:this.moveState.back=0;break;case 65:this.moveState.left=0;break;case 68:this.moveState.right=0;break;case 82:this.moveState.up=0;break;case 70:this.moveState.down=0;break;case 38:this.moveState.pitchUp=0;break;case 40:this.moveState.pitchDown=0;break;case 37:this.moveState.yawLeft=0;break;case 39:this.moveState.yawRight=0;break;case 81:this.moveState.rollLeft=0;break;case 69:this.moveState.rollRight=0}this.updateMovementVector(),this.updateRotationVector()},this.mousedown=function(e){if(this.domElement!==document&&this.domElement.focus(),e.preventDefault(),e.stopPropagation(),this.dragToLook)this.mouseStatus++;else switch(e.button){case 0:this.object.moveForward=!0;break;case 2:this.object.moveBackward=!0}},this.mousemove=function(e){if(!this.dragToLook||this.mouseStatus>0){var t=this.getContainerDimensions(),n=t.size[0]/2,r=t.size[1]/2;this.moveState.yawLeft=-(e.pageX-t.offset[0]-n)/n,this.moveState.pitchDown=(e.pageY-t.offset[1]-r)/r,this.updateRotationVector()}},this.mouseup=function(e){if(e.preventDefault(),e.stopPropagation(),this.dragToLook)this.mouseStatus--,this.moveState.yawLeft=this.moveState.pitchDown=0;else switch(e.button){case 0:this.moveForward=!1;break;case 2:this.moveBackward=!1}this.updateRotationVector()},this.update=function(e){var t=e*this.movementSpeed,e=e*this.rollSpeed;this.object.translateX(this.moveVector.x*t),this.object.translateY(this.moveVector.y*t),this.object.translateZ(this.moveVector.z*t),this.tmpQuaternion.set(this.rotationVector.x*e,this.rotationVector.y*e,this.rotationVector.z*e,1).normalize(),this.object.quaternion.multiplySelf(this.tmpQuaternion),this.object.matrix.setPosition(this.object.position),this.object.matrix.setRotationFromQuaternion(this.object.quaternion),this.object.matrixWorldNeedsUpdate=!0},this.updateMovementVector=function(){var e=this.moveState.forward||this.autoForward&&!this.moveState.back?1:0;this.moveVector.x=-this.moveState.left+this.moveState.right,this.moveVector.y=-this.moveState.down+this.moveState.up,this.moveVector.z=-e+this.moveState.back},this.updateRotationVector=function(){this.rotationVector.x=-this.moveState.pitchDown+this.moveState.pitchUp,this.rotationVector.y=-this.moveState.yawRight+this.moveState.yawLeft,this.rotationVector.z=-this.moveState.rollRight+this.moveState.rollLeft},this.getContainerDimensions=function(){return this.domElement!=document?{size:[this.domElement.offsetWidth,this.domElement.offsetHeight],offset:[this.domElement.offsetLeft,this.domElement.offsetTop]}:{size:[window.innerWidth,window.innerHeight],offset:[0,0]}},this.domElement.addEventListener("mousemove",n(this,this.mousemove),!1),this.domElement.addEventListener("mousedown",n(this,this.mousedown),!1),this.domElement.addEventListener("mouseup",n(this,this.mouseup),!1),this.domElement.addEventListener("keydown",n(this,this.keydown),!1),this.domElement.addEventListener("keyup",n(this,this.keyup),!1),this.updateMovementVector(),this.updateRotationVector()},THREE.RollControls=function(e,t){this.object=e,this.domElement=void 0!==t?t:document,this.mouseLook=!0,this.autoForward=!1,this.rollSpeed=this.movementSpeed=this.lookSpeed=1,this.constrainVertical=[-.9,.9],this.object.matrixAutoUpdate=!1,this.forward=new THREE.Vector3(0,0,1),this.roll=0;var n=new THREE.Vector3,r=new THREE.Vector3,i=new THREE.Vector3,o=new THREE.Matrix4,a=!1,s=1,l=0,c=0,u=0,h=0,f=0,d=window.innerWidth/2,p=window.innerHeight/2;this.update=function(e){if(this.mouseLook){var t=e*this.lookSpeed;this.rotateHorizontally(t*h),this.rotateVertically(t*f)}t=e*this.movementSpeed,this.object.translateZ(-t*(l>0||this.autoForward&&!(l<0)?1:l)),this.object.translateX(t*c),this.object.translateY(t*u),a&&(this.roll=this.roll+this.rollSpeed*e*s),this.forward.y>this.constrainVertical[1]?(this.forward.y=this.constrainVertical[1],this.forward.normalize()):this.forward.y<this.constrainVertical[0]&&(this.forward.y=this.constrainVertical[0],this.forward.normalize()),i.copy(this.forward),r.set(0,1,0),n.cross(r,i).normalize(),r.cross(i,n).normalize(),this.object.matrix.elements[0]=n.x,this.object.matrix.elements[4]=r.x,this.object.matrix.elements[8]=i.x,this.object.matrix.elements[1]=n.y,this.object.matrix.elements[5]=r.y,this.object.matrix.elements[9]=i.y,this.object.matrix.elements[2]=n.z,this.object.matrix.elements[6]=r.z,this.object.matrix.elements[10]=i.z,o.identity(),o.elements[0]=Math.cos(this.roll),o.elements[4]=-Math.sin(this.roll),o.elements[1]=Math.sin(this.roll),o.elements[5]=Math.cos(this.roll),this.object.matrix.multiplySelf(o),this.object.matrixWorldNeedsUpdate=!0,this.object.matrix.elements[12]=this.object.position.x,this.object.matrix.elements[13]=this.object.position.y,this.object.matrix.elements[14]=this.object.position.z},this.translateX=function(e){this.object.position.x=this.object.position.x+this.object.matrix.elements[0]*e,this.object.position.y=this.object.position.y+this.object.matrix.elements[1]*e,this.object.position.z=this.object.position.z+this.object.matrix.elements[2]*e},this.translateY=function(e){this.object.position.x=this.object.position.x+this.object.matrix.elements[4]*e,this.object.position.y=this.object.position.y+this.object.matrix.elements[5]*e,this.object.position.z=this.object.position.z+this.object.matrix.elements[6]*e},this.translateZ=function(e){this.object.position.x=this.object.position.x-this.object.matrix.elements[8]*e,this.object.position.y=this.object.position.y-this.object.matrix.elements[9]*e,this.object.position.z=this.object.position.z-this.object.matrix.elements[10]*e},this.rotateHorizontally=function(e){n.set(this.object.matrix.elements[0],this.object.matrix.elements[1],this.object.matrix.elements[2]),n.multiplyScalar(e),this.forward.subSelf(n),this.forward.normalize()},this.rotateVertically=function(e){r.set(this.object.matrix.elements[4],this.object.matrix.elements[5],this.object.matrix.elements[6]),r.multiplyScalar(e),this.forward.addSelf(r),this.forward.normalize()},this.domElement.addEventListener("contextmenu",function(e){e.preventDefault()},!1),this.domElement.addEventListener("mousemove",function(e){h=(e.clientX-d)/window.innerWidth,f=(e.clientY-p)/window.innerHeight},!1),this.domElement.addEventListener("mousedown",function(e){switch(e.preventDefault(),e.stopPropagation(),e.button){case 0:l=1;break;case 2:l=-1}},!1),this.domElement.addEventListener("mouseup",function(e){switch(e.preventDefault(),e.stopPropagation(),e.button){case 0:l=0;break;case 2:l=0}},!1),this.domElement.addEventListener("keydown",function(e){switch(e.keyCode){case 38:case 87:l=1;break;case 37:case 65:c=-1;break;case 40:case 83:l=-1;break;case 39:case 68:c=1;break;case 81:a=!0,s=1;break;case 69:a=!0,s=-1;break;case 82:u=1;break;case 70:u=-1}},!1),this.domElement.addEventListener("keyup",function(e){switch(e.keyCode){case 38:case 87:l=0;break;case 37:case 65:c=0;break;case 40:case 83:l=0;break;case 39:case 68:c=0;break;case 81:case 69:a=!1;break;case 82:u=0;break;case 70:u=0}},!1)},THREE.TrackballControls=function(e,t){THREE.EventTarget.call(this);var n=this;this.object=e,this.domElement=void 0!==t?t:document,this.enabled=!0,this.screen={width:window.innerWidth,height:window.innerHeight,offsetLeft:0,offsetTop:0},this.radius=(this.screen.width+this.screen.height)/4,this.rotateSpeed=1,this.zoomSpeed=1.2,this.panSpeed=.3,this.staticMoving=this.noPan=this.noZoom=this.noRotate=!1,this.dynamicDampingFactor=.2,this.minDistance=0,this.maxDistance=1/0,this.keys=[65,83,68],this.target=new THREE.Vector3;var r=new THREE.Vector3,i=!1,o=-1,a=new THREE.Vector3,s=new THREE.Vector3,l=new THREE.Vector3,c=new THREE.Vector2,u=new THREE.Vector2,h=new THREE.Vector2,f=new THREE.Vector2,d={type:"change"};this.handleEvent=function(e){"function"==typeof this[e.type]&&this[e.type](e)},this.getMouseOnScreen=function(e,t){return new THREE.Vector2((e-n.screen.offsetLeft)/n.radius*.5,(t-n.screen.offsetTop)/n.radius*.5)},this.getMouseProjectionOnBall=function(e,t){var r=new THREE.Vector3((e-.5*n.screen.width-n.screen.offsetLeft)/n.radius,(.5*n.screen.height+n.screen.offsetTop-t)/n.radius,0),i=r.length();return i>1?r.normalize():r.z=Math.sqrt(1-i*i),a.copy(n.object.position).subSelf(n.target),i=n.object.up.clone().setLength(r.y),i.addSelf(n.object.up.clone().crossSelf(a).setLength(r.x)),i.addSelf(a.setLength(r.z)),i},this.rotateCamera=function(){var e=Math.acos(s.dot(l)/s.length()/l.length());if(e){var t=(new THREE.Vector3).cross(s,l).normalize(),r=new THREE.Quaternion,e=e*n.rotateSpeed;r.setFromAxisAngle(t,-e),r.multiplyVector3(a),r.multiplyVector3(n.object.up),r.multiplyVector3(l),n.staticMoving?s=l:(r.setFromAxisAngle(t,e*(n.dynamicDampingFactor-1)),r.multiplyVector3(s))}},this.zoomCamera=function(){var e=1+(u.y-c.y)*n.zoomSpeed;1!==e&&e>0&&(a.multiplyScalar(e),n.staticMoving?c=u:c.y=c.y+(u.y-c.y)*this.dynamicDampingFactor)},this.panCamera=function(){var e=f.clone().subSelf(h);if(e.lengthSq()){e.multiplyScalar(a.length()*n.panSpeed);var t=a.clone().crossSelf(n.object.up).setLength(e.x);t.addSelf(n.object.up.clone().setLength(e.y)),n.object.position.addSelf(t),n.target.addSelf(t),n.staticMoving?h=f:h.addSelf(e.sub(f,h).multiplyScalar(n.dynamicDampingFactor))}},this.checkDistances=function(){n.noZoom&&n.noPan||(n.object.position.lengthSq()>n.maxDistance*n.maxDistance&&n.object.position.setLength(n.maxDistance),a.lengthSq()<n.minDistance*n.minDistance&&n.object.position.add(n.target,a.setLength(n.minDistance)))},this.update=function(){a.copy(n.object.position).subSelf(n.target),n.noRotate||n.rotateCamera(),n.noZoom||n.zoomCamera(),n.noPan||n.panCamera(),n.object.position.add(n.target,a),n.checkDistances(),n.object.lookAt(n.target),r.distanceTo(n.object.position)>0&&(n.dispatchEvent(d),r.copy(n.object.position))},this.domElement.addEventListener("contextmenu",function(e){e.preventDefault()},!1),this.domElement.addEventListener("mousemove",function(e){n.enabled&&(i&&(s=l=n.getMouseProjectionOnBall(e.clientX,e.clientY),c=u=n.getMouseOnScreen(e.clientX,e.clientY),h=f=n.getMouseOnScreen(e.clientX,e.clientY),i=!1),
-1!==o&&(0!==o||n.noRotate?1!==o||n.noZoom?2===o&&!n.noPan&&(f=n.getMouseOnScreen(e.clientX,e.clientY)):u=n.getMouseOnScreen(e.clientX,e.clientY):l=n.getMouseProjectionOnBall(e.clientX,e.clientY)))},!1),this.domElement.addEventListener("mousedown",function(e){n.enabled&&(e.preventDefault(),e.stopPropagation(),-1===o&&(o=e.button,0!==o||n.noRotate?1!==o||n.noZoom?this.noPan||(h=f=n.getMouseOnScreen(e.clientX,e.clientY)):c=u=n.getMouseOnScreen(e.clientX,e.clientY):s=l=n.getMouseProjectionOnBall(e.clientX,e.clientY)))},!1),this.domElement.addEventListener("mouseup",function(e){n.enabled&&(e.preventDefault(),e.stopPropagation(),o=-1)},!1),window.addEventListener("keydown",function(e){n.enabled&&-1===o&&(e.keyCode!==n.keys[0]||n.noRotate?e.keyCode!==n.keys[1]||n.noZoom?e.keyCode===n.keys[2]&&!n.noPan&&(o=2):o=1:o=0,-1!==o&&(i=!0))},!1),window.addEventListener("keyup",function(){n.enabled&&-1!==o&&(o=-1)},!1)},THREE.CubeGeometry=function(e,t,n,r,i,o,a,s){function l(e,t,n,a,s,l,c,u){var h,f=r||1,d=i||1,p=s/2,v=l/2,g=m.vertices.length;"x"===e&&"y"===t||"y"===e&&"x"===t?h="z":"x"===e&&"z"===t||"z"===e&&"x"===t?(h="y",d=o||1):("z"===e&&"y"===t||"y"===e&&"z"===t)&&(h="x",f=o||1);var E=f+1,y=d+1,x=s/f,T=l/d,b=new THREE.Vector3;for(b[h]=c>0?1:-1,s=0;s<y;s++)for(l=0;l<E;l++){var R=new THREE.Vector3;R[e]=(l*x-p)*n,R[t]=(s*T-v)*a,R[h]=c,m.vertices.push(R)}for(s=0;s<d;s++)for(l=0;l<f;l++)e=new THREE.Face4(l+E*s+g,l+E*(s+1)+g,l+1+E*(s+1)+g,l+1+E*s+g),e.normal.copy(b),e.vertexNormals.push(b.clone(),b.clone(),b.clone(),b.clone()),e.materialIndex=u,m.faces.push(e),m.faceVertexUvs[0].push([new THREE.UV(l/f,s/d),new THREE.UV(l/f,(s+1)/d),new THREE.UV((l+1)/f,(s+1)/d),new THREE.UV((l+1)/f,s/d)])}THREE.Geometry.call(this);var c,u,h,f,d,p,m=this,v=e/2,g=t/2,E=n/2;if(void 0!==a){if(a instanceof Array)this.materials=a;else for(this.materials=[],c=0;c<6;c++)this.materials.push(a);c=0,f=1,u=2,d=3,h=4,p=5}else this.materials=[];if(this.sides={px:!0,nx:!0,py:!0,ny:!0,pz:!0,nz:!0},void 0!=s)for(var y in s)void 0!==this.sides[y]&&(this.sides[y]=s[y]);this.sides.px&&l("z","y",-1,-1,n,t,v,c),this.sides.nx&&l("z","y",1,-1,n,t,-v,f),this.sides.py&&l("x","z",1,1,e,n,g,u),this.sides.ny&&l("x","z",1,-1,e,n,-g,d),this.sides.pz&&l("x","y",1,-1,e,t,E,h),this.sides.nz&&l("x","y",-1,-1,e,t,-E,p),this.computeCentroids(),this.mergeVertices()},THREE.CubeGeometry.prototype=new THREE.Geometry,THREE.CubeGeometry.prototype.constructor=THREE.CubeGeometry,THREE.CylinderGeometry=function(e,t,n,r,i,o){THREE.Geometry.call(this);var a,s,e=void 0!==e?e:20,t=void 0!==t?t:20,n=void 0!==n?n:100,l=n/2,r=r||8,i=i||1,c=[],u=[];for(s=0;s<=i;s++){var h=[],f=[],d=s/i,p=d*(t-e)+e;for(a=0;a<=r;a++){var m=a/r,v=new THREE.Vector3;v.x=p*Math.sin(m*Math.PI*2),v.y=-d*n+l,v.z=p*Math.cos(m*Math.PI*2),this.vertices.push(v),h.push(this.vertices.length-1),f.push(new THREE.UV(m,d))}c.push(h),u.push(f)}for(n=(t-e)/n,a=0;a<r;a++)for(0!==e?(h=this.vertices[c[0][a]].clone(),f=this.vertices[c[0][a+1]].clone()):(h=this.vertices[c[1][a]].clone(),f=this.vertices[c[1][a+1]].clone()),h.setY(Math.sqrt(h.x*h.x+h.z*h.z)*n).normalize(),f.setY(Math.sqrt(f.x*f.x+f.z*f.z)*n).normalize(),s=0;s<i;s++){var d=c[s][a],p=c[s+1][a],m=c[s+1][a+1],v=c[s][a+1],g=h.clone(),E=h.clone(),y=f.clone(),x=f.clone(),T=u[s][a].clone(),b=u[s+1][a].clone(),R=u[s+1][a+1].clone(),w=u[s][a+1].clone();this.faces.push(new THREE.Face4(d,p,m,v,[g,E,y,x])),this.faceVertexUvs[0].push([T,b,R,w])}if(!o&&e>0)for(this.vertices.push(new THREE.Vector3(0,l,0)),a=0;a<r;a++)d=c[0][a],p=c[0][a+1],m=this.vertices.length-1,g=new THREE.Vector3(0,1,0),E=new THREE.Vector3(0,1,0),y=new THREE.Vector3(0,1,0),T=u[0][a].clone(),b=u[0][a+1].clone(),R=new THREE.UV(b.u,0),this.faces.push(new THREE.Face3(d,p,m,[g,E,y])),this.faceVertexUvs[0].push([T,b,R]);if(!o&&t>0)for(this.vertices.push(new THREE.Vector3(0,-l,0)),a=0;a<r;a++)d=c[s][a+1],p=c[s][a],m=this.vertices.length-1,g=new THREE.Vector3(0,-1,0),E=new THREE.Vector3(0,-1,0),y=new THREE.Vector3(0,-1,0),T=u[s][a+1].clone(),b=u[s][a].clone(),R=new THREE.UV(b.u,1),this.faces.push(new THREE.Face3(d,p,m,[g,E,y])),this.faceVertexUvs[0].push([T,b,R]);this.computeCentroids(),this.computeFaceNormals()},THREE.CylinderGeometry.prototype=new THREE.Geometry,THREE.CylinderGeometry.prototype.constructor=THREE.CylinderGeometry,THREE.ExtrudeGeometry=function(e,t){void 0!==e&&(THREE.Geometry.call(this),e=e instanceof Array?e:[e],this.shapebb=e[e.length-1].getBoundingBox(),this.addShapeList(e,t),this.computeCentroids(),this.computeFaceNormals())},THREE.ExtrudeGeometry.prototype=new THREE.Geometry,THREE.ExtrudeGeometry.prototype.constructor=THREE.ExtrudeGeometry,THREE.ExtrudeGeometry.prototype.addShapeList=function(e,t){for(var n=e.length,r=0;r<n;r++)this.addShape(e[r],t)},THREE.ExtrudeGeometry.prototype.addShape=function(e,t){function n(e,t,n){return t||console.log("die"),t.clone().multiplyScalar(n).addSelf(e)}function r(e,t,n){var r=THREE.ExtrudeGeometry.__v1,i=THREE.ExtrudeGeometry.__v2,o=THREE.ExtrudeGeometry.__v3,a=THREE.ExtrudeGeometry.__v4,s=THREE.ExtrudeGeometry.__v5,l=THREE.ExtrudeGeometry.__v6;return r.set(e.x-t.x,e.y-t.y),i.set(e.x-n.x,e.y-n.y),r=r.normalize(),i=i.normalize(),o.set(-r.y,r.x),a.set(i.y,-i.x),s.copy(e).addSelf(o),l.copy(e).addSelf(a),s.equals(l)?a.clone():(s.copy(t).addSelf(o),l.copy(n).addSelf(a),o=r.dot(a),a=l.subSelf(s).dot(a),0===o&&(console.log("Either infinite or no solutions!"),0===a?console.log("Its finite solutions."):console.log("Too bad, no solutions.")),a/=o,a<0?(t=Math.atan2(t.y-e.y,t.x-e.x),e=Math.atan2(n.y-e.y,n.x-e.x),t>e&&(e+=2*Math.PI),n=(t+e)/2,e=-Math.cos(n),n=-Math.sin(n),new THREE.Vector2(e,n)):r.multiplyScalar(a).addSelf(s).subSelf(e).clone())}function i(n,r){var i,o;for(V=n.length;--V>=0;){i=V,o=V-1,o<0&&(o=n.length-1);for(var a=0,s=g+2*m,a=0;a<s;a++){var l=U*a,c=U*(a+1),u=r+i+l,l=r+o+l,h=r+o+c,c=r+i+c,f=n,d=a,p=s,u=u+M,l=l+M,h=h+M,c=c+M;H.faces.push(new THREE.Face4(u,l,h,c,null,null,b)),u=W.generateSideWallUV(H,e,f,t,u,l,h,c,d,p),H.faceVertexUvs[0].push(u)}}}function o(e,t,n){H.vertices.push(new THREE.Vector3(e,t,n))}function a(n,r,i,o){n+=M,r+=M,i+=M,H.faces.push(new THREE.Face3(n,r,i,null,null,T)),n=o?W.generateBottomUV(H,e,t,n,r,i):W.generateTopUV(H,e,t,n,r,i),H.faceVertexUvs[0].push(n)}var s,l,c,u,h,f=void 0!==t.amount?t.amount:100,d=void 0!==t.bevelThickness?t.bevelThickness:6,p=void 0!==t.bevelSize?t.bevelSize:d-2,m=void 0!==t.bevelSegments?t.bevelSegments:3,v=void 0===t.bevelEnabled||t.bevelEnabled,g=void 0!==t.steps?t.steps:1,E=t.bendPath,y=t.extrudePath,x=!1,T=t.material,b=t.extrudeMaterial;y&&(s=y.getSpacedPoints(g),x=!0,v=!1,l=new THREE.TubeGeometry.FrenetFrames(y,g,!1),c=new THREE.Vector3,u=new THREE.Vector3,h=new THREE.Vector3),v||(p=d=m=0);var R,w,_,H=this,M=this.vertices.length;E&&e.addWrapPath(E);var y=e.extractPoints(),E=y.shape,S=y.holes;if(y=!THREE.Shape.Utils.isClockWise(E)){for(E=E.reverse(),w=0,_=S.length;w<_;w++)R=S[w],THREE.Shape.Utils.isClockWise(R)&&(S[w]=R.reverse());y=!1}var C=THREE.Shape.Utils.triangulateShape(E,S),A=E;for(w=0,_=S.length;w<_;w++)R=S[w],E=E.concat(R);var P,D,L,N,k,F,U=E.length,B=C.length,y=[],V=0;for(L=A.length,P=L-1,D=V+1;V<L;V++,P++,D++)P===L&&(P=0),D===L&&(D=0),y[V]=r(A[V],A[P],A[D]);var z,I=[],O=y.concat();for(w=0,_=S.length;w<_;w++){for(R=S[w],z=[],V=0,L=R.length,P=L-1,D=V+1;V<L;V++,P++,D++)P===L&&(P=0),D===L&&(D=0),z[V]=r(R[V],R[P],R[D]);I.push(z),O=O.concat(z)}for(P=0;P<m;P++){for(L=P/m,N=d*(1-L),D=p*Math.sin(L*Math.PI/2),V=0,L=A.length;V<L;V++)k=n(A[V],y[V],D),o(k.x,k.y,-N);for(w=0,_=S.length;w<_;w++)for(R=S[w],z=I[w],V=0,L=R.length;V<L;V++)k=n(R[V],z[V],D),o(k.x,k.y,-N)}for(D=p,V=0;V<U;V++)k=v?n(E[V],O[V],D):E[V],x?(u.copy(l.normals[0]).multiplyScalar(k.x),c.copy(l.binormals[0]).multiplyScalar(k.y),h.copy(s[0]).addSelf(u).addSelf(c),o(h.x,h.y,h.z)):o(k.x,k.y,0);for(L=1;L<=g;L++)for(V=0;V<U;V++)k=v?n(E[V],O[V],D):E[V],x?(u.copy(l.normals[L]).multiplyScalar(k.x),c.copy(l.binormals[L]).multiplyScalar(k.y),h.copy(s[L]).addSelf(u).addSelf(c),o(h.x,h.y,h.z)):o(k.x,k.y,f/g*L);for(P=m-1;P>=0;P--){for(L=P/m,N=d*(1-L),D=p*Math.sin(L*Math.PI/2),V=0,L=A.length;V<L;V++)k=n(A[V],y[V],D),o(k.x,k.y,f+N);for(w=0,_=S.length;w<_;w++)for(R=S[w],z=I[w],V=0,L=R.length;V<L;V++)k=n(R[V],z[V],D),x?o(k.x,k.y+s[g-1].y,s[g-1].x+N):o(k.x,k.y,f+N)}var W=THREE.ExtrudeGeometry.WorldUVGenerator;!function(){if(v){var e;for(e=0*U,V=0;V<B;V++)F=C[V],a(F[2]+e,F[1]+e,F[0]+e,!0);for(e=g+2*m,e*=U,V=0;V<B;V++)F=C[V],a(F[0]+e,F[1]+e,F[2]+e,!1)}else{for(V=0;V<B;V++)F=C[V],a(F[2],F[1],F[0],!0);for(V=0;V<B;V++)F=C[V],a(F[0]+U*g,F[1]+U*g,F[2]+U*g,!1)}}(),function(){var e=0;for(i(A,e),e+=A.length,w=0,_=S.length;w<_;w++)R=S[w],i(R,e),e+=R.length}()},THREE.ExtrudeGeometry.WorldUVGenerator={generateTopUV:function(e,t,n,r,i,o){return t=e.vertices[i].x,i=e.vertices[i].y,n=e.vertices[o].x,o=e.vertices[o].y,[new THREE.UV(e.vertices[r].x,1-e.vertices[r].y),new THREE.UV(t,1-i),new THREE.UV(n,1-o)]},generateBottomUV:function(e,t,n,r,i,o){return this.generateTopUV(e,t,n,r,i,o)},generateSideWallUV:function(e,t,n,r,i,o,a,s){var t=e.vertices[i].x,n=e.vertices[i].y,i=e.vertices[i].z,r=e.vertices[o].x,l=e.vertices[o].y,o=e.vertices[o].z,c=e.vertices[a].x,u=e.vertices[a].y,a=e.vertices[a].z,h=e.vertices[s].x,f=e.vertices[s].y,e=e.vertices[s].z;return Math.abs(n-l)<.01?[new THREE.UV(t,i),new THREE.UV(r,o),new THREE.UV(c,a),new THREE.UV(h,e)]:[new THREE.UV(n,i),new THREE.UV(l,o),new THREE.UV(u,a),new THREE.UV(f,e)]}},THREE.ExtrudeGeometry.__v1=new THREE.Vector2,THREE.ExtrudeGeometry.__v2=new THREE.Vector2,THREE.ExtrudeGeometry.__v3=new THREE.Vector2,THREE.ExtrudeGeometry.__v4=new THREE.Vector2,THREE.ExtrudeGeometry.__v5=new THREE.Vector2,THREE.ExtrudeGeometry.__v6=new THREE.Vector2,THREE.LatheGeometry=function(e,t,n){THREE.Geometry.call(this);for(var t=t||12,n=n||2*Math.PI,r=[],i=(new THREE.Matrix4).makeRotationZ(n/t),o=0;o<e.length;o++)r[o]=e[o].clone(),this.vertices.push(r[o]);for(var a=t+1,n=0;n<a;n++)for(o=0;o<r.length;o++)r[o]=i.multiplyVector3(r[o].clone()),this.vertices.push(r[o]);for(n=0;n<t;n++)for(r=0,i=e.length;r<i-1;r++)this.faces.push(new THREE.Face4(n*i+r,(n+1)%a*i+r,(n+1)%a*i+(r+1)%i,n*i+(r+1)%i)),this.faceVertexUvs[0].push([new THREE.UV(1-n/t,r/i),new THREE.UV(1-(n+1)/t,r/i),new THREE.UV(1-(n+1)/t,(r+1)/i),new THREE.UV(1-n/t,(r+1)/i)]);this.computeCentroids(),this.computeFaceNormals(),this.computeVertexNormals()},THREE.LatheGeometry.prototype=new THREE.Geometry,THREE.LatheGeometry.prototype.constructor=THREE.LatheGeometry,THREE.PlaneGeometry=function(e,t,n,r){THREE.Geometry.call(this);for(var i=e/2,o=t/2,n=n||1,r=r||1,a=n+1,s=r+1,l=e/n,c=t/r,u=new THREE.Vector3(0,1,0),e=0;e<s;e++)for(t=0;t<a;t++)this.vertices.push(new THREE.Vector3(t*l-i,0,e*c-o));for(e=0;e<r;e++)for(t=0;t<n;t++)i=new THREE.Face4(t+a*e,t+a*(e+1),t+1+a*(e+1),t+1+a*e),i.normal.copy(u),i.vertexNormals.push(u.clone(),u.clone(),u.clone(),u.clone()),this.faces.push(i),this.faceVertexUvs[0].push([new THREE.UV(t/n,e/r),new THREE.UV(t/n,(e+1)/r),new THREE.UV((t+1)/n,(e+1)/r),new THREE.UV((t+1)/n,e/r)]);this.computeCentroids()},THREE.PlaneGeometry.prototype=new THREE.Geometry,THREE.PlaneGeometry.prototype.constructor=THREE.PlaneGeometry,THREE.SphereGeometry=function(e,t,n,r,i,o,a){THREE.Geometry.call(this);var s,l,e=e||50,r=void 0!==r?r:0,i=void 0!==i?i:2*Math.PI,o=void 0!==o?o:0,a=void 0!==a?a:Math.PI,t=Math.max(3,Math.floor(t)||8),n=Math.max(2,Math.floor(n)||6),c=[],u=[];for(l=0;l<=n;l++){var h=[],f=[];for(s=0;s<=t;s++){var d=s/t,p=l/n,m=new THREE.Vector3;m.x=-e*Math.cos(r+d*i)*Math.sin(o+p*a),m.y=e*Math.cos(o+p*a),m.z=e*Math.sin(r+d*i)*Math.sin(o+p*a),this.vertices.push(m),h.push(this.vertices.length-1),f.push(new THREE.UV(d,p))}c.push(h),u.push(f)}for(l=0;l<n;l++)for(s=0;s<t;s++){var r=c[l][s+1],i=c[l][s],o=c[l+1][s],a=c[l+1][s+1],h=this.vertices[r].clone().normalize(),f=this.vertices[i].clone().normalize(),d=this.vertices[o].clone().normalize(),p=this.vertices[a].clone().normalize(),m=u[l][s+1].clone(),v=u[l][s].clone(),g=u[l+1][s].clone(),E=u[l+1][s+1].clone();Math.abs(this.vertices[r].y)==e?(this.faces.push(new THREE.Face3(r,o,a,[h,d,p])),this.faceVertexUvs[0].push([m,g,E])):Math.abs(this.vertices[o].y)==e?(this.faces.push(new THREE.Face3(r,i,o,[h,f,d])),this.faceVertexUvs[0].push([m,v,g])):(this.faces.push(new THREE.Face4(r,i,o,a,[h,f,d,p])),this.faceVertexUvs[0].push([m,v,g,E]))}this.computeCentroids(),this.computeFaceNormals(),this.boundingSphere={radius:e}},THREE.SphereGeometry.prototype=new THREE.Geometry,THREE.SphereGeometry.prototype.constructor=THREE.SphereGeometry,THREE.TextGeometry=function(e,t){var n=new THREE.TextPath(e,t).toShapes();if(t.amount=void 0!==t.height?t.height:50,void 0===t.bevelThickness&&(t.bevelThickness=10),void 0===t.bevelSize&&(t.bevelSize=8),void 0===t.bevelEnabled&&(t.bevelEnabled=!1),t.bend){var r=n[n.length-1].getBoundingBox().maxX;t.bendPath=new THREE.QuadraticBezierCurve(new THREE.Vector2(0,0),new THREE.Vector2(r/2,120),new THREE.Vector2(r,0))}THREE.ExtrudeGeometry.call(this,n,t)},THREE.TextGeometry.prototype=new THREE.ExtrudeGeometry,THREE.TextGeometry.prototype.constructor=THREE.TextGeometry,THREE.FontUtils={faces:{},face:"helvetiker",weight:"normal",style:"normal",size:150,divisions:10,getFace:function(){return this.faces[this.face][this.weight][this.style]},loadFace:function(e){var t=e.familyName.toLowerCase();return this.faces[t]=this.faces[t]||{},this.faces[t][e.cssFontWeight]=this.faces[t][e.cssFontWeight]||{},this.faces[t][e.cssFontWeight][e.cssFontStyle]=e,this.faces[t][e.cssFontWeight][e.cssFontStyle]=e},drawText:function(e){for(var t=this.getFace(),n=this.size/t.resolution,r=0,i=(""+e).split(""),o=i.length,a=[],e=0;e<o;e++){var s=new THREE.Path,s=this.extractGlyphPoints(i[e],t,n,r,s),r=r+s.offset;a.push(s.path)}return{paths:a,offset:r/2}},extractGlyphPoints:function(e,t,n,r,i){var o,a,s,l,c,u,h,f,d,p,m,v=[],g=t.glyphs[e]||t.glyphs["?"];if(g){if(g.o)for(t=g._cachedOutline||(g._cachedOutline=g.o.split(" ")),l=t.length,e=0;e<l;)switch(s=t[e++]){case"m":s=t[e++]*n+r,c=t[e++]*n,v.push(new THREE.Vector2(s,c)),i.moveTo(s,c);break;case"l":s=t[e++]*n+r,c=t[e++]*n,v.push(new THREE.Vector2(s,c)),i.lineTo(s,c);break;case"q":if(s=t[e++]*n+r,c=t[e++]*n,f=t[e++]*n+r,d=t[e++]*n,i.quadraticCurveTo(f,d,s,c),o=v[v.length-1])for(u=o.x,h=o.y,o=1,a=this.divisions;o<=a;o++){var E=o/a,y=THREE.Shape.Utils.b2(E,u,f,s),E=THREE.Shape.Utils.b2(E,h,d,c);v.push(new THREE.Vector2(y,E))}break;case"b":if(s=t[e++]*n+r,c=t[e++]*n,f=t[e++]*n+r,d=t[e++]*-n,p=t[e++]*n+r,m=t[e++]*-n,i.bezierCurveTo(s,c,f,d,p,m),o=v[v.length-1])for(u=o.x,h=o.y,o=1,a=this.divisions;o<=a;o++)E=o/a,y=THREE.Shape.Utils.b3(E,u,f,p,s),E=THREE.Shape.Utils.b3(E,h,d,m,c),v.push(new THREE.Vector2(y,E))}return{offset:g.ha*n,points:v,path:i}}}},function(e){var t=function(e){for(var t=e.length,n=0,r=t-1,i=0;i<t;r=i++)n+=e[r].x*e[i].y-e[i].x*e[r].y;return.5*n};e.Triangulate=function(e,n){var r=e.length;if(r<3)return null;var i,o,a,s=[],l=[],c=[];if(t(e)>0)for(o=0;o<r;o++)l[o]=o;else for(o=0;o<r;o++)l[o]=r-1-o;var u=2*r;for(o=r-1;r>2;){if(u--<=0){console.log("Warning, unable to triangulate polygon!");break}i=o,r<=i&&(i=0),o=i+1,r<=o&&(o=0),a=o+1,r<=a&&(a=0);var h;e:{h=e;var f=i,d=o,p=a,m=r,v=l,g=void 0,E=void 0,y=void 0,x=void 0,T=void 0,b=void 0,R=void 0,w=void 0,_=void 0,E=h[v[f]].x,y=h[v[f]].y,x=h[v[d]].x,T=h[v[d]].y,b=h[v[p]].x,R=h[v[p]].y;if(1e-10>(x-E)*(R-y)-(T-y)*(b-E))h=!1;else{for(g=0;g<m;g++)if(g!=f&&g!=d&&g!=p){var w=h[v[g]].x,_=h[v[g]].y,H=void 0,M=void 0,S=void 0,C=void 0,A=void 0,P=void 0,D=void 0,L=void 0,N=void 0,k=void 0,F=void 0,U=void 0,H=S=A=void 0,H=b-x,M=R-T,S=E-b,C=y-R,A=x-E,P=T-y,D=w-E,L=_-y,N=w-x,k=_-T,F=w-b,U=_-R,H=H*k-M*N,A=A*L-P*D,S=S*U-C*F;if(H>=0&&S>=0&&A>=0){h=!1;break e}}h=!0}}if(h){for(s.push([e[l[i]],e[l[o]],e[l[a]]]),c.push([l[i],l[o],l[a]]),i=o,a=o+1;a<r;i++,a++)l[i]=l[a];r--,u=2*r}}return n?c:s},e.Triangulate.area=t}(THREE.FontUtils),self._typeface_js={faces:THREE.FontUtils.faces,loadFace:THREE.FontUtils.loadFace},THREE.TorusGeometry=function(e,t,n,r,i){for(THREE.Geometry.call(this),this.radius=e||100,this.tube=t||40,this.segmentsR=n||8,this.segmentsT=r||6,this.arc=i||2*Math.PI,i=new THREE.Vector3,e=[],t=[],n=0;n<=this.segmentsR;n++)for(r=0;r<=this.segmentsT;r++){var o=r/this.segmentsT*this.arc,a=n/this.segmentsR*Math.PI*2;i.x=this.radius*Math.cos(o),i.y=this.radius*Math.sin(o);var s=new THREE.Vector3;s.x=(this.radius+this.tube*Math.cos(a))*Math.cos(o),s.y=(this.radius+this.tube*Math.cos(a))*Math.sin(o),s.z=this.tube*Math.sin(a),this.vertices.push(s),e.push(new THREE.UV(r/this.segmentsT,1-n/this.segmentsR)),t.push(s.clone().subSelf(i).normalize())}for(n=1;n<=this.segmentsR;n++)for(r=1;r<=this.segmentsT;r++){var i=(this.segmentsT+1)*n+r-1,o=(this.segmentsT+1)*(n-1)+r-1,a=(this.segmentsT+1)*(n-1)+r,s=(this.segmentsT+1)*n+r,l=new THREE.Face4(i,o,a,s,[t[i],t[o],t[a],t[s]]);l.normal.addSelf(t[i]),l.normal.addSelf(t[o]),l.normal.addSelf(t[a]),l.normal.addSelf(t[s]),l.normal.normalize(),this.faces.push(l),this.faceVertexUvs[0].push([e[i].clone(),e[o].clone(),e[a].clone(),e[s].clone()])}this.computeCentroids()},THREE.TorusGeometry.prototype=new THREE.Geometry,THREE.TorusGeometry.prototype.constructor=THREE.TorusGeometry,THREE.TorusKnotGeometry=function(e,t,n,r,i,o,a){function s(e,t,n,r,i,o){var a=Math.cos(e);return Math.cos(t),t=Math.sin(e),e*=n/r,n=Math.cos(e),a*=i*(2+n)*.5,t=i*(2+n)*t*.5,i=o*i*Math.sin(e)*.5,new THREE.Vector3(a,t,i)}for(THREE.Geometry.call(this),this.radius=e||200,this.tube=t||40,this.segmentsR=n||64,this.segmentsT=r||8,this.p=i||2,this.q=o||3,this.heightScale=a||1,this.grid=Array(this.segmentsR),n=new THREE.Vector3,r=new THREE.Vector3,i=new THREE.Vector3,e=0;e<this.segmentsR;++e)for(this.grid[e]=Array(this.segmentsT),t=0;t<this.segmentsT;++t){var l=e/this.segmentsR*2*this.p*Math.PI,a=t/this.segmentsT*2*Math.PI,o=s(l,a,this.q,this.p,this.radius,this.heightScale),l=s(l+.01,a,this.q,this.p,this.radius,this.heightScale);n.sub(l,o),r.add(l,o),i.cross(n,r),r.cross(i,n),i.normalize(),r.normalize(),l=-this.tube*Math.cos(a),a=this.tube*Math.sin(a),o.x=o.x+(l*r.x+a*i.x),o.y=o.y+(l*r.y+a*i.y),o.z=o.z+(l*r.z+a*i.z),this.grid[e][t]=this.vertices.push(new THREE.Vector3(o.x,o.y,o.z))-1}for(e=0;e<this.segmentsR;++e)for(t=0;t<this.segmentsT;++t){var i=(e+1)%this.segmentsR,o=(t+1)%this.segmentsT,n=this.grid[e][t],r=this.grid[i][t],i=this.grid[i][o],o=this.grid[e][o],a=new THREE.UV(e/this.segmentsR,t/this.segmentsT),l=new THREE.UV((e+1)/this.segmentsR,t/this.segmentsT),c=new THREE.UV((e+1)/this.segmentsR,(t+1)/this.segmentsT),u=new THREE.UV(e/this.segmentsR,(t+1)/this.segmentsT);this.faces.push(new THREE.Face4(n,r,i,o)),this.faceVertexUvs[0].push([a,l,c,u])}this.computeCentroids(),this.computeFaceNormals(),this.computeVertexNormals()},THREE.TorusKnotGeometry.prototype=new THREE.Geometry,THREE.TorusKnotGeometry.prototype.constructor=THREE.TorusKnotGeometry,THREE.TubeGeometry=function(e,t,n,r,i,o){THREE.Geometry.call(this),this.path=e,this.segments=t||64,this.radius=n||1,this.segmentsRadius=r||8,this.closed=i||!1,o&&(this.debug=new THREE.Object3D),this.grid=[];var a,s,l,c,u,h,f,d,o=this.segments+1,p=new THREE.Vector3,t=new THREE.TubeGeometry.FrenetFrames(e,t,i);for(h=t.tangents,f=t.normals,d=t.binormals,this.tangents=h,this.normals=f,this.binormals=d,t=0;t<o;t++)for(this.grid[t]=[],r=t/(o-1),u=e.getPointAt(r),r=h[t],a=f[t],s=d[t],this.debug&&(this.debug.add(new THREE.ArrowHelper(r,u,n,255)),this.debug.add(new THREE.ArrowHelper(a,u,n,16711680)),this.debug.add(new THREE.ArrowHelper(s,u,n,65280))),r=0;r<this.segmentsRadius;r++)l=r/this.segmentsRadius*2*Math.PI,c=-this.radius*Math.cos(l),l=this.radius*Math.sin(l),p.copy(u),p.x=p.x+(c*a.x+l*s.x),p.y=p.y+(c*a.y+l*s.y),p.z=p.z+(c*a.z+l*s.z),this.grid[t][r]=this.vertices.push(new THREE.Vector3(p.x,p.y,p.z))-1;for(t=0;t<this.segments;t++)for(r=0;r<this.segmentsRadius;r++)o=i?(t+1)%this.segments:t+1,p=(r+1)%this.segmentsRadius,e=this.grid[t][r],n=this.grid[o][r],o=this.grid[o][p],p=this.grid[t][p],h=new THREE.UV(t/this.segments,r/this.segmentsRadius),f=new THREE.UV((t+1)/this.segments,r/this.segmentsRadius),d=new THREE.UV((t+1)/this.segments,(r+1)/this.segmentsRadius),a=new THREE.UV(t/this.segments,(r+1)/this.segmentsRadius),this.faces.push(new THREE.Face4(e,n,o,p)),this.faceVertexUvs[0].push([h,f,d,a]);this.computeCentroids(),this.computeFaceNormals(),this.computeVertexNormals()},THREE.TubeGeometry.prototype=new THREE.Geometry,THREE.TubeGeometry.prototype.constructor=THREE.TubeGeometry,THREE.TubeGeometry.FrenetFrames=function(e,t,n){new THREE.Vector3;var r=new THREE.Vector3;new THREE.Vector3;var i,o,a,s=[],l=[],c=[],u=new THREE.Vector3,h=new THREE.Matrix4,t=t+1;for(this.tangents=s,this.normals=l,this.binormals=c,i=0;i<t;i++)o=i/(t-1),s[i]=e.getTangentAt(o),s[i].normalize();for(l[0]=new THREE.Vector3,c[0]=new THREE.Vector3,e=Number.MAX_VALUE,i=Math.abs(s[0].x),o=Math.abs(s[0].y),a=Math.abs(s[0].z),i<=e&&(e=i,r.set(1,0,0)),o<=e&&(e=o,r.set(0,1,0)),a<=e&&r.set(0,0,1),u.cross(s[0],r).normalize(),l[0].cross(s[0],u),c[0].cross(s[0],l[0]),i=1;i<t;i++)l[i]=l[i-1].clone(),c[i]=c[i-1].clone(),u.cross(s[i-1],s[i]),u.length()>1e-4&&(u.normalize(),r=Math.acos(s[i-1].dot(s[i])),h.makeRotationAxis(u,r).multiplyVector3(l[i])),c[i].cross(s[i],l[i]);if(n)for(r=Math.acos(l[0].dot(l[t-1])),r/=t-1,s[0].dot(u.cross(l[0],l[t-1]))>0&&(r=-r),i=1;i<t;i++)h.makeRotationAxis(s[i],r*i).multiplyVector3(l[i]),c[i].cross(s[i],l[i])},THREE.PolyhedronGeometry=function(e,t,n,r){function i(e){var t=e.normalize().clone();t.index=l.vertices.push(t)-1;var n=Math.atan2(e.z,-e.x)/2/Math.PI+.5,e=Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))/Math.PI+.5;return t.uv=new THREE.UV(n,e),t}function o(e,t,n,r){r<1?(r=new THREE.Face3(e.index,t.index,n.index,[e.clone(),t.clone(),n.clone()]),r.centroid.addSelf(e).addSelf(t).addSelf(n).divideScalar(3),r.normal=r.centroid.clone().normalize(),l.faces.push(r),r=Math.atan2(r.centroid.z,-r.centroid.x),l.faceVertexUvs[0].push([s(e.uv,e,r),s(t.uv,t,r),s(n.uv,n,r)])):(r-=1,o(e,a(e,t),a(e,n),r),o(a(e,t),t,a(t,n),r),o(a(e,n),a(t,n),n,r),o(a(e,t),a(t,n),a(e,n),r))}function a(e,t){h[e.index]||(h[e.index]=[]),h[t.index]||(h[t.index]=[]);var n=h[e.index][t.index];return void 0===n&&(h[e.index][t.index]=h[t.index][e.index]=n=i((new THREE.Vector3).add(e,t).divideScalar(2))),n}function s(e,t,n){return n<0&&1===e.u&&(e=new THREE.UV(e.u-1,e.v)),0===t.x&&0===t.z&&(e=new THREE.UV(n/2/Math.PI+.5,e.v)),e}THREE.Geometry.call(this);for(var n=n||1,r=r||0,l=this,c=0,u=e.length;c<u;c++)i(new THREE.Vector3(e[c][0],e[c][1],e[c][2]));for(var h=[],e=this.vertices,c=0,u=t.length;c<u;c++)o(e[t[c][0]],e[t[c][1]],e[t[c][2]],r);for(this.mergeVertices(),c=0,u=this.vertices.length;c<u;c++)this.vertices[c].multiplyScalar(n);this.computeCentroids(),this.boundingSphere={radius:n}},THREE.PolyhedronGeometry.prototype=new THREE.Geometry,THREE.PolyhedronGeometry.prototype.constructor=THREE.PolyhedronGeometry,THREE.IcosahedronGeometry=function(e,t){var n=(1+Math.sqrt(5))/2;THREE.PolyhedronGeometry.call(this,[[-1,n,0],[1,n,0],[-1,-n,0],[1,-n,0],[0,-1,n],[0,1,n],[0,-1,-n],[0,1,-n],[n,0,-1],[n,0,1],[-n,0,-1],[-n,0,1]],[[0,11,5],[0,5,1],[0,1,7],[0,7,10],[0,10,11],[1,5,9],[5,11,4],[11,10,2],[10,7,6],[7,1,8],[3,9,4],[3,4,2],[3,2,6],[3,6,8],[3,8,9],[4,9,5],[2,4,11],[6,2,10],[8,6,7],[9,8,1]],e,t)},THREE.IcosahedronGeometry.prototype=new THREE.Geometry,THREE.IcosahedronGeometry.prototype.constructor=THREE.IcosahedronGeometry,THREE.OctahedronGeometry=function(e,t){THREE.PolyhedronGeometry.call(this,[[1,0,0],[-1,0,0],[0,1,0],[0,-1,0],[0,0,1],[0,0,-1]],[[0,2,4],[0,4,3],[0,3,5],[0,5,2],[1,2,5],[1,5,3],[1,3,4],[1,4,2]],e,t)},THREE.OctahedronGeometry.prototype=new THREE.Geometry,THREE.OctahedronGeometry.prototype.constructor=THREE.OctahedronGeometry,THREE.TetrahedronGeometry=function(e,t){THREE.PolyhedronGeometry.call(this,[[1,1,1],[-1,-1,1],[-1,1,-1],[1,-1,-1]],[[2,1,0],[0,3,2],[1,3,0],[2,3,1]],e,t)},THREE.TetrahedronGeometry.prototype=new THREE.Geometry,THREE.TetrahedronGeometry.prototype.constructor=THREE.TetrahedronGeometry,THREE.ParametricGeometry=function(e,t,n,r){THREE.Geometry.call(this);var i,o,a,s,l=this.vertices,c=this.faces,u=this.faceVertexUvs[0],r=void 0!==r&&r,h=t+1;for(i=0;i<=n;i++)for(s=i/n,o=0;o<=t;o++)a=o/t,a=e(a,s),l.push(a);var f,d,p,m;for(i=0;i<n;i++)for(o=0;o<t;o++)e=i*h+o,l=i*h+o+1,s=(i+1)*h+o,a=(i+1)*h+o+1,f=new THREE.UV(i/t,o/n),d=new THREE.UV(i/t,(o+1)/n),p=new THREE.UV((i+1)/t,o/n),m=new THREE.UV((i+1)/t,(o+1)/n),r?(c.push(new THREE.Face3(e,l,s)),c.push(new THREE.Face3(l,a,s)),u.push([f,d,p]),u.push([d,m,p])):(c.push(new THREE.Face4(e,l,a,s)),u.push([f,d,p,m]));this.computeCentroids(),this.computeFaceNormals(),this.computeVertexNormals()},THREE.ParametricGeometry.prototype=new THREE.Geometry,THREE.ParametricGeometry.prototype.constructor=THREE.ParametricGeometry,THREE.AxisHelper=function(){THREE.Object3D.call(this);var e=new THREE.Geometry;e.vertices.push(new THREE.Vector3),e.vertices.push(new THREE.Vector3(0,100,0));var t,n=new THREE.CylinderGeometry(0,5,25,5,1);t=new THREE.Line(e,new THREE.LineBasicMaterial({color:16711680})),t.rotation.z=-Math.PI/2,this.add(t),t=new THREE.Mesh(n,new THREE.MeshBasicMaterial({color:16711680})),t.position.x=100,t.rotation.z=-Math.PI/2,this.add(t),t=new THREE.Line(e,new THREE.LineBasicMaterial({color:65280})),this.add(t),t=new THREE.Mesh(n,new THREE.MeshBasicMaterial({color:65280})),t.position.y=100,this.add(t),t=new THREE.Line(e,new THREE.LineBasicMaterial({color:255})),t.rotation.x=Math.PI/2,this.add(t),t=new THREE.Mesh(n,new THREE.MeshBasicMaterial({color:255})),t.position.z=100,t.rotation.x=Math.PI/2,this.add(t)},THREE.AxisHelper.prototype=new THREE.Object3D,THREE.AxisHelper.prototype.constructor=THREE.AxisHelper,THREE.ArrowHelper=function(e,t,n,r){THREE.Object3D.call(this),void 0===r&&(r=16776960),void 0===n&&(n=20);var i=new THREE.Geometry;i.vertices.push(new THREE.Vector3(0,0,0)),i.vertices.push(new THREE.Vector3(0,1,0)),this.line=new THREE.Line(i,new THREE.LineBasicMaterial({color:r})),this.add(this.line),i=new THREE.CylinderGeometry(0,.05,.25,5,1),this.cone=new THREE.Mesh(i,new THREE.MeshBasicMaterial({color:r})),this.cone.position.set(0,1,0),this.add(this.cone),t instanceof THREE.Vector3&&(this.position=t),this.setDirection(e),this.setLength(n)},THREE.ArrowHelper.prototype=new THREE.Object3D,THREE.ArrowHelper.prototype.constructor=THREE.ArrowHelper,THREE.ArrowHelper.prototype.setDirection=function(e){var t=new THREE.Vector3(0,1,0).crossSelf(e),e=Math.acos(new THREE.Vector3(0,1,0).dot(e.clone().normalize()));this.matrix=(new THREE.Matrix4).makeRotationAxis(t.normalize(),e),this.rotation.getRotationFromMatrix(this.matrix,this.scale)},THREE.ArrowHelper.prototype.setLength=function(e){this.scale.set(e,e,e)},THREE.ArrowHelper.prototype.setColor=function(e){this.line.material.color.setHex(e),this.cone.material.color.setHex(e)},THREE.CameraHelper=function(e){function t(e,t,r){n(e,r),n(t,r)}function n(e,t){r.lineGeometry.vertices.push(new THREE.Vector3),r.lineGeometry.colors.push(new THREE.Color(t)),void 0===r.pointMap[e]&&(r.pointMap[e]=[]),r.pointMap[e].push(r.lineGeometry.vertices.length-1)}THREE.Object3D.call(this);var r=this;this.lineGeometry=new THREE.Geometry,this.lineMaterial=new THREE.LineBasicMaterial({color:16777215,vertexColors:THREE.FaceColors}),this.pointMap={},t("n1","n2",16755200),t("n2","n4",16755200),t("n4","n3",16755200),t("n3","n1",16755200),t("f1","f2",16755200),t("f2","f4",16755200),t("f4","f3",16755200),t("f3","f1",16755200),t("n1","f1",16755200),t("n2","f2",16755200),t("n3","f3",16755200),t("n4","f4",16755200),t("p","n1",16711680),t("p","n2",16711680),t("p","n3",16711680),t("p","n4",16711680),t("u1","u2",43775),t("u2","u3",43775),t("u3","u1",43775),t("c","t",16777215),t("p","c",3355443),t("cn1","cn2",3355443),t("cn3","cn4",3355443),t("cf1","cf2",3355443),t("cf3","cf4",3355443),this.camera=e,this.update(e),this.lines=new THREE.Line(this.lineGeometry,this.lineMaterial,THREE.LinePieces),this.add(this.lines)},THREE.CameraHelper.prototype=new THREE.Object3D,THREE.CameraHelper.prototype.constructor=THREE.CameraHelper,THREE.CameraHelper.prototype.update=function(){function e(e,n,r,i){if(THREE.CameraHelper.__v.set(n,r,i),THREE.CameraHelper.__projector.unprojectVector(THREE.CameraHelper.__v,THREE.CameraHelper.__c),void 0!==(e=t.pointMap[e]))for(n=0,r=e.length;n<r;n++)t.lineGeometry.vertices[e[n]].copy(THREE.CameraHelper.__v)}var t=this;THREE.CameraHelper.__c.projectionMatrix.copy(this.camera.projectionMatrix),e("c",0,0,-1),e("t",0,0,1),e("n1",-1,-1,-1),e("n2",1,-1,-1),e("n3",-1,1,-1),e("n4",1,1,-1),e("f1",-1,-1,1),e("f2",1,-1,1),e("f3",-1,1,1),e("f4",1,1,1),e("u1",.7,1.1,-1),e("u2",-.7,1.1,-1),e("u3",0,2,-1),e("cf1",-1,0,1),e("cf2",1,0,1),e("cf3",0,-1,1),e("cf4",0,1,1),e("cn1",-1,0,-1),e("cn2",1,0,-1),e("cn3",0,-1,-1),e("cn4",0,1,-1),this.lineGeometry.verticesNeedUpdate=!0},THREE.CameraHelper.__projector=new THREE.Projector,THREE.CameraHelper.__v=new THREE.Vector3,THREE.CameraHelper.__c=new THREE.Camera,THREE.SubdivisionModifier=function(e){this.subdivisions=void 0===e?1:e,this.useOldVertexColors=!1,this.supportUVs=!0,this.debug=!1},THREE.SubdivisionModifier.prototype.constructor=THREE.SubdivisionModifier,THREE.SubdivisionModifier.prototype.modify=function(e){for(var t=this.subdivisions;t-- >0;)this.smooth(e)},THREE.SubdivisionModifier.prototype.smooth=function(e){function t(){E.debug&&console.log.apply(console,arguments)}function n(){console&&console.log.apply(console,arguments)}function r(e,n,r,i,a,s,l){var c=new THREE.Face4(e,n,r,i,null,a.color,a.material);if(E.useOldVertexColors){c.vertexColors=[];for(var u,h,f,d=0;d<4;d++){f=s[d],u=new THREE.Color,u.setRGB(0,0,0);for(var p=0;p<f.length;p++)h=a.vertexColors[f[p]-1],u.r=u.r+h.r,u.g=u.g+h.g,u.b=u.b+h.b;u.r=u.r/f.length,u.g=u.g/f.length,u.b=u.b/f.length,c.vertexColors[d]=u}}v.push(c),E.supportUVs&&(a=[o(e,""),o(n,l),o(r,l),o(i,l)],a[0]?a[1]?a[2]?a[3]?g.push(a):t("d :( ",i+":"+l):t("c :( ",r+":"+l):t("b :( ",n+":"+l):t("a :( ",e+":"+l))}function i(e,t){return Math.min(e,t)+"_"+Math.max(e,t)}function o(e,r){var i=e+":"+r,o=w[i];return o||(t(e>=_&&e<_+x.length?"face pt":"edge pt"),n("warning, UV not found for",i),null)}function a(e,t,r){var i=e+":"+t;i in w?n("dup vertexNo",e,"oldFaceNo",t,"value",r,"key",i,w[i]):w[i]=r}function s(e,t){void 0===C[e]&&(C[e]=[]),C[e].push(t)}function l(e,t,n){void 0===A[e]&&(A[e]={}),A[e][t]=n}var c,u,h,f,d,p,m=[],v=[],g=[],E=this,y=e.vertices,x=e.faces,m=y.concat(),T=[],b={},R={},w={},_=y.length,H=e.faceVertexUvs[0];if(t("originalFaces, uvs, originalVerticesLength",x.length,H.length,_),E.supportUVs)for(c=0,u=H.length;c<u;c++)for(h=0,f=H[c].length;h<f;h++)p=x[c]["abcd".charAt(h)],a(p,c,H[c][h]);0==H.length&&(E.supportUVs=!1),c=0;for(d in w)c++;for(c||(E.supportUVs=!1,t("no uvs")),t("-- Original Faces + Vertices UVs completed",w,"vs",H.length),c=0,u=x.length;c<u;c++)d=x[c],T.push(d.centroid),m.push(d.centroid),E.supportUVs&&(H=new THREE.UV,d instanceof THREE.Face3?(H.u=o(d.a,c).u+o(d.b,c).u+o(d.c,c).u,H.v=o(d.a,c).v+o(d.b,c).v+o(d.c,c).v,H.u=H.u/3,H.v=H.v/3):d instanceof THREE.Face4&&(H.u=o(d.a,c).u+o(d.b,c).u+o(d.c,c).u+o(d.d,c).u,H.v=o(d.a,c).v+o(d.b,c).v+o(d.c,c).v+o(d.d,c).v,H.u=H.u/4,H.v=H.v/4),a(_+c,"",H));t("-- added UVs for new Faces",w),u=function(e){function t(e,t){void 0===s[e]&&(s[e]=[]),s[e].push(t)}var n,r,o,a,s={};for(n=0,r=e.faces.length;n<r;n++)o=e.faces[n],o instanceof THREE.Face3?(a=i(o.a,o.b),t(a,n),a=i(o.b,o.c),t(a,n),a=i(o.c,o.a),t(a,n)):o instanceof THREE.Face4&&(a=i(o.a,o.b),t(a,n),a=i(o.b,o.c),t(a,n),a=i(o.c,o.d),t(a,n),a=i(o.d,o.a),t(a,n));return s}(e),p=0;var M,S,C={},A={};for(c in u){for(H=u[c],M=c.split("_"),S=M[0],M=M[1],s(S,[S,M]),s(M,[S,M]),h=0,f=H.length;h<f;h++)d=H[h],l(S,d,c),l(M,d,c);H.length<2&&(R[c]=!0)}t("vertexEdgeMap",C,"vertexFaceMap",A);for(c in u)H=u[c],d=H[0],f=H[1],M=c.split("_"),S=M[0],M=M[1],H=new THREE.Vector3,R[c]?(H.addSelf(y[S]),H.addSelf(y[M]),H.multiplyScalar(.5)):(H.addSelf(T[d]),H.addSelf(T[f]),H.addSelf(y[S]),H.addSelf(y[M]),H.multiplyScalar(.25)),b[c]=_+x.length+p,m.push(H),p++,
E.supportUVs&&(H=new THREE.UV,H.u=o(S,d).u+o(M,d).u,H.v=o(S,d).v+o(M,d).v,H.u=H.u/2,H.v=H.v/2,a(b[c],d,H),R[c]||(H=new THREE.UV,H.u=o(S,f).u+o(M,f).u,H.v=o(S,f).v+o(M,f).v,H.u=H.u/2,H.v=H.v/2,a(b[c],f,H)));t("-- Step 2 done");var P,D;f=["123","12","2","23"],M=["123","23","3","31"];var L=["123","31","1","12"],N=["1234","12","2","23"],k=["1234","23","3","34"],F=["1234","34","4","41"],U=["1234","41","1","12"];for(c=0,u=T.length;c<u;c++)d=x[c],H=_+c,d instanceof THREE.Face3?(p=i(d.a,d.b),S=i(d.b,d.c),P=i(d.c,d.a),r(H,b[p],d.b,b[S],d,f,c),r(H,b[S],d.c,b[P],d,M,c),r(H,b[P],d.a,b[p],d,L,c)):d instanceof THREE.Face4?(p=i(d.a,d.b),S=i(d.b,d.c),P=i(d.c,d.d),D=i(d.d,d.a),r(H,b[p],d.b,b[S],d,N,c),r(H,b[S],d.c,b[P],d,k,c),r(H,b[P],d.d,b[D],d,F,c),r(H,b[D],d.a,b[p],d,U,c)):t("face should be a face!",d);for(b=new THREE.Vector3,d=new THREE.Vector3,c=0,u=y.length;c<u;c++)if(void 0!==C[c]){b.set(0,0,0),d.set(0,0,0),S=new THREE.Vector3(0,0,0),H=0;for(h in A[c])b.addSelf(T[h]),H++;for(f=0,p=C[c].length,h=0;h<p;h++)R[i(C[c][h][0],C[c][h][1])]&&f++;if(2!=f){for(b.divideScalar(H),h=0;h<p;h++)H=C[c][h],H=y[H[0]].clone().addSelf(y[H[1]]).divideScalar(2),d.addSelf(H);d.divideScalar(p),S.addSelf(y[c]),S.multiplyScalar(p-3),S.addSelf(b),S.addSelf(d.multiplyScalar(2)),S.divideScalar(p),m[c]=S}}e.vertices=m,e.faces=v,e.faceVertexUvs[0]=g,delete e.__tmpVertices,e.computeCentroids(),e.computeFaceNormals(),e.computeVertexNormals()},THREE.ImmediateRenderObject=function(){THREE.Object3D.call(this),this.render=function(){}},THREE.ImmediateRenderObject.prototype=new THREE.Object3D,THREE.ImmediateRenderObject.prototype.constructor=THREE.ImmediateRenderObject,THREE.LensFlare=function(e,t,n,r,i){THREE.Object3D.call(this),this.lensFlares=[],this.positionScreen=new THREE.Vector3,this.customUpdateCallback=void 0,void 0!==e&&this.add(e,t,n,r,i)},THREE.LensFlare.prototype=new THREE.Object3D,THREE.LensFlare.prototype.constructor=THREE.LensFlare,THREE.LensFlare.prototype.supr=THREE.Object3D.prototype,THREE.LensFlare.prototype.add=function(e,t,n,r,i,o){void 0===t&&(t=-1),void 0===n&&(n=0),void 0===o&&(o=1),void 0===i&&(i=new THREE.Color(16777215)),void 0===r&&(r=THREE.NormalBlending),n=Math.min(n,Math.max(0,n)),this.lensFlares.push({texture:e,size:t,distance:n,x:0,y:0,z:0,scale:1,rotation:1,opacity:o,color:i,blending:r})},THREE.LensFlare.prototype.updateLensFlares=function(){var e,t,n=this.lensFlares.length,r=2*-this.positionScreen.x,i=2*-this.positionScreen.y;for(e=0;e<n;e++)t=this.lensFlares[e],t.x=this.positionScreen.x+r*t.distance,t.y=this.positionScreen.y+i*t.distance,t.wantedRotation=t.x*Math.PI*.25,t.rotation=t.rotation+.25*(t.wantedRotation-t.rotation)},THREE.MorphBlendMesh=function(e,t){THREE.Mesh.call(this,e,t),this.animationsMap={},this.animationsList=[];var n=this.geometry.morphTargets.length;this.createAnimation("__default",0,n-1,n/1),this.setAnimationWeight("__default",1)},THREE.MorphBlendMesh.prototype=new THREE.Mesh,THREE.MorphBlendMesh.prototype.constructor=THREE.MorphBlendMesh,THREE.MorphBlendMesh.prototype.createAnimation=function(e,t,n,r){t={startFrame:t,endFrame:n,length:n-t+1,fps:r,duration:(n-t)/r,lastFrame:0,currentFrame:0,active:!1,time:0,direction:1,weight:1,directionBackwards:!1,mirroredLoop:!1},this.animationsMap[e]=t,this.animationsList.push(t)},THREE.MorphBlendMesh.prototype.autoCreateAnimations=function(e){for(var t,n=/([a-z]+)(\d+)/,r={},i=this.geometry,o=0,a=i.morphTargets.length;o<a;o++){var s=i.morphTargets[o].name.match(n);if(s&&s.length>1){var l=s[1];r[l]||(r[l]={start:1/0,end:-1/0}),s=r[l],o<s.start&&(s.start=o),o>s.end&&(s.end=o),t||(t=l)}}for(l in r)s=r[l],this.createAnimation(l,s.start,s.end,e);this.firstAnimation=t},THREE.MorphBlendMesh.prototype.setAnimationDirectionForward=function(e){(e=this.animationsMap[e])&&(e.direction=1,e.directionBackwards=!1)},THREE.MorphBlendMesh.prototype.setAnimationDirectionBackward=function(e){(e=this.animationsMap[e])&&(e.direction=-1,e.directionBackwards=!0)},THREE.MorphBlendMesh.prototype.setAnimationFPS=function(e,t){var n=this.animationsMap[e];n&&(n.fps=t,n.duration=(n.end-n.start)/n.fps)},THREE.MorphBlendMesh.prototype.setAnimationDuration=function(e,t){var n=this.animationsMap[e];n&&(n.duration=t,n.fps=(n.end-n.start)/n.duration)},THREE.MorphBlendMesh.prototype.setAnimationWeight=function(e,t){var n=this.animationsMap[e];n&&(n.weight=t)},THREE.MorphBlendMesh.prototype.setAnimationTime=function(e,t){var n=this.animationsMap[e];n&&(n.time=t)},THREE.MorphBlendMesh.prototype.getAnimationTime=function(e){var t=0;return(e=this.animationsMap[e])&&(t=e.time),t},THREE.MorphBlendMesh.prototype.getAnimationDuration=function(e){var t=-1;return(e=this.animationsMap[e])&&(t=e.duration),t},THREE.MorphBlendMesh.prototype.playAnimation=function(e){var t=this.animationsMap[e];t?(t.time=0,t.active=!0):console.warn("animation["+e+"] undefined")},THREE.MorphBlendMesh.prototype.stopAnimation=function(e){(e=this.animationsMap[e])&&(e.active=!1)},THREE.MorphBlendMesh.prototype.update=function(e){for(var t=0,n=this.animationsList.length;t<n;t++){var r=this.animationsList[t];if(r.active){var i=r.duration/r.length;r.time=r.time+r.direction*e,r.mirroredLoop?(r.time>r.duration||r.time<0)&&(r.direction=-1*r.direction,r.time>r.duration&&(r.time=r.duration,r.directionBackwards=!0),r.time<0&&(r.time=0,r.directionBackwards=!1)):(r.time=r.time%r.duration,r.time<0&&(r.time=r.time+r.duration));var o=r.startFrame+THREE.Math.clamp(Math.floor(r.time/i),0,r.length-1),a=r.weight;o!==r.currentFrame&&(this.morphTargetInfluences[r.lastFrame]=0,this.morphTargetInfluences[r.currentFrame]=1*a,this.morphTargetInfluences[o]=0,r.lastFrame=r.currentFrame,r.currentFrame=o),i=r.time%i/i,r.directionBackwards&&(i=1-i),this.morphTargetInfluences[r.currentFrame]=i*a,this.morphTargetInfluences[r.lastFrame]=(1-i)*a}}},THREE.LensFlarePlugin=function(){function e(e){var n=t.createProgram(),r=t.createShader(t.FRAGMENT_SHADER),i=t.createShader(t.VERTEX_SHADER);return t.shaderSource(r,e.fragmentShader),t.shaderSource(i,e.vertexShader),t.compileShader(r),t.compileShader(i),t.attachShader(n,r),t.attachShader(n,i),t.linkProgram(n),n}var t,n,r,i,o,a,s,l,c,u,h,f,d;this.init=function(p){t=p.context,n=p,r=new Float32Array(16),i=new Uint16Array(6),p=0,r[p++]=-1,r[p++]=-1,r[p++]=0,r[p++]=0,r[p++]=1,r[p++]=-1,r[p++]=1,r[p++]=0,r[p++]=1,r[p++]=1,r[p++]=1,r[p++]=1,r[p++]=-1,r[p++]=1,r[p++]=0,r[p++]=1,p=0,i[p++]=0,i[p++]=1,i[p++]=2,i[p++]=0,i[p++]=2,i[p++]=3,o=t.createBuffer(),a=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,o),t.bufferData(t.ARRAY_BUFFER,r,t.STATIC_DRAW),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,a),t.bufferData(t.ELEMENT_ARRAY_BUFFER,i,t.STATIC_DRAW),s=t.createTexture(),l=t.createTexture(),t.bindTexture(t.TEXTURE_2D,s),t.texImage2D(t.TEXTURE_2D,0,t.RGB,16,16,0,t.RGB,t.UNSIGNED_BYTE,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.bindTexture(t.TEXTURE_2D,l),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,16,16,0,t.RGBA,t.UNSIGNED_BYTE,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.getParameter(t.MAX_VERTEX_TEXTURE_IMAGE_UNITS)<=0?(c=!1,u=e(THREE.ShaderFlares.lensFlare)):(c=!0,u=e(THREE.ShaderFlares.lensFlareVertexTexture)),h={},f={},h.vertex=t.getAttribLocation(u,"position"),h.uv=t.getAttribLocation(u,"uv"),f.renderType=t.getUniformLocation(u,"renderType"),f.map=t.getUniformLocation(u,"map"),f.occlusionMap=t.getUniformLocation(u,"occlusionMap"),f.opacity=t.getUniformLocation(u,"opacity"),f.color=t.getUniformLocation(u,"color"),f.scale=t.getUniformLocation(u,"scale"),f.rotation=t.getUniformLocation(u,"rotation"),f.screenPosition=t.getUniformLocation(u,"screenPosition"),d=!1},this.render=function(e,r,i,p){var e=e.__webglFlares,m=e.length;if(m){var v=new THREE.Vector3,g=p/i,E=.5*i,y=.5*p,x=16/p,T=new THREE.Vector2(x*g,x),b=new THREE.Vector3(1,1,0),R=new THREE.Vector2(1,1),w=f,x=h;t.useProgram(u),d||(t.enableVertexAttribArray(h.vertex),t.enableVertexAttribArray(h.uv),d=!0),t.uniform1i(w.occlusionMap,0),t.uniform1i(w.map,1),t.bindBuffer(t.ARRAY_BUFFER,o),t.vertexAttribPointer(x.vertex,2,t.FLOAT,!1,16,0),t.vertexAttribPointer(x.uv,2,t.FLOAT,!1,16,8),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,a),t.disable(t.CULL_FACE),t.depthMask(!1);var _,H,M,S,C;for(_=0;_<m;_++)if(x=16/p,T.set(x*g,x),S=e[_],v.set(S.matrixWorld.elements[12],S.matrixWorld.elements[13],S.matrixWorld.elements[14]),r.matrixWorldInverse.multiplyVector3(v),r.projectionMatrix.multiplyVector3(v),b.copy(v),R.x=b.x*E+E,R.y=b.y*y+y,c||R.x>0&&R.x<i&&R.y>0&&R.y<p)for(t.activeTexture(t.TEXTURE1),t.bindTexture(t.TEXTURE_2D,s),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGB,R.x-8,R.y-8,16,16,0),t.uniform1i(w.renderType,0),t.uniform2f(w.scale,T.x,T.y),t.uniform3f(w.screenPosition,b.x,b.y,b.z),t.disable(t.BLEND),t.enable(t.DEPTH_TEST),t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,l),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGBA,R.x-8,R.y-8,16,16,0),t.uniform1i(w.renderType,1),t.disable(t.DEPTH_TEST),t.activeTexture(t.TEXTURE1),t.bindTexture(t.TEXTURE_2D,s),t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0),S.positionScreen.copy(b),S.customUpdateCallback?S.customUpdateCallback(S):S.updateLensFlares(),t.uniform1i(w.renderType,2),t.enable(t.BLEND),H=0,M=S.lensFlares.length;H<M;H++)C=S.lensFlares[H],C.opacity>.001&&C.scale>.001&&(b.x=C.x,b.y=C.y,b.z=C.z,x=C.size*C.scale/p,T.x=x*g,T.y=x,t.uniform3f(w.screenPosition,b.x,b.y,b.z),t.uniform2f(w.scale,T.x,T.y),t.uniform1f(w.rotation,C.rotation),t.uniform1f(w.opacity,C.opacity),t.uniform3f(w.color,C.color.r,C.color.g,C.color.b),n.setBlending(C.blending,C.blendEquation,C.blendSrc,C.blendDst),n.setTexture(C.texture,1),t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0));t.enable(t.CULL_FACE),t.enable(t.DEPTH_TEST),t.depthMask(!0)}}},THREE.ShadowMapPlugin=function(){var e,t,n,r,i=new THREE.Frustum,o=new THREE.Matrix4,a=new THREE.Vector3,s=new THREE.Vector3;this.init=function(i){e=i.context,t=i;var i=THREE.ShaderLib.depthRGBA,o=THREE.UniformsUtils.clone(i.uniforms);n=new THREE.ShaderMaterial({fragmentShader:i.fragmentShader,vertexShader:i.vertexShader,uniforms:o}),r=new THREE.ShaderMaterial({fragmentShader:i.fragmentShader,vertexShader:i.vertexShader,uniforms:o,morphTargets:!0}),n._shadowPass=!0,r._shadowPass=!0},this.render=function(e,n){t.shadowMapEnabled&&t.shadowMapAutoUpdate&&this.update(e,n)},this.update=function(l,c){var u,h,f,d,p,m,v,g,E,y=[];for(d=0,e.clearColor(1,1,1,1),e.disable(e.BLEND),e.enable(e.CULL_FACE),t.shadowMapCullFrontFaces?e.cullFace(e.FRONT):e.cullFace(e.BACK),t.setDepthTest(!0),u=0,h=l.__lights.length;u<h;u++)if(f=l.__lights[u],f.castShadow)if(f instanceof THREE.DirectionalLight&&f.shadowCascade)for(p=0;p<f.shadowCascadeCount;p++){var x;if(f.shadowCascadeArray[p])x=f.shadowCascadeArray[p];else{E=f,v=p,x=new THREE.DirectionalLight,x.isVirtual=!0,x.onlyShadow=!0,x.castShadow=!0,x.shadowCameraNear=E.shadowCameraNear,x.shadowCameraFar=E.shadowCameraFar,x.shadowCameraLeft=E.shadowCameraLeft,x.shadowCameraRight=E.shadowCameraRight,x.shadowCameraBottom=E.shadowCameraBottom,x.shadowCameraTop=E.shadowCameraTop,x.shadowCameraVisible=E.shadowCameraVisible,x.shadowDarkness=E.shadowDarkness,x.shadowBias=E.shadowCascadeBias[v],x.shadowMapWidth=E.shadowCascadeWidth[v],x.shadowMapHeight=E.shadowCascadeHeight[v],x.pointsWorld=[],x.pointsFrustum=[],g=x.pointsWorld,m=x.pointsFrustum;for(var T=0;T<8;T++)g[T]=new THREE.Vector3,m[T]=new THREE.Vector3;g=E.shadowCascadeNearZ[v],E=E.shadowCascadeFarZ[v],m[0].set(-1,-1,g),m[1].set(1,-1,g),m[2].set(-1,1,g),m[3].set(1,1,g),m[4].set(-1,-1,E),m[5].set(1,-1,E),m[6].set(-1,1,E),m[7].set(1,1,E),x.originalCamera=c,m=new THREE.Gyroscope,m.position=f.shadowCascadeOffset,m.add(x),m.add(x.target),c.add(m),f.shadowCascadeArray[p]=x,console.log("Created virtualLight",x)}v=f,g=p,E=v.shadowCascadeArray[g],E.position.copy(v.position),E.target.position.copy(v.target.position),E.lookAt(E.target),E.shadowCameraVisible=v.shadowCameraVisible,E.shadowDarkness=v.shadowDarkness,E.shadowBias=v.shadowCascadeBias[g],m=v.shadowCascadeNearZ[g],v=v.shadowCascadeFarZ[g],E=E.pointsFrustum,E[0].z=m,E[1].z=m,E[2].z=m,E[3].z=m,E[4].z=v,E[5].z=v,E[6].z=v,E[7].z=v,y[d]=x,d++}else y[d]=f,d++;for(u=0,h=y.length;u<h;u++){if(f=y[u],f.shadowMap||(f.shadowMap=new THREE.WebGLRenderTarget(f.shadowMapWidth,f.shadowMapHeight,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat}),f.shadowMapSize=new THREE.Vector2(f.shadowMapWidth,f.shadowMapHeight),f.shadowMatrix=new THREE.Matrix4),!f.shadowCamera){if(f instanceof THREE.SpotLight)f.shadowCamera=new THREE.PerspectiveCamera(f.shadowCameraFov,f.shadowMapWidth/f.shadowMapHeight,f.shadowCameraNear,f.shadowCameraFar);else{if(!(f instanceof THREE.DirectionalLight)){console.error("Unsupported light type for shadow");continue}f.shadowCamera=new THREE.OrthographicCamera(f.shadowCameraLeft,f.shadowCameraRight,f.shadowCameraTop,f.shadowCameraBottom,f.shadowCameraNear,f.shadowCameraFar)}l.add(f.shadowCamera),t.autoUpdateScene&&l.updateMatrixWorld()}if(f.shadowCameraVisible&&!f.cameraHelper&&(f.cameraHelper=new THREE.CameraHelper(f.shadowCamera),f.shadowCamera.add(f.cameraHelper)),f.isVirtual&&x.originalCamera==c){for(p=c,d=f.shadowCamera,m=f.pointsFrustum,E=f.pointsWorld,a.set(1/0,1/0,1/0),s.set(-1/0,-1/0,-1/0),v=0;v<8;v++)g=E[v],g.copy(m[v]),THREE.ShadowMapPlugin.__projector.unprojectVector(g,p),d.matrixWorldInverse.multiplyVector3(g),g.x<a.x&&(a.x=g.x),g.x>s.x&&(s.x=g.x),g.y<a.y&&(a.y=g.y),g.y>s.y&&(s.y=g.y),g.z<a.z&&(a.z=g.z),g.z>s.z&&(s.z=g.z);d.left=a.x,d.right=s.x,d.top=s.y,d.bottom=a.y,d.updateProjectionMatrix()}for(d=f.shadowMap,m=f.shadowMatrix,p=f.shadowCamera,p.position.copy(f.matrixWorld.getPosition()),p.lookAt(f.target.matrixWorld.getPosition()),p.updateMatrixWorld(),p.matrixWorldInverse.getInverse(p.matrixWorld),f.cameraHelper&&(f.cameraHelper.lines.visible=f.shadowCameraVisible),f.shadowCameraVisible&&f.cameraHelper.update(),m.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),m.multiplySelf(p.projectionMatrix),m.multiplySelf(p.matrixWorldInverse),p._viewMatrixArray||(p._viewMatrixArray=new Float32Array(16)),p._projectionMatrixArray||(p._projectionMatrixArray=new Float32Array(16)),p.matrixWorldInverse.flattenToArray(p._viewMatrixArray),p.projectionMatrix.flattenToArray(p._projectionMatrixArray),o.multiply(p.projectionMatrix,p.matrixWorldInverse),i.setFromMatrix(o),t.setRenderTarget(d),t.clear(),E=l.__webglObjects,f=0,d=E.length;f<d;f++)v=E[f],m=v.object,v.render=!1,!m.visible||!m.castShadow||m instanceof THREE.Mesh&&m.frustumCulled&&!i.contains(m)||(m._modelViewMatrix.multiply(p.matrixWorldInverse,m.matrixWorld),v.render=!0);for(f=0,d=E.length;f<d;f++)v=E[f],v.render&&(m=v.object,v=v.buffer,g=m.customDepthMaterial?m.customDepthMaterial:m.geometry.morphTargets.length?r:n,v instanceof THREE.BufferGeometry?t.renderBufferDirect(p,l.__lights,null,g,v,m):t.renderBuffer(p,l.__lights,null,g,v,m));for(E=l.__webglObjectsImmediate,f=0,d=E.length;f<d;f++)v=E[f],m=v.object,m.visible&&m.castShadow&&(m._modelViewMatrix.multiply(p.matrixWorldInverse,m.matrixWorld),t.renderImmediateObject(p,l.__lights,null,n,m))}u=t.getClearColor(),h=t.getClearAlpha(),e.clearColor(u.r,u.g,u.b,h),e.enable(e.BLEND),t.shadowMapCullFrontFaces&&e.cullFace(e.BACK)}},THREE.ShadowMapPlugin.__projector=new THREE.Projector,THREE.SpritePlugin=function(){function e(e,t){return t.z-e.z}var t,n,r,i,o,a,s,l,c,u;this.init=function(e){t=e.context,n=e,r=new Float32Array(16),i=new Uint16Array(6),e=0,r[e++]=-1,r[e++]=-1,r[e++]=0,r[e++]=1,r[e++]=1,r[e++]=-1,r[e++]=1,r[e++]=1,r[e++]=1,r[e++]=1,r[e++]=1,r[e++]=0,r[e++]=-1,r[e++]=1,r[e++]=0,e=r[e++]=0,i[e++]=0,i[e++]=1,i[e++]=2,i[e++]=0,i[e++]=2,i[e++]=3,o=t.createBuffer(),a=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,o),t.bufferData(t.ARRAY_BUFFER,r,t.STATIC_DRAW),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,a),t.bufferData(t.ELEMENT_ARRAY_BUFFER,i,t.STATIC_DRAW);var e=THREE.ShaderSprite.sprite,h=t.createProgram(),f=t.createShader(t.FRAGMENT_SHADER),d=t.createShader(t.VERTEX_SHADER);t.shaderSource(f,e.fragmentShader),t.shaderSource(d,e.vertexShader),t.compileShader(f),t.compileShader(d),t.attachShader(h,f),t.attachShader(h,d),t.linkProgram(h),s=h,l={},c={},l.position=t.getAttribLocation(s,"position"),l.uv=t.getAttribLocation(s,"uv"),c.uvOffset=t.getUniformLocation(s,"uvOffset"),c.uvScale=t.getUniformLocation(s,"uvScale"),c.rotation=t.getUniformLocation(s,"rotation"),c.scale=t.getUniformLocation(s,"scale"),c.alignment=t.getUniformLocation(s,"alignment"),c.color=t.getUniformLocation(s,"color"),c.map=t.getUniformLocation(s,"map"),c.opacity=t.getUniformLocation(s,"opacity"),c.useScreenCoordinates=t.getUniformLocation(s,"useScreenCoordinates"),c.affectedByDistance=t.getUniformLocation(s,"affectedByDistance"),c.screenPosition=t.getUniformLocation(s,"screenPosition"),c.modelViewMatrix=t.getUniformLocation(s,"modelViewMatrix"),c.projectionMatrix=t.getUniformLocation(s,"projectionMatrix"),u=!1},this.render=function(r,i,h,f){var r=r.__webglSprites,d=r.length;if(d){var p=l,m=c,v=f/h,h=.5*h,g=.5*f,E=!0;t.useProgram(s),u||(t.enableVertexAttribArray(p.position),t.enableVertexAttribArray(p.uv),u=!0),t.disable(t.CULL_FACE),t.enable(t.BLEND),t.depthMask(!0),t.bindBuffer(t.ARRAY_BUFFER,o),t.vertexAttribPointer(p.position,2,t.FLOAT,!1,16,0),t.vertexAttribPointer(p.uv,2,t.FLOAT,!1,16,8),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,a),t.uniformMatrix4fv(m.projectionMatrix,!1,i._projectionMatrixArray),t.activeTexture(t.TEXTURE0),t.uniform1i(m.map,0);for(var y,x=[],p=0;p<d;p++)y=r[p],y.visible&&0!==y.opacity&&(y.useScreenCoordinates?y.z=-y.position.z:(y._modelViewMatrix.multiply(i.matrixWorldInverse,y.matrixWorld),y.z=-y._modelViewMatrix.elements[14]));for(r.sort(e),p=0;p<d;p++)y=r[p],y.visible&&0!==y.opacity&&y.map&&y.map.image&&y.map.image.width&&(y.useScreenCoordinates?(t.uniform1i(m.useScreenCoordinates,1),t.uniform3f(m.screenPosition,(y.position.x-h)/h,(g-y.position.y)/g,Math.max(0,Math.min(1,y.position.z)))):(t.uniform1i(m.useScreenCoordinates,0),t.uniform1i(m.affectedByDistance,y.affectedByDistance?1:0),t.uniformMatrix4fv(m.modelViewMatrix,!1,y._modelViewMatrix.elements)),i=y.map.image.width/(y.scaleByViewport?f:1),x[0]=i*v*y.scale.x,x[1]=i*y.scale.y,t.uniform2f(m.uvScale,y.uvScale.x,y.uvScale.y),t.uniform2f(m.uvOffset,y.uvOffset.x,y.uvOffset.y),t.uniform2f(m.alignment,y.alignment.x,y.alignment.y),t.uniform1f(m.opacity,y.opacity),t.uniform3f(m.color,y.color.r,y.color.g,y.color.b),t.uniform1f(m.rotation,y.rotation),t.uniform2fv(m.scale,x),y.mergeWith3D&&!E?(t.enable(t.DEPTH_TEST),E=!0):!y.mergeWith3D&&E&&(t.disable(t.DEPTH_TEST),E=!1),n.setBlending(y.blending,y.blendEquation,y.blendSrc,y.blendDst),n.setTexture(y.map,0),t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0));t.enable(t.CULL_FACE),t.enable(t.DEPTH_TEST),t.depthMask(!0)}}},THREE.DepthPassPlugin=function(){this.enabled=!1,this.renderTarget=null;var e,t,n,r,i=new THREE.Frustum,o=new THREE.Matrix4;this.init=function(i){e=i.context,t=i;var i=THREE.ShaderLib.depthRGBA,o=THREE.UniformsUtils.clone(i.uniforms);n=new THREE.ShaderMaterial({fragmentShader:i.fragmentShader,vertexShader:i.vertexShader,uniforms:o}),r=new THREE.ShaderMaterial({fragmentShader:i.fragmentShader,vertexShader:i.vertexShader,uniforms:o,morphTargets:!0}),n._shadowPass=!0,r._shadowPass=!0},this.render=function(e,t){this.enabled&&this.update(e,t)},this.update=function(a,s){var l,c,u,h,f,d;for(e.clearColor(1,1,1,1),e.disable(e.BLEND),t.setDepthTest(!0),t.autoUpdateScene&&a.updateMatrixWorld(),s._viewMatrixArray||(s._viewMatrixArray=new Float32Array(16)),s._projectionMatrixArray||(s._projectionMatrixArray=new Float32Array(16)),s.matrixWorldInverse.getInverse(s.matrixWorld),s.matrixWorldInverse.flattenToArray(s._viewMatrixArray),s.projectionMatrix.flattenToArray(s._projectionMatrixArray),o.multiply(s.projectionMatrix,s.matrixWorldInverse),i.setFromMatrix(o),t.setRenderTarget(this.renderTarget),t.clear(),d=a.__webglObjects,l=0,c=d.length;l<c;l++)u=d[l],f=u.object,u.render=!1,!f.visible||f instanceof THREE.Mesh&&f.frustumCulled&&!i.contains(f)||(f._modelViewMatrix.multiply(s.matrixWorldInverse,f.matrixWorld),u.render=!0);for(l=0,c=d.length;l<c;l++)u=d[l],u.render&&(f=u.object,u=u.buffer,t.setObjectFaces(f),h=f.customDepthMaterial?f.customDepthMaterial:f.geometry.morphTargets.length?r:n,u instanceof THREE.BufferGeometry?t.renderBufferDirect(s,a.__lights,null,h,u,f):t.renderBuffer(s,a.__lights,null,h,u,f));for(d=a.__webglObjectsImmediate,l=0,c=d.length;l<c;l++)u=d[l],f=u.object,f.visible&&f.castShadow&&(f._modelViewMatrix.multiply(s.matrixWorldInverse,f.matrixWorld),t.renderImmediateObject(s,a.__lights,null,n,f));l=t.getClearColor(),c=t.getClearAlpha(),e.clearColor(l.r,l.g,l.b,c),e.enable(e.BLEND)}},THREE.ShaderFlares={lensFlareVertexTexture:{vertexShader:"uniform vec3 screenPosition;\nuniform vec2 scale;\nuniform float rotation;\nuniform int renderType;\nuniform sampler2D occlusionMap;\nattribute vec2 position;\nattribute vec2 uv;\nvarying vec2 vUV;\nvarying float vVisibility;\nvoid main() {\nvUV = uv;\nvec2 pos = position;\nif( renderType == 2 ) {\nvec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) ) +\ntexture2D( occlusionMap, vec2( 0.5, 0.1 ) ) +\ntexture2D( occlusionMap, vec2( 0.9, 0.1 ) ) +\ntexture2D( occlusionMap, vec2( 0.9, 0.5 ) ) +\ntexture2D( occlusionMap, vec2( 0.9, 0.9 ) ) +\ntexture2D( occlusionMap, vec2( 0.5, 0.9 ) ) +\ntexture2D( occlusionMap, vec2( 0.1, 0.9 ) ) +\ntexture2D( occlusionMap, vec2( 0.1, 0.5 ) ) +\ntexture2D( occlusionMap, vec2( 0.5, 0.5 ) );\nvVisibility = (       visibility.r / 9.0 ) *\n( 1.0 - visibility.g / 9.0 ) *\n(       visibility.b / 9.0 ) *\n( 1.0 - visibility.a / 9.0 );\npos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;\npos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;\n}\ngl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );\n}",fragmentShader:"precision mediump float;\nuniform sampler2D map;\nuniform float opacity;\nuniform int renderType;\nuniform vec3 color;\nvarying vec2 vUV;\nvarying float vVisibility;\nvoid main() {\nif( renderType == 0 ) {\ngl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );\n} else if( renderType == 1 ) {\ngl_FragColor = texture2D( map, vUV );\n} else {\nvec4 texture = texture2D( map, vUV );\ntexture.a *= opacity * vVisibility;\ngl_FragColor = texture;\ngl_FragColor.rgb *= color;\n}\n}"},lensFlare:{vertexShader:"uniform vec3 screenPosition;\nuniform vec2 scale;\nuniform float rotation;\nuniform int renderType;\nattribute vec2 position;\nattribute vec2 uv;\nvarying vec2 vUV;\nvoid main() {\nvUV = uv;\nvec2 pos = position;\nif( renderType == 2 ) {\npos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;\npos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;\n}\ngl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );\n}",fragmentShader:"precision mediump float;\nuniform sampler2D map;\nuniform sampler2D occlusionMap;\nuniform float opacity;\nuniform int renderType;\nuniform vec3 color;\nvarying vec2 vUV;\nvoid main() {\nif( renderType == 0 ) {\ngl_FragColor = vec4( texture2D( map, vUV ).rgb, 0.0 );\n} else if( renderType == 1 ) {\ngl_FragColor = texture2D( map, vUV );\n} else {\nfloat visibility = texture2D( occlusionMap, vec2( 0.5, 0.1 ) ).a +\ntexture2D( occlusionMap, vec2( 0.9, 0.5 ) ).a +\ntexture2D( occlusionMap, vec2( 0.5, 0.9 ) ).a +\ntexture2D( occlusionMap, vec2( 0.1, 0.5 ) ).a;\nvisibility = ( 1.0 - visibility / 4.0 );\nvec4 texture = texture2D( map, vUV );\ntexture.a *= opacity * visibility;\ngl_FragColor = texture;\ngl_FragColor.rgb *= color;\n}\n}"}},THREE.ShaderSprite={sprite:{vertexShader:"uniform int useScreenCoordinates;\nuniform int affectedByDistance;\nuniform vec3 screenPosition;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform float rotation;\nuniform vec2 scale;\nuniform vec2 alignment;\nuniform vec2 uvOffset;\nuniform vec2 uvScale;\nattribute vec2 position;\nattribute vec2 uv;\nvarying vec2 vUV;\nvoid main() {\nvUV = uvOffset + uv * uvScale;\nvec2 alignedPosition = position + alignment;\nvec2 rotatedPosition;\nrotatedPosition.x = ( cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y ) * scale.x;\nrotatedPosition.y = ( sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y ) * scale.y;\nvec4 finalPosition;\nif( useScreenCoordinates != 0 ) {\nfinalPosition = vec4( screenPosition.xy + rotatedPosition, screenPosition.z, 1.0 );\n} else {\nfinalPosition = projectionMatrix * modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\nfinalPosition.xy += rotatedPosition * ( affectedByDistance == 1 ? 1.0 : finalPosition.z );\n}\ngl_Position = finalPosition;\n}",fragmentShader:"precision mediump float;\nuniform vec3 color;\nuniform sampler2D map;\nuniform float opacity;\nvarying vec2 vUV;\nvoid main() {\nvec4 texture = texture2D( map, vUV );\ngl_FragColor = vec4( color * texture.xyz, texture.a * opacity );\n}"}};var THREEx=THREEx||{};THREEx.KeyboardState=function(){this.keyCodes={},this.modifiers={};var e=this;this._onKeyDown=function(t){e._onKeyChange(t,!0)},this._onKeyUp=function(t){e._onKeyChange(t,!1)},document.addEventListener("keydown",this._onKeyDown,!1),document.addEventListener("keyup",this._onKeyUp,!1)},THREEx.KeyboardState.prototype.destroy=function(){document.removeEventListener("keydown",this._onKeyDown,!1),document.removeEventListener("keyup",this._onKeyUp,!1)},THREEx.KeyboardState.MODIFIERS=["shift","ctrl","alt","meta"],THREEx.KeyboardState.ALIAS={left:37,up:38,right:39,down:40,space:32,pageup:33,pagedown:34,tab:9},THREEx.KeyboardState.prototype._onKeyChange=function(e,t){var n=e.keyCode;this.keyCodes[n]=t,this.modifiers.shift=e.shiftKey,this.modifiers.ctrl=e.ctrlKey,this.modifiers.alt=e.altKey,this.modifiers.meta=e.metaKey},THREEx.KeyboardState.prototype.pressed=function(e){for(var t=e.split("+"),n=0;n<t.length;n++){var r=t[n];if(!(-1!==THREEx.KeyboardState.MODIFIERS.indexOf(r)?this.modifiers[r]:-1!=Object.keys(THREEx.KeyboardState.ALIAS).indexOf(r)?this.keyCodes[THREEx.KeyboardState.ALIAS[r]]:this.keyCodes[r.toUpperCase().charCodeAt(0)]))return!1}return!0};var THREEx=THREEx||{};THREEx.WindowResize=function(e,t){var n=function(){var n=window.innerWidth;n<1280&&(n=1280),e.setSize(n,window.innerHeight),t.aspect=n/window.innerHeight,t.updateProjectionMatrix()};return window.addEventListener("resize",n,!1),{stop:function(){window.removeEventListener("resize",n)}}};var Stats=function(){var e,t,n,r,i,o,a,s,l=0,c=0,u=Date.now(),h=u,f=u,d=0,p=1e3,m=0,v=[[16,16,48],[0,255,255]],g=0,E=1e3,y=0,x=[[16,48,16],[0,255,0]];for(e=document.createElement("div"),e.style.cursor="pointer",e.style.width="80px",e.style.opacity="0.9",e.style.zIndex="10001",e.addEventListener("mousedown",function(e){e.preventDefault(),l=(l+1)%2,0==l?(n.style.display="block",o.style.display="none"):(n.style.display="none",o.style.display="block")},!1),n=document.createElement("div"),n.style.textAlign="left",n.style.lineHeight="1.2em",n.style.backgroundColor="rgb("+Math.floor(v[0][0]/2)+","+Math.floor(v[0][1]/2)+","+Math.floor(v[0][2]/2)+")",n.style.padding="0 0 3px 3px",e.appendChild(n),r=document.createElement("div"),r.style.fontFamily="Helvetica, Arial, sans-serif",r.style.fontSize="9px",r.style.color="rgb("+v[1][0]+","+v[1][1]+","+v[1][2]+")",r.style.fontWeight="bold",r.innerHTML="FPS",n.appendChild(r),i=document.createElement("div"),i.style.position="relative",i.style.width="74px",i.style.height="30px",i.style.backgroundColor="rgb("+v[1][0]+","+v[1][1]+","+v[1][2]+")",n.appendChild(i);74>i.children.length;)t=document.createElement("span"),t.style.width="1px",t.style.height="30px",t.style.cssFloat="left",t.style.backgroundColor="rgb("+v[0][0]+","+v[0][1]+","+v[0][2]+")",i.appendChild(t);for(o=document.createElement("div"),o.style.textAlign="left",o.style.lineHeight="1.2em",o.style.backgroundColor="rgb("+Math.floor(x[0][0]/2)+","+Math.floor(x[0][1]/2)+","+Math.floor(x[0][2]/2)+")",o.style.padding="0 0 3px 3px",o.style.display="none",e.appendChild(o),a=document.createElement("div"),a.style.fontFamily="Helvetica, Arial, sans-serif",a.style.fontSize="9px",a.style.color="rgb("+x[1][0]+","+x[1][1]+","+x[1][2]+")",a.style.fontWeight="bold",a.innerHTML="MS",o.appendChild(a),s=document.createElement("div"),s.style.position="relative",s.style.width="74px",s.style.height="30px",s.style.backgroundColor="rgb("+x[1][0]+","+x[1][1]+","+x[1][2]+")",o.appendChild(s);74>s.children.length;)t=document.createElement("span"),t.style.width="1px",t.style.height=30*Math.random()+"px",t.style.cssFloat="left",t.style.backgroundColor="rgb("+x[0][0]+","+x[0][1]+","+x[0][2]+")",s.appendChild(t);return{getDomElement:function(){return e},getFps:function(){return d},getFpsMin:function(){return p},getFpsMax:function(){return m},getMs:function(){return g},getMsMin:function(){return E},getMsMax:function(){return y},update:function(){u=Date.now(),g=u-h,E=Math.min(E,g),y=Math.max(y,g),a.textContent=g+" MS ("+E+"-"+y+")";var e=Math.min(30,30-g/200*30);s.appendChild(s.firstChild).style.height=e+"px",h=u,c++,u>f+1e3&&(d=Math.round(1e3*c/(u-f)),p=Math.min(p,d),m=Math.max(m,d),r.textContent=d+" FPS ("+p+"-"+m+")",e=Math.min(30,30-d/100*30),i.appendChild(i.firstChild).style.height=e+"px",f=u,c=0)}}};!function(e,t){function n(e){return F.isWindow(e)?e:9===e.nodeType&&(e.defaultView||e.parentWindow)}function r(e){if(!Et[e]){var t=L.body,n=F("<"+e+">").appendTo(t),r=n.css("display");n.remove(),"none"!==r&&""!==r||(pt||(pt=L.createElement("iframe"),pt.frameBorder=pt.width=pt.height=0),t.appendChild(pt),mt&&pt.createElement||(mt=(pt.contentWindow||pt.contentDocument).document,mt.write(("CSS1Compat"===L.compatMode?"<!doctype html>":"")+"<html><body>"),mt.close()),n=mt.createElement(e),mt.body.appendChild(n),r=F.css(n,"display"),t.removeChild(pt)),Et[e]=r}return Et[e]}function i(e,t){var n={};return F.each(Tt.concat.apply([],Tt.slice(0,t)),function(){n[this]=e}),n}function o(){gt=t}function a(){return setTimeout(o,0),gt=F.now()}function s(){try{return new e.ActiveXObject("Microsoft.XMLHTTP")}catch(e){}}function l(){try{return new e.XMLHttpRequest}catch(e){}}function c(e,n){e.dataFilter&&(n=e.dataFilter(n,e.dataType));var r,i,o,a,s,l,c,u,h=e.dataTypes,f={},d=h.length,p=h[0];for(r=1;r<d;r++){if(1===r)for(i in e.converters)"string"==typeof i&&(f[i.toLowerCase()]=e.converters[i]);if(a=p,"*"===(p=h[r]))p=a;else if("*"!==a&&a!==p){if(s=a+" "+p,!(l=f[s]||f["* "+p])){u=t;for(c in f)if(o=c.split(" "),(o[0]===a||"*"===o[0])&&(u=f[o[1]+" "+p])){c=f[c],!0===c?l=u:!0===u&&(l=c);break}}!l&&!u&&F.error("No conversion from "+s.replace(" "," to ")),!0!==l&&(n=l?l(n):u(c(n)))}}return n}function u(e,n,r){var i,o,a,s,l=e.contents,c=e.dataTypes,u=e.responseFields;for(o in u)o in r&&(n[u[o]]=r[o]);for(;"*"===c[0];)c.shift(),i===t&&(i=e.mimeType||n.getResponseHeader("content-type"));if(i)for(o in l)if(l[o]&&l[o].test(i)){c.unshift(o);break}if(c[0]in r)a=c[0];else{for(o in r){if(!c[0]||e.converters[o+" "+c[0]]){a=o;break}s||(s=o)}a=a||s}if(a)return a!==c[0]&&c.unshift(a),r[a]}function h(e,t,n,r){if(F.isArray(t))F.each(t,function(t,i){n||Ge.test(e)?r(e,i):h(e+"["+("object"==typeof i||F.isArray(i)?t:"")+"]",i,n,r)});else if(n||null==t||"object"!=typeof t)r(e,t);else for(var i in t)h(e+"["+i+"]",t[i],n,r)}function f(e,n){var r,i,o=F.ajaxSettings.flatOptions||{};for(r in n)n[r]!==t&&((o[r]?e:i||(i={}))[r]=n[r]);i&&F.extend(!0,e,i)}function d(e,n,r,i,o,a){o=o||n.dataTypes[0],a=a||{},a[o]=!0;for(var s,l=e[o],c=0,u=l?l.length:0,h=e===at;c<u&&(h||!s);c++)"string"==typeof(s=l[c](n,r,i))&&(!h||a[s]?s=t:(n.dataTypes.unshift(s),s=d(e,n,r,i,s,a)));return(h||!s)&&!a["*"]&&(s=d(e,n,r,i,"*",a)),s}function p(e){
return function(t,n){if("string"!=typeof t&&(n=t,t="*"),F.isFunction(n))for(var r,i,o,a=t.toLowerCase().split(nt),s=0,l=a.length;s<l;s++)r=a[s],o=/^\+/.test(r),o&&(r=r.substr(1)||"*"),i=e[r]=e[r]||[],i[o?"unshift":"push"](n)}}function m(e,t,n){var r="width"===t?e.offsetWidth:e.offsetHeight,i="width"===t?ze:Ie,o=0,a=i.length;if(r>0){if("border"!==n)for(;o<a;o++)n||(r-=parseFloat(F.css(e,"padding"+i[o]))||0),"margin"===n?r+=parseFloat(F.css(e,n+i[o]))||0:r-=parseFloat(F.css(e,"border"+i[o]+"Width"))||0;return r+"px"}if(r=Ae(e,t,t),(r<0||null==r)&&(r=e.style[t]||0),r=parseFloat(r)||0,n)for(;o<a;o++)r+=parseFloat(F.css(e,"padding"+i[o]))||0,"padding"!==n&&(r+=parseFloat(F.css(e,"border"+i[o]+"Width"))||0),"margin"===n&&(r+=parseFloat(F.css(e,n+i[o]))||0);return r+"px"}function v(e,t){t.src?F.ajax({url:t.src,async:!1,dataType:"script"}):F.globalEval((t.text||t.textContent||t.innerHTML||"").replace(Me,"/*$0*/")),t.parentNode&&t.parentNode.removeChild(t)}function g(e){var t=L.createElement("div");return Ce.appendChild(t),t.innerHTML=e.outerHTML,t.firstChild}function E(e){var t=(e.nodeName||"").toLowerCase();"input"===t?y(e):"script"!==t&&void 0!==e.getElementsByTagName&&F.grep(e.getElementsByTagName("input"),y)}function y(e){"checkbox"!==e.type&&"radio"!==e.type||(e.defaultChecked=e.checked)}function x(e){return void 0!==e.getElementsByTagName?e.getElementsByTagName("*"):void 0!==e.querySelectorAll?e.querySelectorAll("*"):[]}function T(e,t){var n;1===t.nodeType&&(t.clearAttributes&&t.clearAttributes(),t.mergeAttributes&&t.mergeAttributes(e),n=t.nodeName.toLowerCase(),"object"===n?t.outerHTML=e.outerHTML:"input"!==n||"checkbox"!==e.type&&"radio"!==e.type?"option"===n?t.selected=e.defaultSelected:"input"!==n&&"textarea"!==n||(t.defaultValue=e.defaultValue):(e.checked&&(t.defaultChecked=t.checked=e.checked),t.value!==e.value&&(t.value=e.value)),t.removeAttribute(F.expando))}function b(e,t){if(1===t.nodeType&&F.hasData(e)){var n,r,i,o=F._data(e),a=F._data(t,o),s=o.events;if(s){delete a.handle,a.events={};for(n in s)for(r=0,i=s[n].length;r<i;r++)F.event.add(t,n+(s[n][r].namespace?".":"")+s[n][r].namespace,s[n][r],s[n][r].data)}a.data&&(a.data=F.extend({},a.data))}}function R(e,t){return F.nodeName(e,"table")?e.getElementsByTagName("tbody")[0]||e.appendChild(e.ownerDocument.createElement("tbody")):e}function w(e){var t=me.split("|"),n=e.createDocumentFragment();if(n.createElement)for(;t.length;)n.createElement(t.pop());return n}function _(e,t,n){if(t=t||0,F.isFunction(t))return F.grep(e,function(e,r){return!!t.call(e,r,e)===n});if(t.nodeType)return F.grep(e,function(e,r){return e===t===n});if("string"==typeof t){var r=F.grep(e,function(e){return 1===e.nodeType});if(he.test(t))return F.filter(t,r,!n);t=F.filter(t,r)}return F.grep(e,function(e,r){return F.inArray(e,t)>=0===n})}function H(e){return!e||!e.parentNode||11===e.parentNode.nodeType}function M(){return!0}function S(){return!1}function C(e,t,n){var r=t+"defer",i=t+"queue",o=t+"mark",a=F._data(e,r);a&&("queue"===n||!F._data(e,i))&&("mark"===n||!F._data(e,o))&&setTimeout(function(){!F._data(e,i)&&!F._data(e,o)&&(F.removeData(e,r,!0),a.fire())},0)}function A(e){for(var t in e)if(("data"!==t||!F.isEmptyObject(e[t]))&&"toJSON"!==t)return!1;return!0}function P(e,n,r){if(r===t&&1===e.nodeType){var i="data-"+n.replace(z,"-$1").toLowerCase();if("string"==typeof(r=e.getAttribute(i))){try{r="true"===r||"false"!==r&&("null"===r?null:F.isNumeric(r)?parseFloat(r):V.test(r)?F.parseJSON(r):r)}catch(e){}F.data(e,n,r)}else r=t}return r}function D(e){var t,n,r=U[e]={};for(e=e.split(/\s+/),t=0,n=e.length;t<n;t++)r[e[t]]=!0;return r}var L=e.document,N=e.navigator,k=e.location,F=function(){function n(){if(!s.isReady){try{L.documentElement.doScroll("left")}catch(e){return void setTimeout(n,1)}s.ready()}}var r,i,o,a,s=function(e,t){return new s.fn.init(e,t,r)},l=e.jQuery,c=e.$,u=/^(?:[^#<]*(<[\w\W]+>)[^>]*$|#([\w\-]*)$)/,h=/\S/,f=/^\s+/,d=/\s+$/,p=/^<(\w+)\s*\/?>(?:<\/\1>)?$/,m=/^[\],:{}\s]*$/,v=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,g=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,E=/(?:^|:|,)(?:\s*\[)+/g,y=/(webkit)[ \/]([\w.]+)/,x=/(opera)(?:.*version)?[ \/]([\w.]+)/,T=/(msie) ([\w.]+)/,b=/(mozilla)(?:.*? rv:([\w.]+))?/,R=/-([a-z]|[0-9])/gi,w=/^-ms-/,_=function(e,t){return(t+"").toUpperCase()},H=N.userAgent,M=Object.prototype.toString,S=Object.prototype.hasOwnProperty,C=Array.prototype.push,A=Array.prototype.slice,P=String.prototype.trim,D=Array.prototype.indexOf,k={};return s.fn=s.prototype={constructor:s,init:function(e,n,r){var i,o,a,l;if(!e)return this;if(e.nodeType)return this.context=this[0]=e,this.length=1,this;if("body"===e&&!n&&L.body)return this.context=L,this[0]=L.body,this.selector=e,this.length=1,this;if("string"==typeof e){if((i="<"!==e.charAt(0)||">"!==e.charAt(e.length-1)||e.length<3?u.exec(e):[null,e,null])&&(i[1]||!n)){if(i[1])return n=n instanceof s?n[0]:n,l=n?n.ownerDocument||n:L,a=p.exec(e),a?s.isPlainObject(n)?(e=[L.createElement(a[1])],s.fn.attr.call(e,n,!0)):e=[l.createElement(a[1])]:(a=s.buildFragment([i[1]],[l]),e=(a.cacheable?s.clone(a.fragment):a.fragment).childNodes),s.merge(this,e);if((o=L.getElementById(i[2]))&&o.parentNode){if(o.id!==i[2])return r.find(e);this.length=1,this[0]=o}return this.context=L,this.selector=e,this}return!n||n.jquery?(n||r).find(e):this.constructor(n).find(e)}return s.isFunction(e)?r.ready(e):(e.selector!==t&&(this.selector=e.selector,this.context=e.context),s.makeArray(e,this))},selector:"",jquery:"1.7.1",length:0,size:function(){return this.length},toArray:function(){return A.call(this,0)},get:function(e){return null==e?this.toArray():e<0?this[this.length+e]:this[e]},pushStack:function(e,t,n){var r=this.constructor();return s.isArray(e)?C.apply(r,e):s.merge(r,e),r.prevObject=this,r.context=this.context,"find"===t?r.selector=this.selector+(this.selector?" ":"")+n:t&&(r.selector=this.selector+"."+t+"("+n+")"),r},each:function(e,t){return s.each(this,e,t)},ready:function(e){return s.bindReady(),o.add(e),this},eq:function(e){return e=+e,-1===e?this.slice(e):this.slice(e,e+1)},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},slice:function(){return this.pushStack(A.apply(this,arguments),"slice",A.call(arguments).join(","))},map:function(e){return this.pushStack(s.map(this,function(t,n){return e.call(t,n,t)}))},end:function(){return this.prevObject||this.constructor(null)},push:C,sort:[].sort,splice:[].splice},s.fn.init.prototype=s.fn,s.extend=s.fn.extend=function(){var e,n,r,i,o,a,l=arguments[0]||{},c=1,u=arguments.length,h=!1;for("boolean"==typeof l&&(h=l,l=arguments[1]||{},c=2),"object"!=typeof l&&!s.isFunction(l)&&(l={}),u===c&&(l=this,--c);c<u;c++)if(null!=(e=arguments[c]))for(n in e)r=l[n],i=e[n],l!==i&&(h&&i&&(s.isPlainObject(i)||(o=s.isArray(i)))?(o?(o=!1,a=r&&s.isArray(r)?r:[]):a=r&&s.isPlainObject(r)?r:{},l[n]=s.extend(h,a,i)):i!==t&&(l[n]=i));return l},s.extend({noConflict:function(t){return e.$===s&&(e.$=c),t&&e.jQuery===s&&(e.jQuery=l),s},isReady:!1,readyWait:1,holdReady:function(e){e?s.readyWait++:s.ready(!0)},ready:function(e){if(!0===e&&!--s.readyWait||!0!==e&&!s.isReady){if(!L.body)return setTimeout(s.ready,1);if(s.isReady=!0,!0!==e&&--s.readyWait>0)return;o.fireWith(L,[s]),s.fn.trigger&&s(L).trigger("ready").off("ready")}},bindReady:function(){if(!o){if(o=s.Callbacks("once memory"),"complete"===L.readyState)return setTimeout(s.ready,1);if(L.addEventListener)L.addEventListener("DOMContentLoaded",a,!1),e.addEventListener("load",s.ready,!1);else if(L.attachEvent){L.attachEvent("onreadystatechange",a),e.attachEvent("onload",s.ready);var t=!1;try{t=null==e.frameElement}catch(e){}L.documentElement.doScroll&&t&&n()}}},isFunction:function(e){return"function"===s.type(e)},isArray:Array.isArray||function(e){return"array"===s.type(e)},isWindow:function(e){return e&&"object"==typeof e&&"setInterval"in e},isNumeric:function(e){return!isNaN(parseFloat(e))&&isFinite(e)},type:function(e){return null==e?String(e):k[M.call(e)]||"object"},isPlainObject:function(e){if(!e||"object"!==s.type(e)||e.nodeType||s.isWindow(e))return!1;try{if(e.constructor&&!S.call(e,"constructor")&&!S.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(e){return!1}var n;for(n in e);return n===t||S.call(e,n)},isEmptyObject:function(e){for(var t in e)return!1;return!0},error:function(e){throw new Error(e)},parseJSON:function(t){return"string"==typeof t&&t?(t=s.trim(t),e.JSON&&e.JSON.parse?e.JSON.parse(t):m.test(t.replace(v,"@").replace(g,"]").replace(E,""))?new Function("return "+t)():void s.error("Invalid JSON: "+t)):null},parseXML:function(n){var r,i;try{e.DOMParser?(i=new DOMParser,r=i.parseFromString(n,"text/xml")):(r=new ActiveXObject("Microsoft.XMLDOM"),r.async="false",r.loadXML(n))}catch(e){r=t}return(!r||!r.documentElement||r.getElementsByTagName("parsererror").length)&&s.error("Invalid XML: "+n),r},noop:function(){},globalEval:function(t){t&&h.test(t)&&(e.execScript||function(t){e.eval.call(e,t)})(t)},camelCase:function(e){return e.replace(w,"ms-").replace(R,_)},nodeName:function(e,t){return e.nodeName&&e.nodeName.toUpperCase()===t.toUpperCase()},each:function(e,n,r){var i,o=0,a=e.length,l=a===t||s.isFunction(e);if(r)if(l){for(i in e)if(!1===n.apply(e[i],r))break}else for(;o<a&&!1!==n.apply(e[o++],r););else if(l){for(i in e)if(!1===n.call(e[i],i,e[i]))break}else for(;o<a&&!1!==n.call(e[o],o,e[o++]););return e},trim:P?function(e){return null==e?"":P.call(e)}:function(e){return null==e?"":(e+"").replace(f,"").replace(d,"")},makeArray:function(e,t){var n=t||[];if(null!=e){var r=s.type(e);null==e.length||"string"===r||"function"===r||"regexp"===r||s.isWindow(e)?C.call(n,e):s.merge(n,e)}return n},inArray:function(e,t,n){var r;if(t){if(D)return D.call(t,e,n);for(r=t.length,n=n?n<0?Math.max(0,r+n):n:0;n<r;n++)if(n in t&&t[n]===e)return n}return-1},merge:function(e,n){var r=e.length,i=0;if("number"==typeof n.length)for(var o=n.length;i<o;i++)e[r++]=n[i];else for(;n[i]!==t;)e[r++]=n[i++];return e.length=r,e},grep:function(e,t,n){var r,i=[];n=!!n;for(var o=0,a=e.length;o<a;o++)r=!!t(e[o],o),n!==r&&i.push(e[o]);return i},map:function(e,n,r){var i,o,a=[],l=0,c=e.length;if(e instanceof s||c!==t&&"number"==typeof c&&(c>0&&e[0]&&e[c-1]||0===c||s.isArray(e)))for(;l<c;l++)null!=(i=n(e[l],l,r))&&(a[a.length]=i);else for(o in e)null!=(i=n(e[o],o,r))&&(a[a.length]=i);return a.concat.apply([],a)},guid:1,proxy:function(e,n){if("string"==typeof n){var r=e[n];n=e,e=r}if(!s.isFunction(e))return t;var i=A.call(arguments,2),o=function(){return e.apply(n,i.concat(A.call(arguments)))};return o.guid=e.guid=e.guid||o.guid||s.guid++,o},access:function(e,n,r,i,o,a){var l=e.length;if("object"==typeof n){for(var c in n)s.access(e,c,n[c],i,o,r);return e}if(r!==t){i=!a&&i&&s.isFunction(r);for(var u=0;u<l;u++)o(e[u],n,i?r.call(e[u],u,o(e[u],n)):r,a);return e}return l?o(e[0],n):t},now:function(){return(new Date).getTime()},uaMatch:function(e){e=e.toLowerCase();var t=y.exec(e)||x.exec(e)||T.exec(e)||e.indexOf("compatible")<0&&b.exec(e)||[];return{browser:t[1]||"",version:t[2]||"0"}},sub:function(){function e(t,n){return new e.fn.init(t,n)}s.extend(!0,e,this),e.superclass=this,e.fn=e.prototype=this(),e.fn.constructor=e,e.sub=this.sub,e.fn.init=function(n,r){return r&&r instanceof s&&!(r instanceof e)&&(r=e(r)),s.fn.init.call(this,n,r,t)},e.fn.init.prototype=e.fn;var t=e(L);return e},browser:{}}),s.each("Boolean Number String Function Array Date RegExp Object".split(" "),function(e,t){k["[object "+t+"]"]=t.toLowerCase()}),i=s.uaMatch(H),i.browser&&(s.browser[i.browser]=!0,s.browser.version=i.version),s.browser.webkit&&(s.browser.safari=!0),h.test("")&&(f=/^[\s\xA0]+/,d=/[\s\xA0]+$/),r=s(L),L.addEventListener?a=function(){L.removeEventListener("DOMContentLoaded",a,!1),s.ready()}:L.attachEvent&&(a=function(){"complete"===L.readyState&&(L.detachEvent("onreadystatechange",a),s.ready())}),s}(),U={};F.Callbacks=function(e){e=e?U[e]||D(e):{};var n,r,i,o,a,s=[],l=[],c=function(t){var n,r,i,o;for(n=0,r=t.length;n<r;n++)i=t[n],o=F.type(i),"array"===o?c(i):"function"===o&&(!e.unique||!h.has(i))&&s.push(i)},u=function(t,c){for(c=c||[],n=!e.memory||[t,c],r=!0,a=i||0,i=0,o=s.length;s&&a<o;a++)if(!1===s[a].apply(t,c)&&e.stopOnFalse){n=!0;break}r=!1,s&&(e.once?!0===n?h.disable():s=[]:l&&l.length&&(n=l.shift(),h.fireWith(n[0],n[1])))},h={add:function(){if(s){var e=s.length;c(arguments),r?o=s.length:n&&!0!==n&&(i=e,u(n[0],n[1]))}return this},remove:function(){if(s)for(var t=arguments,n=0,i=t.length;n<i;n++)for(var l=0;l<s.length&&(t[n]!==s[l]||(r&&l<=o&&(o--,l<=a&&a--),s.splice(l--,1),!e.unique));l++);return this},has:function(e){if(s)for(var t=0,n=s.length;t<n;t++)if(e===s[t])return!0;return!1},empty:function(){return s=[],this},disable:function(){return s=l=n=t,this},disabled:function(){return!s},lock:function(){return l=t,(!n||!0===n)&&h.disable(),this},locked:function(){return!l},fireWith:function(t,i){return l&&(r?e.once||l.push([t,i]):(!e.once||!n)&&u(t,i)),this},fire:function(){return h.fireWith(this,arguments),this},fired:function(){return!!n}};return h};var B=[].slice;F.extend({Deferred:function(e){var t,n=F.Callbacks("once memory"),r=F.Callbacks("once memory"),i=F.Callbacks("memory"),o="pending",a={resolve:n,reject:r,notify:i},s={done:n.add,fail:r.add,progress:i.add,state:function(){return o},isResolved:n.fired,isRejected:r.fired,then:function(e,t,n){return l.done(e).fail(t).progress(n),this},always:function(){return l.done.apply(l,arguments).fail.apply(l,arguments),this},pipe:function(e,t,n){return F.Deferred(function(r){F.each({done:[e,"resolve"],fail:[t,"reject"],progress:[n,"notify"]},function(e,t){var n,i=t[0],o=t[1];F.isFunction(i)?l[e](function(){n=i.apply(this,arguments),n&&F.isFunction(n.promise)?n.promise().then(r.resolve,r.reject,r.notify):r[o+"With"](this===l?r:this,[n])}):l[e](r[o])})}).promise()},promise:function(e){if(null==e)e=s;else for(var t in s)e[t]=s[t];return e}},l=s.promise({});for(t in a)l[t]=a[t].fire,l[t+"With"]=a[t].fireWith;return l.done(function(){o="resolved"},r.disable,i.lock).fail(function(){o="rejected"},n.disable,i.lock),e&&e.call(l,l),l},when:function(e){var t=B.call(arguments,0),n=0,r=t.length,i=Array(r),o=r,a=r<=1&&e&&F.isFunction(e.promise)?e:F.Deferred(),s=a.promise();if(r>1){for(;n<r;n++)t[n]&&t[n].promise&&F.isFunction(t[n].promise)?t[n].promise().then(function(e){return function(n){t[e]=arguments.length>1?B.call(arguments,0):n,--o||a.resolveWith(a,t)}}(n),a.reject,function(e){return function(t){i[e]=arguments.length>1?B.call(arguments,0):t,a.notifyWith(s,i)}}(n)):--o;o||a.resolveWith(a,t)}else a!==e&&a.resolveWith(a,r?[e]:[]);return s}}),F.support=function(){var t,n,r,i,o,a,s,l,c,u,h,f,d=L.createElement("div");L.documentElement;if(d.setAttribute("className","t"),d.innerHTML="   <link/><table></table><a href='/a' style='top:1px;float:left;opacity:.55;'>a</a><input type='checkbox'/>",n=d.getElementsByTagName("*"),r=d.getElementsByTagName("a")[0],!n||!n.length||!r)return{};i=L.createElement("select"),o=i.appendChild(L.createElement("option")),a=d.getElementsByTagName("input")[0],t={leadingWhitespace:3===d.firstChild.nodeType,tbody:!d.getElementsByTagName("tbody").length,htmlSerialize:!!d.getElementsByTagName("link").length,style:/top/.test(r.getAttribute("style")),hrefNormalized:"/a"===r.getAttribute("href"),opacity:/^0.55/.test(r.style.opacity),cssFloat:!!r.style.cssFloat,checkOn:"on"===a.value,optSelected:o.selected,getSetAttribute:"t"!==d.className,enctype:!!L.createElement("form").enctype,html5Clone:"<:nav></:nav>"!==L.createElement("nav").cloneNode(!0).outerHTML,submitBubbles:!0,changeBubbles:!0,focusinBubbles:!1,deleteExpando:!0,noCloneEvent:!0,inlineBlockNeedsLayout:!1,shrinkWrapBlocks:!1,reliableMarginRight:!0},a.checked=!0,t.noCloneChecked=a.cloneNode(!0).checked,i.disabled=!0,t.optDisabled=!o.disabled;try{delete d.test}catch(e){t.deleteExpando=!1}if(!d.addEventListener&&d.attachEvent&&d.fireEvent&&(d.attachEvent("onclick",function(){t.noCloneEvent=!1}),d.cloneNode(!0).fireEvent("onclick")),a=L.createElement("input"),a.value="t",a.setAttribute("type","radio"),t.radioValue="t"===a.value,a.setAttribute("checked","checked"),d.appendChild(a),l=L.createDocumentFragment(),l.appendChild(d.lastChild),t.checkClone=l.cloneNode(!0).cloneNode(!0).lastChild.checked,t.appendChecked=a.checked,l.removeChild(a),l.appendChild(d),d.innerHTML="",e.getComputedStyle&&(s=L.createElement("div"),s.style.width="0",s.style.marginRight="0",d.style.width="2px",d.appendChild(s),t.reliableMarginRight=0===(parseInt((e.getComputedStyle(s,null)||{marginRight:0}).marginRight,10)||0)),d.attachEvent)for(h in{submit:1,change:1,focusin:1})u="on"+h,f=u in d,f||(d.setAttribute(u,"return;"),f="function"==typeof d[u]),t[h+"Bubbles"]=f;return l.removeChild(d),l=i=o=s=d=a=null,F(function(){var e,n,r,i,o,a,s,l,u,h,p=L.getElementsByTagName("body")[0];!p||(a=1,s="position:absolute;top:0;left:0;width:1px;height:1px;margin:0;",l="visibility:hidden;border:0;",u="style='"+s+"border:5px solid #000;padding:0;'",h="<div "+u+"><div></div></div><table "+u+" cellpadding='0' cellspacing='0'><tr><td></td></tr></table>",e=L.createElement("div"),e.style.cssText=l+"width:0;height:0;position:static;top:0;margin-top:"+a+"px",p.insertBefore(e,p.firstChild),d=L.createElement("div"),e.appendChild(d),d.innerHTML="<table><tr><td style='padding:0;border:0;display:none'></td><td>t</td></tr></table>",c=d.getElementsByTagName("td"),f=0===c[0].offsetHeight,c[0].style.display="",c[1].style.display="none",t.reliableHiddenOffsets=f&&0===c[0].offsetHeight,d.innerHTML="",d.style.width=d.style.paddingLeft="1px",F.boxModel=t.boxModel=2===d.offsetWidth,void 0!==d.style.zoom&&(d.style.display="inline",d.style.zoom=1,t.inlineBlockNeedsLayout=2===d.offsetWidth,d.style.display="",d.innerHTML="<div style='width:4px;'></div>",t.shrinkWrapBlocks=2!==d.offsetWidth),d.style.cssText=s+l,d.innerHTML=h,n=d.firstChild,r=n.firstChild,i=n.nextSibling.firstChild.firstChild,o={doesNotAddBorder:5!==r.offsetTop,doesAddBorderForTableAndCells:5===i.offsetTop},r.style.position="fixed",r.style.top="20px",o.fixedPosition=20===r.offsetTop||15===r.offsetTop,r.style.position=r.style.top="",n.style.overflow="hidden",n.style.position="relative",o.subtractsBorderForOverflowNotVisible=-5===r.offsetTop,o.doesNotIncludeMarginInBodyOffset=p.offsetTop!==a,p.removeChild(e),d=e=null,F.extend(t,o))}),t}();var V=/^(?:\{.*\}|\[.*\])$/,z=/([A-Z])/g;F.extend({cache:{},uuid:0,expando:"jQuery"+(F.fn.jquery+Math.random()).replace(/\D/g,""),noData:{embed:!0,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",applet:!0},hasData:function(e){return!!(e=e.nodeType?F.cache[e[F.expando]]:e[F.expando])&&!A(e)},data:function(e,n,r,i){if(F.acceptData(e)){var o,a,s,l=F.expando,c="string"==typeof n,u=e.nodeType,h=u?F.cache:e,f=u?e[l]:e[l]&&l,d="events"===n;if((!f||!h[f]||!d&&!i&&!h[f].data)&&c&&r===t)return;return f||(u?e[l]=f=++F.uuid:f=l),h[f]||(h[f]={},u||(h[f].toJSON=F.noop)),("object"!=typeof n&&"function"!=typeof n||(i?h[f]=F.extend(h[f],n):h[f].data=F.extend(h[f].data,n)),o=a=h[f],i||(a.data||(a.data={}),a=a.data),r!==t&&(a[F.camelCase(n)]=r),d&&!a[n])?o.events:(c?null==(s=a[n])&&(s=a[F.camelCase(n)]):s=a,s)}},removeData:function(e,t,n){if(F.acceptData(e)){var r,i,o,a=F.expando,s=e.nodeType,l=s?F.cache:e,c=s?e[a]:a;if(!l[c])return;if(t&&(r=n?l[c]:l[c].data)){F.isArray(t)||(t in r?t=[t]:(t=F.camelCase(t),t=t in r?[t]:t.split(" ")));for(i=0,o=t.length;i<o;i++)delete r[t[i]];if(!(n?A:F.isEmptyObject)(r))return}if(!n&&(delete l[c].data,!A(l[c])))return;F.support.deleteExpando||!l.setInterval?delete l[c]:l[c]=null,s&&(F.support.deleteExpando?delete e[a]:e.removeAttribute?e.removeAttribute(a):e[a]=null)}},_data:function(e,t,n){return F.data(e,t,n,!0)},acceptData:function(e){if(e.nodeName){var t=F.noData[e.nodeName.toLowerCase()];if(t)return!0!==t&&e.getAttribute("classid")===t}return!0}}),F.fn.extend({data:function(e,n){var r,i,o,a=null;if(void 0===e){if(this.length&&(a=F.data(this[0]),1===this[0].nodeType&&!F._data(this[0],"parsedAttrs"))){i=this[0].attributes;for(var s=0,l=i.length;s<l;s++)o=i[s].name,0===o.indexOf("data-")&&(o=F.camelCase(o.substring(5)),P(this[0],o,a[o]));F._data(this[0],"parsedAttrs",!0)}return a}return"object"==typeof e?this.each(function(){F.data(this,e)}):(r=e.split("."),r[1]=r[1]?"."+r[1]:"",n===t?((a=this.triggerHandler("getData"+r[1]+"!",[r[0]]))===t&&this.length&&(a=F.data(this[0],e),a=P(this[0],e,a)),a===t&&r[1]?this.data(r[0]):a):this.each(function(){var t=F(this),i=[r[0],n];t.triggerHandler("setData"+r[1]+"!",i),F.data(this,e,n),t.triggerHandler("changeData"+r[1]+"!",i)}))},removeData:function(e){return this.each(function(){F.removeData(this,e)})}}),F.extend({_mark:function(e,t){e&&(t=(t||"fx")+"mark",F._data(e,t,(F._data(e,t)||0)+1))},_unmark:function(e,t,n){if(!0!==e&&(n=t,t=e,e=!1),t){n=n||"fx";var r=n+"mark",i=e?0:(F._data(t,r)||1)-1;i?F._data(t,r,i):(F.removeData(t,r,!0),C(t,n,"mark"))}},queue:function(e,t,n){var r;if(e)return t=(t||"fx")+"queue",r=F._data(e,t),n&&(!r||F.isArray(n)?r=F._data(e,t,F.makeArray(n)):r.push(n)),r||[]},dequeue:function(e,t){t=t||"fx";var n=F.queue(e,t),r=n.shift(),i={};"inprogress"===r&&(r=n.shift()),r&&("fx"===t&&n.unshift("inprogress"),F._data(e,t+".run",i),r.call(e,function(){F.dequeue(e,t)},i)),n.length||(F.removeData(e,t+"queue "+t+".run",!0),C(e,t,"queue"))}}),F.fn.extend({queue:function(e,n){return"string"!=typeof e&&(n=e,e="fx"),n===t?F.queue(this[0],e):this.each(function(){var t=F.queue(this,e,n);"fx"===e&&"inprogress"!==t[0]&&F.dequeue(this,e)})},dequeue:function(e){return this.each(function(){F.dequeue(this,e)})},delay:function(e,t){return e=F.fx?F.fx.speeds[e]||e:e,t=t||"fx",this.queue(t,function(t,n){var r=setTimeout(t,e);n.stop=function(){clearTimeout(r)}})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,n){function r(){--l||o.resolveWith(a,[a])}"string"!=typeof e&&(e,e=t),e=e||"fx";for(var i,o=F.Deferred(),a=this,s=a.length,l=1,c=e+"defer",u=e+"queue",h=e+"mark";s--;)(i=F.data(a[s],c,t,!0)||(F.data(a[s],u,t,!0)||F.data(a[s],h,t,!0))&&F.data(a[s],c,F.Callbacks("once memory"),!0))&&(l++,i.add(r));return r(),o.promise()}});var I,O,W,j=/[\n\t\r]/g,G=/\s+/,X=/\r/g,Y=/^(?:button|input)$/i,q=/^(?:button|input|object|select|textarea)$/i,K=/^a(?:rea)?$/i,$=/^(?:autofocus|autoplay|async|checked|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped|selected)$/i,Q=F.support.getSetAttribute;F.fn.extend({attr:function(e,t){return F.access(this,e,t,!0,F.attr)},removeAttr:function(e){return this.each(function(){F.removeAttr(this,e)})},prop:function(e,t){return F.access(this,e,t,!0,F.prop)},removeProp:function(e){return e=F.propFix[e]||e,this.each(function(){try{this[e]=t,delete this[e]}catch(e){}})},addClass:function(e){var t,n,r,i,o,a,s;if(F.isFunction(e))return this.each(function(t){F(this).addClass(e.call(this,t,this.className))});if(e&&"string"==typeof e)for(t=e.split(G),n=0,r=this.length;n<r;n++)if(i=this[n],1===i.nodeType)if(i.className||1!==t.length){for(o=" "+i.className+" ",a=0,s=t.length;a<s;a++)~o.indexOf(" "+t[a]+" ")||(o+=t[a]+" ");i.className=F.trim(o)}else i.className=e;return this},removeClass:function(e){var n,r,i,o,a,s,l;if(F.isFunction(e))return this.each(function(t){F(this).removeClass(e.call(this,t,this.className))});if(e&&"string"==typeof e||e===t)for(n=(e||"").split(G),r=0,i=this.length;r<i;r++)if(o=this[r],1===o.nodeType&&o.className)if(e){for(a=(" "+o.className+" ").replace(j," "),s=0,l=n.length;s<l;s++)a=a.replace(" "+n[s]+" "," ");o.className=F.trim(a)}else o.className="";return this},toggleClass:function(e,t){var n=typeof e,r="boolean"==typeof t;return F.isFunction(e)?this.each(function(n){F(this).toggleClass(e.call(this,n,this.className,t),t)}):this.each(function(){if("string"===n)for(var i,o=0,a=F(this),s=t,l=e.split(G);i=l[o++];)s=r?s:!a.hasClass(i),a[s?"addClass":"removeClass"](i);else"undefined"!==n&&"boolean"!==n||(this.className&&F._data(this,"__className__",this.className),this.className=this.className||!1===e?"":F._data(this,"__className__")||"")})},hasClass:function(e){for(var t=" "+e+" ",n=0,r=this.length;n<r;n++)if(1===this[n].nodeType&&(" "+this[n].className+" ").replace(j," ").indexOf(t)>-1)return!0;return!1},val:function(e){var n,r,i,o=this[0];return arguments.length?(i=F.isFunction(e),this.each(function(r){var o,a=F(this);1===this.nodeType&&(o=i?e.call(this,r,a.val()):e,null==o?o="":"number"==typeof o?o+="":F.isArray(o)&&(o=F.map(o,function(e){return null==e?"":e+""})),n=F.valHooks[this.nodeName.toLowerCase()]||F.valHooks[this.type],n&&"set"in n&&n.set(this,o,"value")!==t||(this.value=o))})):o?(n=F.valHooks[o.nodeName.toLowerCase()]||F.valHooks[o.type])&&"get"in n&&(r=n.get(o,"value"))!==t?r:(r=o.value,"string"==typeof r?r.replace(X,""):null==r?"":r):void 0}}),F.extend({valHooks:{option:{get:function(e){var t=e.attributes.value;return!t||t.specified?e.value:e.text}},select:{get:function(e){var t,n,r,i,o=e.selectedIndex,a=[],s=e.options,l="select-one"===e.type;if(o<0)return null;for(n=l?o:0,r=l?o+1:s.length;n<r;n++)if(i=s[n],i.selected&&(F.support.optDisabled?!i.disabled:null===i.getAttribute("disabled"))&&(!i.parentNode.disabled||!F.nodeName(i.parentNode,"optgroup"))){if(t=F(i).val(),l)return t;a.push(t)}return l&&!a.length&&s.length?F(s[o]).val():a},set:function(e,t){var n=F.makeArray(t);return F(e).find("option").each(function(){this.selected=F.inArray(F(this).val(),n)>=0}),n.length||(e.selectedIndex=-1),n}}},attrFn:{val:!0,css:!0,html:!0,text:!0,data:!0,width:!0,height:!0,offset:!0},attr:function(e,n,r,i){var o,a,s,l=e.nodeType;if(e&&3!==l&&8!==l&&2!==l)return i&&n in F.attrFn?F(e)[n](r):void 0===e.getAttribute?F.prop(e,n,r):((s=1!==l||!F.isXMLDoc(e))&&(n=n.toLowerCase(),a=F.attrHooks[n]||($.test(n)?O:I)),r!==t?null===r?void F.removeAttr(e,n):a&&"set"in a&&s&&(o=a.set(e,r,n))!==t?o:(e.setAttribute(n,""+r),r):a&&"get"in a&&s&&null!==(o=a.get(e,n))?o:(o=e.getAttribute(n),null===o?t:o))},removeAttr:function(e,t){var n,r,i,o,a=0;if(t&&1===e.nodeType)for(r=t.toLowerCase().split(G),o=r.length;a<o;a++)(i=r[a])&&(n=F.propFix[i]||i,F.attr(e,i,""),e.removeAttribute(Q?i:n),$.test(i)&&n in e&&(e[n]=!1))},attrHooks:{type:{set:function(e,t){if(Y.test(e.nodeName)&&e.parentNode)F.error("type property can't be changed");else if(!F.support.radioValue&&"radio"===t&&F.nodeName(e,"input")){var n=e.value;return e.setAttribute("type",t),n&&(e.value=n),t}}},value:{get:function(e,t){return I&&F.nodeName(e,"button")?I.get(e,t):t in e?e.value:null},set:function(e,t,n){if(I&&F.nodeName(e,"button"))return I.set(e,t,n);e.value=t}}},propFix:{tabindex:"tabIndex",readonly:"readOnly",for:"htmlFor",class:"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},prop:function(e,n,r){var i,o,a=e.nodeType;if(e&&3!==a&&8!==a&&2!==a)return(1!==a||!F.isXMLDoc(e))&&(n=F.propFix[n]||n,o=F.propHooks[n]),r!==t?o&&"set"in o&&(i=o.set(e,r,n))!==t?i:e[n]=r:o&&"get"in o&&null!==(i=o.get(e,n))?i:e[n]},propHooks:{tabIndex:{get:function(e){var n=e.getAttributeNode("tabindex");return n&&n.specified?parseInt(n.value,10):q.test(e.nodeName)||K.test(e.nodeName)&&e.href?0:t}}}}),F.attrHooks.tabindex=F.propHooks.tabIndex,O={get:function(e,n){var r,i=F.prop(e,n);return!0===i||"boolean"!=typeof i&&(r=e.getAttributeNode(n))&&!1!==r.nodeValue?n.toLowerCase():t},set:function(e,t,n){var r;return!1===t?F.removeAttr(e,n):(r=F.propFix[n]||n,r in e&&(e[r]=!0),e.setAttribute(n,n.toLowerCase())),n}},Q||(W={name:!0,id:!0},I=F.valHooks.button={get:function(e,n){var r;return r=e.getAttributeNode(n),r&&(W[n]?""!==r.nodeValue:r.specified)?r.nodeValue:t},set:function(e,t,n){var r=e.getAttributeNode(n);return r||(r=L.createAttribute(n),e.setAttributeNode(r)),r.nodeValue=t+""}},F.attrHooks.tabindex.set=I.set,F.each(["width","height"],function(e,t){F.attrHooks[t]=F.extend(F.attrHooks[t],{set:function(e,n){if(""===n)return e.setAttribute(t,"auto"),n}})}),F.attrHooks.contenteditable={get:I.get,set:function(e,t,n){""===t&&(t="false"),I.set(e,t,n)}}),F.support.hrefNormalized||F.each(["href","src","width","height"],function(e,n){F.attrHooks[n]=F.extend(F.attrHooks[n],{get:function(e){var r=e.getAttribute(n,2);return null===r?t:r}})}),F.support.style||(F.attrHooks.style={get:function(e){return e.style.cssText.toLowerCase()||t},set:function(e,t){return e.style.cssText=""+t}}),F.support.optSelected||(F.propHooks.selected=F.extend(F.propHooks.selected,{get:function(e){var t=e.parentNode;return t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex),null}})),F.support.enctype||(F.propFix.enctype="encoding"),F.support.checkOn||F.each(["radio","checkbox"],function(){F.valHooks[this]={get:function(e){return null===e.getAttribute("value")?"on":e.value}}}),F.each(["radio","checkbox"],function(){F.valHooks[this]=F.extend(F.valHooks[this],{set:function(e,t){if(F.isArray(t))return e.checked=F.inArray(F(e).val(),t)>=0}})});var Z=/^(?:textarea|input|select)$/i,J=/^([^\.]*)?(?:\.(.+))?$/,ee=/\bhover(\.\S+)?\b/,te=/^key/,ne=/^(?:mouse|contextmenu)|click/,re=/^(?:focusinfocus|focusoutblur)$/,ie=/^(\w*)(?:#([\w\-]+))?(?:\.([\w\-]+))?$/,oe=function(e){var t=ie.exec(e);return t&&(t[1]=(t[1]||"").toLowerCase(),t[3]=t[3]&&new RegExp("(?:^|\\s)"+t[3]+"(?:\\s|$)")),t},ae=function(e,t){var n=e.attributes||{};return(!t[1]||e.nodeName.toLowerCase()===t[1])&&(!t[2]||(n.id||{}).value===t[2])&&(!t[3]||t[3].test((n.class||{}).value))},se=function(e){return F.event.special.hover?e:e.replace(ee,"mouseenter$1 mouseleave$1")};F.event={add:function(e,n,r,i,o){var a,s,l,c,u,h,f,d,p,m,v;if(3!==e.nodeType&&8!==e.nodeType&&n&&r&&(a=F._data(e))){for(r.handler&&(p=r,r=p.handler),r.guid||(r.guid=F.guid++),l=a.events,l||(a.events=l={}),s=a.handle,s||(a.handle=s=function(e){return void 0===F||e&&F.event.triggered===e.type?t:F.event.dispatch.apply(s.elem,arguments)},s.elem=e),n=F.trim(se(n)).split(" "),c=0;c<n.length;c++)u=J.exec(n[c])||[],h=u[1],f=(u[2]||"").split(".").sort(),v=F.event.special[h]||{},h=(o?v.delegateType:v.bindType)||h,v=F.event.special[h]||{},d=F.extend({type:h,origType:u[1],data:i,handler:r,guid:r.guid,selector:o,quick:oe(o),namespace:f.join(".")},p),m=l[h],m||(m=l[h]=[],m.delegateCount=0,v.setup&&!1!==v.setup.call(e,i,f,s)||(e.addEventListener?e.addEventListener(h,s,!1):e.attachEvent&&e.attachEvent("on"+h,s))),v.add&&(v.add.call(e,d),d.handler.guid||(d.handler.guid=r.guid)),o?m.splice(m.delegateCount++,0,d):m.push(d),F.event.global[h]=!0;e=null}},global:{},remove:function(e,t,n,r,i){var o,a,s,l,c,u,h,f,d,p,m,v,g=F.hasData(e)&&F._data(e);if(g&&(f=g.events)){for(t=F.trim(se(t||"")).split(" "),o=0;o<t.length;o++)if(a=J.exec(t[o])||[],s=l=a[1],c=a[2],s){for(d=F.event.special[s]||{},s=(r?d.delegateType:d.bindType)||s,m=f[s]||[],u=m.length,c=c?new RegExp("(^|\\.)"+c.split(".").sort().join("\\.(?:.*\\.)?")+"(\\.|$)"):null,h=0;h<m.length;h++)v=m[h],(i||l===v.origType)&&(!n||n.guid===v.guid)&&(!c||c.test(v.namespace))&&(!r||r===v.selector||"**"===r&&v.selector)&&(m.splice(h--,1),v.selector&&m.delegateCount--,d.remove&&d.remove.call(e,v));0===m.length&&u!==m.length&&((!d.teardown||!1===d.teardown.call(e,c))&&F.removeEvent(e,s,g.handle),delete f[s])}else for(s in f)F.event.remove(e,s+t[o],n,r,!0);F.isEmptyObject(f)&&(p=g.handle,p&&(p.elem=null),F.removeData(e,["events","handle"],!0))}},customEvent:{getData:!0,setData:!0,changeData:!0},trigger:function(n,r,i,o){if(!i||3!==i.nodeType&&8!==i.nodeType){var a,s,l,c,u,h,f,d,p,m,v=n.type||n,g=[];if(re.test(v+F.event.triggered))return;if(v.indexOf("!")>=0&&(v=v.slice(0,-1),s=!0),v.indexOf(".")>=0&&(g=v.split("."),v=g.shift(),g.sort()),(!i||F.event.customEvent[v])&&!F.event.global[v])return;if(n="object"==typeof n?n[F.expando]?n:new F.Event(v,n):new F.Event(v),n.type=v,n.isTrigger=!0,n.exclusive=s,n.namespace=g.join("."),n.namespace_re=n.namespace?new RegExp("(^|\\.)"+g.join("\\.(?:.*\\.)?")+"(\\.|$)"):null,h=v.indexOf(":")<0?"on"+v:"",!i){a=F.cache
;for(l in a)a[l].events&&a[l].events[v]&&F.event.trigger(n,r,a[l].handle.elem,!0);return}if(n.result=t,n.target||(n.target=i),r=null!=r?F.makeArray(r):[],r.unshift(n),f=F.event.special[v]||{},f.trigger&&!1===f.trigger.apply(i,r))return;if(p=[[i,f.bindType||v]],!o&&!f.noBubble&&!F.isWindow(i)){for(m=f.delegateType||v,c=re.test(m+v)?i:i.parentNode,u=null;c;c=c.parentNode)p.push([c,m]),u=c;u&&u===i.ownerDocument&&p.push([u.defaultView||u.parentWindow||e,m])}for(l=0;l<p.length&&!n.isPropagationStopped();l++)c=p[l][0],n.type=p[l][1],d=(F._data(c,"events")||{})[n.type]&&F._data(c,"handle"),d&&d.apply(c,r),(d=h&&c[h])&&F.acceptData(c)&&!1===d.apply(c,r)&&n.preventDefault();return n.type=v,!o&&!n.isDefaultPrevented()&&(!f._default||!1===f._default.apply(i.ownerDocument,r))&&("click"!==v||!F.nodeName(i,"a"))&&F.acceptData(i)&&h&&i[v]&&("focus"!==v&&"blur"!==v||0!==n.target.offsetWidth)&&!F.isWindow(i)&&(u=i[h],u&&(i[h]=null),F.event.triggered=v,i[v](),F.event.triggered=t,u&&(i[h]=u)),n.result}},dispatch:function(n){n=F.event.fix(n||e.event);var r,i,o,a,s,l,c,u,h,f,d=(F._data(this,"events")||{})[n.type]||[],p=d.delegateCount,m=[].slice.call(arguments,0),v=!n.exclusive&&!n.namespace,g=[];if(m[0]=n,n.delegateTarget=this,p&&!n.target.disabled&&(!n.button||"click"!==n.type))for(a=F(this),a.context=this.ownerDocument||this,o=n.target;o!=this;o=o.parentNode||this){for(l={},u=[],a[0]=o,r=0;r<p;r++)h=d[r],f=h.selector,l[f]===t&&(l[f]=h.quick?ae(o,h.quick):a.is(f)),l[f]&&u.push(h);u.length&&g.push({elem:o,matches:u})}for(d.length>p&&g.push({elem:this,matches:d.slice(p)}),r=0;r<g.length&&!n.isPropagationStopped();r++)for(c=g[r],n.currentTarget=c.elem,i=0;i<c.matches.length&&!n.isImmediatePropagationStopped();i++)h=c.matches[i],(v||!n.namespace&&!h.namespace||n.namespace_re&&n.namespace_re.test(h.namespace))&&(n.data=h.data,n.handleObj=h,(s=((F.event.special[h.origType]||{}).handle||h.handler).apply(c.elem,m))!==t&&(n.result=s,!1===s&&(n.preventDefault(),n.stopPropagation())));return n.result},props:"attrChange attrName relatedNode srcElement altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(e,t){return null==e.which&&(e.which=null!=t.charCode?t.charCode:t.keyCode),e}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(e,n){var r,i,o,a=n.button,s=n.fromElement;return null==e.pageX&&null!=n.clientX&&(r=e.target.ownerDocument||L,i=r.documentElement,o=r.body,e.pageX=n.clientX+(i&&i.scrollLeft||o&&o.scrollLeft||0)-(i&&i.clientLeft||o&&o.clientLeft||0),e.pageY=n.clientY+(i&&i.scrollTop||o&&o.scrollTop||0)-(i&&i.clientTop||o&&o.clientTop||0)),!e.relatedTarget&&s&&(e.relatedTarget=s===e.target?n.toElement:s),!e.which&&a!==t&&(e.which=1&a?1:2&a?3:4&a?2:0),e}},fix:function(e){if(e[F.expando])return e;var n,r,i=e,o=F.event.fixHooks[e.type]||{},a=o.props?this.props.concat(o.props):this.props;for(e=F.Event(i),n=a.length;n;)r=a[--n],e[r]=i[r];return e.target||(e.target=i.srcElement||L),3===e.target.nodeType&&(e.target=e.target.parentNode),e.metaKey===t&&(e.metaKey=e.ctrlKey),o.filter?o.filter(e,i):e},special:{ready:{setup:F.bindReady},load:{noBubble:!0},focus:{delegateType:"focusin"},blur:{delegateType:"focusout"},beforeunload:{setup:function(e,t,n){F.isWindow(this)&&(this.onbeforeunload=n)},teardown:function(e,t){this.onbeforeunload===t&&(this.onbeforeunload=null)}}},simulate:function(e,t,n,r){var i=F.extend(new F.Event,n,{type:e,isSimulated:!0,originalEvent:{}});r?F.event.trigger(i,null,t):F.event.dispatch.call(t,i),i.isDefaultPrevented()&&n.preventDefault()}},F.event.handle=F.event.dispatch,F.removeEvent=L.removeEventListener?function(e,t,n){e.removeEventListener&&e.removeEventListener(t,n,!1)}:function(e,t,n){e.detachEvent&&e.detachEvent("on"+t,n)},F.Event=function(e,t){if(!(this instanceof F.Event))return new F.Event(e,t);e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||!1===e.returnValue||e.getPreventDefault&&e.getPreventDefault()?M:S):this.type=e,t&&F.extend(this,t),this.timeStamp=e&&e.timeStamp||F.now(),this[F.expando]=!0},F.Event.prototype={preventDefault:function(){this.isDefaultPrevented=M;var e=this.originalEvent;!e||(e.preventDefault?e.preventDefault():e.returnValue=!1)},stopPropagation:function(){this.isPropagationStopped=M;var e=this.originalEvent;!e||(e.stopPropagation&&e.stopPropagation(),e.cancelBubble=!0)},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=M,this.stopPropagation()},isDefaultPrevented:S,isPropagationStopped:S,isImmediatePropagationStopped:S},F.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(e,t){F.event.special[e]={delegateType:t,bindType:t,handle:function(e){var n,r=this,i=e.relatedTarget,o=e.handleObj;o.selector;return i&&(i===r||F.contains(r,i))||(e.type=o.origType,n=o.handler.apply(this,arguments),e.type=t),n}}}),F.support.submitBubbles||(F.event.special.submit={setup:function(){if(F.nodeName(this,"form"))return!1;F.event.add(this,"click._submit keypress._submit",function(e){var n=e.target,r=F.nodeName(n,"input")||F.nodeName(n,"button")?n.form:t;r&&!r._submit_attached&&(F.event.add(r,"submit._submit",function(e){this.parentNode&&!e.isTrigger&&F.event.simulate("submit",this.parentNode,e,!0)}),r._submit_attached=!0)})},teardown:function(){if(F.nodeName(this,"form"))return!1;F.event.remove(this,"._submit")}}),F.support.changeBubbles||(F.event.special.change={setup:function(){if(Z.test(this.nodeName))return"checkbox"!==this.type&&"radio"!==this.type||(F.event.add(this,"propertychange._change",function(e){"checked"===e.originalEvent.propertyName&&(this._just_changed=!0)}),F.event.add(this,"click._change",function(e){this._just_changed&&!e.isTrigger&&(this._just_changed=!1,F.event.simulate("change",this,e,!0))})),!1;F.event.add(this,"beforeactivate._change",function(e){var t=e.target;Z.test(t.nodeName)&&!t._change_attached&&(F.event.add(t,"change._change",function(e){this.parentNode&&!e.isSimulated&&!e.isTrigger&&F.event.simulate("change",this.parentNode,e,!0)}),t._change_attached=!0)})},handle:function(e){var t=e.target;if(this!==t||e.isSimulated||e.isTrigger||"radio"!==t.type&&"checkbox"!==t.type)return e.handleObj.handler.apply(this,arguments)},teardown:function(){return F.event.remove(this,"._change"),Z.test(this.nodeName)}}),F.support.focusinBubbles||F.each({focus:"focusin",blur:"focusout"},function(e,t){var n=0,r=function(e){F.event.simulate(t,e.target,F.event.fix(e),!0)};F.event.special[t]={setup:function(){0==n++&&L.addEventListener(e,r,!0)},teardown:function(){0==--n&&L.removeEventListener(e,r,!0)}}}),F.fn.extend({on:function(e,n,r,i,o){var a,s;if("object"==typeof e){"string"!=typeof n&&(r=n,n=t);for(s in e)this.on(s,n,r,e[s],o);return this}if(null==r&&null==i?(i=n,r=n=t):null==i&&("string"==typeof n?(i=r,r=t):(i=r,r=n,n=t)),!1===i)i=S;else if(!i)return this;return 1===o&&(a=i,i=function(e){return F().off(e),a.apply(this,arguments)},i.guid=a.guid||(a.guid=F.guid++)),this.each(function(){F.event.add(this,e,i,r,n)})},one:function(e,t,n,r){return this.on.call(this,e,t,n,r,1)},off:function(e,n,r){if(e&&e.preventDefault&&e.handleObj){var i=e.handleObj;return F(e.delegateTarget).off(i.namespace?i.type+"."+i.namespace:i.type,i.selector,i.handler),this}if("object"==typeof e){for(var o in e)this.off(o,n,e[o]);return this}return!1!==n&&"function"!=typeof n||(r=n,n=t),!1===r&&(r=S),this.each(function(){F.event.remove(this,e,r,n)})},bind:function(e,t,n){return this.on(e,null,t,n)},unbind:function(e,t){return this.off(e,null,t)},live:function(e,t,n){return F(this.context).on(e,this.selector,t,n),this},die:function(e,t){return F(this.context).off(e,this.selector||"**",t),this},delegate:function(e,t,n,r){return this.on(t,e,n,r)},undelegate:function(e,t,n){return 1==arguments.length?this.off(e,"**"):this.off(t,e,n)},trigger:function(e,t){return this.each(function(){F.event.trigger(e,t,this)})},triggerHandler:function(e,t){if(this[0])return F.event.trigger(e,t,this[0],!0)},toggle:function(e){var t=arguments,n=e.guid||F.guid++,r=0,i=function(n){var i=(F._data(this,"lastToggle"+e.guid)||0)%r;return F._data(this,"lastToggle"+e.guid,i+1),n.preventDefault(),t[i].apply(this,arguments)||!1};for(i.guid=n;r<t.length;)t[r++].guid=n;return this.click(i)},hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)}}),F.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(e,t){F.fn[t]=function(e,n){return null==n&&(n=e,e=null),arguments.length>0?this.on(t,null,e,n):this.trigger(t)},F.attrFn&&(F.attrFn[t]=!0),te.test(t)&&(F.event.fixHooks[t]=F.event.keyHooks),ne.test(t)&&(F.event.fixHooks[t]=F.event.mouseHooks)}),function(){function e(e,t,n,r,o,a){for(var s=0,l=r.length;s<l;s++){var c=r[s];if(c){var u=!1;for(c=c[e];c;){if(c[i]===n){u=r[c.sizset];break}if(1===c.nodeType)if(a||(c[i]=n,c.sizset=s),"string"!=typeof t){if(c===t){u=!0;break}}else if(f.filter(t,[c]).length>0){u=c;break}c=c[e]}r[s]=u}}}function n(e,t,n,r,o,a){for(var s=0,l=r.length;s<l;s++){var c=r[s];if(c){var u=!1;for(c=c[e];c;){if(c[i]===n){u=r[c.sizset];break}if(1===c.nodeType&&!a&&(c[i]=n,c.sizset=s),c.nodeName.toLowerCase()===t){u=c;break}c=c[e]}r[s]=u}}}var r=/((?:\((?:\([^()]+\)|[^()]+)+\)|\[(?:\[[^\[\]]*\]|['"][^'"]*['"]|[^\[\]'"]+)+\]|\\.|[^ >+~,(\[\\]+)+|[>+~])(\s*,\s*)?((?:.|\r|\n)*)/g,i="sizcache"+(Math.random()+"").replace(".",""),o=0,a=Object.prototype.toString,s=!1,l=!0,c=/\\/g,u=/\r\n/g,h=/\W/;[0,0].sort(function(){return l=!1,0});var f=function(e,t,n,i){n=n||[],t=t||L;var o=t;if(1!==t.nodeType&&9!==t.nodeType)return[];if(!e||"string"!=typeof e)return n;var s,l,c,u,h,d,v,g,y=!0,x=f.isXML(t),b=[],R=e;do{if(r.exec(""),(s=r.exec(R))&&(R=s[3],b.push(s[1]),s[2])){u=s[3];break}}while(s);if(b.length>1&&m.exec(e))if(2===b.length&&p.relative[b[0]])l=T(b[0]+b[1],t,i);else for(l=p.relative[b[0]]?[t]:f(b.shift(),t);b.length;)e=b.shift(),p.relative[e]&&(e+=b.shift()),l=T(e,l,i);else if(!i&&b.length>1&&9===t.nodeType&&!x&&p.match.ID.test(b[0])&&!p.match.ID.test(b[b.length-1])&&(h=f.find(b.shift(),t,x),t=h.expr?f.filter(h.expr,h.set)[0]:h.set[0]),t)for(h=i?{expr:b.pop(),set:E(i)}:f.find(b.pop(),1!==b.length||"~"!==b[0]&&"+"!==b[0]||!t.parentNode?t:t.parentNode,x),l=h.expr?f.filter(h.expr,h.set):h.set,b.length>0?c=E(l):y=!1;b.length;)d=b.pop(),v=d,p.relative[d]?v=b.pop():d="",null==v&&(v=t),p.relative[d](c,v,x);else c=b=[];if(c||(c=l),c||f.error(d||e),"[object Array]"===a.call(c))if(y)if(t&&1===t.nodeType)for(g=0;null!=c[g];g++)c[g]&&(!0===c[g]||1===c[g].nodeType&&f.contains(t,c[g]))&&n.push(l[g]);else for(g=0;null!=c[g];g++)c[g]&&1===c[g].nodeType&&n.push(l[g]);else n.push.apply(n,c);else E(c,n);return u&&(f(u,o,n,i),f.uniqueSort(n)),n};f.uniqueSort=function(e){if(y&&(s=l,e.sort(y),s))for(var t=1;t<e.length;t++)e[t]===e[t-1]&&e.splice(t--,1);return e},f.matches=function(e,t){return f(e,null,null,t)},f.matchesSelector=function(e,t){return f(t,null,null,[e]).length>0},f.find=function(e,t,n){var r,i,o,a,s,l;if(!e)return[];for(i=0,o=p.order.length;i<o;i++)if(s=p.order[i],(a=p.leftMatch[s].exec(e))&&(l=a[1],a.splice(1,1),"\\"!==l.substr(l.length-1)&&(a[1]=(a[1]||"").replace(c,""),null!=(r=p.find[s](a,t,n))))){e=e.replace(p.match[s],"");break}return r||(r=void 0!==t.getElementsByTagName?t.getElementsByTagName("*"):[]),{set:r,expr:e}},f.filter=function(e,n,r,i){for(var o,a,s,l,c,u,h,d,m,v=e,g=[],E=n,y=n&&n[0]&&f.isXML(n[0]);e&&n.length;){for(s in p.filter)if(null!=(o=p.leftMatch[s].exec(e))&&o[2]){if(u=p.filter[s],h=o[1],a=!1,o.splice(1,1),"\\"===h.substr(h.length-1))continue;if(E===g&&(g=[]),p.preFilter[s])if(o=p.preFilter[s](o,E,r,g,i,y)){if(!0===o)continue}else a=l=!0;if(o)for(d=0;null!=(c=E[d]);d++)c&&(l=u(c,o,d,E),m=i^l,r&&null!=l?m?a=!0:E[d]=!1:m&&(g.push(c),a=!0));if(l!==t){if(r||(E=g),e=e.replace(p.match[s],""),!a)return[];break}}if(e===v){if(null!=a)break;f.error(e)}v=e}return E},f.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)};var d=f.getText=function(e){var t,n,r=e.nodeType,i="";if(r){if(1===r||9===r){if("string"==typeof e.textContent)return e.textContent;if("string"==typeof e.innerText)return e.innerText.replace(u,"");for(e=e.firstChild;e;e=e.nextSibling)i+=d(e)}else if(3===r||4===r)return e.nodeValue}else for(t=0;n=e[t];t++)8!==n.nodeType&&(i+=d(n));return i},p=f.selectors={order:["ID","NAME","TAG"],match:{ID:/#((?:[\w\u00c0-\uFFFF\-]|\\.)+)/,CLASS:/\.((?:[\w\u00c0-\uFFFF\-]|\\.)+)/,NAME:/\[name=['"]*((?:[\w\u00c0-\uFFFF\-]|\\.)+)['"]*\]/,ATTR:/\[\s*((?:[\w\u00c0-\uFFFF\-]|\\.)+)\s*(?:(\S?=)\s*(?:(['"])(.*?)\3|(#?(?:[\w\u00c0-\uFFFF\-]|\\.)*)|)|)\s*\]/,TAG:/^((?:[\w\u00c0-\uFFFF\*\-]|\\.)+)/,CHILD:/:(only|nth|last|first)-child(?:\(\s*(even|odd|(?:[+\-]?\d+|(?:[+\-]?\d*)?n\s*(?:[+\-]\s*\d+)?))\s*\))?/,POS:/:(nth|eq|gt|lt|first|last|even|odd)(?:\((\d*)\))?(?=[^\-]|$)/,PSEUDO:/:((?:[\w\u00c0-\uFFFF\-]|\\.)+)(?:\((['"]?)((?:\([^\)]+\)|[^\(\)]*)+)\2\))?/},leftMatch:{},attrMap:{class:"className",for:"htmlFor"},attrHandle:{href:function(e){return e.getAttribute("href")},type:function(e){return e.getAttribute("type")}},relative:{"+":function(e,t){var n="string"==typeof t,r=n&&!h.test(t),i=n&&!r;r&&(t=t.toLowerCase());for(var o,a=0,s=e.length;a<s;a++)if(o=e[a]){for(;(o=o.previousSibling)&&1!==o.nodeType;);e[a]=i||o&&o.nodeName.toLowerCase()===t?o||!1:o===t}i&&f.filter(t,e,!0)},">":function(e,t){var n,r="string"==typeof t,i=0,o=e.length;if(r&&!h.test(t)){for(t=t.toLowerCase();i<o;i++)if(n=e[i]){var a=n.parentNode;e[i]=a.nodeName.toLowerCase()===t&&a}}else{for(;i<o;i++)(n=e[i])&&(e[i]=r?n.parentNode:n.parentNode===t);r&&f.filter(t,e,!0)}},"":function(t,r,i){var a,s=o++,l=e;"string"==typeof r&&!h.test(r)&&(r=r.toLowerCase(),a=r,l=n),l("parentNode",r,s,t,a,i)},"~":function(t,r,i){var a,s=o++,l=e;"string"==typeof r&&!h.test(r)&&(r=r.toLowerCase(),a=r,l=n),l("previousSibling",r,s,t,a,i)}},find:{ID:function(e,t,n){if(void 0!==t.getElementById&&!n){var r=t.getElementById(e[1]);return r&&r.parentNode?[r]:[]}},NAME:function(e,t){if(void 0!==t.getElementsByName){for(var n=[],r=t.getElementsByName(e[1]),i=0,o=r.length;i<o;i++)r[i].getAttribute("name")===e[1]&&n.push(r[i]);return 0===n.length?null:n}},TAG:function(e,t){if(void 0!==t.getElementsByTagName)return t.getElementsByTagName(e[1])}},preFilter:{CLASS:function(e,t,n,r,i,o){if(e=" "+e[1].replace(c,"")+" ",o)return e;for(var a,s=0;null!=(a=t[s]);s++)a&&(i^(a.className&&(" "+a.className+" ").replace(/[\t\n\r]/g," ").indexOf(e)>=0)?n||r.push(a):n&&(t[s]=!1));return!1},ID:function(e){return e[1].replace(c,"")},TAG:function(e,t){return e[1].replace(c,"").toLowerCase()},CHILD:function(e){if("nth"===e[1]){e[2]||f.error(e[0]),e[2]=e[2].replace(/^\+|\s*/g,"");var t=/(-?)(\d*)(?:n([+\-]?\d*))?/.exec("even"===e[2]&&"2n"||"odd"===e[2]&&"2n+1"||!/\D/.test(e[2])&&"0n+"+e[2]||e[2]);e[2]=t[1]+(t[2]||1)-0,e[3]=t[3]-0}else e[2]&&f.error(e[0]);return e[0]=o++,e},ATTR:function(e,t,n,r,i,o){var a=e[1]=e[1].replace(c,"");return!o&&p.attrMap[a]&&(e[1]=p.attrMap[a]),e[4]=(e[4]||e[5]||"").replace(c,""),"~="===e[2]&&(e[4]=" "+e[4]+" "),e},PSEUDO:function(e,t,n,i,o){if("not"===e[1]){if(!((r.exec(e[3])||"").length>1||/^\w/.test(e[3]))){var a=f.filter(e[3],t,n,!0^o);return n||i.push.apply(i,a),!1}e[3]=f(e[3],null,null,t)}else if(p.match.POS.test(e[0])||p.match.CHILD.test(e[0]))return!0;return e},POS:function(e){return e.unshift(!0),e}},filters:{enabled:function(e){return!1===e.disabled&&"hidden"!==e.type},disabled:function(e){return!0===e.disabled},checked:function(e){return!0===e.checked},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,!0===e.selected},parent:function(e){return!!e.firstChild},empty:function(e){return!e.firstChild},has:function(e,t,n){return!!f(n[3],e).length},header:function(e){return/h\d/i.test(e.nodeName)},text:function(e){var t=e.getAttribute("type"),n=e.type;return"input"===e.nodeName.toLowerCase()&&"text"===n&&(t===n||null===t)},radio:function(e){return"input"===e.nodeName.toLowerCase()&&"radio"===e.type},checkbox:function(e){return"input"===e.nodeName.toLowerCase()&&"checkbox"===e.type},file:function(e){return"input"===e.nodeName.toLowerCase()&&"file"===e.type},password:function(e){return"input"===e.nodeName.toLowerCase()&&"password"===e.type},submit:function(e){var t=e.nodeName.toLowerCase();return("input"===t||"button"===t)&&"submit"===e.type},image:function(e){return"input"===e.nodeName.toLowerCase()&&"image"===e.type},reset:function(e){var t=e.nodeName.toLowerCase();return("input"===t||"button"===t)&&"reset"===e.type},button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},input:function(e){return/input|select|textarea|button/i.test(e.nodeName)},focus:function(e){return e===e.ownerDocument.activeElement}},setFilters:{first:function(e,t){return 0===t},last:function(e,t,n,r){return t===r.length-1},even:function(e,t){return t%2==0},odd:function(e,t){return t%2==1},lt:function(e,t,n){return t<n[3]-0},gt:function(e,t,n){return t>n[3]-0},nth:function(e,t,n){return n[3]-0===t},eq:function(e,t,n){return n[3]-0===t}},filter:{PSEUDO:function(e,t,n,r){var i=t[1],o=p.filters[i];if(o)return o(e,n,t,r);if("contains"===i)return(e.textContent||e.innerText||d([e])||"").indexOf(t[3])>=0;if("not"===i){for(var a=t[3],s=0,l=a.length;s<l;s++)if(a[s]===e)return!1;return!0}f.error(i)},CHILD:function(e,t){var n,r,o,a,s,l,c=t[1],u=e;switch(c){case"only":case"first":for(;u=u.previousSibling;)if(1===u.nodeType)return!1;if("first"===c)return!0;u=e;case"last":for(;u=u.nextSibling;)if(1===u.nodeType)return!1;return!0;case"nth":if(n=t[2],r=t[3],1===n&&0===r)return!0;if(o=t[0],(a=e.parentNode)&&(a[i]!==o||!e.nodeIndex)){for(s=0,u=a.firstChild;u;u=u.nextSibling)1===u.nodeType&&(u.nodeIndex=++s);a[i]=o}return l=e.nodeIndex-r,0===n?0===l:l%n==0&&l/n>=0}},ID:function(e,t){return 1===e.nodeType&&e.getAttribute("id")===t},TAG:function(e,t){return"*"===t&&1===e.nodeType||!!e.nodeName&&e.nodeName.toLowerCase()===t},CLASS:function(e,t){return(" "+(e.className||e.getAttribute("class"))+" ").indexOf(t)>-1},ATTR:function(e,t){var n=t[1],r=f.attr?f.attr(e,n):p.attrHandle[n]?p.attrHandle[n](e):null!=e[n]?e[n]:e.getAttribute(n),i=r+"",o=t[2],a=t[4];return null==r?"!="===o:!o&&f.attr?null!=r:"="===o?i===a:"*="===o?i.indexOf(a)>=0:"~="===o?(" "+i+" ").indexOf(a)>=0:a?"!="===o?i!==a:"^="===o?0===i.indexOf(a):"$="===o?i.substr(i.length-a.length)===a:"|="===o&&(i===a||i.substr(0,a.length+1)===a+"-"):i&&!1!==r},POS:function(e,t,n,r){var i=t[2],o=p.setFilters[i];if(o)return o(e,n,t,r)}}},m=p.match.POS,v=function(e,t){return"\\"+(t-0+1)};for(var g in p.match)p.match[g]=new RegExp(p.match[g].source+/(?![^\[]*\])(?![^\(]*\))/.source),p.leftMatch[g]=new RegExp(/(^(?:.|\r|\n)*?)/.source+p.match[g].source.replace(/\\(\d+)/g,v));var E=function(e,t){return e=Array.prototype.slice.call(e,0),t?(t.push.apply(t,e),t):e};try{Array.prototype.slice.call(L.documentElement.childNodes,0)[0].nodeType}catch(e){E=function(e,t){var n=0,r=t||[];if("[object Array]"===a.call(e))Array.prototype.push.apply(r,e);else if("number"==typeof e.length)for(var i=e.length;n<i;n++)r.push(e[n]);else for(;e[n];n++)r.push(e[n]);return r}}var y,x;L.documentElement.compareDocumentPosition?y=function(e,t){return e===t?(s=!0,0):e.compareDocumentPosition&&t.compareDocumentPosition?4&e.compareDocumentPosition(t)?-1:1:e.compareDocumentPosition?-1:1}:(y=function(e,t){if(e===t)return s=!0,0;if(e.sourceIndex&&t.sourceIndex)return e.sourceIndex-t.sourceIndex;var n,r,i=[],o=[],a=e.parentNode,l=t.parentNode,c=a;if(a===l)return x(e,t);if(!a)return-1;if(!l)return 1;for(;c;)i.unshift(c),c=c.parentNode;for(c=l;c;)o.unshift(c),c=c.parentNode;n=i.length,r=o.length;for(var u=0;u<n&&u<r;u++)if(i[u]!==o[u])return x(i[u],o[u]);return u===n?x(e,o[u],-1):x(i[u],t,1)},x=function(e,t,n){if(e===t)return n;for(var r=e.nextSibling;r;){if(r===t)return-1;r=r.nextSibling}return 1}),function(){var e=L.createElement("div"),n="script"+(new Date).getTime(),r=L.documentElement;e.innerHTML="<a name='"+n+"'/>",r.insertBefore(e,r.firstChild),L.getElementById(n)&&(p.find.ID=function(e,n,r){if(void 0!==n.getElementById&&!r){var i=n.getElementById(e[1]);return i?i.id===e[1]||void 0!==i.getAttributeNode&&i.getAttributeNode("id").nodeValue===e[1]?[i]:t:[]}},p.filter.ID=function(e,t){var n=void 0!==e.getAttributeNode&&e.getAttributeNode("id");return 1===e.nodeType&&n&&n.nodeValue===t}),r.removeChild(e),r=e=null}(),function(){var e=L.createElement("div");e.appendChild(L.createComment("")),e.getElementsByTagName("*").length>0&&(p.find.TAG=function(e,t){var n=t.getElementsByTagName(e[1]);if("*"===e[1]){for(var r=[],i=0;n[i];i++)1===n[i].nodeType&&r.push(n[i]);n=r}return n}),e.innerHTML="<a href='#'></a>",e.firstChild&&void 0!==e.firstChild.getAttribute&&"#"!==e.firstChild.getAttribute("href")&&(p.attrHandle.href=function(e){return e.getAttribute("href",2)}),e=null}(),L.querySelectorAll&&function(){var e=f,t=L.createElement("div");if(t.innerHTML="<p class='TEST'></p>",!t.querySelectorAll||0!==t.querySelectorAll(".TEST").length){f=function(t,n,r,i){if(n=n||L,!i&&!f.isXML(n)){var o=/^(\w+$)|^\.([\w\-]+$)|^#([\w\-]+$)/.exec(t);if(o&&(1===n.nodeType||9===n.nodeType)){if(o[1])return E(n.getElementsByTagName(t),r);if(o[2]&&p.find.CLASS&&n.getElementsByClassName)return E(n.getElementsByClassName(o[2]),r)}if(9===n.nodeType){if("body"===t&&n.body)return E([n.body],r);if(o&&o[3]){var a=n.getElementById(o[3]);if(!a||!a.parentNode)return E([],r);if(a.id===o[3])return E([a],r)}try{return E(n.querySelectorAll(t),r)}catch(e){}}else if(1===n.nodeType&&"object"!==n.nodeName.toLowerCase()){var s=n,l=n.getAttribute("id"),c=l||"__sizzle__",u=n.parentNode,h=/^\s*[+~]/.test(t);l?c=c.replace(/'/g,"\\$&"):n.setAttribute("id",c),h&&u&&(n=n.parentNode);try{if(!h||u)return E(n.querySelectorAll("[id='"+c+"'] "+t),r)}catch(e){}finally{l||s.removeAttribute("id")}}}return e(t,n,r,i)};for(var n in e)f[n]=e[n];t=null}}(),function(){var e=L.documentElement,t=e.matchesSelector||e.mozMatchesSelector||e.webkitMatchesSelector||e.msMatchesSelector;if(t){var n=!t.call(L.createElement("div"),"div"),r=!1;try{t.call(L.documentElement,"[test!='']:sizzle")}catch(e){r=!0}f.matchesSelector=function(e,i){if(i=i.replace(/\=\s*([^'"\]]*)\s*\]/g,"='$1']"),!f.isXML(e))try{if(r||!p.match.PSEUDO.test(i)&&!/!=/.test(i)){var o=t.call(e,i);if(o||!n||e.document&&11!==e.document.nodeType)return o}}catch(e){}return f(i,null,null,[e]).length>0}}}(),function(){var e=L.createElement("div");if(e.innerHTML="<div class='test e'></div><div class='test'></div>",e.getElementsByClassName&&0!==e.getElementsByClassName("e").length){if(e.lastChild.className="e",1===e.getElementsByClassName("e").length)return;p.order.splice(1,0,"CLASS"),p.find.CLASS=function(e,t,n){if(void 0!==t.getElementsByClassName&&!n)return t.getElementsByClassName(e[1])},e=null}}(),L.documentElement.contains?f.contains=function(e,t){return e!==t&&(!e.contains||e.contains(t))}:L.documentElement.compareDocumentPosition?f.contains=function(e,t){return!!(16&e.compareDocumentPosition(t))}:f.contains=function(){return!1},f.isXML=function(e){var t=(e?e.ownerDocument||e:0).documentElement;return!!t&&"HTML"!==t.nodeName};var T=function(e,t,n){for(var r,i=[],o="",a=t.nodeType?[t]:t;r=p.match.PSEUDO.exec(e);)o+=r[0],e=e.replace(p.match.PSEUDO,"");e=p.relative[e]?e+"*":e;for(var s=0,l=a.length;s<l;s++)f(e,a[s],i,n);return f.filter(o,i)};f.attr=F.attr,f.selectors.attrMap={},F.find=f,F.expr=f.selectors,F.expr[":"]=F.expr.filters,F.unique=f.uniqueSort,F.text=f.getText,F.isXMLDoc=f.isXML,F.contains=f.contains}();var le=/Until$/,ce=/^(?:parents|prevUntil|prevAll)/,ue=/,/,he=/^.[^:#\[\.,]*$/,fe=Array.prototype.slice,de=F.expr.match.POS,pe={children:!0,contents:!0,next:!0,prev:!0};F.fn.extend({find:function(e){var t,n,r=this;if("string"!=typeof e)return F(e).filter(function(){for(t=0,n=r.length;t<n;t++)if(F.contains(r[t],this))return!0});var i,o,a,s=this.pushStack("","find",e);for(t=0,n=this.length;t<n;t++)if(i=s.length,F.find(e,this[t],s),t>0)for(o=i;o<s.length;o++)for(a=0;a<i;a++)if(s[a]===s[o]){s.splice(o--,1);break}return s},has:function(e){var t=F(e);return this.filter(function(){for(var e=0,n=t.length;e<n;e++)if(F.contains(this,t[e]))return!0})},not:function(e){return this.pushStack(_(this,e,!1),"not",e)},filter:function(e){return this.pushStack(_(this,e,!0),"filter",e)},is:function(e){return!!e&&("string"==typeof e?de.test(e)?F(e,this.context).index(this[0])>=0:F.filter(e,this).length>0:this.filter(e).length>0)},closest:function(e,t){var n,r,i=[],o=this[0];if(F.isArray(e)){for(var a=1;o&&o.ownerDocument&&o!==t;){for(n=0;n<e.length;n++)F(o).is(e[n])&&i.push({selector:e[n],elem:o,level:a});o=o.parentNode,a++}return i}var s=de.test(e)||"string"!=typeof e?F(e,t||this.context):0;for(n=0,r=this.length;n<r;n++)for(o=this[n];o;){if(s?s.index(o)>-1:F.find.matchesSelector(o,e)){i.push(o);break}if(!(o=o.parentNode)||!o.ownerDocument||o===t||11===o.nodeType)break}return i=i.length>1?F.unique(i):i,this.pushStack(i,"closest",e)},index:function(e){return e?"string"==typeof e?F.inArray(this[0],F(e)):F.inArray(e.jquery?e[0]:e,this):this[0]&&this[0].parentNode?this.prevAll().length:-1},add:function(e,t){var n="string"==typeof e?F(e,t):F.makeArray(e&&e.nodeType?[e]:e),r=F.merge(this.get(),n);return this.pushStack(H(n[0])||H(r[0])?r:F.unique(r))},andSelf:function(){return this.add(this.prevObject)}}),F.each({parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return F.dir(e,"parentNode")},parentsUntil:function(e,t,n){return F.dir(e,"parentNode",n)},next:function(e){return F.nth(e,2,"nextSibling")},prev:function(e){return F.nth(e,2,"previousSibling")},nextAll:function(e){return F.dir(e,"nextSibling")},prevAll:function(e){return F.dir(e,"previousSibling")},nextUntil:function(e,t,n){return F.dir(e,"nextSibling",n)},prevUntil:function(e,t,n){return F.dir(e,"previousSibling",n)},siblings:function(e){return F.sibling(e.parentNode.firstChild,e)},children:function(e){return F.sibling(e.firstChild)},contents:function(e){return F.nodeName(e,"iframe")?e.contentDocument||e.contentWindow.document:F.makeArray(e.childNodes)}},function(e,t){F.fn[e]=function(n,r){var i=F.map(this,t,n);return le.test(e)||(r=n),r&&"string"==typeof r&&(i=F.filter(r,i)),i=this.length>1&&!pe[e]?F.unique(i):i,(this.length>1||ue.test(r))&&ce.test(e)&&(i=i.reverse()),this.pushStack(i,e,fe.call(arguments).join(","))}}),F.extend({filter:function(e,t,n){return n&&(e=":not("+e+")"),1===t.length?F.find.matchesSelector(t[0],e)?[t[0]]:[]:F.find.matches(e,t)},dir:function(e,n,r){for(var i=[],o=e[n];o&&9!==o.nodeType&&(r===t||1!==o.nodeType||!F(o).is(r));)1===o.nodeType&&i.push(o),o=o[n];return i},nth:function(e,t,n,r){t=t||1;for(var i=0;e&&(1!==e.nodeType||++i!==t);e=e[n]);return e},sibling:function(e,t){for(var n=[];e;e=e.nextSibling)1===e.nodeType&&e!==t&&n.push(e);return n}});var me="abbr|article|aside|audio|canvas|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",ve=/ jQuery\d+="(?:\d+|null)"/g,ge=/^\s+/,Ee=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,ye=/<([\w:]+)/,xe=/<tbody/i,Te=/<|&#?\w+;/,be=/<(?:script|style)/i,Re=/<(?:script|object|embed|option|style)/i,we=new RegExp("<(?:"+me+")","i"),_e=/checked\s*(?:[^=]|=\s*.checked.)/i,He=/\/(java|ecma)script/i,Me=/^\s*<!(?:\[CDATA\[|\-\-)/,Se={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],area:[1,"<map>","</map>"],_default:[0,"",""]},Ce=w(L);Se.optgroup=Se.option,Se.tbody=Se.tfoot=Se.colgroup=Se.caption=Se.thead,Se.th=Se.td,F.support.htmlSerialize||(Se._default=[1,"div<div>","</div>"]),F.fn.extend({text:function(e){return F.isFunction(e)?this.each(function(t){var n=F(this);n.text(e.call(this,t,n.text()))}):"object"!=typeof e&&e!==t?this.empty().append((this[0]&&this[0].ownerDocument||L).createTextNode(e)):F.text(this)},wrapAll:function(e){if(F.isFunction(e))return this.each(function(t){F(this).wrapAll(e.call(this,t))});if(this[0]){var t=F(e,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){for(var e=this;e.firstChild&&1===e.firstChild.nodeType;)e=e.firstChild;return e}).append(this)}return this},wrapInner:function(e){return F.isFunction(e)?this.each(function(t){F(this).wrapInner(e.call(this,t))}):this.each(function(){var t=F(this),n=t.contents();n.length?n.wrapAll(e):t.append(e)})},wrap:function(e){var t=F.isFunction(e);return this.each(function(n){F(this).wrapAll(t?e.call(this,n):e)})},unwrap:function(){return this.parent().each(function(){F.nodeName(this,"body")||F(this).replaceWith(this.childNodes)}).end()},append:function(){return this.domManip(arguments,!0,function(e){1===this.nodeType&&this.appendChild(e)})},prepend:function(){return this.domManip(arguments,!0,function(e){1===this.nodeType&&this.insertBefore(e,this.firstChild)})},before:function(){if(this[0]&&this[0].parentNode)return this.domManip(arguments,!1,function(e){this.parentNode.insertBefore(e,this)});if(arguments.length){var e=F.clean(arguments);return e.push.apply(e,this.toArray()),this.pushStack(e,"before",arguments)}},after:function(){if(this[0]&&this[0].parentNode)return this.domManip(arguments,!1,function(e){this.parentNode.insertBefore(e,this.nextSibling)});if(arguments.length){var e=this.pushStack(this,"after",arguments);return e.push.apply(e,F.clean(arguments)),e}},remove:function(e,t){for(var n,r=0;null!=(n=this[r]);r++)e&&!F.filter(e,[n]).length||(!t&&1===n.nodeType&&(F.cleanData(n.getElementsByTagName("*")),F.cleanData([n])),n.parentNode&&n.parentNode.removeChild(n));return this},empty:function(){for(var e,t=0;null!=(e=this[t]);t++)for(1===e.nodeType&&F.cleanData(e.getElementsByTagName("*"));e.firstChild;)e.removeChild(e.firstChild);return this},clone:function(e,t){return e=null!=e&&e,t=null==t?e:t,this.map(function(){return F.clone(this,e,t)})},html:function(e){if(e===t)return this[0]&&1===this[0].nodeType?this[0].innerHTML.replace(ve,""):null;if("string"!=typeof e||be.test(e)||!F.support.leadingWhitespace&&ge.test(e)||Se[(ye.exec(e)||["",""])[1].toLowerCase()])F.isFunction(e)?this.each(function(t){var n=F(this);n.html(e.call(this,t,n.html()))}):this.empty().append(e);else{e=e.replace(Ee,"<$1></$2>");try{for(var n=0,r=this.length;n<r;n++)1===this[n].nodeType&&(F.cleanData(this[n].getElementsByTagName("*")),this[n].innerHTML=e)}catch(t){this.empty().append(e)}}return this},replaceWith:function(e){return this[0]&&this[0].parentNode?F.isFunction(e)?this.each(function(t){var n=F(this),r=n.html();n.replaceWith(e.call(this,t,r))}):("string"!=typeof e&&(e=F(e).detach()),this.each(function(){var t=this.nextSibling,n=this.parentNode;F(this).remove(),t?F(t).before(e):F(n).append(e)})):this.length?this.pushStack(F(F.isFunction(e)?e():e),"replaceWith",e):this},detach:function(e){return this.remove(e,!0)},domManip:function(e,n,r){var i,o,a,s,l=e[0],c=[];if(!F.support.checkClone&&3===arguments.length&&"string"==typeof l&&_e.test(l))return this.each(function(){F(this).domManip(e,n,r,!0)});if(F.isFunction(l))return this.each(function(i){var o=F(this);e[0]=l.call(this,i,n?o.html():t),o.domManip(e,n,r)});if(this[0]){if(s=l&&l.parentNode,i=F.support.parentNode&&s&&11===s.nodeType&&s.childNodes.length===this.length?{fragment:s}:F.buildFragment(e,this,c),a=i.fragment,o=1===a.childNodes.length?a=a.firstChild:a.firstChild,o){n=n&&F.nodeName(o,"tr");for(var u=0,h=this.length,f=h-1;u<h;u++)r.call(n?R(this[u],o):this[u],i.cacheable||h>1&&u<f?F.clone(a,!0,!0):a)}c.length&&F.each(c,v)}return this}}),
F.buildFragment=function(e,t,n){var r,i,o,a,s=e[0];return t&&t[0]&&(a=t[0].ownerDocument||t[0]),a.createDocumentFragment||(a=L),1===e.length&&"string"==typeof s&&s.length<512&&a===L&&"<"===s.charAt(0)&&!Re.test(s)&&(F.support.checkClone||!_e.test(s))&&(F.support.html5Clone||!we.test(s))&&(i=!0,(o=F.fragments[s])&&1!==o&&(r=o)),r||(r=a.createDocumentFragment(),F.clean(e,a,r,n)),i&&(F.fragments[s]=o?r:1),{fragment:r,cacheable:i}},F.fragments={},F.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,t){F.fn[e]=function(n){var r=[],i=F(n),o=1===this.length&&this[0].parentNode;if(o&&11===o.nodeType&&1===o.childNodes.length&&1===i.length)return i[t](this[0]),this;for(var a=0,s=i.length;a<s;a++){var l=(a>0?this.clone(!0):this).get();F(i[a])[t](l),r=r.concat(l)}return this.pushStack(r,e,i.selector)}}),F.extend({clone:function(e,t,n){var r,i,o,a=F.support.html5Clone||!we.test("<"+e.nodeName)?e.cloneNode(!0):g(e);if(!(F.support.noCloneEvent&&F.support.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||F.isXMLDoc(e)))for(T(e,a),r=x(e),i=x(a),o=0;r[o];++o)i[o]&&T(r[o],i[o]);if(t&&(b(e,a),n))for(r=x(e),i=x(a),o=0;r[o];++o)b(r[o],i[o]);return r=i=null,a},clean:function(e,t,n,r){var i;t=t||L,void 0===t.createElement&&(t=t.ownerDocument||t[0]&&t[0].ownerDocument||L);for(var o,a,s=[],l=0;null!=(a=e[l]);l++)if("number"==typeof a&&(a+=""),a){if("string"==typeof a)if(Te.test(a)){a=a.replace(Ee,"<$1></$2>");var c=(ye.exec(a)||["",""])[1].toLowerCase(),u=Se[c]||Se._default,h=u[0],f=t.createElement("div");for(t===L?Ce.appendChild(f):w(t).appendChild(f),f.innerHTML=u[1]+a+u[2];h--;)f=f.lastChild;if(!F.support.tbody){var d=xe.test(a),p="table"!==c||d?"<table>"!==u[1]||d?[]:f.childNodes:f.firstChild&&f.firstChild.childNodes;for(o=p.length-1;o>=0;--o)F.nodeName(p[o],"tbody")&&!p[o].childNodes.length&&p[o].parentNode.removeChild(p[o])}!F.support.leadingWhitespace&&ge.test(a)&&f.insertBefore(t.createTextNode(ge.exec(a)[0]),f.firstChild),a=f.childNodes}else a=t.createTextNode(a);var m;if(!F.support.appendChecked)if(a[0]&&"number"==typeof(m=a.length))for(o=0;o<m;o++)E(a[o]);else E(a);a.nodeType?s.push(a):s=F.merge(s,a)}if(n)for(i=function(e){return!e.type||He.test(e.type)},l=0;s[l];l++)if(!r||!F.nodeName(s[l],"script")||s[l].type&&"text/javascript"!==s[l].type.toLowerCase()){if(1===s[l].nodeType){var v=F.grep(s[l].getElementsByTagName("script"),i);s.splice.apply(s,[l+1,0].concat(v))}n.appendChild(s[l])}else r.push(s[l].parentNode?s[l].parentNode.removeChild(s[l]):s[l]);return s},cleanData:function(e){for(var t,n,r,i=F.cache,o=F.event.special,a=F.support.deleteExpando,s=0;null!=(r=e[s]);s++)if((!r.nodeName||!F.noData[r.nodeName.toLowerCase()])&&(n=r[F.expando])){if((t=i[n])&&t.events){for(var l in t.events)o[l]?F.event.remove(r,l):F.removeEvent(r,l,t.handle);t.handle&&(t.handle.elem=null)}a?delete r[F.expando]:r.removeAttribute&&r.removeAttribute(F.expando),delete i[n]}}});var Ae,Pe,De,Le=/alpha\([^)]*\)/i,Ne=/opacity=([^)]*)/,ke=/([A-Z]|^ms)/g,Fe=/^-?\d+(?:px)?$/i,Ue=/^-?\d/,Be=/^([\-+])=([\-+.\de]+)/,Ve={position:"absolute",visibility:"hidden",display:"block"},ze=["Left","Right"],Ie=["Top","Bottom"];F.fn.css=function(e,n){return 2===arguments.length&&n===t?this:F.access(this,e,n,!0,function(e,n,r){return r!==t?F.style(e,n,r):F.css(e,n)})},F.extend({cssHooks:{opacity:{get:function(e,t){if(t){var n=Ae(e,"opacity","opacity");return""===n?"1":n}return e.style.opacity}}},cssNumber:{fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{float:F.support.cssFloat?"cssFloat":"styleFloat"},style:function(e,n,r,i){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var o,a,s=F.camelCase(n),l=e.style,c=F.cssHooks[s];if(n=F.cssProps[s]||s,r===t)return c&&"get"in c&&(o=c.get(e,!1,i))!==t?o:l[n];if("string"===(a=typeof r)&&(o=Be.exec(r))&&(r=+(o[1]+1)*+o[2]+parseFloat(F.css(e,n)),a="number"),null==r||"number"===a&&isNaN(r))return;if("number"===a&&!F.cssNumber[s]&&(r+="px"),!(c&&"set"in c&&(r=c.set(e,r))===t))try{l[n]=r}catch(e){}}},css:function(e,n,r){var i,o;return n=F.camelCase(n),o=F.cssHooks[n],"cssFloat"===(n=F.cssProps[n]||n)&&(n="float"),o&&"get"in o&&(i=o.get(e,!0,r))!==t?i:Ae?Ae(e,n):void 0},swap:function(e,t,n){var r={};for(var i in t)r[i]=e.style[i],e.style[i]=t[i];n.call(e);for(i in t)e.style[i]=r[i]}}),F.curCSS=F.css,F.each(["height","width"],function(e,t){F.cssHooks[t]={get:function(e,n,r){var i;if(n)return 0!==e.offsetWidth?m(e,t,r):(F.swap(e,Ve,function(){i=m(e,t,r)}),i)},set:function(e,t){return Fe.test(t)?(t=parseFloat(t),t>=0?t+"px":void 0):t}}}),F.support.opacity||(F.cssHooks.opacity={get:function(e,t){return Ne.test((t&&e.currentStyle?e.currentStyle.filter:e.style.filter)||"")?parseFloat(RegExp.$1)/100+"":t?"1":""},set:function(e,t){var n=e.style,r=e.currentStyle,i=F.isNumeric(t)?"alpha(opacity="+100*t+")":"",o=r&&r.filter||n.filter||"";n.zoom=1,t>=1&&""===F.trim(o.replace(Le,""))&&(n.removeAttribute("filter"),r&&!r.filter)||(n.filter=Le.test(o)?o.replace(Le,i):o+" "+i)}}),F(function(){F.support.reliableMarginRight||(F.cssHooks.marginRight={get:function(e,t){var n;return F.swap(e,{display:"inline-block"},function(){n=t?Ae(e,"margin-right","marginRight"):e.style.marginRight}),n}})}),L.defaultView&&L.defaultView.getComputedStyle&&(Pe=function(e,t){var n,r,i;return t=t.replace(ke,"-$1").toLowerCase(),(r=e.ownerDocument.defaultView)&&(i=r.getComputedStyle(e,null))&&""===(n=i.getPropertyValue(t))&&!F.contains(e.ownerDocument.documentElement,e)&&(n=F.style(e,t)),n}),L.documentElement.currentStyle&&(De=function(e,t){var n,r,i,o=e.currentStyle&&e.currentStyle[t],a=e.style;return null===o&&a&&(i=a[t])&&(o=i),!Fe.test(o)&&Ue.test(o)&&(n=a.left,r=e.runtimeStyle&&e.runtimeStyle.left,r&&(e.runtimeStyle.left=e.currentStyle.left),a.left="fontSize"===t?"1em":o||0,o=a.pixelLeft+"px",a.left=n,r&&(e.runtimeStyle.left=r)),""===o?"auto":o}),Ae=Pe||De,F.expr&&F.expr.filters&&(F.expr.filters.hidden=function(e){var t=e.offsetWidth,n=e.offsetHeight;return 0===t&&0===n||!F.support.reliableHiddenOffsets&&"none"===(e.style&&e.style.display||F.css(e,"display"))},F.expr.filters.visible=function(e){return!F.expr.filters.hidden(e)});var Oe,We,je=/%20/g,Ge=/\[\]$/,Xe=/\r?\n/g,Ye=/#.*$/,qe=/^(.*?):[ \t]*([^\r\n]*)\r?$/gm,Ke=/^(?:color|date|datetime|datetime-local|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i,$e=/^(?:about|app|app\-storage|.+\-extension|file|res|widget):$/,Qe=/^(?:GET|HEAD)$/,Ze=/^\/\//,Je=/\?/,et=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,tt=/^(?:select|textarea)/i,nt=/\s+/,rt=/([?&])_=[^&]*/,it=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+))?)?/,ot=F.fn.load,at={},st={},lt=["*/"]+["*"];try{Oe=k.href}catch(e){Oe=L.createElement("a"),Oe.href="",Oe=Oe.href}We=it.exec(Oe.toLowerCase())||[],F.fn.extend({load:function(e,n,r){if("string"!=typeof e&&ot)return ot.apply(this,arguments);if(!this.length)return this;var i=e.indexOf(" ");if(i>=0){var o=e.slice(i,e.length);e=e.slice(0,i)}var a="GET";n&&(F.isFunction(n)?(r=n,n=t):"object"==typeof n&&(n=F.param(n,F.ajaxSettings.traditional),a="POST"));var s=this;return F.ajax({url:e,type:a,dataType:"html",data:n,complete:function(e,t,n){n=e.responseText,e.isResolved()&&(e.done(function(e){n=e}),s.html(o?F("<div>").append(n.replace(et,"")).find(o):n)),r&&s.each(r,[n,t,e])}}),this},serialize:function(){return F.param(this.serializeArray())},serializeArray:function(){return this.map(function(){return this.elements?F.makeArray(this.elements):this}).filter(function(){return this.name&&!this.disabled&&(this.checked||tt.test(this.nodeName)||Ke.test(this.type))}).map(function(e,t){var n=F(this).val();return null==n?null:F.isArray(n)?F.map(n,function(e,n){return{name:t.name,value:e.replace(Xe,"\r\n")}}):{name:t.name,value:n.replace(Xe,"\r\n")}}).get()}}),F.each("ajaxStart ajaxStop ajaxComplete ajaxError ajaxSuccess ajaxSend".split(" "),function(e,t){F.fn[t]=function(e){return this.on(t,e)}}),F.each(["get","post"],function(e,n){F[n]=function(e,r,i,o){return F.isFunction(r)&&(o=o||i,i=r,r=t),F.ajax({type:n,url:e,data:r,success:i,dataType:o})}}),F.extend({getScript:function(e,n){return F.get(e,t,n,"script")},getJSON:function(e,t,n){return F.get(e,t,n,"json")},ajaxSetup:function(e,t){return t?f(e,F.ajaxSettings):(t=e,e=F.ajaxSettings),f(e,t),e},ajaxSettings:{url:Oe,isLocal:$e.test(We[1]),global:!0,type:"GET",contentType:"application/x-www-form-urlencoded",processData:!0,async:!0,accepts:{xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript","*":lt},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText"},converters:{"* text":e.String,"text html":!0,"text json":F.parseJSON,"text xml":F.parseXML},flatOptions:{context:!0,url:!0}},ajaxPrefilter:p(at),ajaxTransport:p(st),ajax:function(e,n){function r(e,n,r,a){if(2!==R){R=2,l&&clearTimeout(l),s=t,o=a||"",w.readyState=e>0?4:0;var h,d,p,T,b,_=n,H=r?u(m,w,r):t;if(e>=200&&e<300||304===e)if(m.ifModified&&((T=w.getResponseHeader("Last-Modified"))&&(F.lastModified[i]=T),(b=w.getResponseHeader("Etag"))&&(F.etag[i]=b)),304===e)_="notmodified",h=!0;else try{d=c(m,H),_="success",h=!0}catch(e){_="parsererror",p=e}else p=_,_&&!e||(_="error",e<0&&(e=0));w.status=e,w.statusText=""+(n||_),h?E.resolveWith(v,[d,_,w]):E.rejectWith(v,[w,_,p]),w.statusCode(x),x=t,f&&g.trigger("ajax"+(h?"Success":"Error"),[w,m,h?d:p]),y.fireWith(v,[w,_]),f&&(g.trigger("ajaxComplete",[w,m]),--F.active||F.event.trigger("ajaxStop"))}}"object"==typeof e&&(n=e,e=t),n=n||{};var i,o,a,s,l,h,f,p,m=F.ajaxSetup({},n),v=m.context||m,g=v!==m&&(v.nodeType||v instanceof F)?F(v):F.event,E=F.Deferred(),y=F.Callbacks("once memory"),x=m.statusCode||{},T={},b={},R=0,w={readyState:0,setRequestHeader:function(e,t){if(!R){var n=e.toLowerCase();e=b[n]=b[n]||e,T[e]=t}return this},getAllResponseHeaders:function(){return 2===R?o:null},getResponseHeader:function(e){var n;if(2===R){if(!a)for(a={};n=qe.exec(o);)a[n[1].toLowerCase()]=n[2];n=a[e.toLowerCase()]}return n===t?null:n},overrideMimeType:function(e){return R||(m.mimeType=e),this},abort:function(e){return e=e||"abort",s&&s.abort(e),r(0,e),this}};if(E.promise(w),w.success=w.done,w.error=w.fail,w.complete=y.add,w.statusCode=function(e){if(e){var t;if(R<2)for(t in e)x[t]=[x[t],e[t]];else t=e[w.status],w.then(t,t)}return this},m.url=((e||m.url)+"").replace(Ye,"").replace(Ze,We[1]+"//"),m.dataTypes=F.trim(m.dataType||"*").toLowerCase().split(nt),null==m.crossDomain&&(h=it.exec(m.url.toLowerCase()),m.crossDomain=!(!h||h[1]==We[1]&&h[2]==We[2]&&(h[3]||("http:"===h[1]?80:443))==(We[3]||("http:"===We[1]?80:443)))),m.data&&m.processData&&"string"!=typeof m.data&&(m.data=F.param(m.data,m.traditional)),d(at,m,n,w),2===R)return!1;if(f=m.global,m.type=m.type.toUpperCase(),m.hasContent=!Qe.test(m.type),f&&0==F.active++&&F.event.trigger("ajaxStart"),!m.hasContent&&(m.data&&(m.url+=(Je.test(m.url)?"&":"?")+m.data,delete m.data),i=m.url,!1===m.cache)){var _=F.now(),H=m.url.replace(rt,"$1_="+_);m.url=H+(H===m.url?(Je.test(m.url)?"&":"?")+"_="+_:"")}(m.data&&m.hasContent&&!1!==m.contentType||n.contentType)&&w.setRequestHeader("Content-Type",m.contentType),m.ifModified&&(i=i||m.url,F.lastModified[i]&&w.setRequestHeader("If-Modified-Since",F.lastModified[i]),F.etag[i]&&w.setRequestHeader("If-None-Match",F.etag[i])),w.setRequestHeader("Accept",m.dataTypes[0]&&m.accepts[m.dataTypes[0]]?m.accepts[m.dataTypes[0]]+("*"!==m.dataTypes[0]?", "+lt+"; q=0.01":""):m.accepts["*"]);for(p in m.headers)w.setRequestHeader(p,m.headers[p]);if(m.beforeSend&&(!1===m.beforeSend.call(v,w,m)||2===R))return w.abort(),!1;for(p in{success:1,error:1,complete:1})w[p](m[p]);if(s=d(st,m,n,w)){w.readyState=1,f&&g.trigger("ajaxSend",[w,m]),m.async&&m.timeout>0&&(l=setTimeout(function(){w.abort("timeout")},m.timeout));try{R=1,s.send(T,r)}catch(e){if(!(R<2))throw e;r(-1,e)}}else r(-1,"No Transport");return w},param:function(e,n){var r=[],i=function(e,t){t=F.isFunction(t)?t():t,r[r.length]=encodeURIComponent(e)+"="+encodeURIComponent(t)};if(n===t&&(n=F.ajaxSettings.traditional),F.isArray(e)||e.jquery&&!F.isPlainObject(e))F.each(e,function(){i(this.name,this.value)});else for(var o in e)h(o,e[o],n,i);return r.join("&").replace(je,"+")}}),F.extend({active:0,lastModified:{},etag:{}});var ct=F.now(),ut=/(\=)\?(&|$)|\?\?/i;F.ajaxSetup({jsonp:"callback",jsonpCallback:function(){return F.expando+"_"+ct++}}),F.ajaxPrefilter("json jsonp",function(t,n,r){var i="application/x-www-form-urlencoded"===t.contentType&&"string"==typeof t.data;if("jsonp"===t.dataTypes[0]||!1!==t.jsonp&&(ut.test(t.url)||i&&ut.test(t.data))){var o,a=t.jsonpCallback=F.isFunction(t.jsonpCallback)?t.jsonpCallback():t.jsonpCallback,s=e[a],l=t.url,c=t.data,u="$1"+a+"$2";return!1!==t.jsonp&&(l=l.replace(ut,u),t.url===l&&(i&&(c=c.replace(ut,u)),t.data===c&&(l+=(/\?/.test(l)?"&":"?")+t.jsonp+"="+a))),t.url=l,t.data=c,e[a]=function(e){o=[e]},r.always(function(){e[a]=s,o&&F.isFunction(s)&&e[a](o[0])}),t.converters["script json"]=function(){return o||F.error(a+" was not called"),o[0]},t.dataTypes[0]="json","script"}}),F.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/javascript|ecmascript/},converters:{"text script":function(e){return F.globalEval(e),e}}}),F.ajaxPrefilter("script",function(e){e.cache===t&&(e.cache=!1),e.crossDomain&&(e.type="GET",e.global=!1)}),F.ajaxTransport("script",function(e){if(e.crossDomain){var n,r=L.head||L.getElementsByTagName("head")[0]||L.documentElement;return{send:function(i,o){n=L.createElement("script"),n.async="async",e.scriptCharset&&(n.charset=e.scriptCharset),n.src=e.url,n.onload=n.onreadystatechange=function(e,i){(i||!n.readyState||/loaded|complete/.test(n.readyState))&&(n.onload=n.onreadystatechange=null,r&&n.parentNode&&r.removeChild(n),n=t,i||o(200,"success"))},r.insertBefore(n,r.firstChild)},abort:function(){n&&n.onload(0,1)}}}});var ht,ft=!!e.ActiveXObject&&function(){for(var e in ht)ht[e](0,1)},dt=0;F.ajaxSettings.xhr=e.ActiveXObject?function(){return!this.isLocal&&l()||s()}:l,function(e){F.extend(F.support,{ajax:!!e,cors:!!e&&"withCredentials"in e})}(F.ajaxSettings.xhr()),F.support.ajax&&F.ajaxTransport(function(n){if(!n.crossDomain||F.support.cors){var r;return{send:function(i,o){var a,s,l=n.xhr();if(n.username?l.open(n.type,n.url,n.async,n.username,n.password):l.open(n.type,n.url,n.async),n.xhrFields)for(s in n.xhrFields)l[s]=n.xhrFields[s];n.mimeType&&l.overrideMimeType&&l.overrideMimeType(n.mimeType),!n.crossDomain&&!i["X-Requested-With"]&&(i["X-Requested-With"]="XMLHttpRequest");try{for(s in i)l.setRequestHeader(s,i[s])}catch(e){}l.send(n.hasContent&&n.data||null),r=function(e,i){var s,c,u,h,f;try{if(r&&(i||4===l.readyState))if(r=t,a&&(l.onreadystatechange=F.noop,ft&&delete ht[a]),i)4!==l.readyState&&l.abort();else{s=l.status,u=l.getAllResponseHeaders(),h={},f=l.responseXML,f&&f.documentElement&&(h.xml=f),h.text=l.responseText;try{c=l.statusText}catch(e){c=""}s||!n.isLocal||n.crossDomain?1223===s&&(s=204):s=h.text?200:404}}catch(e){i||o(-1,e)}h&&o(s,c,h,u)},n.async&&4!==l.readyState?(a=++dt,ft&&(ht||(ht={},F(e).unload(ft)),ht[a]=r),l.onreadystatechange=r):r()},abort:function(){r&&r(0,1)}}}});var pt,mt,vt,gt,Et={},yt=/^(?:toggle|show|hide)$/,xt=/^([+\-]=)?([\d+.\-]+)([a-z%]*)$/i,Tt=[["height","marginTop","marginBottom","paddingTop","paddingBottom"],["width","marginLeft","marginRight","paddingLeft","paddingRight"],["opacity"]];F.fn.extend({show:function(e,t,n){var o,a;if(e||0===e)return this.animate(i("show",3),e,t,n);for(var s=0,l=this.length;s<l;s++)o=this[s],o.style&&(a=o.style.display,!F._data(o,"olddisplay")&&"none"===a&&(a=o.style.display=""),""===a&&"none"===F.css(o,"display")&&F._data(o,"olddisplay",r(o.nodeName)));for(s=0;s<l;s++)o=this[s],o.style&&(""!==(a=o.style.display)&&"none"!==a||(o.style.display=F._data(o,"olddisplay")||""));return this},hide:function(e,t,n){if(e||0===e)return this.animate(i("hide",3),e,t,n);for(var r,o,a=0,s=this.length;a<s;a++)r=this[a],r.style&&"none"!==(o=F.css(r,"display"))&&!F._data(r,"olddisplay")&&F._data(r,"olddisplay",o);for(a=0;a<s;a++)this[a].style&&(this[a].style.display="none");return this},_toggle:F.fn.toggle,toggle:function(e,t,n){var r="boolean"==typeof e;return F.isFunction(e)&&F.isFunction(t)?this._toggle.apply(this,arguments):null==e||r?this.each(function(){var t=r?e:F(this).is(":hidden");F(this)[t?"show":"hide"]()}):this.animate(i("toggle",3),e,t,n),this},fadeTo:function(e,t,n,r){return this.filter(":hidden").css("opacity",0).show().end().animate({opacity:t},e,n,r)},animate:function(e,t,n,i){function o(){!1===a.queue&&F._mark(this);var t,n,i,o,s,l,c,u,h,f=F.extend({},a),d=1===this.nodeType,p=d&&F(this).is(":hidden");f.animatedProperties={};for(i in e){if(t=F.camelCase(i),i!==t&&(e[t]=e[i],delete e[i]),n=e[t],F.isArray(n)?(f.animatedProperties[t]=n[1],n=e[t]=n[0]):f.animatedProperties[t]=f.specialEasing&&f.specialEasing[t]||f.easing||"swing","hide"===n&&p||"show"===n&&!p)return f.complete.call(this);d&&("height"===t||"width"===t)&&(f.overflow=[this.style.overflow,this.style.overflowX,this.style.overflowY],"inline"===F.css(this,"display")&&"none"===F.css(this,"float")&&(F.support.inlineBlockNeedsLayout&&"inline"!==r(this.nodeName)?this.style.zoom=1:this.style.display="inline-block"))}null!=f.overflow&&(this.style.overflow="hidden");for(i in e)o=new F.fx(this,f,i),n=e[i],yt.test(n)?(h=F._data(this,"toggle"+i)||("toggle"===n?p?"show":"hide":0),h?(F._data(this,"toggle"+i,"show"===h?"hide":"show"),o[h]()):o[n]()):(s=xt.exec(n),l=o.cur(),s?(c=parseFloat(s[2]),u=s[3]||(F.cssNumber[i]?"":"px"),"px"!==u&&(F.style(this,i,(c||1)+u),l=(c||1)/o.cur()*l,F.style(this,i,l+u)),s[1]&&(c=("-="===s[1]?-1:1)*c+l),o.custom(l,c,u)):o.custom(l,n,""));return!0}var a=F.speed(t,n,i);return F.isEmptyObject(e)?this.each(a.complete,[!1]):(e=F.extend({},e),!1===a.queue?this.each(o):this.queue(a.queue,o))},stop:function(e,n,r){return"string"!=typeof e&&(r=n,n=e,e=t),n&&!1!==e&&this.queue(e||"fx",[]),this.each(function(){function t(e,t,n){var i=t[n];F.removeData(e,n,!0),i.stop(r)}var n,i=!1,o=F.timers,a=F._data(this);if(r||F._unmark(!0,this),null==e)for(n in a)a[n]&&a[n].stop&&n.indexOf(".run")===n.length-4&&t(this,a,n);else a[n=e+".run"]&&a[n].stop&&t(this,a,n);for(n=o.length;n--;)o[n].elem===this&&(null==e||o[n].queue===e)&&(r?o[n](!0):o[n].saveState(),i=!0,o.splice(n,1));(!r||!i)&&F.dequeue(this,e)})}}),F.each({slideDown:i("show",1),slideUp:i("hide",1),slideToggle:i("toggle",1),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,t){F.fn[e]=function(e,n,r){return this.animate(t,e,n,r)}}),F.extend({speed:function(e,t,n){var r=e&&"object"==typeof e?F.extend({},e):{complete:n||!n&&t||F.isFunction(e)&&e,duration:e,easing:n&&t||t&&!F.isFunction(t)&&t};return r.duration=F.fx.off?0:"number"==typeof r.duration?r.duration:r.duration in F.fx.speeds?F.fx.speeds[r.duration]:F.fx.speeds._default,null!=r.queue&&!0!==r.queue||(r.queue="fx"),r.old=r.complete,r.complete=function(e){F.isFunction(r.old)&&r.old.call(this),r.queue?F.dequeue(this,r.queue):!1!==e&&F._unmark(this)},r},easing:{linear:function(e,t,n,r){return n+r*e},swing:function(e,t,n,r){return(-Math.cos(e*Math.PI)/2+.5)*r+n}},timers:[],fx:function(e,t,n){this.options=t,this.elem=e,this.prop=n,t.orig=t.orig||{}}}),F.fx.prototype={update:function(){this.options.step&&this.options.step.call(this.elem,this.now,this),(F.fx.step[this.prop]||F.fx.step._default)(this)},cur:function(){if(null!=this.elem[this.prop]&&(!this.elem.style||null==this.elem.style[this.prop]))return this.elem[this.prop];var e,t=F.css(this.elem,this.prop);return isNaN(e=parseFloat(t))?t&&"auto"!==t?t:0:e},custom:function(e,n,r){function i(e){return o.step(e)}var o=this,s=F.fx;this.startTime=gt||a(),this.end=n,this.now=this.start=e,this.pos=this.state=0,this.unit=r||this.unit||(F.cssNumber[this.prop]?"":"px"),i.queue=this.options.queue,i.elem=this.elem,i.saveState=function(){o.options.hide&&F._data(o.elem,"fxshow"+o.prop)===t&&F._data(o.elem,"fxshow"+o.prop,o.start)},i()&&F.timers.push(i)&&!vt&&(vt=setInterval(s.tick,s.interval))},show:function(){var e=F._data(this.elem,"fxshow"+this.prop);this.options.orig[this.prop]=e||F.style(this.elem,this.prop),this.options.show=!0,e!==t?this.custom(this.cur(),e):this.custom("width"===this.prop||"height"===this.prop?1:0,this.cur()),F(this.elem).show()},hide:function(){this.options.orig[this.prop]=F._data(this.elem,"fxshow"+this.prop)||F.style(this.elem,this.prop),this.options.hide=!0,this.custom(this.cur(),0)},step:function(e){var t,n,r,i=gt||a(),o=!0,s=this.elem,l=this.options;if(e||i>=l.duration+this.startTime){this.now=this.end,this.pos=this.state=1,this.update(),l.animatedProperties[this.prop]=!0;for(t in l.animatedProperties)!0!==l.animatedProperties[t]&&(o=!1);if(o){if(null!=l.overflow&&!F.support.shrinkWrapBlocks&&F.each(["","X","Y"],function(e,t){s.style["overflow"+t]=l.overflow[e]}),l.hide&&F(s).hide(),l.hide||l.show)for(t in l.animatedProperties)F.style(s,t,l.orig[t]),F.removeData(s,"fxshow"+t,!0),F.removeData(s,"toggle"+t,!0);(r=l.complete)&&(l.complete=!1,r.call(s))}return!1}return l.duration==1/0?this.now=i:(n=i-this.startTime,this.state=n/l.duration,this.pos=F.easing[l.animatedProperties[this.prop]](this.state,n,0,1,l.duration),this.now=this.start+(this.end-this.start)*this.pos),this.update(),!0}},F.extend(F.fx,{tick:function(){for(var e,t=F.timers,n=0;n<t.length;n++)!(e=t[n])()&&t[n]===e&&t.splice(n--,1);t.length||F.fx.stop()},interval:13,stop:function(){clearInterval(vt),vt=null},speeds:{slow:600,fast:200,_default:400},step:{opacity:function(e){F.style(e.elem,"opacity",e.now)},_default:function(e){e.elem.style&&null!=e.elem.style[e.prop]?e.elem.style[e.prop]=e.now+e.unit:e.elem[e.prop]=e.now}}}),F.each(["width","height"],function(e,t){F.fx.step[t]=function(e){F.style(e.elem,t,Math.max(0,e.now)+e.unit)}}),F.expr&&F.expr.filters&&(F.expr.filters.animated=function(e){return F.grep(F.timers,function(t){return e===t.elem}).length});var bt=/^t(?:able|d|h)$/i,Rt=/^(?:body|html)$/i;"getBoundingClientRect"in L.documentElement?F.fn.offset=function(e){var t,r=this[0];if(e)return this.each(function(t){F.offset.setOffset(this,e,t)});if(!r||!r.ownerDocument)return null;if(r===r.ownerDocument.body)return F.offset.bodyOffset(r);try{t=r.getBoundingClientRect()}catch(e){}var i=r.ownerDocument,o=i.documentElement;if(!t||!F.contains(o,r))return t?{top:t.top,left:t.left}:{top:0,left:0};var a=i.body,s=n(i),l=o.clientTop||a.clientTop||0,c=o.clientLeft||a.clientLeft||0,u=s.pageYOffset||F.support.boxModel&&o.scrollTop||a.scrollTop,h=s.pageXOffset||F.support.boxModel&&o.scrollLeft||a.scrollLeft;return{top:t.top+u-l,left:t.left+h-c}}:F.fn.offset=function(e){var t=this[0];if(e)return this.each(function(t){F.offset.setOffset(this,e,t)});if(!t||!t.ownerDocument)return null;if(t===t.ownerDocument.body)return F.offset.bodyOffset(t);for(var n,r=t.offsetParent,i=t.ownerDocument,o=i.documentElement,a=i.body,s=i.defaultView,l=s?s.getComputedStyle(t,null):t.currentStyle,c=t.offsetTop,u=t.offsetLeft;(t=t.parentNode)&&t!==a&&t!==o&&(!F.support.fixedPosition||"fixed"!==l.position);)n=s?s.getComputedStyle(t,null):t.currentStyle,c-=t.scrollTop,u-=t.scrollLeft,t===r&&(c+=t.offsetTop,u+=t.offsetLeft,F.support.doesNotAddBorder&&(!F.support.doesAddBorderForTableAndCells||!bt.test(t.nodeName))&&(c+=parseFloat(n.borderTopWidth)||0,u+=parseFloat(n.borderLeftWidth)||0),r,r=t.offsetParent),F.support.subtractsBorderForOverflowNotVisible&&"visible"!==n.overflow&&(c+=parseFloat(n.borderTopWidth)||0,u+=parseFloat(n.borderLeftWidth)||0),l=n;return"relative"!==l.position&&"static"!==l.position||(c+=a.offsetTop,u+=a.offsetLeft),F.support.fixedPosition&&"fixed"===l.position&&(c+=Math.max(o.scrollTop,a.scrollTop),u+=Math.max(o.scrollLeft,a.scrollLeft)),{top:c,left:u}},F.offset={bodyOffset:function(e){var t=e.offsetTop,n=e.offsetLeft;return F.support.doesNotIncludeMarginInBodyOffset&&(t+=parseFloat(F.css(e,"marginTop"))||0,n+=parseFloat(F.css(e,"marginLeft"))||0),{top:t,left:n}},setOffset:function(e,t,n){var r=F.css(e,"position");"static"===r&&(e.style.position="relative");var i,o,a=F(e),s=a.offset(),l=F.css(e,"top"),c=F.css(e,"left"),u=("absolute"===r||"fixed"===r)&&F.inArray("auto",[l,c])>-1,h={},f={};u?(f=a.position(),i=f.top,o=f.left):(i=parseFloat(l)||0,o=parseFloat(c)||0),F.isFunction(t)&&(t=t.call(e,n,s)),null!=t.top&&(h.top=t.top-s.top+i),null!=t.left&&(h.left=t.left-s.left+o),"using"in t?t.using.call(e,h):a.css(h)}},F.fn.extend({position:function(){if(!this[0])return null;var e=this[0],t=this.offsetParent(),n=this.offset(),r=Rt.test(t[0].nodeName)?{top:0,left:0}:t.offset();return n.top-=parseFloat(F.css(e,"marginTop"))||0,n.left-=parseFloat(F.css(e,"marginLeft"))||0,r.top+=parseFloat(F.css(t[0],"borderTopWidth"))||0,r.left+=parseFloat(F.css(t[0],"borderLeftWidth"))||0,{top:n.top-r.top,left:n.left-r.left}},offsetParent:function(){return this.map(function(){for(var e=this.offsetParent||L.body;e&&!Rt.test(e.nodeName)&&"static"===F.css(e,"position");)e=e.offsetParent;return e})}}),F.each(["Left","Top"],function(e,r){var i="scroll"+r;F.fn[i]=function(r){var o,a;return r===t?(o=this[0])?(a=n(o),a?"pageXOffset"in a?a[e?"pageYOffset":"pageXOffset"]:F.support.boxModel&&a.document.documentElement[i]||a.document.body[i]:o[i]):null:this.each(function(){a=n(this),a?a.scrollTo(e?F(a).scrollLeft():r,e?r:F(a).scrollTop()):this[i]=r})}}),F.each(["Height","Width"],function(e,n){var r=n.toLowerCase();F.fn["inner"+n]=function(){var e=this[0];return e?e.style?parseFloat(F.css(e,r,"padding")):this[r]():null},F.fn["outer"+n]=function(e){var t=this[0];return t?t.style?parseFloat(F.css(t,r,e?"margin":"border")):this[r]():null},F.fn[r]=function(e){var i=this[0];if(!i)return null==e?null:this;if(F.isFunction(e))return this.each(function(t){var n=F(this);n[r](e.call(this,t,n[r]()))});if(F.isWindow(i)){var o=i.document.documentElement["client"+n],a=i.document.body;return"CSS1Compat"===i.document.compatMode&&o||a&&a["client"+n]||o}if(9===i.nodeType)return Math.max(i.documentElement["client"+n],i.body["scroll"+n],i.documentElement["scroll"+n],i.body["offset"+n],i.documentElement["offset"+n]);if(e===t){var s=F.css(i,r),l=parseFloat(s);return F.isNumeric(l)?l:s}return this.css(r,"string"==typeof e?e:e+"px")}}),e.jQuery=e.$=F,"function"==typeof define&&define.amd&&define.amd.jQuery&&define("jquery",[],function(){return F})}(window),THREE.ShaderExtras={screen:{uniforms:{tDiffuse:{type:"t",value:0,texture:null},opacity:{type:"f",value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = vec2( uv.x, 1.0 - uv.y );","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float opacity;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 texel = texture2D( tDiffuse, vUv );","gl_FragColor = opacity * texel;","}"].join("\n")},convolution:{uniforms:{tDiffuse:{type:"t",value:0,texture:null},uImageIncrement:{type:"v2",value:new THREE.Vector2(.001953125,0)},cKernel:{type:"fv1",value:[]}},vertexShader:["uniform vec2 uImageIncrement;","varying vec2 vUv;","void main() {","vUv = uv - ( ( KERNEL_SIZE - 1.0 ) / 2.0 ) * uImageIncrement;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float cKernel[ KERNEL_SIZE ];","uniform sampler2D tDiffuse;","uniform vec2 uImageIncrement;","varying vec2 vUv;","void main() {","vec2 imageCoord = vUv;","vec4 sum = vec4( 0.0, 0.0, 0.0, 0.0 );","for( int i = 0; i < KERNEL_SIZE; i ++ ) {","sum += texture2D( tDiffuse, imageCoord ) * cKernel[ i ];","imageCoord += uImageIncrement;","}","gl_FragColor = sum;","}"].join("\n")},film:{uniforms:{tDiffuse:{type:"t",value:0,texture:null},time:{type:"f",value:0},nIntensity:{type:"f",value:.5},sIntensity:{type:"f",value:.05},sCount:{type:"f",value:4096},grayscale:{type:"i",value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = vec2( uv.x, 1.0 - uv.y );","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float time;","uniform bool grayscale;","uniform float nIntensity;","uniform float sIntensity;","uniform float sCount;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 cTextureScreen = texture2D( tDiffuse, vUv );","float x = vUv.x * vUv.y * time *  1000.0;","x = mod( x, 13.0 ) * mod( x, 123.0 );","float dx = mod( x, 0.01 );","vec3 cResult = cTextureScreen.rgb + cTextureScreen.rgb * clamp( 0.1 + dx * 100.0, 0.0, 1.0 );","vec2 sc = vec2( sin( vUv.y * sCount ), cos( vUv.y * sCount ) );","cResult += cTextureScreen.rgb * vec3( sc.x, sc.y, sc.x ) * sIntensity;","cResult = cTextureScreen.rgb + clamp( nIntensity, 0.0,1.0 ) * ( cResult - cTextureScreen.rgb );","if( grayscale ) {","cResult = vec3( cResult.r * 0.3 + cResult.g * 0.59 + cResult.b * 0.11 );","}","gl_FragColor =  vec4( cResult, cTextureScreen.a );","}"].join("\n")},bokeh:{uniforms:{tColor:{type:"t",value:0,texture:null},tDepth:{type:"t",value:1,texture:null},focus:{type:"f",value:1},aspect:{type:"f",value:1},aperture:{type:"f",value:.025},maxblur:{type:"f",value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = vec2( uv.x, 1.0 - uv.y );","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),
fragmentShader:["varying vec2 vUv;","uniform sampler2D tColor;","uniform sampler2D tDepth;","uniform float maxblur;","uniform float aperture;","uniform float focus;","uniform float aspect;","void main() {","vec2 aspectcorrect = vec2( 1.0, aspect );","vec4 depth1 = texture2D( tDepth, vUv );","float factor = depth1.x - focus;","vec2 dofblur = vec2 ( clamp( factor * aperture, -maxblur, maxblur ) );","vec2 dofblur9 = dofblur * 0.9;","vec2 dofblur7 = dofblur * 0.7;","vec2 dofblur4 = dofblur * 0.4;","vec4 col = vec4( 0.0 );","col += texture2D( tColor, vUv.xy );","col += texture2D( tColor, vUv.xy + ( vec2(  0.0,   0.4  ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2(  0.15,  0.37 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2(  0.29,  0.29 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2( -0.37,  0.15 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2(  0.40,  0.0  ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2(  0.37, -0.15 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2(  0.29, -0.29 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2( -0.15, -0.37 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2(  0.0,  -0.4  ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2( -0.15,  0.37 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2( -0.29,  0.29 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2(  0.37,  0.15 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2( -0.4,   0.0  ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2( -0.37, -0.15 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2( -0.29, -0.29 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2(  0.15, -0.37 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2(  0.15,  0.37 ) * aspectcorrect ) * dofblur9 );","col += texture2D( tColor, vUv.xy + ( vec2( -0.37,  0.15 ) * aspectcorrect ) * dofblur9 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.37, -0.15 ) * aspectcorrect ) * dofblur9 );","col += texture2D( tColor, vUv.xy + ( vec2( -0.15, -0.37 ) * aspectcorrect ) * dofblur9 );","col += texture2D( tColor, vUv.xy + ( vec2( -0.15,  0.37 ) * aspectcorrect ) * dofblur9 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.37,  0.15 ) * aspectcorrect ) * dofblur9 );","col += texture2D( tColor, vUv.xy + ( vec2( -0.37, -0.15 ) * aspectcorrect ) * dofblur9 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.15, -0.37 ) * aspectcorrect ) * dofblur9 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.29,  0.29 ) * aspectcorrect ) * dofblur7 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.40,  0.0  ) * aspectcorrect ) * dofblur7 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.29, -0.29 ) * aspectcorrect ) * dofblur7 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.0,  -0.4  ) * aspectcorrect ) * dofblur7 );","col += texture2D( tColor, vUv.xy + ( vec2( -0.29,  0.29 ) * aspectcorrect ) * dofblur7 );","col += texture2D( tColor, vUv.xy + ( vec2( -0.4,   0.0  ) * aspectcorrect ) * dofblur7 );","col += texture2D( tColor, vUv.xy + ( vec2( -0.29, -0.29 ) * aspectcorrect ) * dofblur7 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.0,   0.4  ) * aspectcorrect ) * dofblur7 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.29,  0.29 ) * aspectcorrect ) * dofblur4 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.4,   0.0  ) * aspectcorrect ) * dofblur4 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.29, -0.29 ) * aspectcorrect ) * dofblur4 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.0,  -0.4  ) * aspectcorrect ) * dofblur4 );","col += texture2D( tColor, vUv.xy + ( vec2( -0.29,  0.29 ) * aspectcorrect ) * dofblur4 );","col += texture2D( tColor, vUv.xy + ( vec2( -0.4,   0.0  ) * aspectcorrect ) * dofblur4 );","col += texture2D( tColor, vUv.xy + ( vec2( -0.29, -0.29 ) * aspectcorrect ) * dofblur4 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.0,   0.4  ) * aspectcorrect ) * dofblur4 );","gl_FragColor = col / 41.0;","gl_FragColor.a = 1.0;","}"].join("\n")},dofmipmap:{uniforms:{tColor:{type:"t",value:0,texture:null},tDepth:{type:"t",value:1,texture:null},focus:{type:"f",value:1},maxblur:{type:"f",value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = vec2( uv.x, 1.0 - uv.y );","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float focus;","uniform float maxblur;","uniform sampler2D tColor;","uniform sampler2D tDepth;","varying vec2 vUv;","void main() {","vec4 depth = texture2D( tDepth, vUv );","float factor = depth.x - focus;","vec4 col = texture2D( tColor, vUv, 2.0 * maxblur * abs( focus - depth.x ) );","gl_FragColor = col;","gl_FragColor.a = 1.0;","}"].join("\n")},sepia:{uniforms:{tDiffuse:{type:"t",value:0,texture:null},amount:{type:"f",value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = vec2( uv.x, 1.0 - uv.y );","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float amount;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 color = texture2D( tDiffuse, vUv );","vec3 c = color.rgb;","color.r = dot( c, vec3( 1.0 - 0.607 * amount, 0.769 * amount, 0.189 * amount ) );","color.g = dot( c, vec3( 0.349 * amount, 1.0 - 0.314 * amount, 0.168 * amount ) );","color.b = dot( c, vec3( 0.272 * amount, 0.534 * amount, 1.0 - 0.869 * amount ) );","gl_FragColor = vec4( min( vec3( 1.0 ), color.rgb ), color.a );","}"].join("\n")},dotscreen:{uniforms:{tDiffuse:{type:"t",value:0,texture:null},tSize:{type:"v2",value:new THREE.Vector2(256,256)},center:{type:"v2",value:new THREE.Vector2(.5,.5)},angle:{type:"f",value:1.57},scale:{type:"f",value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = vec2( uv.x, 1.0 - uv.y );","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform vec2 center;","uniform float angle;","uniform float scale;","uniform vec2 tSize;","uniform sampler2D tDiffuse;","varying vec2 vUv;","float pattern() {","float s = sin( angle ), c = cos( angle );","vec2 tex = vUv * tSize - center;","vec2 point = vec2( c * tex.x - s * tex.y, s * tex.x + c * tex.y ) * scale;","return ( sin( point.x ) * sin( point.y ) ) * 4.0;","}","void main() {","vec4 color = texture2D( tDiffuse, vUv );","float average = ( color.r + color.g + color.b ) / 3.0;","gl_FragColor = vec4( vec3( average * 10.0 - 5.0 + pattern() ), color.a );","}"].join("\n")},vignette:{uniforms:{tDiffuse:{type:"t",value:0,texture:null},offset:{type:"f",value:1},darkness:{type:"f",value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = vec2( uv.x, 1.0 - uv.y );","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float offset;","uniform float darkness;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 texel = texture2D( tDiffuse, vUv );","vec2 uv = ( vUv - vec2( 0.5 ) ) * vec2( offset );","gl_FragColor = vec4( mix( texel.rgb, vec3( 1.0 - darkness ), dot( uv, uv ) ), texel.a );","}"].join("\n")},bleachbypass:{uniforms:{tDiffuse:{type:"t",value:0,texture:null},opacity:{type:"f",value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = vec2( uv.x, 1.0 - uv.y );","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float opacity;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 base = texture2D( tDiffuse, vUv );","vec3 lumCoeff = vec3( 0.25, 0.65, 0.1 );","float lum = dot( lumCoeff, base.rgb );","vec3 blend = vec3( lum );","float L = min( 1.0, max( 0.0, 10.0 * ( lum - 0.45 ) ) );","vec3 result1 = 2.0 * base.rgb * blend;","vec3 result2 = 1.0 - 2.0 * ( 1.0 - blend ) * ( 1.0 - base.rgb );","vec3 newColor = mix( result1, result2, L );","float A2 = opacity * base.a;","vec3 mixRGB = A2 * newColor.rgb;","mixRGB += ( ( 1.0 - A2 ) * base.rgb );","gl_FragColor = vec4( mixRGB, base.a );","}"].join("\n")},focus:{uniforms:{tDiffuse:{type:"t",value:0,texture:null},screenWidth:{type:"f",value:1024},screenHeight:{type:"f",value:1024},sampleDistance:{type:"f",value:.94},waveFactor:{type:"f",value:.00125}},vertexShader:["varying vec2 vUv;","void main() {","vUv = vec2( uv.x, 1.0 - uv.y );","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float screenWidth;","uniform float screenHeight;","uniform float sampleDistance;","uniform float waveFactor;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 color, org, tmp, add;","float sample_dist, f;","vec2 vin;","vec2 uv = vUv;","add += color = org = texture2D( tDiffuse, uv );","vin = ( uv - vec2( 0.5 ) ) * vec2( 1.4 );","sample_dist = dot( vin, vin ) * 2.0;","f = ( waveFactor * 100.0 + sample_dist ) * sampleDistance * 4.0;","vec2 sampleSize = vec2(  1.0 / screenWidth, 1.0 / screenHeight ) * vec2( f );","add += tmp = texture2D( tDiffuse, uv + vec2( 0.111964, 0.993712 ) * sampleSize );","if( tmp.b < color.b ) color = tmp;","add += tmp = texture2D( tDiffuse, uv + vec2( 0.846724, 0.532032 ) * sampleSize );","if( tmp.b < color.b ) color = tmp;","add += tmp = texture2D( tDiffuse, uv + vec2( 0.943883, -0.330279 ) * sampleSize );","if( tmp.b < color.b ) color = tmp;","add += tmp = texture2D( tDiffuse, uv + vec2( 0.330279, -0.943883 ) * sampleSize );","if( tmp.b < color.b ) color = tmp;","add += tmp = texture2D( tDiffuse, uv + vec2( -0.532032, -0.846724 ) * sampleSize );","if( tmp.b < color.b ) color = tmp;","add += tmp = texture2D( tDiffuse, uv + vec2( -0.993712, -0.111964 ) * sampleSize );","if( tmp.b < color.b ) color = tmp;","add += tmp = texture2D( tDiffuse, uv + vec2( -0.707107, 0.707107 ) * sampleSize );","if( tmp.b < color.b ) color = tmp;","color = color * vec4( 2.0 ) - ( add / vec4( 8.0 ) );","color = color + ( add / vec4( 8.0 ) - color ) * ( vec4( 1.0 ) - vec4( sample_dist * 0.5 ) );","gl_FragColor = vec4( color.rgb * color.rgb * vec3( 0.95 ) + color.rgb, 1.0 );","}"].join("\n")},triangleBlur:{uniforms:{texture:{type:"t",value:0,texture:null},delta:{type:"v2",value:new THREE.Vector2(1,1)}},vertexShader:["varying vec2 vUv;","void main() {","vUv = vec2( uv.x, 1.0 - uv.y );","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#define ITERATIONS 10.0","uniform sampler2D texture;","uniform vec2 delta;","varying vec2 vUv;","float random( vec3 scale, float seed ) {","return fract( sin( dot( gl_FragCoord.xyz + seed, scale ) ) * 43758.5453 + seed );","}","void main() {","vec4 color = vec4( 0.0 );","float total = 0.0;","float offset = random( vec3( 12.9898, 78.233, 151.7182 ), 0.0 );","for ( float t = -ITERATIONS; t <= ITERATIONS; t ++ ) {","float percent = ( t + offset - 0.5 ) / ITERATIONS;","float weight = 1.0 - abs( percent );","color += texture2D( texture, vUv + delta * percent ) * weight;","total += weight;","}","gl_FragColor = color / total;","}"].join("\n")},basic:{uniforms:{},vertexShader:["void main() {","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["void main() {","gl_FragColor = vec4( 1.0, 0.0, 0.0, 0.5 );","}"].join("\n")},horizontalBlur:{uniforms:{tDiffuse:{type:"t",value:0,texture:null},h:{type:"f",value:1/512}},vertexShader:["varying vec2 vUv;","void main() {","vUv = vec2( uv.x, 1.0 - uv.y );","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform float h;","varying vec2 vUv;","void main() {","vec4 sum = vec4( 0.0 );","sum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * h, vUv.y ) ) * 0.051;","sum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * h, vUv.y ) ) * 0.0918;","sum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * h, vUv.y ) ) * 0.12245;","sum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * h, vUv.y ) ) * 0.1531;","sum += texture2D( tDiffuse, vec2( vUv.x, \t\t  \tvUv.y ) ) * 0.1633;","sum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * h, vUv.y ) ) * 0.1531;","sum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * h, vUv.y ) ) * 0.12245;","sum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * h, vUv.y ) ) * 0.0918;","sum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * h, vUv.y ) ) * 0.051;","gl_FragColor = sum;","}"].join("\n")},verticalBlur:{uniforms:{tDiffuse:{type:"t",value:0,texture:null},v:{type:"f",value:1/512}},vertexShader:["varying vec2 vUv;","void main() {","vUv = vec2( uv.x, 1.0 - uv.y );","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform float v;","varying vec2 vUv;","void main() {","vec4 sum = vec4( 0.0 );","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * v ) ) * 0.051;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * v ) ) * 0.0918;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * v ) ) * 0.12245;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * v ) ) * 0.1531;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y\t\t\t  ) ) * 0.1633;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * v ) ) * 0.1531;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * v ) ) * 0.12245;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * v ) ) * 0.0918;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * v ) ) * 0.051;","gl_FragColor = sum;","}"].join("\n")},horizontalTiltShift:{uniforms:{tDiffuse:{type:"t",value:0,texture:null},h:{type:"f",value:1/512},r:{type:"f",value:.35}},vertexShader:["varying vec2 vUv;","void main() {","vUv = vec2( uv.x, 1.0 - uv.y );","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform float h;","uniform float r;","varying vec2 vUv;","void main() {","vec4 sum = vec4( 0.0 );","float hh = h * abs( r - vUv.y );","sum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * hh, vUv.y ) ) * 0.051;","sum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * hh, vUv.y ) ) * 0.0918;","sum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * hh, vUv.y ) ) * 0.12245;","sum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * hh, vUv.y ) ) * 0.1531;","sum += texture2D( tDiffuse, vec2( vUv.x, \t\t  \t vUv.y ) ) * 0.1633;","sum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * hh, vUv.y ) ) * 0.1531;","sum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * hh, vUv.y ) ) * 0.12245;","sum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * hh, vUv.y ) ) * 0.0918;","sum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * hh, vUv.y ) ) * 0.051;","gl_FragColor = sum;","}"].join("\n")},verticalTiltShift:{uniforms:{tDiffuse:{type:"t",value:0,texture:null},v:{type:"f",value:1/512},r:{type:"f",value:.35}},vertexShader:["varying vec2 vUv;","void main() {","vUv = vec2( uv.x, 1.0 - uv.y );","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform float v;","uniform float r;","varying vec2 vUv;","void main() {","vec4 sum = vec4( 0.0 );","float vv = v * abs( r - vUv.y );","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * vv ) ) * 0.051;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * vv ) ) * 0.0918;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * vv ) ) * 0.12245;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * vv ) ) * 0.1531;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y\t\t\t   ) ) * 0.1633;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * vv ) ) * 0.1531;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * vv ) ) * 0.12245;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * vv ) ) * 0.0918;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * vv ) ) * 0.051;","gl_FragColor = sum;","}"].join("\n")},blend:{uniforms:{tDiffuse1:{type:"t",value:0,texture:null},tDiffuse2:{type:"t",value:1,texture:null},mixRatio:{type:"f",value:.5},opacity:{type:"f",value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = vec2( uv.x, 1.0 - uv.y );","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float opacity;","uniform float mixRatio;","uniform sampler2D tDiffuse1;","uniform sampler2D tDiffuse2;","varying vec2 vUv;","void main() {","vec4 texel1 = texture2D( tDiffuse1, vUv );","vec4 texel2 = texture2D( tDiffuse2, vUv );","gl_FragColor = opacity * mix( texel1, texel2, mixRatio );","}"].join("\n")},fxaa:{uniforms:{tDiffuse:{type:"t",value:0,texture:null},resolution:{type:"v2",value:new THREE.Vector2(1/1024,1/512)}},vertexShader:["varying vec2 vUv;","void main() {","vUv = vec2( uv.x, 1.0 - uv.y );","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform vec2 resolution;","varying vec2 vUv;","#define FXAA_REDUCE_MIN   (1.0/128.0)","#define FXAA_REDUCE_MUL   (1.0/8.0)","#define FXAA_SPAN_MAX     8.0","void main() {","vec3 rgbNW = texture2D( tDiffuse, ( gl_FragCoord.xy + vec2( -1.0, -1.0 ) ) * resolution ).xyz;","vec3 rgbNE = texture2D( tDiffuse, ( gl_FragCoord.xy + vec2( 1.0, -1.0 ) ) * resolution ).xyz;","vec3 rgbSW = texture2D( tDiffuse, ( gl_FragCoord.xy + vec2( -1.0, 1.0 ) ) * resolution ).xyz;","vec3 rgbSE = texture2D( tDiffuse, ( gl_FragCoord.xy + vec2( 1.0, 1.0 ) ) * resolution ).xyz;","vec3 rgbM  = texture2D( tDiffuse,  gl_FragCoord.xy  * resolution ).xyz;","vec3 luma = vec3( 0.299, 0.587, 0.114 );","float lumaNW = dot( rgbNW, luma );","float lumaNE = dot( rgbNE, luma );","float lumaSW = dot( rgbSW, luma );","float lumaSE = dot( rgbSE, luma );","float lumaM  = dot( rgbM,  luma );","float lumaMin = min( lumaM, min( min( lumaNW, lumaNE ), min( lumaSW, lumaSE ) ) );","float lumaMax = max( lumaM, max( max( lumaNW, lumaNE) , max( lumaSW, lumaSE ) ) );","vec2 dir;","dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));","dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));","float dirReduce = max( ( lumaNW + lumaNE + lumaSW + lumaSE ) * ( 0.25 * FXAA_REDUCE_MUL ), FXAA_REDUCE_MIN );","float rcpDirMin = 1.0 / ( min( abs( dir.x ), abs( dir.y ) ) + dirReduce );","dir = min( vec2( FXAA_SPAN_MAX,  FXAA_SPAN_MAX),","max( vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),","dir * rcpDirMin)) * resolution;","vec3 rgbA = 0.5 * (","texture2D( tDiffuse, gl_FragCoord.xy  * resolution + dir * ( 1.0 / 3.0 - 0.5 ) ).xyz +","texture2D( tDiffuse, gl_FragCoord.xy  * resolution + dir * ( 2.0 / 3.0 - 0.5 ) ).xyz );","vec3 rgbB = rgbA * 0.5 + 0.25 * (","texture2D( tDiffuse, gl_FragCoord.xy  * resolution + dir * -0.5 ).xyz +","texture2D( tDiffuse, gl_FragCoord.xy  * resolution + dir * 0.5 ).xyz );","float lumaB = dot( rgbB, luma );","if ( ( lumaB < lumaMin ) || ( lumaB > lumaMax ) ) {","gl_FragColor = vec4( rgbA, 1.0 );","} else {","gl_FragColor = vec4( rgbB, 1.0 );","}","}"].join("\n")},luminosity:{uniforms:{tDiffuse:{type:"t",value:0,texture:null}},vertexShader:["varying vec2 vUv;","void main() {","vUv = vec2( uv.x, 1.0 - uv.y );","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 texel = texture2D( tDiffuse, vUv );","vec3 luma = vec3( 0.299, 0.587, 0.114 );","float v = dot( texel.xyz, luma );","gl_FragColor = vec4( v, v, v, texel.w );","}"].join("\n")},colorCorrection:{uniforms:{tDiffuse:{type:"t",value:0,texture:null},powRGB:{type:"v3",value:new THREE.Vector3(2,2,2)},mulRGB:{type:"v3",value:new THREE.Vector3(1,1,1)}},vertexShader:["varying vec2 vUv;","void main() {","vUv = vec2( uv.x, 1.0 - uv.y );","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform vec3 powRGB;","uniform vec3 mulRGB;","varying vec2 vUv;","void main() {","gl_FragColor = texture2D( tDiffuse, vUv );","gl_FragColor.rgb = mulRGB * pow( gl_FragColor.rgb, powRGB );","}"].join("\n")},normalmap:{uniforms:{heightMap:{type:"t",value:0,texture:null},resolution:{type:"v2",value:new THREE.Vector2(512,512)},scale:{type:"v2",value:new THREE.Vector2(1,1)},height:{type:"f",value:.05}},vertexShader:["varying vec2 vUv;","void main() {","vUv = vec2( uv.x, 1.0 - uv.y );","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float height;","uniform vec2 resolution;","uniform sampler2D heightMap;","varying vec2 vUv;","void main() {","float val = texture2D( heightMap, vUv ).x;","float valU = texture2D( heightMap, vUv + vec2( 1.0 / resolution.x, 0.0 ) ).x;","float valV = texture2D( heightMap, vUv + vec2( 0.0, 1.0 / resolution.y ) ).x;","gl_FragColor = vec4( ( 0.5 * normalize( vec3( val - valU, val - valV, height  ) ) + 0.5 ), 1.0 );","}"].join("\n")},ssao:{uniforms:{tDiffuse:{type:"t",value:0,texture:null},tDepth:{type:"t",value:1,texture:null},size:{type:"v2",value:new THREE.Vector2(512,512)},cameraNear:{type:"f",value:1},cameraFar:{type:"f",value:100},fogNear:{type:"f",value:5},fogFar:{type:"f",value:100},fogEnabled:{type:"i",value:0},aoClamp:{type:"f",value:.3}},vertexShader:["varying vec2 vUv;","void main() {","vUv = vec2( uv.x, 1.0 - uv.y );","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float cameraNear;","uniform float cameraFar;","uniform float fogNear;","uniform float fogFar;","uniform bool fogEnabled;","uniform vec2 size;","uniform float aoClamp;","uniform sampler2D tDiffuse;","uniform sampler2D tDepth;","varying vec2 vUv;","#define DL 2.399963229728653","#define EULER 2.718281828459045","float width = size.x;","float height = size.y;","float cameraFarPlusNear = cameraFar + cameraNear;","float cameraFarMinusNear = cameraFar - cameraNear;","float cameraCoef = 2.0 * cameraNear;","const int samples = 8;","const float radius = 5.0;","const bool useNoise = false;","const float noiseAmount = 0.0002;","const float diffArea = 0.4;","const float gDisplace = 0.4;","const bool onlyAO = false;","const float lumInfluence = 0.3;","float unpackDepth( const in vec4 rgba_depth ) {","const vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );","float depth = dot( rgba_depth, bit_shift );","return depth;","}","vec2 rand( const vec2 coord ) {","vec2 noise;","if ( useNoise ) {","float nx = dot ( coord, vec2( 12.9898, 78.233 ) );","float ny = dot ( coord, vec2( 12.9898, 78.233 ) * 2.0 );","noise = clamp( fract ( 43758.5453 * sin( vec2( nx, ny ) ) ), 0.0, 1.0 );","} else {","float ff = fract( 1.0 - coord.s * ( width / 2.0 ) );","float gg = fract( coord.t * ( height / 2.0 ) );","noise = vec2( 0.25, 0.75 ) * vec2( ff ) + vec2( 0.75, 0.25 ) * gg;","}","return ( noise * 2.0  - 1.0 ) * noiseAmount;","}","float doFog() {","float zdepth = unpackDepth( texture2D( tDepth, vUv ) );","float depth = -cameraFar * cameraNear / ( zdepth * cameraFarMinusNear - cameraFar );","return smoothstep( fogNear, fogFar, depth );","}","float readDepth( const in vec2 coord ) {","return cameraCoef / ( cameraFarPlusNear - unpackDepth( texture2D( tDepth, coord ) ) * cameraFarMinusNear );","}","float compareDepths( const in float depth1, const in float depth2, inout int far ) {","float garea = 2.0;","float diff = ( depth1 - depth2 ) * 100.0;","if ( diff < gDisplace ) {","garea = diffArea;","} else {","far = 1;","}","float dd = diff - gDisplace;","float gauss = pow( EULER, -2.0 * dd * dd / ( garea * garea ) );","return gauss;","}","float calcAO( float depth, float dw, float dh ) {","float dd = radius - depth * radius;","vec2 vv = vec2( dw, dh );","vec2 coord1 = vUv + dd * vv;","vec2 coord2 = vUv - dd * vv;","float temp1 = 0.0;","float temp2 = 0.0;","int far = 0;","temp1 = compareDepths( depth, readDepth( coord1 ), far );","if ( far > 0 ) {","temp2 = compareDepths( readDepth( coord2 ), depth, far );","temp1 += ( 1.0 - temp1 ) * temp2;","}","return temp1;","}","void main() {","vec2 noise = rand( vUv );","float depth = readDepth( vUv );","float tt = clamp( depth, aoClamp, 1.0 );","float w = ( 1.0 / width )  / tt + ( noise.x * ( 1.0 - noise.x ) );","float h = ( 1.0 / height ) / tt + ( noise.y * ( 1.0 - noise.y ) );","float pw;","float ph;","float ao;","float dz = 1.0 / float( samples );","float z = 1.0 - dz / 2.0;","float l = 0.0;","for ( int i = 0; i <= samples; i ++ ) {","float r = sqrt( 1.0 - z );","pw = cos( l ) * r;","ph = sin( l ) * r;","ao += calcAO( depth, pw * w, ph * h );","z = z - dz;","l = l + DL;","}","ao /= float( samples );","ao = 1.0 - ao;","if ( fogEnabled ) {","ao = mix( ao, 1.0, doFog() );","}","vec3 color = texture2D( tDiffuse, vUv ).rgb;","vec3 lumcoeff = vec3( 0.299, 0.587, 0.114 );","float lum = dot( color.rgb, lumcoeff );","vec3 luminance = vec3( lum );","vec3 final = vec3( color * mix( vec3( ao ), vec3( 1.0 ), luminance * lumInfluence ) );","if ( onlyAO ) {","final = vec3( mix( vec3( ao ), vec3( 1.0 ), luminance * lumInfluence ) );","}","gl_FragColor = vec4( final, 1.0 );","}"].join("\n")},colorify:{uniforms:{tDiffuse:{type:"t",value:0,texture:null},color:{type:"c",value:new THREE.Color(16777215)}},vertexShader:["varying vec2 vUv;","void main() {","vUv = vec2( uv.x, 1.0 - uv.y );","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform vec3 color;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 texel = texture2D( tDiffuse, vUv );","vec3 luma = vec3( 0.299, 0.587, 0.114 );","float v = dot( texel.xyz, luma );","gl_FragColor = vec4( v * color, texel.w );","}"].join("\n")},unpackDepthRGBA:{uniforms:{tDiffuse:{type:"t",value:0,texture:null},opacity:{type:"f",value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = vec2( uv.x, 1.0 - uv.y );","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float opacity;","uniform sampler2D tDiffuse;","varying vec2 vUv;","float unpackDepth( const in vec4 rgba_depth ) {","const vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );","float depth = dot( rgba_depth, bit_shift );","return depth;","}","void main() {","float depth = 1.0 - unpackDepth( texture2D( tDiffuse, vUv ) );","gl_FragColor = opacity * vec4( vec3( depth ), 1.0 );","}"].join("\n")},buildKernel:function(e){var t,n,r,i,o=2*Math.ceil(3*e)+1;for(o>25&&(o=25),i=.5*(o-1),n=new Array(o),r=0,t=0;t<o;++t)n[t]=function(e,t){return Math.exp(-e*e/(2*t*t))}(t-i,e),r+=n[t];for(t=0;t<o;++t)n[t]/=r;return n}},window.console||(window.console={},window.console.log=function(e){},window.console.dir=function(e){}),Array.prototype.indexOf||(Array.prototype.indexOf=function(e){for(var t=0;t<this.length;t++)if(this[t]==e)return t;return-1}),function(){function e(){var e={};return e.FRAMERATE=30,e.MAX_VIRTUAL_PIXELS=3e4,e.init=function(t){e.Definitions={},e.Styles={},e.Animations=[],e.Images=[],e.ctx=t,e.ViewPort=new function(){this.viewPorts=[],this.Clear=function(){this.viewPorts=[]},this.SetCurrent=function(e,t){this.viewPorts.push({width:e,height:t})},this.RemoveCurrent=function(){this.viewPorts.pop()},this.Current=function(){return this.viewPorts[this.viewPorts.length-1]},this.width=function(){return this.Current().width},this.height=function(){return this.Current().height},this.ComputeSize=function(e){return null!=e&&"number"==typeof e?e:"x"==e?this.width():"y"==e?this.height():Math.sqrt(Math.pow(this.width(),2)+Math.pow(this.height(),2))/Math.sqrt(2)}}},e.init(),e.ImagesLoaded=function(){for(var t=0;t<e.Images.length;t++)if(!e.Images[t].loaded)return!1;return!0},e.trim=function(e){return e.replace(/^\s+|\s+$/g,"")},e.compressSpaces=function(e){return e.replace(/[\s\r\t\n]+/gm," ")},e.ajax=function(e){var t;return t=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),t?(t.open("GET",e,!1),t.send(null),t.responseText):null},e.parseXml=function(e){if(window.DOMParser){return(new DOMParser).parseFromString(e,"text/xml")}e=e.replace(/<!DOCTYPE svg[^>]*>/,"");var t=new ActiveXObject("Microsoft.XMLDOM");return t.async="false",t.loadXML(e),t},e.Property=function(t,n){this.name=t,this.value=n,this.hasValue=function(){return null!=this.value&&""!==this.value},this.numValue=function(){if(!this.hasValue())return 0;var e=parseFloat(this.value);return(this.value+"").match(/%$/)&&(e/=100),e},this.valueOrDefault=function(e){return this.hasValue()?this.value:e},this.numValueOrDefault=function(e){return this.hasValue()?this.numValue():e};var r=this;this.Color={addOpacity:function(t){var n=r.value;if(null!=t&&""!=t){var i=new RGBColor(r.value);i.ok&&(n="rgba("+i.r+", "+i.g+", "+i.b+", "+t+")")}return new e.Property(r.name,n)}},this.Definition={getDefinition:function(){var t=r.value.replace(/^(url\()?#([^\)]+)\)?$/,"$2");return e.Definitions[t]},isUrl:function(){return 0==r.value.indexOf("url(")},getFillStyle:function(t){var n=this.getDefinition();return null!=n&&n.createGradient?n.createGradient(e.ctx,t):null!=n&&n.createPattern?n.createPattern(e.ctx,t):null}},this.Length={DPI:function(e){return 96},EM:function(t){var n=12,r=new e.Property("fontSize",e.Font.Parse(e.ctx.font).fontSize);return r.hasValue()&&(n=r.Length.toPixels(t)),n},toPixels:function(t){if(!r.hasValue())return 0;var n=r.value+"";return n.match(/em$/)?r.numValue()*this.EM(t):n.match(/ex$/)?r.numValue()*this.EM(t)/2:n.match(/px$/)?r.numValue():n.match(/pt$/)?1.25*r.numValue():n.match(/pc$/)?15*r.numValue():n.match(/cm$/)?r.numValue()*this.DPI(t)/2.54:n.match(/mm$/)?r.numValue()*this.DPI(t)/25.4:n.match(/in$/)?r.numValue()*this.DPI(t):n.match(/%$/)?r.numValue()*e.ViewPort.ComputeSize(t):r.numValue()}},this.Time={toMilliseconds:function(){if(!r.hasValue())return 0;var e=r.value+"";return e.match(/s$/)?1e3*r.numValue():(e.match(/ms$/),r.numValue())}},this.Angle={toRadians:function(){if(!r.hasValue())return 0;var e=r.value+"";return e.match(/deg$/)?r.numValue()*(Math.PI/180):e.match(/grad$/)?r.numValue()*(Math.PI/200):e.match(/rad$/)?r.numValue():r.numValue()*(Math.PI/180)}}},e.Font=new function(){this.Styles=["normal","italic","oblique","inherit"],this.Variants=["normal","small-caps","inherit"],this.Weights=["normal","bold","bolder","lighter","100","200","300","400","500","600","700","800","900","inherit"],this.CreateFont=function(t,n,r,i,o,a){var s=null!=a?this.Parse(a):this.CreateFont("","","","","",e.ctx.font);return{fontFamily:o||s.fontFamily,fontSize:i||s.fontSize,fontStyle:t||s.fontStyle,fontWeight:r||s.fontWeight,fontVariant:n||s.fontVariant,toString:function(){return[this.fontStyle,this.fontVariant,this.fontWeight,this.fontSize,this.fontFamily].join(" ")}}};var t=this;this.Parse=function(n){for(var r={},i=e.trim(e.compressSpaces(n||"")).split(" "),o={fontSize:!1,fontStyle:!1,fontWeight:!1,fontVariant:!1},a="",s=0;s<i.length;s++)o.fontStyle||-1==t.Styles.indexOf(i[s])?o.fontVariant||-1==t.Variants.indexOf(i[s])?o.fontWeight||-1==t.Weights.indexOf(i[s])?o.fontSize?"inherit"!=i[s]&&(a+=i[s]):("inherit"!=i[s]&&(r.fontSize=i[s].split("/")[0]),o.fontStyle=o.fontVariant=o.fontWeight=o.fontSize=!0):("inherit"!=i[s]&&(r.fontWeight=i[s]),o.fontStyle=o.fontVariant=o.fontWeight=!0):("inherit"!=i[s]&&(r.fontVariant=i[s]),o.fontStyle=o.fontVariant=!0):("inherit"!=i[s]&&(r.fontStyle=i[s]),o.fontStyle=!0);return""!=a&&(r.fontFamily=a),r}},e.ToNumberArray=function(t){for(var n=e.trim(e.compressSpaces((t||"").replace(/,/g," "))).split(" "),r=0;r<n.length;r++)n[r]=parseFloat(n[r]);return n},e.Point=function(e,t){this.x=e,this.y=t,this.angleTo=function(e){return Math.atan2(e.y-this.y,e.x-this.x)},this.applyTransform=function(e){var t=this.x*e[0]+this.y*e[2]+e[4],n=this.x*e[1]+this.y*e[3]+e[5];this.x=t,this.y=n}},e.CreatePoint=function(t){var n=e.ToNumberArray(t)
;return new e.Point(n[0],n[1])},e.CreatePath=function(t){for(var n=e.ToNumberArray(t),r=[],i=0;i<n.length;i+=2)r.push(new e.Point(n[i],n[i+1]));return r},e.BoundingBox=function(e,t,n,r){this.x1=Number.NaN,this.y1=Number.NaN,this.x2=Number.NaN,this.y2=Number.NaN,this.x=function(){return this.x1},this.y=function(){return this.y1},this.width=function(){return this.x2-this.x1},this.height=function(){return this.y2-this.y1},this.addPoint=function(e,t){null!=e&&((isNaN(this.x1)||isNaN(this.x2))&&(this.x1=e,this.x2=e),e<this.x1&&(this.x1=e),e>this.x2&&(this.x2=e)),null!=t&&((isNaN(this.y1)||isNaN(this.y2))&&(this.y1=t,this.y2=t),t<this.y1&&(this.y1=t),t>this.y2&&(this.y2=t))},this.addX=function(e){this.addPoint(e,null)},this.addY=function(e){this.addPoint(null,e)},this.addBoundingBox=function(e){this.addPoint(e.x1,e.y1),this.addPoint(e.x2,e.y2)},this.addQuadraticCurve=function(e,t,n,r,i,o){var a=e+2/3*(n-e),s=t+2/3*(r-t),l=a+1/3*(i-e),c=s+1/3*(o-t);this.addBezierCurve(e,t,a,l,s,c,i,o)},this.addBezierCurve=function(e,t,n,r,o,a,s,l){var c=[e,t],u=[n,r],h=[o,a],f=[s,l];for(this.addPoint(c[0],c[1]),this.addPoint(f[0],f[1]),i=0;i<=1;i++){var d=function(e){return Math.pow(1-e,3)*c[i]+3*Math.pow(1-e,2)*e*u[i]+3*(1-e)*Math.pow(e,2)*h[i]+Math.pow(e,3)*f[i]},p=6*c[i]-12*u[i]+6*h[i],m=-3*c[i]+9*u[i]-9*h[i]+3*f[i],v=3*u[i]-3*c[i];if(0!=m){var g=Math.pow(p,2)-4*v*m;if(!(g<0)){var E=(-p+Math.sqrt(g))/(2*m);0<E&&E<1&&(0==i&&this.addX(d(E)),1==i&&this.addY(d(E)));var y=(-p-Math.sqrt(g))/(2*m);0<y&&y<1&&(0==i&&this.addX(d(y)),1==i&&this.addY(d(y)))}}else{if(0==p)continue;var x=-v/p;0<x&&x<1&&(0==i&&this.addX(d(x)),1==i&&this.addY(d(x)))}}},this.isPointInBox=function(e,t){return this.x1<=e&&e<=this.x2&&this.y1<=t&&t<=this.y2},this.addPoint(e,t),this.addPoint(n,r)},e.Transform=function(t){var n=this;this.Type={},this.Type.translate=function(t){this.p=e.CreatePoint(t),this.apply=function(e){e.translate(this.p.x||0,this.p.y||0)},this.applyToPoint=function(e){e.applyTransform([1,0,0,1,this.p.x||0,this.p.y||0])}},this.Type.rotate=function(t){var n=e.ToNumberArray(t);this.angle=new e.Property("angle",n[0]),this.cx=n[1]||0,this.cy=n[2]||0,this.apply=function(e){e.translate(this.cx,this.cy),e.rotate(this.angle.Angle.toRadians()),e.translate(-this.cx,-this.cy)},this.applyToPoint=function(e){var t=this.angle.Angle.toRadians();e.applyTransform([1,0,0,1,this.p.x||0,this.p.y||0]),e.applyTransform([Math.cos(t),Math.sin(t),-Math.sin(t),Math.cos(t),0,0]),e.applyTransform([1,0,0,1,-this.p.x||0,-this.p.y||0])}},this.Type.scale=function(t){this.p=e.CreatePoint(t),this.apply=function(e){e.scale(this.p.x||1,this.p.y||this.p.x||1)},this.applyToPoint=function(e){e.applyTransform([this.p.x||0,0,0,this.p.y||0,0,0])}},this.Type.matrix=function(t){this.m=e.ToNumberArray(t),this.apply=function(e){e.transform(this.m[0],this.m[1],this.m[2],this.m[3],this.m[4],this.m[5])},this.applyToPoint=function(e){e.applyTransform(this.m)}},this.Type.SkewBase=function(t){this.base=n.Type.matrix,this.base(t),this.angle=new e.Property("angle",t)},this.Type.SkewBase.prototype=new this.Type.matrix,this.Type.skewX=function(e){this.base=n.Type.SkewBase,this.base(e),this.m=[1,0,Math.tan(this.angle.Angle.toRadians()),1,0,0]},this.Type.skewX.prototype=new this.Type.SkewBase,this.Type.skewY=function(e){this.base=n.Type.SkewBase,this.base(e),this.m=[1,Math.tan(this.angle.Angle.toRadians()),0,1,0,0]},this.Type.skewY.prototype=new this.Type.SkewBase,this.transforms=[],this.apply=function(e){for(var t=0;t<this.transforms.length;t++)this.transforms[t].apply(e)},this.applyToPoint=function(e){for(var t=0;t<this.transforms.length;t++)this.transforms[t].applyToPoint(e)};for(var r=e.trim(e.compressSpaces(t)).split(/\s(?=[a-z])/),i=0;i<r.length;i++){var o=r[i].split("(")[0],a=r[i].split("(")[1].replace(")",""),s=new this.Type[o](a);this.transforms.push(s)}},e.AspectRatio=function(t,n,r,i,o,a,s,l,c,u){n=e.compressSpaces(n),n=n.replace(/^defer\s/,"");var h=n.split(" ")[0]||"xMidYMid",f=n.split(" ")[1]||"meet",d=r/i,p=o/a,m=Math.min(d,p),v=Math.max(d,p);"meet"==f&&(i*=m,a*=m),"slice"==f&&(i*=v,a*=v),c=new e.Property("refX",c),u=new e.Property("refY",u),c.hasValue()&&u.hasValue()?t.translate(-m*c.Length.toPixels("x"),-m*u.Length.toPixels("y")):(h.match(/^xMid/)&&("meet"==f&&m==p||"slice"==f&&v==p)&&t.translate(r/2-i/2,0),h.match(/YMid$/)&&("meet"==f&&m==d||"slice"==f&&v==d)&&t.translate(0,o/2-a/2),h.match(/^xMax/)&&("meet"==f&&m==p||"slice"==f&&v==p)&&t.translate(r-i,0),h.match(/YMax$/)&&("meet"==f&&m==d||"slice"==f&&v==d)&&t.translate(0,o-a)),"none"==h?t.scale(d,p):"meet"==f?t.scale(m,m):"slice"==f&&t.scale(v,v),t.translate(null==s?0:-s,null==l?0:-l)},e.Element={},e.Element.ElementBase=function(t){if(this.attributes={},this.styles={},this.children=[],this.attribute=function(t,n){var r=this.attributes[t];return null!=r?r:(r=new e.Property(t,""),1==n&&(this.attributes[t]=r),r)},this.style=function(t,n){var r=this.styles[t];if(null!=r)return r;var i=this.attribute(t);if(null!=i&&i.hasValue())return i;var o=this.parent;if(null!=o){var a=o.style(t);if(null!=a&&a.hasValue())return a}return r=new e.Property(t,""),1==n&&(this.styles[t]=r),r},this.render=function(e){if("none"!=this.style("display").value&&"hidden"!=this.attribute("visibility").value){if(e.save(),this.setContext(e),this.attribute("mask").hasValue()){var t=this.attribute("mask").Definition.getDefinition();null!=t&&t.apply(e,this)}else if(this.style("filter").hasValue()){var n=this.style("filter").Definition.getDefinition();null!=n&&n.apply(e,this)}else this.renderChildren(e);this.clearContext(e),e.restore()}},this.setContext=function(e){},this.clearContext=function(e){},this.renderChildren=function(e){for(var t=0;t<this.children.length;t++)this.children[t].render(e)},this.addChild=function(t,n){var r=t;n&&(r=e.CreateElement(t)),r.parent=this,this.children.push(r)},null!=t&&1==t.nodeType){for(var n=0;n<t.childNodes.length;n++){var r=t.childNodes[n];1==r.nodeType&&this.addChild(r,!0)}for(var n=0;n<t.attributes.length;n++){var i=t.attributes[n];this.attributes[i.nodeName]=new e.Property(i.nodeName,i.nodeValue)}var o=e.Styles[t.nodeName];if(null!=o)for(var a in o)this.styles[a]=o[a];if(this.attribute("class").hasValue())for(var s=e.compressSpaces(this.attribute("class").value).split(" "),l=0;l<s.length;l++){if(null!=(o=e.Styles["."+s[l]]))for(var a in o)this.styles[a]=o[a];if(null!=(o=e.Styles[t.nodeName+"."+s[l]]))for(var a in o)this.styles[a]=o[a]}if(this.attribute("style").hasValue())for(var o=this.attribute("style").value.split(";"),n=0;n<o.length;n++)if(""!=e.trim(o[n])){var c=o[n].split(":"),a=e.trim(c[0]),u=e.trim(c[1]);this.styles[a]=new e.Property(a,u)}this.attribute("id").hasValue()&&null==e.Definitions[this.attribute("id").value]&&(e.Definitions[this.attribute("id").value]=this)}},e.Element.RenderedElementBase=function(t){this.base=e.Element.ElementBase,this.base(t),this.setContext=function(t){if(this.style("fill").Definition.isUrl()){var n=this.style("fill").Definition.getFillStyle(this);null!=n&&(t.fillStyle=n)}else if(this.style("fill").hasValue()){var r=this.style("fill");this.style("fill-opacity").hasValue()&&(r=r.Color.addOpacity(this.style("fill-opacity").value)),t.fillStyle="none"==r.value?"rgba(0,0,0,0)":r.value}if(this.style("stroke").Definition.isUrl()){var n=this.style("stroke").Definition.getFillStyle(this);null!=n&&(t.strokeStyle=n)}else if(this.style("stroke").hasValue()){var i=this.style("stroke");this.style("stroke-opacity").hasValue()&&(i=i.Color.addOpacity(this.style("stroke-opacity").value)),t.strokeStyle="none"==i.value?"rgba(0,0,0,0)":i.value}if(this.style("stroke-width").hasValue()&&(t.lineWidth=this.style("stroke-width").Length.toPixels()),this.style("stroke-linecap").hasValue()&&(t.lineCap=this.style("stroke-linecap").value),this.style("stroke-linejoin").hasValue()&&(t.lineJoin=this.style("stroke-linejoin").value),this.style("stroke-miterlimit").hasValue()&&(t.miterLimit=this.style("stroke-miterlimit").value),void 0!==t.font&&(t.font=e.Font.CreateFont(this.style("font-style").value,this.style("font-variant").value,this.style("font-weight").value,this.style("font-size").hasValue()?this.style("font-size").Length.toPixels()+"px":"",this.style("font-family").value).toString()),this.attribute("transform").hasValue()){new e.Transform(this.attribute("transform").value).apply(t)}if(this.attribute("clip-path").hasValue()){var o=this.attribute("clip-path").Definition.getDefinition();null!=o&&o.apply(t)}this.style("opacity").hasValue()&&(t.globalAlpha=this.style("opacity").numValue())}},e.Element.RenderedElementBase.prototype=new e.Element.ElementBase,e.Element.PathElementBase=function(t){this.base=e.Element.RenderedElementBase,this.base(t),this.path=function(t){return null!=t&&t.beginPath(),new e.BoundingBox},this.renderChildren=function(t){this.path(t),e.Mouse.checkPath(this,t),""!=t.fillStyle&&t.fill(),""!=t.strokeStyle&&t.stroke();var n=this.getMarkers();if(null!=n){if(this.style("marker-start").Definition.isUrl()){var r=this.style("marker-start").Definition.getDefinition();r.render(t,n[0][0],n[0][1])}if(this.style("marker-mid").Definition.isUrl())for(var r=this.style("marker-mid").Definition.getDefinition(),i=1;i<n.length-1;i++)r.render(t,n[i][0],n[i][1]);if(this.style("marker-end").Definition.isUrl()){var r=this.style("marker-end").Definition.getDefinition();r.render(t,n[n.length-1][0],n[n.length-1][1])}}},this.getBoundingBox=function(){return this.path()},this.getMarkers=function(){return null}},e.Element.PathElementBase.prototype=new e.Element.RenderedElementBase,e.Element.svg=function(t){this.base=e.Element.RenderedElementBase,this.base(t),this.baseClearContext=this.clearContext,this.clearContext=function(t){this.baseClearContext(t),e.ViewPort.RemoveCurrent()},this.baseSetContext=this.setContext,this.setContext=function(t){t.strokeStyle="rgba(0,0,0,0)",t.lineCap="butt",t.lineJoin="miter",t.miterLimit=4,this.baseSetContext(t),this.attribute("x").hasValue()&&this.attribute("y").hasValue()&&t.translate(this.attribute("x").Length.toPixels("x"),this.attribute("y").Length.toPixels("y"));var n=e.ViewPort.width(),r=e.ViewPort.height();if(void 0===this.root&&this.attribute("width").hasValue()&&this.attribute("height").hasValue()){n=this.attribute("width").Length.toPixels("x"),r=this.attribute("height").Length.toPixels("y");var i=0,o=0;this.attribute("refX").hasValue()&&this.attribute("refY").hasValue()&&(i=-this.attribute("refX").Length.toPixels("x"),o=-this.attribute("refY").Length.toPixels("y")),t.beginPath(),t.moveTo(i,o),t.lineTo(n,o),t.lineTo(n,r),t.lineTo(i,r),t.closePath(),t.clip()}if(e.ViewPort.SetCurrent(n,r),this.attribute("viewBox").hasValue()){var a=e.ToNumberArray(this.attribute("viewBox").value),s=a[0],l=a[1];n=a[2],r=a[3],e.AspectRatio(t,this.attribute("preserveAspectRatio").value,e.ViewPort.width(),n,e.ViewPort.height(),r,s,l,this.attribute("refX").value,this.attribute("refY").value),e.ViewPort.RemoveCurrent(),e.ViewPort.SetCurrent(a[2],a[3])}}},e.Element.svg.prototype=new e.Element.RenderedElementBase,e.Element.rect=function(t){this.base=e.Element.PathElementBase,this.base(t),this.path=function(t){var n=this.attribute("x").Length.toPixels("x"),r=this.attribute("y").Length.toPixels("y"),i=this.attribute("width").Length.toPixels("x"),o=this.attribute("height").Length.toPixels("y"),a=this.attribute("rx").Length.toPixels("x"),s=this.attribute("ry").Length.toPixels("y");return this.attribute("rx").hasValue()&&!this.attribute("ry").hasValue()&&(s=a),this.attribute("ry").hasValue()&&!this.attribute("rx").hasValue()&&(a=s),null!=t&&(t.beginPath(),t.moveTo(n+a,r),t.lineTo(n+i-a,r),t.quadraticCurveTo(n+i,r,n+i,r+s),t.lineTo(n+i,r+o-s),t.quadraticCurveTo(n+i,r+o,n+i-a,r+o),t.lineTo(n+a,r+o),t.quadraticCurveTo(n,r+o,n,r+o-s),t.lineTo(n,r+s),t.quadraticCurveTo(n,r,n+a,r),t.closePath()),new e.BoundingBox(n,r,n+i,r+o)}},e.Element.rect.prototype=new e.Element.PathElementBase,e.Element.circle=function(t){this.base=e.Element.PathElementBase,this.base(t),this.path=function(t){var n=this.attribute("cx").Length.toPixels("x"),r=this.attribute("cy").Length.toPixels("y"),i=this.attribute("r").Length.toPixels();return null!=t&&(t.beginPath(),t.arc(n,r,i,0,2*Math.PI,!0),t.closePath()),new e.BoundingBox(n-i,r-i,n+i,r+i)}},e.Element.circle.prototype=new e.Element.PathElementBase,e.Element.ellipse=function(t){this.base=e.Element.PathElementBase,this.base(t),this.path=function(t){var n=(Math.sqrt(2)-1)/3*4,r=this.attribute("rx").Length.toPixels("x"),i=this.attribute("ry").Length.toPixels("y"),o=this.attribute("cx").Length.toPixels("x"),a=this.attribute("cy").Length.toPixels("y");return null!=t&&(t.beginPath(),t.moveTo(o,a-i),t.bezierCurveTo(o+n*r,a-i,o+r,a-n*i,o+r,a),t.bezierCurveTo(o+r,a+n*i,o+n*r,a+i,o,a+i),t.bezierCurveTo(o-n*r,a+i,o-r,a+n*i,o-r,a),t.bezierCurveTo(o-r,a-n*i,o-n*r,a-i,o,a-i),t.closePath()),new e.BoundingBox(o-r,a-i,o+r,a+i)}},e.Element.ellipse.prototype=new e.Element.PathElementBase,e.Element.line=function(t){this.base=e.Element.PathElementBase,this.base(t),this.getPoints=function(){return[new e.Point(this.attribute("x1").Length.toPixels("x"),this.attribute("y1").Length.toPixels("y")),new e.Point(this.attribute("x2").Length.toPixels("x"),this.attribute("y2").Length.toPixels("y"))]},this.path=function(t){var n=this.getPoints();return null!=t&&(t.beginPath(),t.moveTo(n[0].x,n[0].y),t.lineTo(n[1].x,n[1].y)),new e.BoundingBox(n[0].x,n[0].y,n[1].x,n[1].y)},this.getMarkers=function(){var e=this.getPoints(),t=e[0].angleTo(e[1]);return[[e[0],t],[e[1],t]]}},e.Element.line.prototype=new e.Element.PathElementBase,e.Element.polyline=function(t){this.base=e.Element.PathElementBase,this.base(t),this.points=e.CreatePath(this.attribute("points").value),this.path=function(t){var n=new e.BoundingBox(this.points[0].x,this.points[0].y);null!=t&&(t.beginPath(),t.moveTo(this.points[0].x,this.points[0].y));for(var r=1;r<this.points.length;r++)n.addPoint(this.points[r].x,this.points[r].y),null!=t&&t.lineTo(this.points[r].x,this.points[r].y);return n},this.getMarkers=function(){for(var e=[],t=0;t<this.points.length-1;t++)e.push([this.points[t],this.points[t].angleTo(this.points[t+1])]);return e.push([this.points[this.points.length-1],e[e.length-1][1]]),e}},e.Element.polyline.prototype=new e.Element.PathElementBase,e.Element.polygon=function(t){this.base=e.Element.polyline,this.base(t),this.basePath=this.path,this.path=function(e){var t=this.basePath(e);return null!=e&&(e.lineTo(this.points[0].x,this.points[0].y),e.closePath()),t}},e.Element.polygon.prototype=new e.Element.polyline,e.Element.path=function(t){this.base=e.Element.PathElementBase,this.base(t);var n=this.attribute("d").value;n=n.replace(/,/gm," "),n=n.replace(/([MmZzLlHhVvCcSsQqTtAa])([MmZzLlHhVvCcSsQqTtAa])/gm,"$1 $2"),n=n.replace(/([MmZzLlHhVvCcSsQqTtAa])([MmZzLlHhVvCcSsQqTtAa])/gm,"$1 $2"),n=n.replace(/([MmZzLlHhVvCcSsQqTtAa])([^\s])/gm,"$1 $2"),n=n.replace(/([^\s])([MmZzLlHhVvCcSsQqTtAa])/gm,"$1 $2"),n=n.replace(/([0-9])([+\-])/gm,"$1 $2"),n=n.replace(/(\.[0-9]*)(\.)/gm,"$1 $2"),n=n.replace(/([Aa](\s+[0-9]+){3})\s+([01])\s*([01])/gm,"$1 $3 $4 "),n=e.compressSpaces(n),n=e.trim(n),this.PathParser=new function(t){this.tokens=t.split(" "),this.reset=function(){this.i=-1,this.command="",this.previousCommand="",this.start=new e.Point(0,0),this.control=new e.Point(0,0),this.current=new e.Point(0,0),this.points=[],this.angles=[]},this.isEnd=function(){return this.i>=this.tokens.length-1},this.isCommandOrEnd=function(){return!!this.isEnd()||null!=this.tokens[this.i+1].match(/^[A-Za-z]$/)},this.isRelativeCommand=function(){return this.command==this.command.toLowerCase()},this.getToken=function(){return this.i=this.i+1,this.tokens[this.i]},this.getScalar=function(){return parseFloat(this.getToken())},this.nextCommand=function(){this.previousCommand=this.command,this.command=this.getToken()},this.getPoint=function(){var t=new e.Point(this.getScalar(),this.getScalar());return this.makeAbsolute(t)},this.getAsControlPoint=function(){var e=this.getPoint();return this.control=e,e},this.getAsCurrentPoint=function(){var e=this.getPoint();return this.current=e,e},this.getReflectedControlPoint=function(){return"c"!=this.previousCommand.toLowerCase()&&"s"!=this.previousCommand.toLowerCase()?this.current:new e.Point(2*this.current.x-this.control.x,2*this.current.y-this.control.y)},this.makeAbsolute=function(e){return this.isRelativeCommand()&&(e.x=this.current.x+e.x,e.y=this.current.y+e.y),e},this.addMarker=function(e,t,n){null!=n&&this.angles.length>0&&null==this.angles[this.angles.length-1]&&(this.angles[this.angles.length-1]=this.points[this.points.length-1].angleTo(n)),this.addMarkerAngle(e,null==t?null:t.angleTo(e))},this.addMarkerAngle=function(e,t){this.points.push(e),this.angles.push(t)},this.getMarkerPoints=function(){return this.points},this.getMarkerAngles=function(){for(var e=0;e<this.angles.length;e++)if(null==this.angles[e])for(var t=e+1;t<this.angles.length;t++)if(null!=this.angles[t]){this.angles[e]=this.angles[t];break}return this.angles}}(n),this.path=function(t){var n=this.PathParser;n.reset();var r=new e.BoundingBox;for(null!=t&&t.beginPath();!n.isEnd();)switch(n.nextCommand(),n.command.toUpperCase()){case"M":var i=n.getAsCurrentPoint();for(n.addMarker(i),r.addPoint(i.x,i.y),null!=t&&t.moveTo(i.x,i.y),n.start=n.current;!n.isCommandOrEnd();){var i=n.getAsCurrentPoint();n.addMarker(i,n.start),r.addPoint(i.x,i.y),null!=t&&t.lineTo(i.x,i.y)}break;case"L":for(;!n.isCommandOrEnd();){var o=n.current,i=n.getAsCurrentPoint();n.addMarker(i,o),r.addPoint(i.x,i.y),null!=t&&t.lineTo(i.x,i.y)}break;case"H":for(;!n.isCommandOrEnd();){var a=new e.Point((n.isRelativeCommand()?n.current.x:0)+n.getScalar(),n.current.y);n.addMarker(a,n.current),n.current=a,r.addPoint(n.current.x,n.current.y),null!=t&&t.lineTo(n.current.x,n.current.y)}break;case"V":for(;!n.isCommandOrEnd();){var a=new e.Point(n.current.x,(n.isRelativeCommand()?n.current.y:0)+n.getScalar());n.addMarker(a,n.current),n.current=a,r.addPoint(n.current.x,n.current.y),null!=t&&t.lineTo(n.current.x,n.current.y)}break;case"C":for(;!n.isCommandOrEnd();){var s=n.current,l=n.getPoint(),c=n.getAsControlPoint(),u=n.getAsCurrentPoint();n.addMarker(u,c,l),r.addBezierCurve(s.x,s.y,l.x,l.y,c.x,c.y,u.x,u.y),null!=t&&t.bezierCurveTo(l.x,l.y,c.x,c.y,u.x,u.y)}break;case"S":for(;!n.isCommandOrEnd();){var s=n.current,l=n.getReflectedControlPoint(),c=n.getAsControlPoint(),u=n.getAsCurrentPoint();n.addMarker(u,c,l),r.addBezierCurve(s.x,s.y,l.x,l.y,c.x,c.y,u.x,u.y),null!=t&&t.bezierCurveTo(l.x,l.y,c.x,c.y,u.x,u.y)}break;case"Q":for(;!n.isCommandOrEnd();){var s=n.current,c=n.getAsControlPoint(),u=n.getAsCurrentPoint();n.addMarker(u,c,c),r.addQuadraticCurve(s.x,s.y,c.x,c.y,u.x,u.y),null!=t&&t.quadraticCurveTo(c.x,c.y,u.x,u.y)}break;case"T":for(;!n.isCommandOrEnd();){var s=n.current,c=n.getReflectedControlPoint();n.control=c;var u=n.getAsCurrentPoint();n.addMarker(u,c,c),r.addQuadraticCurve(s.x,s.y,c.x,c.y,u.x,u.y),null!=t&&t.quadraticCurveTo(c.x,c.y,u.x,u.y)}break;case"A":for(;!n.isCommandOrEnd();){var s=n.current,h=n.getScalar(),f=n.getScalar(),d=n.getScalar()*(Math.PI/180),p=n.getScalar(),m=n.getScalar(),u=n.getAsCurrentPoint(),v=new e.Point(Math.cos(d)*(s.x-u.x)/2+Math.sin(d)*(s.y-u.y)/2,-Math.sin(d)*(s.x-u.x)/2+Math.cos(d)*(s.y-u.y)/2),g=Math.pow(v.x,2)/Math.pow(h,2)+Math.pow(v.y,2)/Math.pow(f,2);g>1&&(h*=Math.sqrt(g),f*=Math.sqrt(g));var E=(p==m?-1:1)*Math.sqrt((Math.pow(h,2)*Math.pow(f,2)-Math.pow(h,2)*Math.pow(v.y,2)-Math.pow(f,2)*Math.pow(v.x,2))/(Math.pow(h,2)*Math.pow(v.y,2)+Math.pow(f,2)*Math.pow(v.x,2)));isNaN(E)&&(E=0);var y=new e.Point(E*h*v.y/f,E*-f*v.x/h),x=new e.Point((s.x+u.x)/2+Math.cos(d)*y.x-Math.sin(d)*y.y,(s.y+u.y)/2+Math.sin(d)*y.x+Math.cos(d)*y.y),T=function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2))},b=function(e,t){return(e[0]*t[0]+e[1]*t[1])/(T(e)*T(t))},R=function(e,t){return(e[0]*t[1]<e[1]*t[0]?-1:1)*Math.acos(b(e,t))},w=R([1,0],[(v.x-y.x)/h,(v.y-y.y)/f]),_=[(v.x-y.x)/h,(v.y-y.y)/f],H=[(-v.x-y.x)/h,(-v.y-y.y)/f],M=R(_,H);b(_,H)<=-1&&(M=Math.PI),b(_,H)>=1&&(M=0),0==m&&M>0&&(M-=2*Math.PI),1==m&&M<0&&(M+=2*Math.PI);var S=new e.Point(x.x-h*Math.cos((w+M)/2),x.y-f*Math.sin((w+M)/2));if(n.addMarkerAngle(S,(w+M)/2+(0==m?1:-1)*Math.PI/2),n.addMarkerAngle(u,M+(0==m?1:-1)*Math.PI/2),r.addPoint(u.x,u.y),null!=t){var b=h>f?h:f,C=h>f?1:h/f,A=h>f?f/h:1;t.translate(x.x,x.y),t.rotate(d),t.scale(C,A),t.arc(0,0,b,w,w+M,1-m),t.scale(1/C,1/A),t.rotate(-d),t.translate(-x.x,-x.y)}}break;case"Z":null!=t&&t.closePath(),n.current=n.start}return r},this.getMarkers=function(){for(var e=this.PathParser.getMarkerPoints(),t=this.PathParser.getMarkerAngles(),n=[],r=0;r<e.length;r++)n.push([e[r],t[r]]);return n}},e.Element.path.prototype=new e.Element.PathElementBase,e.Element.pattern=function(t){this.base=e.Element.ElementBase,this.base(t),this.createPattern=function(t,n){var r=new e.Element.svg;r.attributes.viewBox=new e.Property("viewBox",this.attribute("viewBox").value),r.attributes.x=new e.Property("x",this.attribute("x").value),r.attributes.y=new e.Property("y",this.attribute("y").value),r.attributes.width=new e.Property("width",this.attribute("width").value),r.attributes.height=new e.Property("height",this.attribute("height").value),r.children=this.children;var i=document.createElement("canvas");return r.render(i.getContext("2d")),t.createPattern(i,"repeat")}},e.Element.pattern.prototype=new e.Element.ElementBase,e.Element.marker=function(t){this.base=e.Element.ElementBase,this.base(t),this.baseRender=this.render,this.render=function(t,n,r){t.translate(n.x,n.y),"auto"==this.attribute("orient").valueOrDefault("auto")&&t.rotate(r),"strokeWidth"==this.attribute("markerUnits").valueOrDefault("strokeWidth")&&t.scale(t.lineWidth,t.lineWidth),t.save();var i=new e.Element.svg;i.attributes.viewBox=new e.Property("viewBox",this.attribute("viewBox").value),i.attributes.refX=new e.Property("refX",this.attribute("refX").value),i.attributes.refY=new e.Property("refY",this.attribute("refY").value),i.attributes.width=new e.Property("width",this.attribute("markerWidth").value),i.attributes.height=new e.Property("height",this.attribute("markerHeight").value),i.attributes.fill=new e.Property("fill",this.attribute("fill").valueOrDefault("black")),i.attributes.stroke=new e.Property("stroke",this.attribute("stroke").valueOrDefault("none")),i.children=this.children,i.render(t),t.restore(),"strokeWidth"==this.attribute("markerUnits").valueOrDefault("strokeWidth")&&t.scale(1/t.lineWidth,1/t.lineWidth),"auto"==this.attribute("orient").valueOrDefault("auto")&&t.rotate(-r),t.translate(-n.x,-n.y)}},e.Element.marker.prototype=new e.Element.ElementBase,e.Element.defs=function(t){this.base=e.Element.ElementBase,this.base(t),this.render=function(e){}},e.Element.defs.prototype=new e.Element.ElementBase,e.Element.GradientBase=function(t){this.base=e.Element.ElementBase,this.base(t),this.gradientUnits=this.attribute("gradientUnits").valueOrDefault("objectBoundingBox"),this.stops=[];for(var n=0;n<this.children.length;n++){var r=this.children[n];this.stops.push(r)}this.getGradient=function(){},this.createGradient=function(t,n){var r=this;this.attribute("xlink:href").hasValue()&&(r=this.attribute("xlink:href").Definition.getDefinition());for(var i=this.getGradient(t,n),o=0;o<r.stops.length;o++)i.addColorStop(r.stops[o].offset,r.stops[o].color);if(this.attribute("gradientTransform").hasValue()){var a=e.ViewPort.viewPorts[0],s=new e.Element.rect;s.attributes.x=new e.Property("x",-e.MAX_VIRTUAL_PIXELS/3),s.attributes.y=new e.Property("y",-e.MAX_VIRTUAL_PIXELS/3),s.attributes.width=new e.Property("width",e.MAX_VIRTUAL_PIXELS),s.attributes.height=new e.Property("height",e.MAX_VIRTUAL_PIXELS);var l=new e.Element.g;l.attributes.transform=new e.Property("transform",this.attribute("gradientTransform").value),l.children=[s];var c=new e.Element.svg;c.attributes.x=new e.Property("x",0),c.attributes.y=new e.Property("y",0),c.attributes.width=new e.Property("width",a.width),c.attributes.height=new e.Property("height",a.height),c.children=[l];var u=document.createElement("canvas"),h=u.getContext("2d");return h.fillStyle=i,c.render(h),h.createPattern(u,"no-repeat")}return i}},e.Element.GradientBase.prototype=new e.Element.ElementBase,e.Element.linearGradient=function(t){this.base=e.Element.GradientBase,this.base(t),this.getGradient=function(e,t){var n=t.getBoundingBox(),r="objectBoundingBox"==this.gradientUnits?n.x()+n.width()*this.attribute("x1").numValue():this.attribute("x1").Length.toPixels("x"),i="objectBoundingBox"==this.gradientUnits?n.y()+n.height()*this.attribute("y1").numValue():this.attribute("y1").Length.toPixels("y"),o="objectBoundingBox"==this.gradientUnits?n.x()+n.width()*this.attribute("x2").numValue():this.attribute("x2").Length.toPixels("x"),a="objectBoundingBox"==this.gradientUnits?n.y()+n.height()*this.attribute("y2").numValue():this.attribute("y2").Length.toPixels("y");return e.createLinearGradient(r,i,o,a)}},e.Element.linearGradient.prototype=new e.Element.GradientBase,e.Element.radialGradient=function(t){this.base=e.Element.GradientBase,this.base(t),this.getGradient=function(e,t){var n=t.getBoundingBox(),r="objectBoundingBox"==this.gradientUnits?n.x()+n.width()*this.attribute("cx").numValue():this.attribute("cx").Length.toPixels("x"),i="objectBoundingBox"==this.gradientUnits?n.y()+n.height()*this.attribute("cy").numValue():this.attribute("cy").Length.toPixels("y"),o=r,a=i;this.attribute("fx").hasValue()&&(o="objectBoundingBox"==this.gradientUnits?n.x()+n.width()*this.attribute("fx").numValue():this.attribute("fx").Length.toPixels("x")),this.attribute("fy").hasValue()&&(a="objectBoundingBox"==this.gradientUnits?n.y()+n.height()*this.attribute("fy").numValue():this.attribute("fy").Length.toPixels("y"));var s="objectBoundingBox"==this.gradientUnits?(n.width()+n.height())/2*this.attribute("r").numValue():this.attribute("r").Length.toPixels();return e.createRadialGradient(o,a,0,r,i,s)}},e.Element.radialGradient.prototype=new e.Element.GradientBase,e.Element.stop=function(t){this.base=e.Element.ElementBase,this.base(t),this.offset=this.attribute("offset").numValue();var n=this.style("stop-color");this.style("stop-opacity").hasValue()&&(n=n.Color.addOpacity(this.style("stop-opacity").value)),this.color=n.value},e.Element.stop.prototype=new e.Element.ElementBase,e.Element.AnimateBase=function(t){this.base=e.Element.ElementBase,this.base(t),e.Animations.push(this),this.duration=0,this.begin=this.attribute("begin").Time.toMilliseconds(),this.maxDuration=this.begin+this.attribute("dur").Time.toMilliseconds(),this.getProperty=function(){var e=this.attribute("attributeType").value,t=this.attribute("attributeName").value;return"CSS"==e?this.parent.style(t,!0):this.parent.attribute(t,!0)},this.initialValue=null,this.removed=!1,this.calcValue=function(){return""},this.update=function(e){if(null==this.initialValue&&(this.initialValue=this.getProperty().value),this.duration>this.maxDuration){if("indefinite"!=this.attribute("repeatCount").value)return"remove"==this.attribute("fill").valueOrDefault("remove")&&!this.removed&&(this.removed=!0,this.getProperty().value=this.initialValue,!0);this.duration=0}this.duration=this.duration+e;var t=!1;if(this.begin<this.duration){var n=this.calcValue();if(this.attribute("type").hasValue()){n=this.attribute("type").value+"("+n+")"}this.getProperty().value=n,t=!0}return t},this.progress=function(){return(this.duration-this.begin)/(this.maxDuration-this.begin)}},e.Element.AnimateBase.prototype=new e.Element.ElementBase,e.Element.animate=function(t){this.base=e.Element.AnimateBase,this.base(t),this.calcValue=function(){var e=this.attribute("from").numValue();return e+(this.attribute("to").numValue()-e)*this.progress()}},e.Element.animate.prototype=new e.Element.AnimateBase,e.Element.animateColor=function(t){this.base=e.Element.AnimateBase,this.base(t),this.calcValue=function(){var e=new RGBColor(this.attribute("from").value),t=new RGBColor(this.attribute("to").value);if(e.ok&&t.ok){var n=e.r+(t.r-e.r)*this.progress(),r=e.g+(t.g-e.g)*this.progress(),i=e.b+(t.b-e.b)*this.progress();return"rgb("+parseInt(n,10)+","+parseInt(r,10)+","+parseInt(i,10)+")"}return this.attribute("from").value}},e.Element.animateColor.prototype=new e.Element.AnimateBase,e.Element.animateTransform=function(t){this.base=e.Element.animate,this.base(t)},e.Element.animateTransform.prototype=new e.Element.animate,e.Element.font=function(t){this.base=e.Element.ElementBase,this.base(t),this.horizAdvX=this.attribute("horiz-adv-x").numValue(),this.isRTL=!1,this.isArabic=!1,this.fontFace=null,this.missingGlyph=null,this.glyphs=[];for(var n=0;n<this.children.length;n++){var r=this.children[n];"font-face"==r.type?(this.fontFace=r,r.style("font-family").hasValue()&&(e.Definitions[r.style("font-family").value]=this)):"missing-glyph"==r.type?this.missingGlyph=r:"glyph"==r.type&&(""!=r.arabicForm?(this.isRTL=!0,this.isArabic=!0,void 0===this.glyphs[r.unicode]&&(this.glyphs[r.unicode]=[]),this.glyphs[r.unicode][r.arabicForm]=r):this.glyphs[r.unicode]=r)}},e.Element.font.prototype=new e.Element.ElementBase,e.Element.fontface=function(t){this.base=e.Element.ElementBase,this.base(t),this.ascent=this.attribute("ascent").value,this.descent=this.attribute("descent").value,this.unitsPerEm=this.attribute("units-per-em").numValue()},e.Element.fontface.prototype=new e.Element.ElementBase,e.Element.missingglyph=function(t){this.base=e.Element.path,this.base(t),this.horizAdvX=0},e.Element.missingglyph.prototype=new e.Element.path,e.Element.glyph=function(t){this.base=e.Element.path,this.base(t),this.horizAdvX=this.attribute("horiz-adv-x").numValue(),this.unicode=this.attribute("unicode").value,this.arabicForm=this.attribute("arabic-form").value},e.Element.glyph.prototype=new e.Element.path,e.Element.text=function(t){if(this.base=e.Element.RenderedElementBase,this.base(t),null!=t){this.children=[];for(var n=0;n<t.childNodes.length;n++){var r=t.childNodes[n];1==r.nodeType?this.addChild(r,!0):3==r.nodeType&&this.addChild(new e.Element.tspan(r),!1)}}this.baseSetContext=this.setContext,this.setContext=function(e){this.baseSetContext(e),this.style("dominant-baseline").hasValue()&&(e.textBaseline=this.style("dominant-baseline").value),this.style("alignment-baseline").hasValue()&&(e.textBaseline=this.style("alignment-baseline").value)},this.renderChildren=function(e){for(var t=this.style("text-anchor").valueOrDefault("start"),n=this.attribute("x").Length.toPixels("x"),r=this.attribute("y").Length.toPixels("y"),i=0;i<this.children.length;i++){var o=this.children[i];o.attribute("x").hasValue()?o.x=o.attribute("x").Length.toPixels("x"):(o.attribute("dx").hasValue()&&(n+=o.attribute("dx").Length.toPixels("x")),o.x=n);var a=o.measureText(e);if("start"!=t&&(0==i||o.attribute("x").hasValue())){for(var s=a,l=i+1;l<this.children.length;l++){var c=this.children[l];if(c.attribute("x").hasValue())break;s+=c.measureText(e)}o.x-="end"==t?s:s/2}n=o.x+a,o.attribute("y").hasValue()?o.y=o.attribute("y").Length.toPixels("y"):(o.attribute("dy").hasValue()&&(r+=o.attribute("dy").Length.toPixels("y")),o.y=r),r=o.y,o.render(e)}}},e.Element.text.prototype=new e.Element.RenderedElementBase,e.Element.TextElementBase=function(t){this.base=e.Element.RenderedElementBase,this.base(t),this.getGlyph=function(e,t,n){var r=t[n],i=null;if(e.isArabic){var o="isolated";(0==n||" "==t[n-1])&&n<t.length-2&&" "!=t[n+1]&&(o="terminal"),n>0&&" "!=t[n-1]&&n<t.length-2&&" "!=t[n+1]&&(o="medial"),n>0&&" "!=t[n-1]&&(n==t.length-1||" "==t[n+1])&&(o="initial"),void 0!==e.glyphs[r]&&null==(i=e.glyphs[r][o])&&"glyph"==e.glyphs[r].type&&(i=e.glyphs[r])}else i=e.glyphs[r];return null==i&&(i=e.missingGlyph),i},this.renderChildren=function(t){var n=this.parent.style("font-family").Definition.getDefinition();if(null==n)""!=t.strokeStyle&&t.strokeText(e.compressSpaces(this.getText()),this.x,this.y),""!=t.fillStyle&&t.fillText(e.compressSpaces(this.getText()),this.x,this.y);else{
var r=this.parent.style("font-size").numValueOrDefault(e.Font.Parse(e.ctx.font).fontSize),i=this.parent.style("font-style").valueOrDefault(e.Font.Parse(e.ctx.font).fontStyle),o=this.getText();n.isRTL&&(o=o.split("").reverse().join(""));for(var a=e.ToNumberArray(this.parent.attribute("dx").value),s=0;s<o.length;s++){var l=this.getGlyph(n,o,s),c=r/n.fontFace.unitsPerEm;t.translate(this.x,this.y),t.scale(c,-c);var u=t.lineWidth;t.lineWidth=t.lineWidth*n.fontFace.unitsPerEm/r,"italic"==i&&t.transform(1,0,.4,1,0,0),l.render(t),"italic"==i&&t.transform(1,0,-.4,1,0,0),t.lineWidth=u,t.scale(1/c,-1/c),t.translate(-this.x,-this.y),this.x+=r*(l.horizAdvX||n.horizAdvX)/n.fontFace.unitsPerEm,void 0===a[s]||isNaN(a[s])||(this.x+=a[s])}}},this.getText=function(){},this.measureText=function(t){var n=this.parent.style("font-family").Definition.getDefinition();if(null!=n){var r=this.parent.style("font-size").numValueOrDefault(e.Font.Parse(e.ctx.font).fontSize),i=0,o=this.getText();n.isRTL&&(o=o.split("").reverse().join(""));for(var a=e.ToNumberArray(this.parent.attribute("dx").value),s=0;s<o.length;s++){i+=(this.getGlyph(n,o,s).horizAdvX||n.horizAdvX)*r/n.fontFace.unitsPerEm,void 0===a[s]||isNaN(a[s])||(i+=a[s])}return i}var l=e.compressSpaces(this.getText());if(!t.measureText)return 10*l.length;t.save(),this.setContext(t);var c=t.measureText(l).width;return t.restore(),c}},e.Element.TextElementBase.prototype=new e.Element.RenderedElementBase,e.Element.tspan=function(t){this.base=e.Element.TextElementBase,this.base(t),this.text=3==t.nodeType?t.nodeValue:t.childNodes.length>0?t.childNodes[0].nodeValue:t.text,this.getText=function(){return this.text}},e.Element.tspan.prototype=new e.Element.TextElementBase,e.Element.tref=function(t){this.base=e.Element.TextElementBase,this.base(t),this.getText=function(){var e=this.attribute("xlink:href").Definition.getDefinition();if(null!=e)return e.children[0].getText()}},e.Element.tref.prototype=new e.Element.TextElementBase,e.Element.a=function(t){this.base=e.Element.TextElementBase,this.base(t),this.hasText=!0;for(var n=0;n<t.childNodes.length;n++)3!=t.childNodes[n].nodeType&&(this.hasText=!1);this.text=this.hasText?t.childNodes[0].nodeValue:"",this.getText=function(){return this.text},this.baseRenderChildren=this.renderChildren,this.renderChildren=function(t){if(this.hasText){this.baseRenderChildren(t);var n=new e.Property("fontSize",e.Font.Parse(e.ctx.font).fontSize);e.Mouse.checkBoundingBox(this,new e.BoundingBox(this.x,this.y-n.Length.toPixels("y"),this.x+this.measureText(t),this.y))}else{var r=new e.Element.g;r.children=this.children,r.parent=this,r.render(t)}},this.onclick=function(){window.open(this.attribute("xlink:href").value)},this.onmousemove=function(){e.ctx.canvas.style.cursor="pointer"}},e.Element.a.prototype=new e.Element.TextElementBase,e.Element.image=function(t){this.base=e.Element.RenderedElementBase,this.base(t),e.Images.push(this),this.img=document.createElement("img"),this.loaded=!1;var n=this;this.img.onload=function(){n.loaded=!0},this.img.src=this.attribute("xlink:href").value,this.renderChildren=function(t){var n=this.attribute("x").Length.toPixels("x"),r=this.attribute("y").Length.toPixels("y"),i=this.attribute("width").Length.toPixels("x"),o=this.attribute("height").Length.toPixels("y");0!=i&&0!=o&&(t.save(),t.translate(n,r),e.AspectRatio(t,this.attribute("preserveAspectRatio").value,i,this.img.width,o,this.img.height,0,0),t.drawImage(this.img,0,0),t.restore())}},e.Element.image.prototype=new e.Element.RenderedElementBase,e.Element.g=function(t){this.base=e.Element.RenderedElementBase,this.base(t),this.getBoundingBox=function(){for(var t=new e.BoundingBox,n=0;n<this.children.length;n++)t.addBoundingBox(this.children[n].getBoundingBox());return t}},e.Element.g.prototype=new e.Element.RenderedElementBase,e.Element.symbol=function(t){this.base=e.Element.RenderedElementBase,this.base(t),this.baseSetContext=this.setContext,this.setContext=function(t){if(this.baseSetContext(t),this.attribute("viewBox").hasValue()){var n=e.ToNumberArray(this.attribute("viewBox").value),r=n[0],i=n[1];width=n[2],height=n[3],e.AspectRatio(t,this.attribute("preserveAspectRatio").value,this.attribute("width").Length.toPixels("x"),width,this.attribute("height").Length.toPixels("y"),height,r,i),e.ViewPort.SetCurrent(n[2],n[3])}}},e.Element.symbol.prototype=new e.Element.RenderedElementBase,e.Element.style=function(t){this.base=e.Element.ElementBase,this.base(t);var n=t.childNodes[0].nodeValue+(t.childNodes.length>1?t.childNodes[1].nodeValue:"");n=n.replace(/(\/\*([^*]|[\r\n]|(\*+([^*\/]|[\r\n])))*\*+\/)|(^[\s]*\/\/.*)/gm,""),n=e.compressSpaces(n);for(var r=n.split("}"),i=0;i<r.length;i++)if(""!=e.trim(r[i]))for(var o=r[i].split("{"),a=o[0].split(","),s=o[1].split(";"),l=0;l<a.length;l++){var c=e.trim(a[l]);if(""!=c){for(var u={},h=0;h<s.length;h++){var f=s[h].indexOf(":"),d=s[h].substr(0,f),p=s[h].substr(f+1,s[h].length-f);null!=d&&null!=p&&(u[e.trim(d)]=new e.Property(e.trim(d),e.trim(p)))}if(e.Styles[c]=u,"@font-face"==c)for(var m=u["font-family"].value.replace(/"/g,""),v=u.src.value.split(","),g=0;g<v.length;g++)if(v[g].indexOf('format("svg")')>0)for(var E=v[g].indexOf("url"),y=v[g].indexOf(")",E),x=v[g].substr(E+5,y-E-6),T=e.parseXml(e.ajax(x)),b=T.getElementsByTagName("font"),R=0;R<b.length;R++){var w=e.CreateElement(b[R]);e.Definitions[m]=w}}}},e.Element.style.prototype=new e.Element.ElementBase,e.Element.use=function(t){this.base=e.Element.RenderedElementBase,this.base(t),this.baseSetContext=this.setContext,this.setContext=function(e){this.baseSetContext(e),this.attribute("x").hasValue()&&e.translate(this.attribute("x").Length.toPixels("x"),0),this.attribute("y").hasValue()&&e.translate(0,this.attribute("y").Length.toPixels("y"))},this.getDefinition=function(){var e=this.attribute("xlink:href").Definition.getDefinition();return this.attribute("width").hasValue()&&(e.attribute("width",!0).value=this.attribute("width").value),this.attribute("height").hasValue()&&(e.attribute("height",!0).value=this.attribute("height").value),e},this.path=function(e){var t=this.getDefinition();null!=t&&t.path(e)},this.renderChildren=function(e){var t=this.getDefinition();null!=t&&t.render(e)}},e.Element.use.prototype=new e.Element.RenderedElementBase,e.Element.mask=function(t){this.base=e.Element.ElementBase,this.base(t),this.apply=function(e,t){var n=this.attribute("x").Length.toPixels("x"),r=this.attribute("y").Length.toPixels("y"),i=this.attribute("width").Length.toPixels("x"),o=this.attribute("height").Length.toPixels("y"),a=t.attribute("mask").value;t.attribute("mask").value="";var s=document.createElement("canvas"),l=s.getContext("2d");this.renderChildren(l);var c=document.createElement("canvas"),u=c.getContext("2d");t.render(u),u.globalCompositeOperation="destination-in",u.fillStyle=l.createPattern(s,"no-repeat"),u.fillRect(0,0,n+i,r+o),e.fillStyle=u.createPattern(c,"no-repeat"),e.fillRect(0,0,n+i,r+o),t.attribute("mask").value=a},this.render=function(e){}},e.Element.mask.prototype=new e.Element.ElementBase,e.Element.clipPath=function(t){this.base=e.Element.ElementBase,this.base(t),this.apply=function(e){for(var t=0;t<this.children.length;t++)this.children[t].path&&(this.children[t].path(e),e.clip())},this.render=function(e){}},e.Element.clipPath.prototype=new e.Element.ElementBase,e.Element.filter=function(t){this.base=e.Element.ElementBase,this.base(t),this.apply=function(e,t){var n=t.getBoundingBox(),r=this.attribute("x").Length.toPixels("x"),i=this.attribute("y").Length.toPixels("y");0!=r&&0!=i||(r=n.x1,i=n.y1);var o=this.attribute("width").Length.toPixels("x"),a=this.attribute("height").Length.toPixels("y");0!=o&&0!=a||(o=n.width(),a=n.height());var s=t.style("filter").value;t.style("filter").value="";var l=.2*o,c=.2*a,u=document.createElement("canvas"),h=u.getContext("2d");h.translate(-r+l,-i+c),t.render(h);for(var f=0;f<this.children.length;f++)this.children[f].apply(h,0,0,o+2*l,a+2*c);e.drawImage(u,0,0,o+2*l,a+2*c,r-l,i-c,o+2*l,a+2*c),t.style("filter",!0).value=s},this.render=function(e){}},e.Element.filter.prototype=new e.Element.ElementBase,e.Element.feGaussianBlur=function(t){function n(e){e=Math.max(e,.01);var t=Math.ceil(4*e)+1;mask=[];for(var n=0;n<t;n++)mask[n]=Math.exp(n/e*-.5*(n/e));return mask}function r(e){for(var t=0,n=1;n<e.length;n++)t+=Math.abs(e[n]);t=2*t+Math.abs(e[0]);for(var n=0;n<e.length;n++)e[n]/=t;return e}function i(e,t,n,r,i){for(var s=0;s<i;s++)for(var l=0;l<r;l++)for(var c=o(e,l,s,r,i,3)/255,u=0;u<4;u++){for(var h=n[0]*(0==c?255:o(e,l,s,r,i,u))*(0==c||3==u?1:c),f=1;f<n.length;f++){var d=o(e,Math.max(l-f,0),s,r,i,3)/255,p=o(e,Math.min(l+f,r-1),s,r,i,3)/255;h+=n[f]*((0==d?255:o(e,Math.max(l-f,0),s,r,i,u))*(0==d||3==u?1:d)+(0==p?255:o(e,Math.min(l+f,r-1),s,r,i,u))*(0==p||3==u?1:p))}a(t,s,l,i,r,u,h)}}function o(e,t,n,r,i,o){return e[n*r*4+4*t+o]}function a(e,t,n,r,i,o,a){e[n*r*4+4*t+o]=a}function s(e,t,o,a){var s=e.getImageData(0,0,t,o),l=n(a);l=r(l),tmp=[],i(s.data,tmp,l,t,o),i(tmp,s.data,l,o,t),e.clearRect(0,0,t,o),e.putImageData(s,0,0)}this.base=e.Element.ElementBase,this.base(t),this.apply=function(e,t,n,r,i){s(e,r,i,this.attribute("stdDeviation").numValue())}},e.Element.filter.prototype=new e.Element.feGaussianBlur,e.Element.title=function(e){},e.Element.title.prototype=new e.Element.ElementBase,e.Element.desc=function(e){},e.Element.desc.prototype=new e.Element.ElementBase,e.Element.MISSING=function(e){console.log("ERROR: Element '"+e.nodeName+"' not yet implemented.")},e.Element.MISSING.prototype=new e.Element.ElementBase,e.CreateElement=function(t){var n=t.nodeName.replace(/^[^:]+:/,"");n=n.replace(/\-/g,"");var r=null;return r=void 0!==e.Element[n]?new e.Element[n](t):new e.Element.MISSING(t),r.type=t.nodeName,r},e.load=function(t,n){e.loadXml(t,e.ajax(n))},e.loadXml=function(t,n){e.loadXmlDoc(t,e.parseXml(n))},e.loadXmlDoc=function(t,n){e.init(t);var r=function(e){for(var n=t.canvas;n;)e.x-=n.offsetLeft,e.y-=n.offsetTop,n=n.offsetParent;return window.scrollX&&(e.x+=window.scrollX),window.scrollY&&(e.y+=window.scrollY),e};1!=e.opts.ignoreMouse&&(t.canvas.onclick=function(t){var n=r(new e.Point(null!=t?t.clientX:event.clientX,null!=t?t.clientY:event.clientY));e.Mouse.onclick(n.x,n.y)},t.canvas.onmousemove=function(t){var n=r(new e.Point(null!=t?t.clientX:event.clientX,null!=t?t.clientY:event.clientY));e.Mouse.onmousemove(n.x,n.y)});var i=e.CreateElement(n.documentElement);i.root=!0;var o=!0,a=function(){e.ViewPort.Clear(),t.canvas.parentNode&&e.ViewPort.SetCurrent(t.canvas.parentNode.clientWidth,t.canvas.parentNode.clientHeight);var n=t.canvas.clientWidth||t.canvas.width,r=t.canvas.clientHeight||t.canvas.height;if(e.ViewPort.SetCurrent(n,r),null!=e.opts&&null!=e.opts.offsetX&&(i.attribute("x",!0).value=e.opts.offsetX),null!=e.opts&&null!=e.opts.offsetY&&(i.attribute("y",!0).value=e.opts.offsetY),null!=e.opts&&null!=e.opts.scaleWidth&&null!=e.opts.scaleHeight){var a=1,s=1;i.attribute("width").hasValue()&&(a=i.attribute("width").Length.toPixels("x")/e.opts.scaleWidth),i.attribute("height").hasValue()&&(s=i.attribute("height").Length.toPixels("y")/e.opts.scaleHeight),i.attribute("width",!0).value=e.opts.scaleWidth,i.attribute("height",!0).value=e.opts.scaleHeight,i.attribute("viewBox",!0).value="0 0 "+n*a+" "+r*s,i.attribute("preserveAspectRatio",!0).value="none"}1!=e.opts.ignoreClear&&t.clearRect(0,0,n,r),i.render(t),o&&(o=!1,null!=e.opts&&"function"==typeof e.opts.renderCallback&&e.opts.renderCallback())},s=!0;e.ImagesLoaded()&&(s=!1,a()),e.intervalID=setInterval(function(){var t=!1;if(s&&e.ImagesLoaded()&&(s=!1,t=!0),1!=e.opts.ignoreMouse&&(t|=e.Mouse.hasEvents()),1!=e.opts.ignoreAnimation)for(var n=0;n<e.Animations.length;n++)t|=e.Animations[n].update(1e3/e.FRAMERATE);null!=e.opts&&"function"==typeof e.opts.forceRedraw&&1==e.opts.forceRedraw()&&(t=!0),t&&(a(),e.Mouse.runEvents())},1e3/e.FRAMERATE)},e.stop=function(){e.intervalID&&clearInterval(e.intervalID)},e.Mouse=new function(){this.events=[],this.hasEvents=function(){return 0!=this.events.length},this.onclick=function(e,t){this.events.push({type:"onclick",x:e,y:t,run:function(e){e.onclick&&e.onclick()}})},this.onmousemove=function(e,t){this.events.push({type:"onmousemove",x:e,y:t,run:function(e){e.onmousemove&&e.onmousemove()}})},this.eventElements=[],this.checkPath=function(e,t){for(var n=0;n<this.events.length;n++){var r=this.events[n];t.isPointInPath&&t.isPointInPath(r.x,r.y)&&(this.eventElements[n]=e)}},this.checkBoundingBox=function(e,t){for(var n=0;n<this.events.length;n++){var r=this.events[n];t.isPointInBox(r.x,r.y)&&(this.eventElements[n]=e)}},this.runEvents=function(){e.ctx.canvas.style.cursor="";for(var t=0;t<this.events.length;t++)for(var n=this.events[t],r=this.eventElements[t];r;)n.run(r),r=r.parent;this.events=[],this.eventElements=[]}},e}this.canvg=function(t,n,r){if(null!=t||null!=n||null!=r){r=r||{},"string"==typeof t&&(t=document.getElementById(t));var i;null==t.svg?(i=e(),t.svg=i):(i=t.svg,i.stop()),i.opts=r;var o=t.getContext("2d");void 0!==n.documentElement?i.loadXmlDoc(o,n):"<"==n.substr(0,1)?i.loadXml(o,n):i.load(o,n)}else for(var a=document.getElementsByTagName("svg"),s=0;s<a.length;s++){var l=a[s],c=document.createElement("canvas");l.parentNode.insertBefore(c,l),l.parentNode.removeChild(l);var u=document.createElement("div");u.appendChild(l),canvg(c,u.innerHTML)}}}(),CanvasRenderingContext2D&&(CanvasRenderingContext2D.prototype.drawSvg=function(e,t,n,r,i){canvg(this.canvas,e,{ignoreMouse:!0,ignoreAnimation:!0,ignoreDimensions:!0,ignoreClear:!0,offsetX:t,offsetY:n,scaleWidth:r,scaleHeight:i})}),function(){var e=function(t,n){var r=t.nodeType;if(3==r)n.push(t.textContent.replace(/&/,"&amp;").replace(/</,"&lt;").replace(">","&gt;"));else if(1==r){if(n.push("<",t.tagName),t.hasAttributes())for(var i=t.attributes,o=0,a=i.length;o<a;++o){var s=i.item(o);n.push(" ",s.name,"='",s.value,"'")}if(t.hasChildNodes()){n.push(">");for(var l=t.childNodes,o=0,a=l.length;o<a;++o)e(l.item(o),n);n.push("</",t.tagName,">")}else n.push("/>")}else{if(8!=r)throw"Error serializing XML. Unhandled node of type: "+r;n.push("\x3c!--",t.nodeValue,"--\x3e")}};Object.defineProperty(SVGElement.prototype,"innerHTML",{get:function(){for(var t=[],n=this.firstChild;n;)e(n,t),n=n.nextSibling;return t.join("")},set:function(e){for(;this.firstChild;)this.removeChild(this.firstChild);try{var t=new DOMParser;t.async=!1,sXML="<svg xmlns='http://www.w3.org/2000/svg'>"+e+"</svg>";for(var n=t.parseFromString(sXML,"text/xml").documentElement,r=n.firstChild;r;)this.appendChild(this.ownerDocument.importNode(r,!0)),r=r.nextSibling}catch(e){throw new Error("Error parsing XML string")}}}),Object.defineProperty(SVGElement.prototype,"innerSVG",{get:function(){return this.innerHTML},set:function(e){this.innerHTML=e}})}(),function(){function e(e){for(var t=-1,n=e.length,r=[];++t<n;)r.push(e[t]);return r}function t(e){return Array.prototype.slice.call(e)}function n(){}function r(e){return e}function i(){return this}function o(){return!0}function a(e){return"function"==typeof e?e:function(){return e}}function s(e,t,n){return function(){var r=n.apply(t,arguments);return arguments.length?e:r}}function l(e){return null!=e&&!isNaN(e)}function c(e){return e.length}function u(e){return null==e}function h(e){return e.replace(/^\s+|\s+$/g,"").replace(/\s+/g," ")}function f(e){for(var t=1;e*t%1;)t*=10;return t}function d(){}function p(e){function t(){for(var t,n=r,i=-1,o=n.length;++i<o;)(t=n[i].on)&&t.apply(this,arguments);return e}var r=[],i=new n;return t.on=function(t,n){var o,a=i.get(t);return arguments.length<2?a&&a.on:(a&&(a.on=null,r=r.slice(0,o=r.indexOf(a)).concat(r.slice(o+1)),i.remove(t)),n&&r.push(i.set(t,{on:n})),e)},t}function m(e,t){return t-(e?1+Math.floor(Math.log(e+Math.pow(10,1+Math.floor(Math.log(e)/Math.LN10)-t))/Math.LN10):1)}function v(e){return e+""}function g(e){for(var t=e.lastIndexOf("."),n=t>=0?e.substring(t):(t=e.length,""),r=[];t>0;)r.push(e.substring(t-=3,t+3));return r.reverse().join(",")+n}function E(e,t){var n=Math.pow(10,3*Math.abs(8-t));return{scale:t>8?function(e){return e/n}:function(e){return e*n},symbol:e}}function y(e){return function(t){return t<=0?0:t>=1?1:e(t)}}function x(e){return function(t){return 1-e(1-t)}}function T(e){return function(t){return.5*(t<.5?e(2*t):2-e(2-2*t))}}function b(e){return e}function R(e){return function(t){return Math.pow(t,e)}}function w(e){return 1-Math.cos(e*Math.PI/2)}function _(e){return Math.pow(2,10*(e-1))}function H(e){return 1-Math.sqrt(1-e*e)}function M(e,t){var n;return arguments.length<2&&(t=.45),arguments.length<1?(e=1,n=t/4):n=t/(2*Math.PI)*Math.asin(1/e),function(r){return 1+e*Math.pow(2,10*-r)*Math.sin(2*(r-n)*Math.PI/t)}}function S(e){return e||(e=1.70158),function(t){return t*t*((e+1)*t-e)}}function C(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375}function A(){d3.event.stopPropagation(),d3.event.preventDefault()}function P(){for(var e,t=d3.event;e=t.sourceEvent;)t=e;return t}function D(e){for(var t=new d,n=0,r=arguments.length;++n<r;)t[arguments[n]]=p(t);return t.of=function(n,r){return function(i){try{var o=i.sourceEvent=d3.event;i.target=e,d3.event=i,t[i.type].apply(n,r)}finally{d3.event=o}}},t}function L(e){return"transform"==e?d3.interpolateTransform:d3.interpolate}function N(e,t){return t=t-(e=+e)?1/(t-e):0,function(n){return(n-e)*t}}function k(e,t){return t=t-(e=+e)?1/(t-e):0,function(n){return Math.max(0,Math.min(1,(n-e)*t))}}function F(e,t,n){return new U(e,t,n)}function U(e,t,n){this.r=e,this.g=t,this.b=n}function B(e){return e<16?"0"+Math.max(0,e).toString(16):Math.min(255,e).toString(16)}function V(e,t,n){var r,i,o,a=0,s=0,l=0;if(r=/([a-z]+)\((.*)\)/i.exec(e))switch(i=r[2].split(","),r[1]){case"hsl":return n(parseFloat(i[0]),parseFloat(i[1])/100,parseFloat(i[2])/100);case"rgb":return t(I(i[0]),I(i[1]),I(i[2]))}return(o=Ur.get(e))?t(o.r,o.g,o.b):(null!=e&&"#"===e.charAt(0)&&(4===e.length?(a=e.charAt(1),a+=a,s=e.charAt(2),s+=s,l=e.charAt(3),l+=l):7===e.length&&(a=e.substring(1,3),s=e.substring(3,5),l=e.substring(5,7)),a=parseInt(a,16),s=parseInt(s,16),l=parseInt(l,16)),t(a,s,l))}function z(e,t,n){var r,i,o=Math.min(e/=255,t/=255,n/=255),a=Math.max(e,t,n),s=a-o,l=(a+o)/2;return s?(i=l<.5?s/(a+o):s/(2-a-o),r=e==a?(t-n)/s+(t<n?6:0):t==a?(n-e)/s+2:(e-t)/s+4,r*=60):i=r=0,O(r,i,l)}function I(e){var t=parseFloat(e);return"%"===e.charAt(e.length-1)?Math.round(2.55*t):t}function O(e,t,n){return new W(e,t,n)}function W(e,t,n){this.h=e,this.s=t,this.l=n}function j(e,t,n){function r(e){return e>360?e-=360:e<0&&(e+=360),e<60?o+(a-o)*e/60:e<180?a:e<240?o+(a-o)*(240-e)/60:o}function i(e){return Math.round(255*r(e))}var o,a;return e%=360,e<0&&(e+=360),t=t<0?0:t>1?1:t,n=n<0?0:n>1?1:n,a=n<=.5?n*(1+t):n+t-n*t,o=2*n-a,F(i(e+120),i(e),i(e-120))}function G(e){return br(e,Wr),e}function X(e){return function(){return Br(e,this)}}function Y(e){return function(){return Vr(e,this)}}function q(e,t){function n(){if(t=this.classList)return t.add(e);var t=this.className,n=null!=t.baseVal,r=n?t.baseVal:t;o.lastIndex=0,o.test(r)||(r=h(r+" "+e),n?t.baseVal=r:this.className=r)}function r(){if(t=this.classList)return t.remove(e);var t=this.className,n=null!=t.baseVal,r=n?t.baseVal:t;r=h(r.replace(o," ")),n?t.baseVal=r:this.className=r}function i(){(t.apply(this,arguments)?n:r).call(this)}var o=new RegExp("(^|\\s+)"+d3.requote(e)+"(\\s+|$)","g");if(arguments.length<2){var a=this.node();if(s=a.classList)return s.contains(e);var s=a.className;return o.lastIndex=0,o.test(null!=s.baseVal?s.baseVal:s)}return this.each("function"==typeof t?i:t?n:r)}function K(e){return{__data__:e}}function $(e){return function(){return Or(this,e)}}function Q(e){return arguments.length||(e=d3.ascending),function(t,n){return e(t&&t.__data__,n&&n.__data__)}}function Z(e,t){for(var n=0,r=e.length;n<r;n++)for(var i,o=e[n],a=0,s=o.length;a<s;a++)(i=o[a])&&t(i,a,n);return e}function J(e){return br(e,Gr),e}function ee(e,t,r){br(e,Yr);var i=new n,o=d3.dispatch("start","end"),a=Jr;return e.id=t,e.time=r,e.tween=function(t,n){return arguments.length<2?i.get(t):(null==n?i.remove(t):i.set(t,n),e)},e.ease=function(t){return arguments.length?(a="function"==typeof t?t:d3.ease.apply(d3,arguments),e):a},e.each=function(t,n){return arguments.length<2?re.call(e,t):(o.on(t,n),e)},d3.timer(function(n){return Z(e,function(e,s,l){function c(n){return m.active>t?h():(m.active=t,i.forEach(function(t,n){(n=n.call(e,v,s))&&f.push(n)}),o.start.call(e,v,s),u(n)||d3.timer(u,0,r),1)}function u(n){if(m.active!==t)return h();for(var r=(n-d)/p,i=a(r),l=f.length;l>0;)f[--l].call(e,i);return r>=1?(h(),Kr=t,o.end.call(e,v,s),Kr=0,1):void 0}function h(){return--m.count||delete e.__transition__,1}var f=[],d=e.delay,p=e.duration,m=(e=e.node).__transition__||(e.__transition__={active:0,count:0}),v=e.__data__;++m.count,d<=n?c(n):d3.timer(c,d,r)})},0,r),e}function te(e,t,n){return""!=n&&Xr}function ne(e,t){function n(e,n,r){var o=t.call(this,e,n);return null==o?""!=r&&Xr:r!=o&&i(r,o)}function r(e,n,r){return r!=t&&i(r,t)}var i=L(e);return"function"==typeof t?n:null==t?te:(t+="",r)}function re(e){var t=Kr,n=Jr,r=Qr,i=Zr;return Kr=this.id,Jr=this.ease(),Z(this,function(t,n,r){Qr=t.delay,Zr=t.duration,e.call(t=t.node,t.__data__,n,r)}),Kr=t,Jr=n,Qr=r,Zr=i,this}function ie(){for(var e,t=Date.now(),n=ni;n;)e=t-n.then,e>=n.delay&&(n.flush=n.callback(e)),n=n.next;var r=oe()-t;r>24?(isFinite(r)&&(clearTimeout(ti),ti=setTimeout(ie,r)),ei=0):(ei=1,ri(ie))}function oe(){for(var e=null,t=ni,n=1/0;t;)t.flush?t=e?e.next=t.next:ni=t.next:(n=Math.min(n,t.then+t.delay),t=(e=t).next);return n}function ae(e){var t=[e.a,e.b],n=[e.c,e.d],r=le(t),i=se(t,n),o=le(ce(n,t,-i))||0;t[0]*n[1]<n[0]*t[1]&&(t[0]*=-1,t[1]*=-1,r*=-1,i*=-1),this.rotate=(r?Math.atan2(t[1],t[0]):Math.atan2(-n[0],n[1]))*ii,this.translate=[e.e,e.f],this.scale=[r,o],this.skew=o?Math.atan2(i,o)*ii:0}function se(e,t){return e[0]*t[0]+e[1]*t[1]}function le(e){var t=Math.sqrt(se(e,e));return t&&(e[0]/=t,e[1]/=t),t}function ce(e,t,n){return e[0]+=n*t[0],e[1]+=n*t[1],e}function ue(e,t){var n=e.ownerSVGElement||e;if(n.createSVGPoint){var r=n.createSVGPoint();if(oi<0&&(window.scrollX||window.scrollY)){n=d3.select(document.body).append("svg").style("position","absolute").style("top",0).style("left",0);var i=n[0][0].getScreenCTM();oi=!i.f&&!i.e,n.remove()}return oi?(r.x=t.pageX,r.y=t.pageY):(r.x=t.clientX,r.y=t.clientY),r=r.matrixTransform(e.getScreenCTM().inverse()),[r.x,r.y]}var o=e.getBoundingClientRect();return[t.clientX-o.left-e.clientLeft,t.clientY-o.top-e.clientTop]}function he(e){var t=e[0],n=e[e.length-1];return t<n?[t,n]:[n,t]}function fe(e){return e.rangeExtent?e.rangeExtent():he(e.range())}function de(e,t){var n,r=0,i=e.length-1,o=e[r],a=e[i];return a<o&&(n=r,r=i,i=n,n=o,o=a,a=n),(n=a-o)&&(t=t(n),e[r]=t.floor(o),e[i]=t.ceil(a)),e}function pe(){return Math}function me(e,t,n,r){function i(){var i=Math.min(e.length,t.length)>2?be:Te,l=r?k:N;return a=i(e,t,l,n),s=i(t,e,l,d3.interpolate),o}function o(e){return a(e)}var a,s;return o.invert=function(e){return s(e)},o.domain=function(t){return arguments.length?(e=t.map(Number),i()):e},o.range=function(e){return arguments.length?(t=e,i()):t},o.rangeRound=function(e){return o.range(e).interpolate(d3.interpolateRound)},o.clamp=function(e){return arguments.length?(r=e,i()):r},o.interpolate=function(e){return arguments.length?(n=e,i()):n},o.ticks=function(t){return ye(e,t)},o.tickFormat=function(t){return xe(e,t)},o.nice=function(){return de(e,ge),i()},o.copy=function(){return me(e,t,n,r)},i()}function ve(e,t){return d3.rebind(e,t,"range","rangeRound","interpolate","clamp")}function ge(e){return e=Math.pow(10,Math.round(Math.log(e)/Math.LN10)-1),{floor:function(t){return Math.floor(t/e)*e},ceil:function(t){return Math.ceil(t/e)*e}}}function Ee(e,t){var n=he(e),r=n[1]-n[0],i=Math.pow(10,Math.floor(Math.log(r/t)/Math.LN10)),o=t/r*i;return o<=.15?i*=10:o<=.35?i*=5:o<=.75&&(i*=2),n[0]=Math.ceil(n[0]/i)*i,n[1]=Math.floor(n[1]/i)*i+.5*i,n[2]=i,n}function ye(e,t){return d3.range.apply(d3,Ee(e,t))}function xe(e,t){return d3.format(",."+Math.max(0,-Math.floor(Math.log(Ee(e,t)[2])/Math.LN10+.01))+"f")}function Te(e,t,n,r){var i=n(e[0],e[1]),o=r(t[0],t[1]);return function(e){return o(i(e))}}function be(e,t,n,r){var i=[],o=[],a=0,s=Math.min(e.length,t.length)-1;for(e[s]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++a<=s;)i.push(n(e[a-1],e[a])),o.push(r(t[a-1],t[a]));return function(t){var n=d3.bisect(e,t,1,s)-1;return o[n](i[n](t))}}function Re(e,t){function n(n){return e(t(n))}var r=t.pow;return n.invert=function(t){return r(e.invert(t))},n.domain=function(i){return arguments.length?(t=i[0]<0?_e:we,r=t.pow,e.domain(i.map(t)),n):e.domain().map(r)},n.nice=function(){return e.domain(de(e.domain(),pe)),n},n.ticks=function(){var n=he(e.domain()),i=[];if(n.every(isFinite)){var o=Math.floor(n[0]),a=Math.ceil(n[1]),s=r(n[0]),l=r(n[1]);if(t===_e)for(i.push(r(o));o++<a;)for(var c=9;c>0;c--)i.push(r(o)*c);else{for(;o<a;o++)for(var c=1;c<10;c++)i.push(r(o)*c);i.push(r(o))}for(o=0;i[o]<s;o++);for(a=i.length;i[a-1]>l;a--);i=i.slice(o,a)}return i},n.tickFormat=function(e,i){if(arguments.length<2&&(i=ai),arguments.length<1)return i;var o,a=Math.max(.1,e/n.ticks().length),s=t===_e?(o=-1e-12,Math.floor):(o=1e-12,Math.ceil);return function(e){return e/r(s(t(e)+o))<=a?i(e):""}},n.copy=function(){return Re(e.copy(),t)},ve(n,e)}function we(e){return Math.log(e<0?0:e)/Math.LN10}function _e(e){return-Math.log(e>0?0:-e)/Math.LN10}function He(e,t){function n(t){return e(r(t))}var r=Me(t),i=Me(1/t);return n.invert=function(t){return i(e.invert(t))},n.domain=function(t){return arguments.length?(e.domain(t.map(r)),n):e.domain().map(i)},n.ticks=function(e){return ye(n.domain(),e)},n.tickFormat=function(e){return xe(n.domain(),e)},n.nice=function(){return n.domain(de(n.domain(),ge))},n.exponent=function(e){if(!arguments.length)return t;var o=n.domain();return r=Me(t=e),i=Me(1/t),n.domain(o)},n.copy=function(){return He(e.copy(),t)},ve(n,e)}function Me(e){return function(t){return t<0?-Math.pow(-t,e):Math.pow(t,e)}}function Se(e,t){function r(t){return a[((o.get(t)||o.set(t,e.push(t)))-1)%a.length]}function i(t,n){return d3.range(e.length).map(function(e){return t+n*e})}var o,a,s;return r.domain=function(i){if(!arguments.length)return e;e=[],o=new n;for(var a,s=-1,l=i.length;++s<l;)o.has(a=i[s])||o.set(a,e.push(a));return r[t.t](t.x,t.p)},r.range=function(e){return arguments.length?(a=e,s=0,t={t:"range",x:e},r):a},r.rangePoints=function(n,o){arguments.length<2&&(o=0);var l=n[0],c=n[1],u=(c-l)/(e.length-1+o);return a=i(e.length<2?(l+c)/2:l+u*o/2,u),s=0,t={t:"rangePoints",x:n,p:o},r},r.rangeBands=function(n,o){arguments.length<2&&(o=0);var l=n[1]<n[0],c=n[l-0],u=n[1-l],h=(u-c)/(e.length+o);return a=i(c+h*o,h),l&&a.reverse(),s=h*(1-o),t={t:"rangeBands",x:n,p:o},r},r.rangeRoundBands=function(n,o){arguments.length<2&&(o=0);var l=n[1]<n[0],c=n[l-0],u=n[1-l],h=Math.floor((u-c)/(e.length+o)),f=u-c-(e.length-o)*h;return a=i(c+Math.round(f/2),h),l&&a.reverse(),s=Math.round(h*(1-o)),t={t:"rangeRoundBands",x:n,p:o},r},r.rangeBand=function(){return s},r.rangeExtent=function(){return he(t.x)},r.copy=function(){return Se(e,t)},r.domain(e)}function Ce(e,t){function n(){var n=0,o=(e.length,t.length);for(i=[];++n<o;)i[n-1]=d3.quantile(e,n/o);return r}function r(e){return isNaN(e=+e)?NaN:t[d3.bisect(i,e)]}var i;return r.domain=function(t){return arguments.length?(e=t.filter(function(e){return!isNaN(e)}).sort(d3.ascending),n()):e},r.range=function(e){return arguments.length?(t=e,n()):t},r.quantiles=function(){return i},r.copy=function(){return Ce(e,t)},n()}function Ae(e,t,n){function r(t){return n[Math.max(0,Math.min(a,Math.floor(o*(t-e))))]}function i(){return o=n.length/(t-e),a=n.length-1,r}var o,a;return r.domain=function(n){return arguments.length?(e=+n[0],t=+n[n.length-1],i()):[e,t]},r.range=function(e){return arguments.length?(n=e,i()):n},r.copy=function(){return Ae(e,t,n)},i()}function Pe(e){function t(e){return+e}return t.invert=t,t.domain=t.range=function(n){return arguments.length?(e=n.map(t),t):e},t.ticks=function(t){return ye(e,t)},t.tickFormat=function(t){return xe(e,t)},t.copy=function(){return Pe(e)},t}function De(e){return e.innerRadius}function Le(e){return e.outerRadius}function Ne(e){return e.startAngle}function ke(e){return e.endAngle}function Fe(e){function t(t){function o(){u.push("M",l(e(h),c))}for(var s,u=[],h=[],f=-1,d=t.length,p=a(n),m=a(r);++f<d;)i.call(this,s=t[f],f)?h.push([+p.call(this,s,f),+m.call(this,s,f)]):h.length&&(o(),h=[]);return h.length&&o(),u.length?u.join(""):null}var n=Ue,r=Be,i=o,s=di,l=Ve,c=.7;return t.x=function(e){return arguments.length?(n=e,t):n},t.y=function(e){return arguments.length?(r=e,t):r},t.defined=function(e){return arguments.length?(i=e,t):i},t.interpolate=function(e){return arguments.length?(pi.has(e+="")||(e=di),l=pi.get(s=e),t):s},t.tension=function(e){return arguments.length?(c=e,t):c},t}function Ue(e){return e[0]}function Be(e){return e[1]}function Ve(e){for(var t=0,n=e.length,r=e[0],i=[r[0],",",r[1]];++t<n;)i.push("L",(r=e[t])[0],",",r[1]);return i.join("")}function ze(e){for(var t=0,n=e.length,r=e[0],i=[r[0],",",r[1]];++t<n;)i.push("V",(r=e[t])[1],"H",r[0]);return i.join("")}function Ie(e){for(var t=0,n=e.length,r=e[0],i=[r[0],",",r[1]];++t<n;)i.push("H",(r=e[t])[0],"V",r[1]);return i.join("")}function Oe(e,t){return e.length<4?Ve(e):e[1]+Ge(e.slice(1,e.length-1),Xe(e,t))}function We(e,t){return e.length<3?Ve(e):e[0]+Ge((e.push(e[0]),e),Xe([e[e.length-2]].concat(e,[e[1]]),t))}function je(e,t,n){return e.length<3?Ve(e):e[0]+Ge(e,Xe(e,t))}function Ge(e,t){if(t.length<1||e.length!=t.length&&e.length!=t.length+2)return Ve(e);var n=e.length!=t.length,r="",i=e[0],o=e[1],a=t[0],s=a,l=1;if(n&&(r+="Q"+(o[0]-2*a[0]/3)+","+(o[1]-2*a[1]/3)+","+o[0]+","+o[1],i=e[1],l=2),t.length>1){s=t[1],o=e[l],l++,r+="C"+(i[0]+a[0])+","+(i[1]+a[1])+","+(o[0]-s[0])+","+(o[1]-s[1])+","+o[0]+","+o[1];for(var c=2;c<t.length;c++,l++)o=e[l],s=t[c],r+="S"+(o[0]-s[0])+","+(o[1]-s[1])+","+o[0]+","+o[1]}if(n){var u=e[l];r+="Q"+(o[0]+2*s[0]/3)+","+(o[1]+2*s[1]/3)+","+u[0]+","+u[1]}return r}function Xe(e,t){for(var n,r=[],i=(1-t)/2,o=e[0],a=e[1],s=1,l=e.length;++s<l;)n=o,o=a,a=e[s],r.push([i*(a[0]-n[0]),i*(a[1]-n[1])]);return r}function Ye(e){if(e.length<3)return Ve(e);var t=1,n=e.length,r=e[0],i=r[0],o=r[1],a=[i,i,i,(r=e[1])[0]],s=[o,o,o,r[1]],l=[i,",",o];for(Ze(l,a,s);++t<n;)r=e[t],a.shift(),a.push(r[0]),s.shift(),s.push(r[1]),Ze(l,a,s);for(t=-1;++t<2;)a.shift(),a.push(r[0]),s.shift(),s.push(r[1]),Ze(l,a,s);return l.join("")}function qe(e){if(e.length<4)return Ve(e);for(var t,n=[],r=-1,i=e.length,o=[0],a=[0];++r<3;)t=e[r],o.push(t[0]),a.push(t[1]);for(n.push(Qe(gi,o)+","+Qe(gi,a)),--r;++r<i;)t=e[r],o.shift(),o.push(t[0]),a.shift(),a.push(t[1]),Ze(n,o,a);return n.join("")}function Ke(e){for(var t,n,r=-1,i=e.length,o=i+4,a=[],s=[];++r<4;)n=e[r%i],a.push(n[0]),s.push(n[1]);for(t=[Qe(gi,a),",",Qe(gi,s)],--r;++r<o;)n=e[r%i],a.shift(),a.push(n[0]),s.shift(),s.push(n[1]),Ze(t,a,s);return t.join("")}function $e(e,t){var n=e.length-1;if(n)for(var r,i,o=e[0][0],a=e[0][1],s=e[n][0]-o,l=e[n][1]-a,c=-1;++c<=n;)r=e[c],i=c/n,r[0]=t*r[0]+(1-t)*(o+i*s),r[1]=t*r[1]+(1-t)*(a+i*l);return Ye(e)}function Qe(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}function Ze(e,t,n){e.push("C",Qe(mi,t),",",Qe(mi,n),",",Qe(vi,t),",",Qe(vi,n),",",Qe(gi,t),",",Qe(gi,n))}function Je(e,t){return(t[1]-e[1])/(t[0]-e[0])}function et(e){for(var t=0,n=e.length-1,r=[],i=e[0],o=e[1],a=r[0]=Je(i,o);++t<n;)r[t]=a+(a=Je(i=o,o=e[t+1]));return r[t]=a,r}function tt(e){for(var t,n,r,i,o=[],a=et(e),s=-1,l=e.length-1;++s<l;)t=Je(e[s],e[s+1]),Math.abs(t)<1e-6?a[s]=a[s+1]=0:(n=a[s]/t,r=a[s+1]/t,(i=n*n+r*r)>9&&(i=3*t/Math.sqrt(i),a[s]=i*n,a[s+1]=i*r));for(s=-1;++s<=l;)i=(e[Math.min(l,s+1)][0]-e[Math.max(0,s-1)][0])/(6*(1+a[s]*a[s])),o.push([i||0,a[s]*i||0]);return o}function nt(e){return e.length<3?Ve(e):e[0]+Ge(e,tt(e))}
function rt(e){for(var t,n,r,i=-1,o=e.length;++i<o;)t=e[i],n=t[0],r=t[1]+hi,t[0]=n*Math.cos(r),t[1]=n*Math.sin(r);return e}function it(e){function t(t){function o(){v.push("M",u(e(E),d),f,h(e(g.reverse()),d),"Z")}for(var c,p,m,v=[],g=[],E=[],y=-1,x=t.length,T=a(n),b=a(i),R=n===r?function(){return p}:a(r),w=i===s?function(){return m}:a(s);++y<x;)l.call(this,c=t[y],y)?(g.push([p=+T.call(this,c,y),m=+b.call(this,c,y)]),E.push([+R.call(this,c,y),+w.call(this,c,y)])):g.length&&(o(),g=[],E=[]);return g.length&&o(),v.length?v.join(""):null}var n=Ue,r=Ue,i=0,s=Be,l=o,c=di,u=Ve,h=Ve,f="L",d=.7;return t.x=function(e){return arguments.length?(n=r=e,t):r},t.x0=function(e){return arguments.length?(n=e,t):n},t.x1=function(e){return arguments.length?(r=e,t):r},t.y=function(e){return arguments.length?(i=s=e,t):s},t.y0=function(e){return arguments.length?(i=e,t):i},t.y1=function(e){return arguments.length?(s=e,t):s},t.defined=function(e){return arguments.length?(l=e,t):l},t.interpolate=function(e){return arguments.length?(pi.has(e+="")||(e=di),u=pi.get(c=e),h=u.reverse||u,f=/-closed$/.test(e)?"M":"L",t):c},t.tension=function(e){return arguments.length?(d=e,t):d},t}function ot(e){return e.source}function at(e){return e.target}function st(e){return e.radius}function lt(e){return[e.x,e.y]}function ct(e){return function(){var t=e.apply(this,arguments),n=t[0],r=t[1]+hi;return[n*Math.cos(r),n*Math.sin(r)]}}function ut(){return 64}function ht(){return"circle"}function ft(e){var t=Math.sqrt(e/Math.PI);return"M0,"+t+"A"+t+","+t+" 0 1,1 0,"+-t+"A"+t+","+t+" 0 1,1 0,"+t+"Z"}function dt(e,t){e.attr("transform",function(e){return"translate("+t(e)+",0)"})}function pt(e,t){e.attr("transform",function(e){return"translate(0,"+t(e)+")"})}function mt(e,t,n){if(r=[],n&&t.length>1){for(var r,i,o,a=he(e.domain()),s=-1,l=t.length,c=(t[1]-t[0])/++n;++s<l;)for(i=n;--i>0;)(o=+t[s]-i*c)>=a[0]&&r.push(o);for(--s,i=0;++i<n&&(o=+t[s]+i*c)<a[1];)r.push(o)}return r}function vt(){Ri||(Ri=d3.select("body").append("div").style("visibility","hidden").style("top",0).style("height",0).style("width",0).style("overflow-y","scroll").append("div").style("height","2000px").node().parentNode);var e,t=d3.event;try{Ri.scrollTop=1e3,Ri.dispatchEvent(t),e=1e3-Ri.scrollTop}catch(n){e=t.wheelDelta||5*-t.detail}return e}function gt(e){for(var t=e.source,n=e.target,r=yt(t,n),i=[t];t!==r;)t=t.parent,i.push(t);for(var o=i.length;n!==r;)i.splice(o,0,n),n=n.parent;return i}function Et(e){for(var t=[],n=e.parent;null!=n;)t.push(e),e=n,n=n.parent;return t.push(e),t}function yt(e,t){if(e===t)return e;for(var n=Et(e),r=Et(t),i=n.pop(),o=r.pop(),a=null;i===o;)a=i,i=n.pop(),o=r.pop();return a}function xt(e){e.fixed|=2}function Tt(e){e!==Hi&&(e.fixed&=1)}function bt(){Hi.fixed&=1,_i=Hi=null}function Rt(){Hi.px=d3.event.x,Hi.py=d3.event.y,_i.resume()}function wt(e,t,n){var r=0,i=0;if(e.charge=0,!e.leaf)for(var o,a=e.nodes,s=a.length,l=-1;++l<s;)null!=(o=a[l])&&(wt(o,t,n),e.charge+=o.charge,r+=o.charge*o.cx,i+=o.charge*o.cy);if(e.point){e.leaf||(e.point.x+=Math.random()-.5,e.point.y+=Math.random()-.5);var c=t*n[e.point.index];e.charge+=e.pointCharge=c,r+=c*e.point.x,i+=c*e.point.y}e.cx=r/e.charge,e.cy=i/e.charge}function _t(e){return 20}function Ht(e){return 1}function Mt(e){return e.x}function St(e){return e.y}function Ct(e,t,n){e.y0=t,e.y=n}function At(e){return d3.range(e.length)}function Pt(e){for(var t=-1,n=e[0].length,r=[];++t<n;)r[t]=0;return r}function Dt(e){for(var t,n=1,r=0,i=e[0][1],o=e.length;n<o;++n)(t=e[n][1])>i&&(r=n,i=t);return r}function Lt(e){return e.reduce(Nt,0)}function Nt(e,t){return e+t[1]}function kt(e,t){return Ft(e,Math.ceil(Math.log(t.length)/Math.LN2+1))}function Ft(e,t){for(var n=-1,r=+e[0],i=(e[1]-r)/t,o=[];++n<=t;)o[n]=i*n+r;return o}function Ut(e){return[d3.min(e),d3.max(e)]}function Bt(e,t){return d3.rebind(e,t,"sort","children","value"),e.links=Ot,e.nodes=function(t){return Ai=!0,(e.nodes=e)(t)},e}function Vt(e){return e.children}function zt(e){return e.value}function It(e,t){return t.value-e.value}function Ot(e){return d3.merge(e.map(function(e){return(e.children||[]).map(function(t){return{source:e,target:t}})}))}function Wt(e,t){return e.value-t.value}function jt(e,t){var n=e._pack_next;e._pack_next=t,t._pack_prev=e,t._pack_next=n,n._pack_prev=t}function Gt(e,t){e._pack_next=t,t._pack_prev=e}function Xt(e,t){var n=t.x-e.x,r=t.y-e.y,i=e.r+t.r;return i*i-n*n-r*r>.001}function Yt(e){function t(e){s=Math.min(e.x-e.r,s),l=Math.max(e.x+e.r,l),c=Math.min(e.y-e.r,c),u=Math.max(e.y+e.r,u)}var n,r,i,o,a,s=1/0,l=-1/0,c=1/0,u=-1/0,h=e.length;if(e.forEach(qt),n=e[0],n.x=-n.r,n.y=0,t(n),h>1&&(r=e[1],r.x=r.r,r.y=0,t(r),h>2)){i=e[2],Zt(n,r,i),t(i),jt(n,i),n._pack_prev=i,jt(i,r),r=n._pack_next;for(var f=3;f<h;f++){Zt(n,r,i=e[f]);var d=0,p=1,m=1;for(o=r._pack_next;o!==r;o=o._pack_next,p++)if(Xt(o,i)){d=1;break}if(1==d)for(a=n._pack_prev;a!==o._pack_prev&&!Xt(a,i);a=a._pack_prev,m++);d?(p<m||p==m&&r.r<n.r?Gt(n,r=o):Gt(n=a,r),f--):(jt(n,i),r=i,t(i))}}for(var v=(s+l)/2,g=(c+u)/2,E=0,f=0;f<h;f++){var y=e[f];y.x-=v,y.y-=g,E=Math.max(E,y.r+Math.sqrt(y.x*y.x+y.y*y.y))}return e.forEach(Kt),E}function qt(e){e._pack_next=e._pack_prev=e}function Kt(e){delete e._pack_next,delete e._pack_prev}function $t(e){var t=e.children;t&&t.length?(t.forEach($t),e.r=Yt(t)):e.r=Math.sqrt(e.value)}function Qt(e,t,n,r){var i=e.children;if(e.x=t+=r*e.x,e.y=n+=r*e.y,e.r*=r,i)for(var o=-1,a=i.length;++o<a;)Qt(i[o],t,n,r)}function Zt(e,t,n){var r=e.r+n.r,i=t.x-e.x,o=t.y-e.y;if(r&&(i||o)){var a=t.r+n.r,s=Math.sqrt(i*i+o*o),l=Math.max(-1,Math.min(1,(r*r+s*s-a*a)/(2*r*s))),c=Math.acos(l),u=l*(r/=s),h=Math.sin(c)*r;n.x=e.x+u*i+h*o,n.y=e.y+u*o-h*i}else n.x=e.x+r,n.y=e.y}function Jt(e){return 1+d3.max(e,function(e){return e.y})}function en(e){return e.reduce(function(e,t){return e+t.x},0)/e.length}function tn(e){var t=e.children;return t&&t.length?tn(t[0]):e}function nn(e){var t,n=e.children;return n&&(t=n.length)?nn(n[t-1]):e}function rn(e,t){return e.parent==t.parent?1:2}function on(e){var t=e.children;return t&&t.length?t[0]:e._tree.thread}function an(e){var t,n=e.children;return n&&(t=n.length)?n[t-1]:e._tree.thread}function sn(e,t){var n=e.children;if(n&&(i=n.length))for(var r,i,o=-1;++o<i;)t(r=sn(n[o],t),e)>0&&(e=r);return e}function ln(e,t){return e.x-t.x}function cn(e,t){return t.x-e.x}function un(e,t){return e.depth-t.depth}function hn(e,t){function n(e,r){var i=e.children;if(i&&(a=i.length))for(var o,a,s=null,l=-1;++l<a;)o=i[l],n(o,s),s=o;t(e,r)}n(e,null)}function fn(e){for(var t,n=0,r=0,i=e.children,o=i.length;--o>=0;)t=i[o]._tree,t.prelim+=n,t.mod+=n,n+=t.shift+(r+=t.change)}function dn(e,t,n){e=e._tree,t=t._tree;var r=n/(t.number-e.number);e.change+=r,t.change-=r,t.shift+=n,t.prelim+=n,t.mod+=n}function pn(e,t,n){return e._tree.ancestor.parent==t.parent?e._tree.ancestor:n}function mn(e){return{x:e.x,y:e.y,dx:e.dx,dy:e.dy}}function vn(e,t){var n=e.x+t[3],r=e.y+t[0],i=e.dx-t[1]-t[3],o=e.dy-t[0]-t[2];return i<0&&(n+=i/2,i=0),o<0&&(r+=o/2,o=0),{x:n,y:r,dx:i,dy:o}}function gn(e){return e.map(En).join(",")}function En(e){return/[",\n]/.test(e)?'"'+e.replace(/\"/g,'""')+'"':e}function yn(e,t){return function(n){return n&&e.hasOwnProperty(n.type)?e[n.type](n):t}}function xn(e){return"m0,"+e+"a"+e+","+e+" 0 1,1 0,"+-2*e+"a"+e+","+e+" 0 1,1 0,"+2*e+"z"}function Tn(e,t){Di.hasOwnProperty(e.type)&&Di[e.type](e,t)}function bn(e,t){Tn(e.geometry,t)}function Rn(e,t){for(var n=e.features,r=0,i=n.length;r<i;r++)Tn(n[r].geometry,t)}function wn(e,t){for(var n=e.geometries,r=0,i=n.length;r<i;r++)Tn(n[r],t)}function _n(e,t){for(var n=e.coordinates,r=0,i=n.length;r<i;r++)t.apply(null,n[r])}function Hn(e,t){for(var n=e.coordinates,r=0,i=n.length;r<i;r++)for(var o=n[r],a=0,s=o.length;a<s;a++)t.apply(null,o[a])}function Mn(e,t){for(var n=e.coordinates,r=0,i=n.length;r<i;r++)for(var o=n[r][0],a=0,s=o.length;a<s;a++)t.apply(null,o[a])}function Sn(e,t){t.apply(null,e.coordinates)}function Cn(e,t){for(var n=e.coordinates[0],r=0,i=n.length;r<i;r++)t.apply(null,n[r])}function An(e){return e.source}function Pn(e){return e.target}function Dn(){function e(e){var t=Math.sin(e*=d)*p,n=Math.sin(d-e)*p,r=n*o+t*h,s=n*a+t*f,l=n*i+t*u;return[Math.atan2(s,r)/Pi,Math.atan2(l,Math.sqrt(r*r+s*s))/Pi]}var t,n,r,i,o,a,s,l,c,u,h,f,d,p;return e.distance=function(){return null==d&&(p=1/Math.sin(d=Math.acos(Math.max(-1,Math.min(1,i*u+r*c*Math.cos(s-t)))))),d},e.source=function(s){var l=Math.cos(t=s[0]*Pi),c=Math.sin(t);return r=Math.cos(n=s[1]*Pi),i=Math.sin(n),o=r*l,a=r*c,d=null,e},e.target=function(t){var n=Math.cos(s=t[0]*Pi),r=Math.sin(s);return c=Math.cos(l=t[1]*Pi),u=Math.sin(l),h=c*n,f=c*r,d=null,e},e}function Ln(e,t){var n=Dn().source(e).target(t);return n.distance(),n}function Nn(e){for(var t=0,n=0;;){if(e(t,n))return[t,n];0===t?(t=n+1,n=0):(t-=1,n+=1)}}function kn(e,t,n,r){var i,o,a,s,l,c;return i=r[e],o=i[0],a=i[1],i=r[t],s=i[0],l=i[1],i=r[n],c=i[0],(i[1]-a)*(s-o)-(l-a)*(c-o)>0}function Fn(e,t,n){return(n[0]-t[0])*(e[1]-t[1])<(n[1]-t[1])*(e[0]-t[0])}function Un(e,t,n,r){var i=e[0],o=t[0],a=n[0],s=r[0],l=e[1],c=t[1],u=n[1],h=r[1],f=i-a,d=o-i,p=s-a,m=l-u,v=c-l,g=h-u,E=(p*m-g*f)/(g*d-p*v);return[i+E*d,l+E*v]}function Bn(e,t){var n={list:e.map(function(e,t){return{index:t,x:e[0],y:e[1]}}).sort(function(e,t){return e.y<t.y?-1:e.y>t.y?1:e.x<t.x?-1:e.x>t.x?1:0}),bottomSite:null},r={list:[],leftEnd:null,rightEnd:null,init:function(){r.leftEnd=r.createHalfEdge(null,"l"),r.rightEnd=r.createHalfEdge(null,"l"),r.leftEnd.r=r.rightEnd,r.rightEnd.l=r.leftEnd,r.list.unshift(r.leftEnd,r.rightEnd)},createHalfEdge:function(e,t){return{edge:e,side:t,vertex:null,l:null,r:null}},insert:function(e,t){t.l=e,t.r=e.r,e.r.l=t,e.r=t},leftBound:function(e){var t=r.leftEnd;do{t=t.r}while(t!=r.rightEnd&&i.rightOf(t,e));return t=t.l},del:function(e){e.l.r=e.r,e.r.l=e.l,e.edge=null},right:function(e){return e.r},left:function(e){return e.l},leftRegion:function(e){return null==e.edge?n.bottomSite:e.edge.region[e.side]},rightRegion:function(e){return null==e.edge?n.bottomSite:e.edge.region[ki[e.side]]}},i={bisect:function(e,t){var n={region:{l:e,r:t},ep:{l:null,r:null}},r=t.x-e.x,i=t.y-e.y,o=r>0?r:-r,a=i>0?i:-i;return n.c=e.x*r+e.y*i+.5*(r*r+i*i),o>a?(n.a=1,n.b=i/r,n.c/=r):(n.b=1,n.a=r/i,n.c/=i),n},intersect:function(e,t){var n=e.edge,r=t.edge;if(!n||!r||n.region.r==r.region.r)return null;var i=n.a*r.b-n.b*r.a;if(Math.abs(i)<1e-10)return null;var o,a,s=(n.c*r.b-r.c*n.b)/i,l=(r.c*n.a-n.c*r.a)/i,c=n.region.r,u=r.region.r;c.y<u.y||c.y==u.y&&c.x<u.x?(o=e,a=n):(o=t,a=r);var h=s>=a.region.r.x;return h&&"l"===o.side||!h&&"r"===o.side?null:{x:s,y:l}},rightOf:function(e,t){var n=e.edge,r=n.region.r,i=t.x>r.x;if(i&&"l"===e.side)return 1;if(!i&&"r"===e.side)return 0;if(1===n.a){var o=t.y-r.y,a=t.x-r.x,s=0,l=0;if(!i&&n.b<0||i&&n.b>=0?l=s=o>=n.b*a:(l=t.x+t.y*n.b>n.c,n.b<0&&(l=!l),l||(s=1)),!s){var c=r.x-n.region.l.x;l=n.b*(a*a-o*o)<c*o*(1+2*a/c+n.b*n.b),n.b<0&&(l=!l)}}else{var u=n.c-n.a*t.x,h=t.y-u,f=t.x-r.x,d=u-r.y;l=h*h>f*f+d*d}return"l"===e.side?l:!l},endPoint:function(e,n,r){e.ep[n]=r,e.ep[ki[n]]&&t(e)},distance:function(e,t){var n=e.x-t.x,r=e.y-t.y;return Math.sqrt(n*n+r*r)}},o={list:[],insert:function(e,t,n){e.vertex=t,e.ystar=t.y+n;for(var r=0,i=o.list,a=i.length;r<a;r++){var s=i[r];if(!(e.ystar>s.ystar||e.ystar==s.ystar&&t.x>s.vertex.x))break}i.splice(r,0,e)},del:function(e){for(var t=0,n=o.list,r=n.length;t<r&&n[t]!=e;++t);n.splice(t,1)},empty:function(){return 0===o.list.length},nextEvent:function(e){for(var t=0,n=o.list,r=n.length;t<r;++t)if(n[t]==e)return n[t+1];return null},min:function(){var e=o.list[0];return{x:e.vertex.x,y:e.ystar}},extractMin:function(){return o.list.shift()}};r.init(),n.bottomSite=n.list.shift();for(var a,s,l,c,u,h,f,d,p,m,v,g,E,y=n.list.shift();;)if(o.empty()||(a=o.min()),y&&(o.empty()||y.y<a.y||y.y==a.y&&y.x<a.x))s=r.leftBound(y),l=r.right(s),f=r.rightRegion(s),g=i.bisect(f,y),h=r.createHalfEdge(g,"l"),r.insert(s,h),m=i.intersect(s,h),m&&(o.del(s),o.insert(s,m,i.distance(m,y))),s=h,h=r.createHalfEdge(g,"r"),r.insert(s,h),m=i.intersect(h,l),m&&o.insert(h,m,i.distance(m,y)),y=n.list.shift();else{if(o.empty())break;s=o.extractMin(),c=r.left(s),l=r.right(s),u=r.right(l),f=r.leftRegion(s),d=r.rightRegion(l),v=s.vertex,i.endPoint(s.edge,s.side,v),i.endPoint(l.edge,l.side,v),r.del(s),o.del(l),r.del(l),E="l",f.y>d.y&&(p=f,f=d,d=p,E="r"),g=i.bisect(f,d),h=r.createHalfEdge(g,E),r.insert(c,h),i.endPoint(g,ki[E],v),m=i.intersect(c,h),m&&(o.del(c),o.insert(c,m,i.distance(m,f))),(m=i.intersect(h,u))&&o.insert(h,m,i.distance(m,f))}for(s=r.right(r.leftEnd);s!=r.rightEnd;s=r.right(s))t(s.edge)}function Vn(){return{leaf:!0,nodes:[],point:null}}function zn(e,t,n,r,i,o){if(!e(t,n,r,i,o)){var a=.5*(n+i),s=.5*(r+o),l=t.nodes;l[0]&&zn(e,l[0],n,r,a,s),l[1]&&zn(e,l[1],a,r,i,s),l[2]&&zn(e,l[2],n,s,a,o),l[3]&&zn(e,l[3],a,s,i,o)}}function In(e){return{x:e[0],y:e[1]}}function On(){this._=new Date(arguments.length>1?Date.UTC.apply(this,arguments):arguments[0])}function Wn(e,t,n,r){for(var i,o,a=0,s=t.length,l=n.length;a<s;){if(r>=l)return-1;if(37==(i=t.charCodeAt(a++))){if(!(o=Wi[t.charAt(a++)])||(r=o(e,n,r))<0)return-1}else if(i!=n.charCodeAt(r++))return-1}return r}function jn(e,t,n){return ji.test(t.substring(n,n+=3))?n:-1}function Gn(e,t,n){Gi.lastIndex=0;var r=Gi.exec(t.substring(n,n+10));return r?n+=r[0].length:-1}function Xn(e,t,n){var r=Yi.get(t.substring(n,n+=3).toLowerCase());return null==r?-1:(e.m=r,n)}function Yn(e,t,n){qi.lastIndex=0;var r=qi.exec(t.substring(n,n+12));return r?(e.m=Ki.get(r[0].toLowerCase()),n+=r[0].length):-1}function qn(e,t,n){return Wn(e,Oi.c.toString(),t,n)}function Kn(e,t,n){return Wn(e,Oi.x.toString(),t,n)}function $n(e,t,n){return Wn(e,Oi.X.toString(),t,n)}function Qn(e,t,n){Qi.lastIndex=0;var r=Qi.exec(t.substring(n,n+4));return r?(e.y=+r[0],n+=r[0].length):-1}function Zn(e,t,n){Qi.lastIndex=0;var r=Qi.exec(t.substring(n,n+2));return r?(e.y=Jn()+ +r[0],n+=r[0].length):-1}function Jn(){return 1e3*~~((new Date).getFullYear()/1e3)}function er(e,t,n){Qi.lastIndex=0;var r=Qi.exec(t.substring(n,n+2));return r?(e.m=r[0]-1,n+=r[0].length):-1}function tr(e,t,n){Qi.lastIndex=0;var r=Qi.exec(t.substring(n,n+2));return r?(e.d=+r[0],n+=r[0].length):-1}function nr(e,t,n){Qi.lastIndex=0;var r=Qi.exec(t.substring(n,n+2));return r?(e.H=+r[0],n+=r[0].length):-1}function rr(e,t,n){Qi.lastIndex=0;var r=Qi.exec(t.substring(n,n+2));return r?(e.M=+r[0],n+=r[0].length):-1}function ir(e,t,n){Qi.lastIndex=0;var r=Qi.exec(t.substring(n,n+2));return r?(e.S=+r[0],n+=r[0].length):-1}function or(e,t,n){Qi.lastIndex=0;var r=Qi.exec(t.substring(n,n+3));return r?(e.L=+r[0],n+=r[0].length):-1}function ar(e,t,n){var r=Zi.get(t.substring(n,n+=2).toLowerCase());return null==r?-1:(e.p=r,n)}function sr(e){var t=e.getTimezoneOffset(),n=t>0?"-":"+",r=~~(Math.abs(t)/60),i=Math.abs(t)%60;return n+Bi(r)+Bi(i)}function lr(e){return e.toISOString()}function cr(e,t,n){function r(t){var n=e(t),r=o(n,1);return t-n<r-t?n:r}function i(n){return t(n=e(new Fi(n-1)),1),n}function o(e,n){return t(e=new Fi(+e),n),e}function a(e,r,o){var a=i(e),s=[];if(o>1)for(;a<r;)n(a)%o||s.push(new Date(+a)),t(a,1);else for(;a<r;)s.push(new Date(+a)),t(a,1);return s}function s(e,t,n){try{Fi=On;var r=new On;return r._=e,a(r,t,n)}finally{Fi=Date}}e.floor=e,e.round=r,e.ceil=i,e.offset=o,e.range=a;var l=e.utc=ur(e);return l.floor=l,l.round=ur(r),l.ceil=ur(i),l.offset=ur(o),l.range=s,e}function ur(e){return function(t,n){try{Fi=On;var r=new On;return r._=t,e(r,n)._}finally{Fi=Date}}}function hr(e,t,n){function r(t){return e(t)}return r.invert=function(t){return dr(e.invert(t))},r.domain=function(t){return arguments.length?(e.domain(t),r):e.domain().map(dr)},r.nice=function(e){var t=fr(r.domain());return r.domain([e.floor(t[0]),e.ceil(t[1])])},r.ticks=function(n,i){var o=fr(r.domain());if("function"!=typeof n){var a=o[1]-o[0],s=a/n,l=d3.bisect(eo,s);if(l==eo.length)return t.year(o,n);if(!l)return e.ticks(n).map(dr);Math.log(s/eo[l-1])<Math.log(eo[l]/s)&&--l,n=t[l],i=n[1],n=n[0].range}return n(o[0],new Date(+o[1]+1),i)},r.tickFormat=function(){return n},r.copy=function(){return hr(e.copy(),t,n)},d3.rebind(r,e,"range","rangeRound","interpolate","clamp")}function fr(e){var t=e[0],n=e[e.length-1];return t<n?[t,n]:[n,t]}function dr(e){return new Date(e)}function pr(e){return function(t){for(var n=e.length-1,r=e[n];!r[1](t);)r=e[--n];return r[0](t)}}function mr(e){var t=new Date(e,0,1);return t.setFullYear(e),t}function vr(e){var t=e.getFullYear(),n=mr(t);return t+(e-n)/(mr(t+1)-n)}function gr(e){var t=new Date(Date.UTC(e,0,1));return t.setUTCFullYear(e),t}function Er(e){var t=e.getUTCFullYear(),n=gr(t);return t+(e-n)/(gr(t+1)-n)}Date.now||(Date.now=function(){return+new Date});try{document.createElement("div").style.setProperty("opacity",0,"")}catch(e){var yr=CSSStyleDeclaration.prototype,xr=yr.setProperty;yr.setProperty=function(e,t,n){xr.call(this,e,t+"",n)}}d3={version:"2.9.6"};var Tr=t;try{Tr(document.documentElement.childNodes)[0].nodeType}catch(t){Tr=e}var br=[].__proto__?function(e,t){e.__proto__=t}:function(e,t){for(var n in t)e[n]=t[n]};d3.map=function(e){var t=new n;for(var r in e)t.set(r,e[r]);return t},function(e,t){try{for(var n in t)Object.defineProperty(e.prototype,n,{value:t[n],enumerable:!1})}catch(n){e.prototype=t}}(n,{has:function(e){return Rr+e in this},get:function(e){return this[Rr+e]},set:function(e,t){return this[Rr+e]=t},remove:function(e){return(e=Rr+e)in this&&delete this[e]},keys:function(){var e=[];return this.forEach(function(t){e.push(t)}),e},values:function(){var e=[];return this.forEach(function(t,n){e.push(n)}),e},entries:function(){var e=[];return this.forEach(function(t,n){e.push({key:t,value:n})}),e},forEach:function(e){for(var t in this)t.charCodeAt(0)===wr&&e.call(this,t.substring(1),this[t])}});var Rr="\0",wr=Rr.charCodeAt(0);d3.functor=a,d3.rebind=function(e,t){for(var n,r=1,i=arguments.length;++r<i;)e[n=arguments[r]]=s(e,t,t[n]);return e},d3.ascending=function(e,t){return e<t?-1:e>t?1:e>=t?0:NaN},d3.descending=function(e,t){return t<e?-1:t>e?1:t>=e?0:NaN},d3.mean=function(e,t){var n,r=e.length,i=0,o=-1,a=0;if(1===arguments.length)for(;++o<r;)l(n=e[o])&&(i+=(n-i)/++a);else for(;++o<r;)l(n=t.call(e,e[o],o))&&(i+=(n-i)/++a);return a?i:void 0},d3.median=function(e,t){return arguments.length>1&&(e=e.map(t)),e=e.filter(l),e.length?d3.quantile(e.sort(d3.ascending),.5):void 0},d3.min=function(e,t){var n,r,i=-1,o=e.length;if(1===arguments.length){for(;++i<o&&(null==(n=e[i])||n!=n);)n=void 0;for(;++i<o;)null!=(r=e[i])&&n>r&&(n=r)}else{for(;++i<o&&(null==(n=t.call(e,e[i],i))||n!=n);)n=void 0;for(;++i<o;)null!=(r=t.call(e,e[i],i))&&n>r&&(n=r)}return n},d3.max=function(e,t){var n,r,i=-1,o=e.length;if(1===arguments.length){for(;++i<o&&(null==(n=e[i])||n!=n);)n=void 0;for(;++i<o;)null!=(r=e[i])&&r>n&&(n=r)}else{for(;++i<o&&(null==(n=t.call(e,e[i],i))||n!=n);)n=void 0;for(;++i<o;)null!=(r=t.call(e,e[i],i))&&r>n&&(n=r)}return n},d3.extent=function(e,t){var n,r,i,o=-1,a=e.length;if(1===arguments.length){for(;++o<a&&(null==(n=i=e[o])||n!=n);)n=i=void 0;for(;++o<a;)null!=(r=e[o])&&(n>r&&(n=r),i<r&&(i=r))}else{for(;++o<a&&(null==(n=i=t.call(e,e[o],o))||n!=n);)n=void 0;for(;++o<a;)null!=(r=t.call(e,e[o],o))&&(n>r&&(n=r),i<r&&(i=r))}return[n,i]},d3.random={normal:function(e,t){return arguments.length<2&&(t=1),arguments.length<1&&(e=0),function(){var n,r,i;do{n=2*Math.random()-1,r=2*Math.random()-1,i=n*n+r*r}while(!i||i>1);return e+t*n*Math.sqrt(-2*Math.log(i)/i)}}},d3.sum=function(e,t){var n,r=0,i=e.length,o=-1;if(1===arguments.length)for(;++o<i;)isNaN(n=+e[o])||(r+=n);else for(;++o<i;)isNaN(n=+t.call(e,e[o],o))||(r+=n);return r},d3.quantile=function(e,t){var n=(e.length-1)*t+1,r=Math.floor(n),i=e[r-1],o=n-r;return o?i+o*(e[r]-i):i},d3.transpose=function(e){return d3.zip.apply(d3,e)},d3.zip=function(){if(!(r=arguments.length))return[];for(var e=-1,t=d3.min(arguments,c),n=new Array(t);++e<t;)for(var r,i=-1,o=n[e]=new Array(r);++i<r;)o[i]=arguments[i][e];return n},d3.bisector=function(e){return{left:function(t,n,r,i){for(arguments.length<3&&(r=0),arguments.length<4&&(i=t.length);r<i;){var o=r+i>>1;e.call(t,t[o],o)<n?r=o+1:i=o}return r},right:function(t,n,r,i){for(arguments.length<3&&(r=0),arguments.length<4&&(i=t.length);r<i;){var o=r+i>>1;n<e.call(t,t[o],o)?i=o:r=o+1}return r}}};var _r=d3.bisector(function(e){return e});d3.bisectLeft=_r.left,d3.bisect=d3.bisectRight=_r.right,d3.first=function(e,t){var n,r=0,i=e.length,o=e[0];for(1===arguments.length&&(t=d3.ascending);++r<i;)t.call(e,o,n=e[r])>0&&(o=n);return o},d3.last=function(e,t){var n,r=0,i=e.length,o=e[0];for(1===arguments.length&&(t=d3.ascending);++r<i;)t.call(e,o,n=e[r])<=0&&(o=n);return o},d3.nest=function(){function e(t,s){if(s>=a.length)return i?i.call(o,t):r?t.sort(r):t;for(var l,c,u,h=-1,f=t.length,d=a[s++],p=new n,m={};++h<f;)(u=p.get(l=d(c=t[h])))?u.push(c):p.set(l,[c]);return p.forEach(function(t){m[t]=e(p.get(t),s)}),m}function t(e,n){if(n>=a.length)return e;var r,i=[],o=s[n++];for(r in e)i.push({key:r,values:t(e[r],n)});return o&&i.sort(function(e,t){return o(e.key,t.key)}),i}var r,i,o={},a=[],s=[];return o.map=function(t){return e(t,0)},o.entries=function(n){return t(e(n,0),0)},o.key=function(e){return a.push(e),o},o.sortKeys=function(e){return s[a.length-1]=e,o},o.sortValues=function(e){return r=e,o},o.rollup=function(e){return i=e,o},o},d3.keys=function(e){var t=[];for(var n in e)t.push(n);return t},d3.values=function(e){var t=[];for(var n in e)t.push(e[n]);return t},d3.entries=function(e){var t=[];for(var n in e)t.push({key:n,value:e[n]});return t},d3.permute=function(e,t){for(var n=[],r=-1,i=t.length;++r<i;)n[r]=e[t[r]];return n},d3.merge=function(e){return Array.prototype.concat.apply([],e)},d3.split=function(e,t){var n,r=[],i=[],o=-1,a=e.length;for(arguments.length<2&&(t=u);++o<a;)t.call(i,n=e[o],o)?i=[]:(i.length||r.push(i),i.push(n));return r},d3.range=function(e,t,n){if(arguments.length<3&&(n=1,arguments.length<2&&(t=e,e=0)),(t-e)/n==1/0)throw new Error("infinite range");var r,i=[],o=f(Math.abs(n)),a=-1;if(e*=o,t*=o,n*=o,n<0)for(;(r=e+n*++a)>t;)i.push(r/o);else for(;(r=e+n*++a)<t;)i.push(r/o);return i},d3.requote=function(e){return e.replace(Hr,"\\$&")};var Hr=/[\\\^\$\*\+\?\|\[\]\(\)\.\{\}]/g;d3.round=function(e,t){return t?Math.round(e*(t=Math.pow(10,t)))/t:Math.round(e)},d3.xhr=function(e,t,n){var r=new XMLHttpRequest;arguments.length<3?(n=t,t=null):t&&r.overrideMimeType&&r.overrideMimeType(t),r.open("GET",e,!0),t&&r.setRequestHeader("Accept",t),r.onreadystatechange=function(){if(4===r.readyState){var e=r.status;n(!e&&r.response||e>=200&&e<300||304===e?r:null)}},r.send(null)},d3.text=function(e,t,n){function r(e){n(e&&e.responseText)}arguments.length<3&&(n=t,t=null),d3.xhr(e,t,r)},d3.json=function(e,t){d3.text(e,"application/json",function(e){t(e?JSON.parse(e):null)})},d3.html=function(e,t){d3.text(e,"text/html",function(e){if(null!=e){var n=document.createRange();n.selectNode(document.body),e=n.createContextualFragment(e)}t(e)})},d3.xml=function(e,t,n){function r(e){n(e&&e.responseXML)}arguments.length<3&&(n=t,t=null),d3.xhr(e,t,r)};var Mr={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};d3.ns={prefix:Mr,qualify:function(e){var t=e.indexOf(":"),n=e;return t>=0&&(n=e.substring(0,t),e=e.substring(t+1)),Mr.hasOwnProperty(n)?{space:Mr[n],local:e}:e}},d3.dispatch=function(){for(var e=new d,t=-1,n=arguments.length;++t<n;)e[arguments[t]]=p(e);return e},d.prototype.on=function(e,t){var n=e.indexOf("."),r="";return n>0&&(r=e.substring(n+1),e=e.substring(0,n)),arguments.length<2?this[e].on(r):this[e].on(r,t)},d3.format=function(e){var t=Sr.exec(e),n=t[1]||" ",r=t[3]||"",i=t[5],o=+t[6],a=t[7],s=t[8],l=t[9],c=1,u="",h=!1;switch(s&&(s=+s.substring(1)),i&&(n="0",a&&(o-=Math.floor((o-1)/4))),l){case"n":a=!0,l="g";break;case"%":c=100,u="%",l="f";break;case"p":c=100,u="%",l="r";break;case"d":h=!0,s=0;break;case"s":c=-1,l="r"}return"r"==l&&!s&&(l="g"),l=Cr.get(l)||v,function(e){if(h&&e%1)return"";var t=e<0&&(e=-e)?"":r;if(c<0){var f=d3.formatPrefix(e,s);e=f.scale(e),u=f.symbol}else e*=c;if(e=l(e,s),i){var d=e.length+t.length;d<o&&(e=new Array(o-d+1).join(n)+e),a&&(e=g(e)),e=t+e}else{a&&(e=g(e)),e=t+e;var d=e.length;d<o&&(e=new Array(o-d+1).join(n)+e)}return e+u}};var Sr=/(?:([^{])?([<>=^]))?([+\- ])?(#)?(0)?([0-9]+)?(,)?(\.[0-9]+)?([a-zA-Z%])?/,Cr=d3.map({g:function(e,t){return e.toPrecision(t)},e:function(e,t){return e.toExponential(t)},f:function(e,t){return e.toFixed(t)},r:function(e,t){return d3.round(e,t=m(e,t)).toFixed(Math.max(0,Math.min(20,t)))}}),Ar=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"].map(E);d3.formatPrefix=function(e,t){var n=0;return e&&(e<0&&(e*=-1),t&&(e=d3.round(e,m(e,t))),n=1+Math.floor(1e-12+Math.log(e)/Math.LN10),n=Math.max(-24,Math.min(24,3*Math.floor((n<=0?n+1:n-1)/3)))),Ar[8+n/3]};var Pr=R(2),Dr=R(3),Lr=function(){return b},Nr=d3.map({linear:Lr,poly:R,quad:function(){return Pr},cubic:function(){return Dr},sin:function(){return w},exp:function(){return _},circle:function(){return H},elastic:M,back:S,bounce:function(){return C}}),kr=d3.map({in:b,out:x,"in-out":T,"out-in":function(e){return T(x(e))}});d3.ease=function(e){var t=e.indexOf("-"),n=t>=0?e.substring(0,t):e,r=t>=0?e.substring(t+1):"in";return n=Nr.get(n)||Lr,r=kr.get(r)||b,y(r(n.apply(null,Array.prototype.slice.call(arguments,1))))},d3.event=null,d3.interpolate=function(e,t){for(var n,r=d3.interpolators.length;--r>=0&&!(n=d3.interpolators[r](e,t)););return n},d3.interpolateNumber=function(e,t){return t-=e,function(n){return e+t*n}},d3.interpolateRound=function(e,t){return t-=e,function(n){return Math.round(e+t*n)}},d3.interpolateString=function(e,t){var n,r,i,o,a,s=0,l=[],c=[];for(Fr.lastIndex=0,r=0;n=Fr.exec(t);++r)n.index&&l.push(t.substring(s,n.index)),c.push({i:l.length,x:n[0]}),l.push(null),s=Fr.lastIndex;for(s<t.length&&l.push(t.substring(s)),r=0,o=c.length;(n=Fr.exec(e))&&r<o;++r)if(a=c[r],a.x==n[0]){if(a.i)if(null==l[a.i+1])for(l[a.i-1]+=a.x,l.splice(a.i,1),i=r+1;i<o;++i)c[i].i--;else for(l[a.i-1]+=a.x+l[a.i+1],l.splice(a.i,2),i=r+1;i<o;++i)c[i].i-=2;else if(null==l[a.i+1])l[a.i]=a.x;else for(l[a.i]=a.x+l[a.i+1],l.splice(a.i+1,1),i=r+1;i<o;++i)c[i].i--;c.splice(r,1),o--,r--}else a.x=d3.interpolateNumber(parseFloat(n[0]),parseFloat(a.x));for(;r<o;)a=c.pop(),null==l[a.i+1]?l[a.i]=a.x:(l[a.i]=a.x+l[a.i+1],l.splice(a.i+1,1)),o--;return 1===l.length?null==l[0]?c[0].x:function(){return t}:function(e){for(r=0;r<o;++r)l[(a=c[r]).i]=a.x(e);return l.join("")}},d3.interpolateTransform=function(e,t){var n,r=[],i=[],o=d3.transform(e),a=d3.transform(t),s=o.translate,l=a.translate,c=o.rotate,u=a.rotate,h=o.skew,f=a.skew,d=o.scale,p=a.scale;return s[0]!=l[0]||s[1]!=l[1]?(r.push("translate(",null,",",null,")"),i.push({i:1,x:d3.interpolateNumber(s[0],l[0])},{i:3,x:d3.interpolateNumber(s[1],l[1])})):l[0]||l[1]?r.push("translate("+l+")"):r.push(""),c!=u?(c-u>180?u+=360:u-c>180&&(c+=360),i.push({i:r.push(r.pop()+"rotate(",null,")")-2,x:d3.interpolateNumber(c,u)})):u&&r.push(r.pop()+"rotate("+u+")"),h!=f?i.push({i:r.push(r.pop()+"skewX(",null,")")-2,x:d3.interpolateNumber(h,f)}):f&&r.push(r.pop()+"skewX("+f+")"),d[0]!=p[0]||d[1]!=p[1]?(n=r.push(r.pop()+"scale(",null,",",null,")"),i.push({i:n-4,x:d3.interpolateNumber(d[0],p[0])},{i:n-2,x:d3.interpolateNumber(d[1],p[1])})):(1!=p[0]||1!=p[1])&&r.push(r.pop()+"scale("+p+")"),n=i.length,function(e){for(var t,o=-1;++o<n;)r[(t=i[o]).i]=t.x(e);return r.join("")}},d3.interpolateRgb=function(e,t){e=d3.rgb(e),t=d3.rgb(t);var n=e.r,r=e.g,i=e.b,o=t.r-n,a=t.g-r,s=t.b-i;return function(e){return"#"+B(Math.round(n+o*e))+B(Math.round(r+a*e))+B(Math.round(i+s*e))}},d3.interpolateHsl=function(e,t){e=d3.hsl(e),t=d3.hsl(t);var n=e.h,r=e.s,i=e.l,o=t.h-n,a=t.s-r,s=t.l-i;return o>180?o-=360:o<-180&&(o+=360),function(e){return j(n+o*e,r+a*e,i+s*e).toString()}},d3.interpolateArray=function(e,t){var n,r=[],i=[],o=e.length,a=t.length,s=Math.min(e.length,t.length);for(n=0;n<s;++n)r.push(d3.interpolate(e[n],t[n]));for(;n<o;++n)i[n]=e[n];for(;n<a;++n)i[n]=t[n];return function(e){for(n=0;n<s;++n)i[n]=r[n](e);return i}},d3.interpolateObject=function(e,t){var n,r={},i={};for(n in e)n in t?r[n]=L(n)(e[n],t[n]):i[n]=e[n];for(n in t)n in e||(i[n]=t[n]);return function(e){for(n in r)i[n]=r[n](e);return i}};var Fr=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g;d3.interpolators=[d3.interpolateObject,function(e,t){return t instanceof Array&&d3.interpolateArray(e,t)},function(e,t){return("string"==typeof e||"string"==typeof t)&&d3.interpolateString(e+"",t+"")},function(e,t){return("string"==typeof t?Ur.has(t)||/^(#|rgb\(|hsl\()/.test(t):t instanceof U||t instanceof W)&&d3.interpolateRgb(e,t)},function(e,t){return!isNaN(e=+e)&&!isNaN(t=+t)&&d3.interpolateNumber(e,t)}],d3.rgb=function(e,t,n){return 1===arguments.length?e instanceof U?F(e.r,e.g,e.b):V(""+e,F,j):F(~~e,~~t,~~n)},U.prototype.brighter=function(e){e=Math.pow(.7,arguments.length?e:1);var t=this.r,n=this.g,r=this.b,i=30;return t||n||r?(t&&t<i&&(t=i),n&&n<i&&(n=i),r&&r<i&&(r=i),F(Math.min(255,Math.floor(t/e)),Math.min(255,Math.floor(n/e)),Math.min(255,Math.floor(r/e)))):F(i,i,i)},U.prototype.darker=function(e){return e=Math.pow(.7,arguments.length?e:1),F(Math.floor(e*this.r),Math.floor(e*this.g),Math.floor(e*this.b))},U.prototype.hsl=function(){return z(this.r,this.g,this.b)},U.prototype.toString=function(){return"#"+B(this.r)+B(this.g)+B(this.b)};var Ur=d3.map({aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",
salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"});Ur.forEach(function(e,t){Ur.set(e,V(t,F,j))}),d3.hsl=function(e,t,n){return 1===arguments.length?e instanceof W?O(e.h,e.s,e.l):V(""+e,z,O):O(+e,+t,+n)},W.prototype.brighter=function(e){return e=Math.pow(.7,arguments.length?e:1),O(this.h,this.s,this.l/e)},W.prototype.darker=function(e){return e=Math.pow(.7,arguments.length?e:1),O(this.h,this.s,e*this.l)},W.prototype.rgb=function(){return j(this.h,this.s,this.l)},W.prototype.toString=function(){return this.rgb().toString()};var Br=function(e,t){return t.querySelector(e)},Vr=function(e,t){return t.querySelectorAll(e)},zr=document.documentElement,Ir=zr.matchesSelector||zr.webkitMatchesSelector||zr.mozMatchesSelector||zr.msMatchesSelector||zr.oMatchesSelector,Or=function(e,t){return Ir.call(e,t)};"function"==typeof Sizzle&&(Br=function(e,t){return Sizzle(e,t)[0]||null},Vr=function(e,t){return Sizzle.uniqueSort(Sizzle(e,t))},Or=Sizzle.matchesSelector);var Wr=[];d3.selection=function(){return jr},d3.selection.prototype=Wr,Wr.select=function(e){var t,n,r,i,o=[];"function"!=typeof e&&(e=X(e));for(var a=-1,s=this.length;++a<s;){o.push(t=[]),t.parentNode=(r=this[a]).parentNode;for(var l=-1,c=r.length;++l<c;)(i=r[l])?(t.push(n=e.call(i,i.__data__,l)),n&&"__data__"in i&&(n.__data__=i.__data__)):t.push(null)}return G(o)},Wr.selectAll=function(e){var t,n,r=[];"function"!=typeof e&&(e=Y(e));for(var i=-1,o=this.length;++i<o;)for(var a=this[i],s=-1,l=a.length;++s<l;)(n=a[s])&&(r.push(t=Tr(e.call(n,n.__data__,s))),t.parentNode=n);return G(r)},Wr.attr=function(e,t){function n(){this.removeAttribute(e)}function r(){this.removeAttributeNS(e.space,e.local)}function i(){this.setAttribute(e,t)}function o(){this.setAttributeNS(e.space,e.local,t)}function a(){var n=t.apply(this,arguments);null==n?this.removeAttribute(e):this.setAttribute(e,n)}function s(){var n=t.apply(this,arguments);null==n?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,n)}if(e=d3.ns.qualify(e),arguments.length<2){var l=this.node();return e.local?l.getAttributeNS(e.space,e.local):l.getAttribute(e)}return this.each(null==t?e.local?r:n:"function"==typeof t?e.local?s:a:e.local?o:i)},Wr.classed=function(e,t){var n=h(e).split(" "),r=n.length,i=-1;if(arguments.length>1){for(;++i<r;)q.call(this,n[i],t);return this}for(;++i<r;)if(!q.call(this,n[i]))return!1;return!0},Wr.style=function(e,t,n){function r(){this.style.removeProperty(e)}function i(){this.style.setProperty(e,t,n)}function o(){var r=t.apply(this,arguments);null==r?this.style.removeProperty(e):this.style.setProperty(e,r,n)}return arguments.length<3&&(n=""),arguments.length<2?window.getComputedStyle(this.node(),null).getPropertyValue(e):this.each(null==t?r:"function"==typeof t?o:i)},Wr.property=function(e,t){function n(){delete this[e]}function r(){this[e]=t}function i(){var n=t.apply(this,arguments);null==n?delete this[e]:this[e]=n}return arguments.length<2?this.node()[e]:this.each(null==t?n:"function"==typeof t?i:r)},Wr.text=function(e){return arguments.length<1?this.node().textContent:this.each("function"==typeof e?function(){var t=e.apply(this,arguments);this.textContent=null==t?"":t}:null==e?function(){this.textContent=""}:function(){this.textContent=e})},Wr.html=function(e){return arguments.length<1?this.node().innerHTML:this.each("function"==typeof e?function(){var t=e.apply(this,arguments);this.innerHTML=null==t?"":t}:null==e?function(){this.innerHTML=""}:function(){this.innerHTML=e})},Wr.append=function(e){function t(){return this.appendChild(document.createElementNS(this.namespaceURI,e))}function n(){return this.appendChild(document.createElementNS(e.space,e.local))}return e=d3.ns.qualify(e),this.select(e.local?n:t)},Wr.insert=function(e,t){function n(){return this.insertBefore(document.createElementNS(this.namespaceURI,e),Br(t,this))}function r(){return this.insertBefore(document.createElementNS(e.space,e.local),Br(t,this))}return e=d3.ns.qualify(e),this.select(e.local?r:n)},Wr.remove=function(){return this.each(function(){var e=this.parentNode;e&&e.removeChild(this)})},Wr.data=function(e,t){function r(e,r){var i,o,a,s=e.length,h=r.length,f=Math.min(s,h),d=Math.max(s,h),p=[],m=[],v=[];if(t){var g,E=new n,y=[],x=r.length;for(i=-1;++i<s;)g=t.call(o=e[i],o.__data__,i),E.has(g)?v[x++]=o:E.set(g,o),y.push(g);for(i=-1;++i<h;)g=t.call(r,a=r[i],i),E.has(g)?(p[i]=o=E.get(g),o.__data__=a,m[i]=v[i]=null):(m[i]=K(a),p[i]=v[i]=null),E.remove(g);for(i=-1;++i<s;)E.has(y[i])&&(v[i]=e[i])}else{for(i=-1;++i<f;)o=e[i],a=r[i],o?(o.__data__=a,p[i]=o,m[i]=v[i]=null):(m[i]=K(a),p[i]=v[i]=null);for(;i<h;++i)m[i]=K(r[i]),p[i]=v[i]=null;for(;i<d;++i)v[i]=e[i],m[i]=p[i]=null}m.update=p,m.parentNode=p.parentNode=v.parentNode=e.parentNode,l.push(m),c.push(p),u.push(v)}var i,o,a=-1,s=this.length;if(!arguments.length){for(e=new Array(s=(i=this[0]).length);++a<s;)(o=i[a])&&(e[a]=o.__data__);return e}var l=J([]),c=G([]),u=G([]);if("function"==typeof e)for(;++a<s;)r(i=this[a],e.call(i,i.parentNode.__data__,a));else for(;++a<s;)r(i=this[a],e);return c.enter=function(){return l},c.exit=function(){return u},c},Wr.datum=Wr.map=function(e){return arguments.length<1?this.property("__data__"):this.property("__data__",e)},Wr.filter=function(e){var t,n,r,i=[];"function"!=typeof e&&(e=$(e));for(var o=0,a=this.length;o<a;o++){i.push(t=[]),t.parentNode=(n=this[o]).parentNode;for(var s=0,l=n.length;s<l;s++)(r=n[s])&&e.call(r,r.__data__,s)&&t.push(r)}return G(i)},Wr.order=function(){for(var e=-1,t=this.length;++e<t;)for(var n,r=this[e],i=r.length-1,o=r[i];--i>=0;)(n=r[i])&&(o&&o!==n.nextSibling&&o.parentNode.insertBefore(n,o),o=n);return this},Wr.sort=function(e){e=Q.apply(this,arguments);for(var t=-1,n=this.length;++t<n;)this[t].sort(e);return this.order()},Wr.on=function(e,t,n){arguments.length<3&&(n=!1);var r="__on"+e,i=e.indexOf(".");return i>0&&(e=e.substring(0,i)),arguments.length<2?(i=this.node()[r])&&i._:this.each(function(i,o){function a(e){var n=d3.event;d3.event=e;try{t.call(s,s.__data__,o)}finally{d3.event=n}}var s=this,l=s[r];l&&(s.removeEventListener(e,l,l.$),delete s[r]),t&&(s.addEventListener(e,s[r]=a,a.$=n),a._=t)})},Wr.each=function(e){return Z(this,function(t,n,r){e.call(t,t.__data__,n,r)})},Wr.call=function(e){return e.apply(this,(arguments[0]=this,arguments)),this},Wr.empty=function(){return!this.node()},Wr.node=function(e){for(var t=0,n=this.length;t<n;t++)for(var r=this[t],i=0,o=r.length;i<o;i++){var a=r[i];if(a)return a}return null},Wr.transition=function(){for(var e,t,n=[],r=-1,i=this.length;++r<i;){n.push(e=[]);for(var o=this[r],a=-1,s=o.length;++a<s;)e.push((t=o[a])?{node:t,delay:Qr,duration:Zr}:null)}return ee(n,Kr||++qr,Date.now())};var jr=G([[document]]);jr[0].parentNode=zr,d3.select=function(e){return"string"==typeof e?jr.select(e):G([[e]])},d3.selectAll=function(e){return"string"==typeof e?jr.selectAll(e):G([Tr(e)])};var Gr=[];d3.selection.enter=J,d3.selection.enter.prototype=Gr,Gr.append=Wr.append,Gr.insert=Wr.insert,Gr.empty=Wr.empty,Gr.node=Wr.node,Gr.select=function(e){for(var t,n,r,i,o,a=[],s=-1,l=this.length;++s<l;){r=(i=this[s]).update,a.push(t=[]),t.parentNode=i.parentNode;for(var c=-1,u=i.length;++c<u;)(o=i[c])?(t.push(r[c]=n=e.call(i.parentNode,o.__data__,c)),n.__data__=o.__data__):t.push(null)}return G(a)};var Xr={},Yr=[],qr=0,Kr=0,$r=d3.ease("cubic-in-out"),Qr=0,Zr=250,Jr=$r;Yr.call=Wr.call,d3.transition=function(e){return arguments.length?Kr?e.transition():e:jr.transition()},d3.transition.prototype=Yr,Yr.select=function(e){var t,n,r,i=[];"function"!=typeof e&&(e=X(e));for(var o=-1,a=this.length;++o<a;){i.push(t=[]);for(var s=this[o],l=-1,c=s.length;++l<c;)(r=s[l])&&(n=e.call(r.node,r.node.__data__,l))?("__data__"in r.node&&(n.__data__=r.node.__data__),t.push({node:n,delay:r.delay,duration:r.duration})):t.push(null)}return ee(i,this.id,this.time).ease(this.ease())},Yr.selectAll=function(e){var t,n,r,i=[];"function"!=typeof e&&(e=Y(e));for(var o=-1,a=this.length;++o<a;)for(var s=this[o],l=-1,c=s.length;++l<c;)if(r=s[l]){n=e.call(r.node,r.node.__data__,l),i.push(t=[]);for(var u=-1,h=n.length;++u<h;)t.push({node:n[u],delay:r.delay,duration:r.duration})}return ee(i,this.id,this.time).ease(this.ease())},Yr.attr=function(e,t){return this.attrTween(e,ne(e,t))},Yr.attrTween=function(e,t){function n(e,n){var r=t.call(this,e,n,this.getAttribute(i));return r===Xr?(this.removeAttribute(i),null):r&&function(e){this.setAttribute(i,r(e))}}function r(e,n){var r=t.call(this,e,n,this.getAttributeNS(i.space,i.local));return r===Xr?(this.removeAttributeNS(i.space,i.local),null):r&&function(e){this.setAttributeNS(i.space,i.local,r(e))}}var i=d3.ns.qualify(e);return this.tween("attr."+e,i.local?r:n)},Yr.style=function(e,t,n){return arguments.length<3&&(n=""),this.styleTween(e,ne(e,t),n)},Yr.styleTween=function(e,t,n){return arguments.length<3&&(n=""),this.tween("style."+e,function(r,i){var o=t.call(this,r,i,window.getComputedStyle(this,null).getPropertyValue(e));return o===Xr?(this.style.removeProperty(e),null):o&&function(t){this.style.setProperty(e,o(t),n)}})},Yr.text=function(e){return this.tween("text",function(t,n){this.textContent="function"==typeof e?e.call(this,t,n):e})},Yr.remove=function(){return this.each("end.transition",function(){var e;!this.__transition__&&(e=this.parentNode)&&e.removeChild(this)})},Yr.delay=function(e){return Z(this,"function"==typeof e?function(t,n,r){t.delay=0|e.call(t=t.node,t.__data__,n,r)}:(e|=0,function(t){t.delay=e}))},Yr.duration=function(e){return Z(this,"function"==typeof e?function(t,n,r){t.duration=Math.max(1,0|e.call(t=t.node,t.__data__,n,r))}:(e=Math.max(1,0|e),function(t){t.duration=e}))},Yr.transition=function(){return this.select(i)};var ei,ti,ni=null;d3.timer=function(e,t,n){var r=!1,i=ni;if(arguments.length<3){if(arguments.length<2)t=0;else if(!isFinite(t))return;n=Date.now()}for(;i;){if(i.callback===e){i.then=n,i.delay=t,r=!0;break}i,i=i.next}r||(ni={callback:e,then:n,delay:t,next:ni}),ei||(ti=clearTimeout(ti),ei=1,ri(ie))},d3.timer.flush=function(){for(var e,t=Date.now(),n=ni;n;)e=t-n.then,n.delay||(n.flush=n.callback(e)),n=n.next;oe()};var ri=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){setTimeout(e,17)};d3.transform=function(e){var t=document.createElementNS(d3.ns.prefix.svg,"g"),n={a:1,b:0,c:0,d:1,e:0,f:0};return(d3.transform=function(e){t.setAttribute("transform",e);var r=t.transform.baseVal.consolidate();return new ae(r?r.matrix:n)})(e)},ae.prototype.toString=function(){return"translate("+this.translate+")rotate("+this.rotate+")skewX("+this.skew+")scale("+this.scale+")"};var ii=180/Math.PI;d3.mouse=function(e){return ue(e,P())};var oi=/WebKit/.test(navigator.userAgent)?-1:0;d3.touches=function(e,t){return arguments.length<2&&(t=P().touches),t?Tr(t).map(function(t){var n=ue(e,t);return n.identifier=t.identifier,n}):[]},d3.scale={},d3.scale.linear=function(){return me([0,1],[0,1],d3.interpolate,!1)},d3.scale.log=function(){return Re(d3.scale.linear(),we)};var ai=d3.format(".0e");we.pow=function(e){return Math.pow(10,e)},_e.pow=function(e){return-Math.pow(10,-e)},d3.scale.pow=function(){return He(d3.scale.linear(),1)},d3.scale.sqrt=function(){return d3.scale.pow().exponent(.5)},d3.scale.ordinal=function(){return Se([],{t:"range",x:[]})},d3.scale.category10=function(){return d3.scale.ordinal().range(si)},d3.scale.category20=function(){return d3.scale.ordinal().range(li)},d3.scale.category20b=function(){return d3.scale.ordinal().range(ci)},d3.scale.category20c=function(){return d3.scale.ordinal().range(ui)};var si=["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf"],li=["#1f77b4","#aec7e8","#ff7f0e","#ffbb78","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5","#8c564b","#c49c94","#e377c2","#f7b6d2","#7f7f7f","#c7c7c7","#bcbd22","#dbdb8d","#17becf","#9edae5"],ci=["#393b79","#5254a3","#6b6ecf","#9c9ede","#637939","#8ca252","#b5cf6b","#cedb9c","#8c6d31","#bd9e39","#e7ba52","#e7cb94","#843c39","#ad494a","#d6616b","#e7969c","#7b4173","#a55194","#ce6dbd","#de9ed6"],ui=["#3182bd","#6baed6","#9ecae1","#c6dbef","#e6550d","#fd8d3c","#fdae6b","#fdd0a2","#31a354","#74c476","#a1d99b","#c7e9c0","#756bb1","#9e9ac8","#bcbddc","#dadaeb","#636363","#969696","#bdbdbd","#d9d9d9"];d3.scale.quantile=function(){return Ce([],[])},d3.scale.quantize=function(){return Ae(0,1,[0,1])},d3.scale.identity=function(){return Pe([0,1])},d3.svg={},d3.svg.arc=function(){function e(){var e=t.apply(this,arguments),o=n.apply(this,arguments),a=r.apply(this,arguments)+hi,s=i.apply(this,arguments)+hi,l=(s<a&&(l=a,a=s,s=l),s-a),c=l<Math.PI?"0":"1",u=Math.cos(a),h=Math.sin(a),f=Math.cos(s),d=Math.sin(s);return l>=fi?e?"M0,"+o+"A"+o+","+o+" 0 1,1 0,"+-o+"A"+o+","+o+" 0 1,1 0,"+o+"M0,"+e+"A"+e+","+e+" 0 1,0 0,"+-e+"A"+e+","+e+" 0 1,0 0,"+e+"Z":"M0,"+o+"A"+o+","+o+" 0 1,1 0,"+-o+"A"+o+","+o+" 0 1,1 0,"+o+"Z":e?"M"+o*u+","+o*h+"A"+o+","+o+" 0 "+c+",1 "+o*f+","+o*d+"L"+e*f+","+e*d+"A"+e+","+e+" 0 "+c+",0 "+e*u+","+e*h+"Z":"M"+o*u+","+o*h+"A"+o+","+o+" 0 "+c+",1 "+o*f+","+o*d+"L0,0Z"}var t=De,n=Le,r=Ne,i=ke;return e.innerRadius=function(n){return arguments.length?(t=a(n),e):t},e.outerRadius=function(t){return arguments.length?(n=a(t),e):n},e.startAngle=function(t){return arguments.length?(r=a(t),e):r},e.endAngle=function(t){return arguments.length?(i=a(t),e):i},e.centroid=function(){var e=(t.apply(this,arguments)+n.apply(this,arguments))/2,o=(r.apply(this,arguments)+i.apply(this,arguments))/2+hi;return[Math.cos(o)*e,Math.sin(o)*e]},e};var hi=-Math.PI/2,fi=2*Math.PI-1e-6;d3.svg.line=function(){return Fe(r)};var di="linear",pi=d3.map({linear:Ve,"step-before":ze,"step-after":Ie,basis:Ye,"basis-open":qe,"basis-closed":Ke,bundle:$e,cardinal:je,"cardinal-open":Oe,"cardinal-closed":We,monotone:nt}),mi=[0,2/3,1/3,0],vi=[0,1/3,2/3,0],gi=[0,1/6,2/3,1/6];d3.svg.line.radial=function(){var e=Fe(rt);return e.radius=e.x,delete e.x,e.angle=e.y,delete e.y,e},ze.reverse=Ie,Ie.reverse=ze,d3.svg.area=function(){return it(Object)},d3.svg.area.radial=function(){var e=it(rt);return e.radius=e.x,delete e.x,e.innerRadius=e.x0,delete e.x0,e.outerRadius=e.x1,delete e.x1,e.angle=e.y,delete e.y,e.startAngle=e.y0,delete e.y0,e.endAngle=e.y1,delete e.y1,e},d3.svg.chord=function(){function e(e,a){var l=t(this,o,e,a),c=t(this,s,e,a);return"M"+l.p0+r(l.r,l.p1,l.a1-l.a0)+(n(l,c)?i(l.r,l.p1,l.r,l.p0):i(l.r,l.p1,c.r,c.p0)+r(c.r,c.p1,c.a1-c.a0)+i(c.r,c.p1,l.r,l.p0))+"Z"}function t(e,t,n,r){var i=t.call(e,n,r),o=l.call(e,i,r),a=c.call(e,i,r)+hi,s=u.call(e,i,r)+hi;return{r:o,a0:a,a1:s,p0:[o*Math.cos(a),o*Math.sin(a)],p1:[o*Math.cos(s),o*Math.sin(s)]}}function n(e,t){return e.a0==t.a0&&e.a1==t.a1}function r(e,t,n){return"A"+e+","+e+" 0 "+ +(n>Math.PI)+",1 "+t}function i(e,t,n,r){return"Q 0,0 "+r}var o=ot,s=at,l=st,c=Ne,u=ke;return e.radius=function(t){return arguments.length?(l=a(t),e):l},e.source=function(t){return arguments.length?(o=a(t),e):o},e.target=function(t){return arguments.length?(s=a(t),e):s},e.startAngle=function(t){return arguments.length?(c=a(t),e):c},e.endAngle=function(t){return arguments.length?(u=a(t),e):u},e},d3.svg.diagonal=function(){function e(e,i){var o=t.call(this,e,i),a=n.call(this,e,i),s=(o.y+a.y)/2,l=[o,{x:o.x,y:s},{x:a.x,y:s},a];return l=l.map(r),"M"+l[0]+"C"+l[1]+" "+l[2]+" "+l[3]}var t=ot,n=at,r=lt;return e.source=function(n){return arguments.length?(t=a(n),e):t},e.target=function(t){return arguments.length?(n=a(t),e):n},e.projection=function(t){return arguments.length?(r=t,e):r},e},d3.svg.diagonal.radial=function(){var e=d3.svg.diagonal(),t=lt,n=e.projection;return e.projection=function(e){return arguments.length?n(ct(t=e)):t},e},d3.svg.mouse=d3.mouse,d3.svg.touches=d3.touches,d3.svg.symbol=function(){function e(e,r){return(Ei.get(t.call(this,e,r))||ft)(n.call(this,e,r))}var t=ht,n=ut;return e.type=function(n){return arguments.length?(t=a(n),e):t},e.size=function(t){return arguments.length?(n=a(t),e):n},e};var Ei=d3.map({circle:ft,cross:function(e){var t=Math.sqrt(e/5)/2;return"M"+-3*t+","+-t+"H"+-t+"V"+-3*t+"H"+t+"V"+-t+"H"+3*t+"V"+t+"H"+t+"V"+3*t+"H"+-t+"V"+t+"H"+-3*t+"Z"},diamond:function(e){var t=Math.sqrt(e/(2*xi)),n=t*xi;return"M0,"+-t+"L"+n+",0 0,"+t+" "+-n+",0Z"},square:function(e){var t=Math.sqrt(e)/2;return"M"+-t+","+-t+"L"+t+","+-t+" "+t+","+t+" "+-t+","+t+"Z"},"triangle-down":function(e){var t=Math.sqrt(e/yi),n=t*yi/2;return"M0,"+n+"L"+t+","+-n+" "+-t+","+-n+"Z"},"triangle-up":function(e){var t=Math.sqrt(e/yi),n=t*yi/2;return"M0,"+-n+"L"+t+","+n+" "+-t+","+n+"Z"}});d3.svg.symbolTypes=Ei.keys();var yi=Math.sqrt(3),xi=Math.tan(30*Math.PI/180);d3.svg.axis=function(){function e(e){e.each(function(){var e,h=d3.select(this),f=null==c?n.ticks?n.ticks.apply(n,l):n.domain():c,d=null==t?n.tickFormat?n.tickFormat.apply(n,l):String:t,p=mt(n,f,u),m=h.selectAll(".minor").data(p,String),v=m.enter().insert("line","g").attr("class","tick minor").style("opacity",1e-6),g=d3.transition(m.exit()).style("opacity",1e-6).remove(),E=d3.transition(m).style("opacity",1),y=h.selectAll("g").data(f,String),x=y.enter().insert("g","path").style("opacity",1e-6),T=d3.transition(y.exit()).style("opacity",1e-6).remove(),b=d3.transition(y).style("opacity",1),R=fe(n),w=h.selectAll(".domain").data([0]),_=(w.enter().append("path").attr("class","domain"),d3.transition(w)),H=n.copy(),M=this.__chart__||H;this.__chart__=H,x.append("line").attr("class","tick"),x.append("text");var S=x.select("line"),C=b.select("line"),A=y.select("text").text(d),P=x.select("text"),D=b.select("text");switch(r){case"bottom":e=dt,v.attr("y2",o),E.attr("x2",0).attr("y2",o),S.attr("y2",i),P.attr("y",Math.max(i,0)+s),C.attr("x2",0).attr("y2",i),D.attr("x",0).attr("y",Math.max(i,0)+s),A.attr("dy",".71em").attr("text-anchor","middle"),_.attr("d","M"+R[0]+","+a+"V0H"+R[1]+"V"+a);break;case"top":e=dt,v.attr("y2",-o),E.attr("x2",0).attr("y2",-o),S.attr("y2",-i),P.attr("y",-(Math.max(i,0)+s)),C.attr("x2",0).attr("y2",-i),D.attr("x",0).attr("y",-(Math.max(i,0)+s)),A.attr("dy","0em").attr("text-anchor","middle"),_.attr("d","M"+R[0]+","+-a+"V0H"+R[1]+"V"+-a);break;case"left":e=pt,v.attr("x2",-o),E.attr("x2",-o).attr("y2",0),S.attr("x2",-i),P.attr("x",-(Math.max(i,0)+s)),C.attr("x2",-i).attr("y2",0),D.attr("x",-(Math.max(i,0)+s)).attr("y",0),A.attr("dy",".32em").attr("text-anchor","end"),_.attr("d","M"+-a+","+R[0]+"H0V"+R[1]+"H"+-a);break;case"right":e=pt,v.attr("x2",o),E.attr("x2",o).attr("y2",0),S.attr("x2",i),P.attr("x",Math.max(i,0)+s),C.attr("x2",i).attr("y2",0),D.attr("x",Math.max(i,0)+s).attr("y",0),A.attr("dy",".32em").attr("text-anchor","start"),_.attr("d","M"+a+","+R[0]+"H0V"+R[1]+"H"+a)}if(n.ticks)x.call(e,M),b.call(e,H),T.call(e,H),v.call(e,M),E.call(e,H),g.call(e,H);else{var L=H.rangeBand()/2,N=function(e){return H(e)+L};x.call(e,N),b.call(e,N)}})}var t,n=d3.scale.linear(),r="bottom",i=6,o=6,a=6,s=3,l=[10],c=null,u=0;return e.scale=function(t){return arguments.length?(n=t,e):n},e.orient=function(t){return arguments.length?(r=t,e):r},e.ticks=function(){return arguments.length?(l=arguments,e):l},e.tickValues=function(t){return arguments.length?(c=t,e):c},e.tickFormat=function(n){return arguments.length?(t=n,e):t},e.tickSize=function(t,n,r){if(!arguments.length)return i;var s=arguments.length-1;return i=+t,o=s>1?+n:i,a=s>0?+arguments[s]:i,e},e.tickPadding=function(t){return arguments.length?(s=+t,e):s},e.tickSubdivide=function(t){return arguments.length?(u=+t,e):u},e},d3.svg.brush=function(){function e(o){o.each(function(){var o,a=d3.select(this),u=a.selectAll(".background").data([0]),h=a.selectAll(".extent").data([0]),f=a.selectAll(".resize").data(c,String);a.style("pointer-events","all").on("mousedown.brush",i).on("touchstart.brush",i),u.enter().append("rect").attr("class","background").style("visibility","hidden").style("cursor","crosshair"),h.enter().append("rect").attr("class","extent").style("cursor","move"),f.enter().append("g").attr("class",function(e){return"resize "+e}).style("cursor",function(e){return Ti[e]}).append("rect").attr("x",function(e){return/[ew]$/.test(e)?-3:null}).attr("y",function(e){return/^[ns]/.test(e)?-3:null}).attr("width",6).attr("height",6).style("visibility","hidden"),f.style("display",e.empty()?"none":null),f.exit().remove(),s&&(o=fe(s),u.attr("x",o[0]).attr("width",o[1]-o[0]),n(a)),l&&(o=fe(l),u.attr("y",o[0]).attr("height",o[1]-o[0]),r(a)),t(a)})}function t(e){e.selectAll(".resize").attr("transform",function(e){return"translate("+u[+/e$/.test(e)][0]+","+u[+/^s/.test(e)][1]+")"})}function n(e){e.select(".extent").attr("x",u[0][0]),e.selectAll(".extent,.n>rect,.s>rect").attr("width",u[1][0]-u[0][0])}function r(e){e.select(".extent").attr("y",u[0][1]),e.selectAll(".extent,.e>rect,.w>rect").attr("height",u[1][1]-u[0][1])}function i(){function i(){var e=d3.event.changedTouches;return e?d3.touches(g,e)[0]:d3.mouse(g)}function c(){32==d3.event.keyCode&&(w||(m=null,_[0]-=u[1][0],_[1]-=u[1][1],w=2),A())}function h(){32==d3.event.keyCode&&2==w&&(_[0]+=u[1][0],_[1]+=u[1][1],w=0,A())}function f(){var e=i(),o=!1;v&&(e[0]+=v[0],e[1]+=v[1]),w||(d3.event.altKey?(m||(m=[(u[0][0]+u[1][0])/2,(u[0][1]+u[1][1])/2]),_[0]=u[+(e[0]<m[0])][0],_[1]=u[+(e[1]<m[1])][1]):m=null),b&&d(e,s,0)&&(n(x),o=!0),R&&d(e,l,1)&&(r(x),o=!0),o&&(t(x),y({type:"brush",mode:w?"move":"resize"}))}function d(e,t,n){var r,i,a=fe(t),s=a[0],l=a[1],c=_[n],h=u[1][n]-u[0][n];if(w&&(s-=c,l-=h+c),r=Math.max(s,Math.min(l,e[n])),w?i=(r+=c)+h:(m&&(c=Math.max(s,Math.min(l,2*m[n]-r))),c<r?(i=r,r=c):i=c),u[0][n]!==r||u[1][n]!==i)return o=null,u[0][n]=r,u[1][n]=i,!0}function p(){f(),x.style("pointer-events","all").selectAll(".resize").style("display",e.empty()?"none":null),d3.select("body").style("cursor",null),H.on("mousemove.brush",null).on("mouseup.brush",null).on("touchmove.brush",null).on("touchend.brush",null).on("keydown.brush",null).on("keyup.brush",null),y({type:"brushend"}),A()}var m,v,g=this,E=d3.select(d3.event.target),y=a.of(g,arguments),x=d3.select(g),T=E.datum(),b=!/^(n|s)$/.test(T)&&s,R=!/^(e|w)$/.test(T)&&l,w=E.classed("extent"),_=i(),H=d3.select(window).on("mousemove.brush",f).on("mouseup.brush",p).on("touchmove.brush",f).on("touchend.brush",p).on("keydown.brush",c).on("keyup.brush",h);if(w)_[0]=u[0][0]-_[0],_[1]=u[0][1]-_[1];else if(T){var M=+/w$/.test(T),S=+/^n/.test(T);v=[u[1-M][0]-_[0],u[1-S][1]-_[1]],_[0]=u[M][0],_[1]=u[S][1]}else d3.event.altKey&&(m=_.slice());x.style("pointer-events","none").selectAll(".resize").style("display",null),d3.select("body").style("cursor",E.style("cursor")),y({type:"brushstart"}),f(),A()}var o,a=D(e,"brushstart","brush","brushend"),s=null,l=null,c=bi[0],u=[[0,0],[0,0]];return e.x=function(t){return arguments.length?(s=t,c=bi[!s<<1|!l],e):s},e.y=function(t){return arguments.length?(l=t,c=bi[!s<<1|!l],e):l},e.extent=function(t){var n,r,i,a,c;return arguments.length?(o=[[0,0],[0,0]],s&&(n=t[0],r=t[1],l&&(n=n[0],r=r[0]),o[0][0]=n,o[1][0]=r,s.invert&&(n=s(n),r=s(r)),r<n&&(c=n,n=r,r=c),u[0][0]=0|n,u[1][0]=0|r),l&&(i=t[0],a=t[1],s&&(i=i[1],a=a[1]),o[0][1]=i,o[1][1]=a,l.invert&&(i=l(i),a=l(a)),a<i&&(c=i,i=a,a=c),u[0][1]=0|i,u[1][1]=0|a),e):(t=o||u,s&&(n=t[0][0],r=t[1][0],o||(n=u[0][0],r=u[1][0],s.invert&&(n=s.invert(n),r=s.invert(r)),r<n&&(c=n,n=r,r=c))),l&&(i=t[0][1],a=t[1][1],o||(i=u[0][1],a=u[1][1],l.invert&&(i=l.invert(i),a=l.invert(a)),a<i&&(c=i,i=a,a=c))),s&&l?[[n,i],[r,a]]:s?[n,r]:l&&[i,a])},e.clear=function(){return o=null,u[0][0]=u[0][1]=u[1][0]=u[1][1]=0,e},e.empty=function(){return s&&u[0][0]===u[1][0]||l&&u[0][1]===u[1][1]},d3.rebind(e,a,"on")};var Ti={n:"ns-resize",e:"ew-resize",s:"ns-resize",w:"ew-resize",nw:"nwse-resize",ne:"nesw-resize",se:"nwse-resize",sw:"nesw-resize"},bi=[["n","e","s","w","nw","ne","se","sw"],["e","w"],["n","s"],[]];d3.behavior={},d3.behavior.drag=function(){function e(){this.on("mousedown.drag",t).on("touchstart.drag",t)}function t(){function e(){var e=s.parentNode,t=d3.event.changedTouches;return t?d3.touches(e,t)[0]:d3.mouse(e)}function t(){if(!s.parentNode)return i();var t=e(),n=t[0]-u[0],r=t[1]-u[1];h|=n|r,u=t,A(),l({type:"drag",x:t[0]+a[0],y:t[1]+a[1],dx:n,dy:r})}function i(){l({type:"dragend"}),h&&(A(),d3.event.target===c&&f.on("click.drag",o,!0)),f.on("mousemove.drag",null).on("touchmove.drag",null).on("mouseup.drag",null).on("touchend.drag",null)}function o(){A(),f.on("click.drag",null)}var a,s=this,l=n.of(s,arguments),c=d3.event.target,u=e(),h=0,f=d3.select(window).on("mousemove.drag",t).on("touchmove.drag",t).on("mouseup.drag",i,!0).on("touchend.drag",i,!0);r?(a=r.apply(s,arguments),a=[a.x-u[0],a.y-u[1]]):a=[0,0],A(),l({type:"dragstart"})}var n=D(e,"drag","dragstart","dragend"),r=null;return e.origin=function(t){return arguments.length?(r=t,e):r},d3.rebind(e,n,"on")},d3.behavior.zoom=function(){function e(){this.on("mousedown.zoom",a).on("mousewheel.zoom",s).on("mousemove.zoom",l).on("DOMMouseScroll.zoom",s).on("dblclick.zoom",c).on("touchstart.zoom",u).on("touchmove.zoom",h).on("touchend.zoom",u)}function t(e){return[(e[0]-y[0])/x,(e[1]-y[1])/x]}function n(e){return[e[0]*x+y[0],e[1]*x+y[1]]}function r(e){x=Math.max(T[0],Math.min(T[1],e))}function i(e,t){t=n(t),y[0]+=e[0]-t[0],y[1]+=e[1]-t[1]}function o(e){m&&m.domain(p.range().map(function(e){return(e-y[0])/x}).map(p.invert)),g&&g.domain(v.range().map(function(e){return(e-y[1])/x}).map(v.invert)),d3.event.preventDefault(),e({type:"zoom",scale:x,translate:y})}function a(){function e(){c=1,i(d3.mouse(a),h),o(s)}function n(){c&&A(),u.on("mousemove.zoom",null).on("mouseup.zoom",null),c&&d3.event.target===l&&u.on("click.zoom",r,!0)}function r(){A(),u.on("click.zoom",null)}var a=this,s=b.of(a,arguments),l=d3.event.target,c=0,u=d3.select(window).on("mousemove.zoom",e).on("mouseup.zoom",n),h=t(d3.mouse(a));window.focus(),A()}function s(){f||(f=t(d3.mouse(this))),r(Math.pow(2,.002*vt())*x),i(d3.mouse(this),f),o(b.of(this,arguments))}function l(){f=null}function c(){var e=d3.mouse(this),n=t(e);r(d3.event.shiftKey?x/2:2*x),i(e,n),o(b.of(this,arguments))}function u(){var e=d3.touches(this),n=Date.now();if(d=x,f={},e.forEach(function(e){f[e.identifier]=t(e)}),A(),1===e.length&&n-E<500){var a=e[0],s=t(e[0]);r(2*x),i(a,s),o(b.of(this,arguments))}E=n}function h(){var e=d3.touches(this),t=e[0],n=f[t.identifier];if(a=e[1]){var a,s=f[a.identifier];t=[(t[0]+a[0])/2,(t[1]+a[1])/2],n=[(n[0]+s[0])/2,(n[1]+s[1])/2],r(d3.event.scale*d)}i(t,n),o(b.of(this,arguments))}var f,d,p,m,v,g,E,y=[0,0],x=1,T=wi,b=D(e,"zoom");return e.translate=function(t){return arguments.length?(y=t.map(Number),e):y},e.scale=function(t){return arguments.length?(x=+t,e):x},e.scaleExtent=function(t){return arguments.length?(T=null==t?wi:t.map(Number),e):T},e.x=function(t){return arguments.length?(m=t,p=t.copy(),e):m},e.y=function(t){return arguments.length?(g=t,v=t.copy(),e):g},d3.rebind(e,b,"on")};var Ri,wi=[0,1/0];d3.layout={},d3.layout.bundle=function(){return function(e){for(var t=[],n=-1,r=e.length;++n<r;)t.push(gt(e[n]));return t}},d3.layout.chord=function(){function e(){var e,c,h,f,d,p={},m=[],v=d3.range(o),g=[];for(n=[],r=[],e=0,f=-1;++f<o;){for(c=0,d=-1;++d<o;)c+=i[f][d];m.push(c),g.push(d3.range(o)),e+=c}for(a&&v.sort(function(e,t){return a(m[e],m[t])}),s&&g.forEach(function(e,t){e.sort(function(e,n){return s(i[t][e],i[t][n])})}),e=(2*Math.PI-u*o)/e,c=0,f=-1;++f<o;){for(h=c,d=-1;++d<o;){var E=v[f],y=g[E][d],x=i[E][y],T=c,b=c+=x*e;p[E+"-"+y]={index:E,subindex:y,startAngle:T,endAngle:b,value:x}}r[E]={index:E,startAngle:h,endAngle:c,value:(c-h)/e},c+=u}for(f=-1;++f<o;)for(d=f-1;++d<o;){var R=p[f+"-"+d],w=p[d+"-"+f];(R.value||w.value)&&n.push(R.value<w.value?{source:w,target:R}:{source:R,target:w})}l&&t()}function t(){n.sort(function(e,t){return l((e.source.value+e.target.value)/2,(t.source.value+t.target.value)/2)})}var n,r,i,o,a,s,l,c={},u=0;return c.matrix=function(e){return arguments.length?(o=(i=e)&&i.length,n=r=null,c):i},c.padding=function(e){return arguments.length?(u=e,n=r=null,c):u},c.sortGroups=function(e){return arguments.length?(a=e,n=r=null,c):a},c.sortSubgroups=function(e){return arguments.length?(s=e,n=null,c):s},c.sortChords=function(e){return arguments.length?(l=e,n&&t(),c):l},c.chords=function(){return n||e(),n},c.groups=function(){return r||e(),r},c},d3.layout.force=function(){function e(e){return function(t,n,r,i,o){if(t.point!==e){var a=t.cx-e.x,s=t.cy-e.y,l=1/Math.sqrt(a*a+s*s);if((i-n)*l<g){var c=t.charge*l*l;return e.px-=a*c,e.py-=s*c,!0}if(t.point&&isFinite(l)){var c=t.pointCharge*l*l;e.px-=a*c,e.py-=s*c}}return!t.charge}}function t(e){xt(Hi=e),_i=c}var n,i,o,s,l,c={},u=d3.dispatch("start","tick","end"),h=[1,1],f=.9,d=_t,p=Ht,m=-30,v=.1,g=.8,E=[],y=[];return c.tick=function(){if((i*=.99)<.005)return u.end({type:"end",alpha:i=0}),!0;var t,n,r,a,c,d,p,g,x,T=E.length,b=y.length;for(n=0;n<b;++n)r=y[n],a=r.source,c=r.target,g=c.x-a.x,x=c.y-a.y,(d=g*g+x*x)&&(d=i*s[n]*((d=Math.sqrt(d))-o[n])/d,g*=d,x*=d,c.x-=g*(p=a.weight/(c.weight+a.weight)),c.y-=x*p,a.x+=g*(p=1-p),a.y+=x*p);if((p=i*v)&&(g=h[0]/2,x=h[1]/2,n=-1,p))for(;++n<T;)r=E[n],r.x+=(g-r.x)*p,r.y+=(x-r.y)*p;if(m)for(wt(t=d3.geom.quadtree(E),i,l),n=-1;++n<T;)(r=E[n]).fixed||t.visit(e(r));for(n=-1;++n<T;)r=E[n],r.fixed?(r.x=r.px,r.y=r.py):(r.x-=(r.px-(r.px=r.x))*f,r.y-=(r.py-(r.py=r.y))*f);u.tick({type:"tick",alpha:i})},c.nodes=function(e){return arguments.length?(E=e,c):E},c.links=function(e){return arguments.length?(y=e,c):y},c.size=function(e){return arguments.length?(h=e,c):h},c.linkDistance=function(e){return arguments.length?(d=a(e),c):d},c.distance=c.linkDistance,c.linkStrength=function(e){return arguments.length?(p=a(e),c):p},c.friction=function(e){return arguments.length?(f=e,c):f},c.charge=function(e){return arguments.length?(m="function"==typeof e?e:+e,c):m},c.gravity=function(e){return arguments.length?(v=e,c):v},c.theta=function(e){return arguments.length?(g=e,c):g},c.alpha=function(e){return arguments.length?(i?i=e>0?e:0:e>0&&(u.start({type:"start",alpha:i=e}),d3.timer(c.tick)),c):i},c.start=function(){function e(e,n){for(var r,i=t(),o=-1,a=i.length;++o<a;)if(!isNaN(r=i[o][e]))return r;return Math.random()*n}function t(){if(!i){for(i=[],r=0;r<u;++r)i[r]=[];for(r=0;r<f;++r){var e=y[r];i[e.source.index].push(e.target),i[e.target.index].push(e.source)}}return i[n]}var n,r,i,a,u=E.length,f=y.length,v=h[0],g=h[1];for(n=0;n<u;++n)(a=E[n]).index=n,a.weight=0;for(o=[],s=[],n=0;n<f;++n)a=y[n],"number"==typeof a.source&&(a.source=E[a.source]),"number"==typeof a.target&&(a.target=E[a.target]),o[n]=d.call(this,a,n),s[n]=p.call(this,a,n),++a.source.weight,++a.target.weight;for(n=0;n<u;++n)a=E[n],isNaN(a.x)&&(a.x=e("x",v)),isNaN(a.y)&&(a.y=e("y",g)),isNaN(a.px)&&(a.px=a.x),isNaN(a.py)&&(a.py=a.y);if(l=[],"function"==typeof m)for(n=0;n<u;++n)l[n]=+m.call(this,E[n],n);else for(n=0;n<u;++n)l[n]=m;return c.resume()},c.resume=function(){return c.alpha(.1)},c.stop=function(){return c.alpha(0)},c.drag=function(){n||(n=d3.behavior.drag().origin(r).on("dragstart",t).on("drag",Rt).on("dragend",bt)),this.on("mouseover.force",xt).on("mouseout.force",Tt).call(n)},d3.rebind(c,u,"on")};var _i,Hi;d3.layout.partition=function(){function e(t,n,r,i){var o=t.children;if(t.x=n,t.y=t.depth*i,t.dx=r,t.dy=i,o&&(a=o.length)){var a,s,l,c=-1;for(r=t.value?r/t.value:0;++c<a;)e(s=o[c],n,l=s.value*r,i),n+=l}}function t(e){var n=e.children,r=0;if(n&&(i=n.length))for(var i,o=-1;++o<i;)r=Math.max(r,t(n[o]));return 1+r}function n(n,o){var a=r.call(this,n,o);return e(a[0],0,i[0],i[1]/t(a[0])),a}var r=d3.layout.hierarchy(),i=[1,1];return n.size=function(e){return arguments.length?(i=e,n):i},Bt(n,r)},d3.layout.pie=function(){function e(o,a){
var s=o.map(function(n,r){return+t.call(e,n,r)}),l=+("function"==typeof r?r.apply(this,arguments):r),c=(("function"==typeof i?i.apply(this,arguments):i)-r)/d3.sum(s),u=d3.range(o.length);null!=n&&u.sort(n===Mi?function(e,t){return s[t]-s[e]}:function(e,t){return n(o[e],o[t])});var h=[];return u.forEach(function(e){var t;h[e]={data:o[e],value:t=s[e],startAngle:l,endAngle:l+=t*c}}),h}var t=Number,n=Mi,r=0,i=2*Math.PI;return e.value=function(n){return arguments.length?(t=n,e):t},e.sort=function(t){return arguments.length?(n=t,e):n},e.startAngle=function(t){return arguments.length?(r=t,e):r},e.endAngle=function(t){return arguments.length?(i=t,e):i},e};var Mi={};d3.layout.stack=function(){function e(r,l){var c=r.map(function(n,r){return t.call(e,n,r)}),u=c.map(function(t,n){return t.map(function(t,n){return[a.call(e,t,n),s.call(e,t,n)]})}),h=n.call(e,u,l);c=d3.permute(c,h),u=d3.permute(u,h);var f,d,p,m=i.call(e,u,l),v=c.length,g=c[0].length;for(d=0;d<g;++d)for(o.call(e,c[0][d],p=m[d],u[0][d][1]),f=1;f<v;++f)o.call(e,c[f][d],p+=u[f-1][d][1],u[f][d][1]);return r}var t=r,n=At,i=Pt,o=Ct,a=Mt,s=St;return e.values=function(n){return arguments.length?(t=n,e):t},e.order=function(t){return arguments.length?(n="function"==typeof t?t:Si.get(t)||At,e):n},e.offset=function(t){return arguments.length?(i="function"==typeof t?t:Ci.get(t)||Pt,e):i},e.x=function(t){return arguments.length?(a=t,e):a},e.y=function(t){return arguments.length?(s=t,e):s},e.out=function(t){return arguments.length?(o=t,e):o},e};var Si=d3.map({"inside-out":function(e){var t,n,r=e.length,i=e.map(Dt),o=e.map(Lt),a=d3.range(r).sort(function(e,t){return i[e]-i[t]}),s=0,l=0,c=[],u=[];for(t=0;t<r;++t)n=a[t],s<l?(s+=o[n],c.push(n)):(l+=o[n],u.push(n));return u.reverse().concat(c)},reverse:function(e){return d3.range(e.length).reverse()},default:At}),Ci=d3.map({silhouette:function(e){var t,n,r,i=e.length,o=e[0].length,a=[],s=0,l=[];for(n=0;n<o;++n){for(t=0,r=0;t<i;t++)r+=e[t][n][1];r>s&&(s=r),a.push(r)}for(n=0;n<o;++n)l[n]=(s-a[n])/2;return l},wiggle:function(e){var t,n,r,i,o,a,s,l,c,u=e.length,h=e[0],f=h.length,d=[];for(d[0]=l=c=0,n=1;n<f;++n){for(t=0,i=0;t<u;++t)i+=e[t][n][1];for(t=0,o=0,s=h[n][0]-h[n-1][0];t<u;++t){for(r=0,a=(e[t][n][1]-e[t][n-1][1])/(2*s);r<t;++r)a+=(e[r][n][1]-e[r][n-1][1])/s;o+=a*e[t][n][1]}d[n]=l-=i?o/i*s:0,l<c&&(c=l)}for(n=0;n<f;++n)d[n]-=c;return d},expand:function(e){var t,n,r,i=e.length,o=e[0].length,a=1/i,s=[];for(n=0;n<o;++n){for(t=0,r=0;t<i;t++)r+=e[t][n][1];if(r)for(t=0;t<i;t++)e[t][n][1]/=r;else for(t=0;t<i;t++)e[t][n][1]=a}for(n=0;n<o;++n)s[n]=0;return s},zero:Pt});d3.layout.histogram=function(){function e(e,o){for(var a,s,l=[],c=e.map(n,this),u=r.call(this,c,o),h=i.call(this,u,c,o),o=-1,f=c.length,d=h.length-1,p=t?1:1/f;++o<d;)a=l[o]=[],a.dx=h[o+1]-(a.x=h[o]),a.y=0;if(d>0)for(o=-1;++o<f;)(s=c[o])>=u[0]&&s<=u[1]&&(a=l[d3.bisect(h,s,1,d)-1],a.y+=p,a.push(e[o]));return l}var t=!0,n=Number,r=Ut,i=kt;return e.value=function(t){return arguments.length?(n=t,e):n},e.range=function(t){return arguments.length?(r=a(t),e):r},e.bins=function(t){return arguments.length?(i="number"==typeof t?function(e){return Ft(e,t)}:a(t),e):i},e.frequency=function(n){return arguments.length?(t=!!n,e):t},e},d3.layout.hierarchy=function(){function e(t,a,s){var l=i.call(n,t,a),c=Ai?t:{data:t};if(c.depth=a,s.push(c),l&&(u=l.length)){for(var u,h,f=-1,d=c.children=[],p=0,m=a+1;++f<u;)h=e(l[f],m,s),h.parent=c,d.push(h),p+=h.value;r&&d.sort(r),o&&(c.value=p)}else o&&(c.value=+o.call(n,t,a)||0);return c}function t(e,r){var i=e.children,a=0;if(i&&(s=i.length))for(var s,l=-1,c=r+1;++l<s;)a+=t(i[l],c);else o&&(a=+o.call(n,Ai?e:e.data,r)||0);return o&&(e.value=a),a}function n(t){var n=[];return e(t,0,n),n}var r=It,i=Vt,o=zt;return n.sort=function(e){return arguments.length?(r=e,n):r},n.children=function(e){return arguments.length?(i=e,n):i},n.value=function(e){return arguments.length?(o=e,n):o},n.revalue=function(e){return t(e,0),e},n};var Ai=!1;d3.layout.pack=function(){function e(e,r){var i=t.call(this,e,r),o=i[0];o.x=0,o.y=0,$t(o);var a=n[0],s=n[1];return Qt(o,a/2,s/2,1/Math.max(2*o.r/a,2*o.r/s)),i}var t=d3.layout.hierarchy().sort(Wt),n=[1,1];return e.size=function(t){return arguments.length?(n=t,e):n},Bt(e,t)},d3.layout.cluster=function(){function e(e,i){var o,a=t.call(this,e,i),s=a[0],l=0;hn(s,function(e){var t=e.children;t&&t.length?(e.x=en(t),e.y=Jt(t)):(e.x=o?l+=n(e,o):0,e.y=0,o=e)});var c=tn(s),u=nn(s),h=c.x-n(c,u)/2,f=u.x+n(u,c)/2;return hn(s,function(e){e.x=(e.x-h)/(f-h)*r[0],e.y=(1-(s.y?e.y/s.y:1))*r[1]}),a}var t=d3.layout.hierarchy().sort(null).value(null),n=rn,r=[1,1];return e.separation=function(t){return arguments.length?(n=t,e):n},e.size=function(t){return arguments.length?(r=t,e):r},Bt(e,t)},d3.layout.tree=function(){function e(e,i){function o(e,t){var r=e.children,i=e._tree;if(r&&(a=r.length)){for(var a,l,c,u=r[0],h=u,f=-1;++f<a;)c=r[f],o(c,l),h=s(c,l,h),l=c;fn(e);var d=.5*(u._tree.prelim+c._tree.prelim);t?(i.prelim=t._tree.prelim+n(e,t),i.mod=i.prelim-d):i.prelim=d}else t&&(i.prelim=t._tree.prelim+n(e,t))}function a(e,t){e.x=e._tree.prelim+t;var n=e.children;if(n&&(r=n.length)){var r,i=-1;for(t+=e._tree.mod;++i<r;)a(n[i],t)}}function s(e,t,r){if(t){for(var i,o=e,a=e,s=t,l=e.parent.children[0],c=o._tree.mod,u=a._tree.mod,h=s._tree.mod,f=l._tree.mod;s=an(s),o=on(o),s&&o;)l=on(l),a=an(a),a._tree.ancestor=e,i=s._tree.prelim+h-o._tree.prelim-c+n(s,o),i>0&&(dn(pn(s,e,r),e,i),c+=i,u+=i),h+=s._tree.mod,c+=o._tree.mod,f+=l._tree.mod,u+=a._tree.mod;s&&!an(a)&&(a._tree.thread=s,a._tree.mod+=h-u),o&&!on(l)&&(l._tree.thread=o,l._tree.mod+=c-f,r=e)}return r}var l=t.call(this,e,i),c=l[0];hn(c,function(e,t){e._tree={ancestor:e,prelim:0,mod:0,change:0,shift:0,number:t?t._tree.number+1:0}}),o(c),a(c,-c._tree.prelim);var u=sn(c,cn),h=sn(c,ln),f=sn(c,un),d=u.x-n(u,h)/2,p=h.x+n(h,u)/2,m=f.depth||1;return hn(c,function(e){e.x=(e.x-d)/(p-d)*r[0],e.y=e.depth/m*r[1],delete e._tree}),l}var t=d3.layout.hierarchy().sort(null).value(null),n=rn,r=[1,1];return e.separation=function(t){return arguments.length?(n=t,e):n},e.size=function(t){return arguments.length?(r=t,e):r},Bt(e,t)},d3.layout.treemap=function(){function e(e,t){for(var n,r,i=-1,o=e.length;++i<o;)r=(n=e[i]).value*(t<0?0:t),n.area=isNaN(r)||r<=0?0:r}function t(n){var o=n.children;if(o&&o.length){var a,s,l,c=h(n),u=[],f=o.slice(),d=1/0,p=Math.min(c.dx,c.dy);for(e(f,c.dx*c.dy/n.value),u.area=0;(l=f.length)>0;)u.push(a=f[l-1]),u.area+=a.area,(s=r(u,p))<=d?(f.pop(),d=s):(u.area-=u.pop().area,i(u,p,c,!1),p=Math.min(c.dx,c.dy),u.length=u.area=0,d=1/0);u.length&&(i(u,p,c,!0),u.length=u.area=0),o.forEach(t)}}function n(t){var r=t.children;if(r&&r.length){var o,a=h(t),s=r.slice(),l=[];for(e(s,a.dx*a.dy/t.value),l.area=0;o=s.pop();)l.push(o),l.area+=o.area,null!=o.z&&(i(l,o.z?a.dx:a.dy,a,!s.length),l.length=l.area=0);r.forEach(n)}}function r(e,t){for(var n,r=e.area,i=0,o=1/0,a=-1,s=e.length;++a<s;)(n=e[a].area)&&(n<o&&(o=n),n>i&&(i=n));return r*=r,t*=t,r?Math.max(t*i*d/r,r/(t*o*d)):1/0}function i(e,t,n,r){var i,o=-1,a=e.length,s=n.x,c=n.y,u=t?l(e.area/t):0;if(t==n.dx){for((r||u>n.dy)&&(u=n.dy);++o<a;)i=e[o],i.x=s,i.y=c,i.dy=u,s+=i.dx=Math.min(n.x+n.dx-s,u?l(i.area/u):0);i.z=!0,i.dx+=n.x+n.dx-s,n.y+=u,n.dy-=u}else{for((r||u>n.dx)&&(u=n.dx);++o<a;)i=e[o],i.x=s,i.y=c,i.dx=u,c+=i.dy=Math.min(n.y+n.dy-c,u?l(i.area/u):0);i.z=!1,i.dy+=n.y+n.dy-c,n.x+=u,n.dx-=u}}function o(r){var i=a||s(r),o=i[0];return o.x=0,o.y=0,o.dx=c[0],o.dy=c[1],a&&s.revalue(o),e([o],o.dx*o.dy/o.value),(a?n:t)(o),f&&(a=i),i}var a,s=d3.layout.hierarchy(),l=Math.round,c=[1,1],u=null,h=mn,f=!1,d=.5*(1+Math.sqrt(5));return o.size=function(e){return arguments.length?(c=e,o):c},o.padding=function(e){function t(t){var n=e.call(o,t,t.depth);return null==n?mn(t):vn(t,"number"==typeof n?[n,n,n,n]:n)}function n(t){return vn(t,e)}if(!arguments.length)return u;var r;return h=null==(u=e)?mn:"function"==(r=typeof e)?t:"number"===r?(e=[e,e,e,e],n):n,o},o.round=function(e){return arguments.length?(l=e?Math.round:Number,o):l!=Number},o.sticky=function(e){return arguments.length?(f=e,a=null,o):f},o.ratio=function(e){return arguments.length?(d=e,o):d},Bt(o,s)},d3.csv=function(e,t){d3.text(e,"text/csv",function(e){t(e&&d3.csv.parse(e))})},d3.csv.parse=function(e){var t;return d3.csv.parseRows(e,function(e,n){if(n){for(var r={},i=-1,o=t.length;++i<o;)r[t[i]]=e[i];return r}return t=e,null})},d3.csv.parseRows=function(e,t){function n(){if(l.lastIndex>=e.length)return a;if(i)return i=!1,o;var t=l.lastIndex;if(34===e.charCodeAt(t)){for(var n=t;n++<e.length;)if(34===e.charCodeAt(n)){if(34!==e.charCodeAt(n+1))break;n++}l.lastIndex=n+2;var r=e.charCodeAt(n+1);return 13===r?(i=!0,10===e.charCodeAt(n+2)&&l.lastIndex++):10===r&&(i=!0),e.substring(t+1,n).replace(/""/g,'"')}var s=l.exec(e);return s?(i=44!==s[0].charCodeAt(0),e.substring(t,s.index)):(l.lastIndex=e.length,e.substring(t))}var r,i,o={},a={},s=[],l=/\r\n|[,\r\n]/g,c=0;for(l.lastIndex=0;(r=n())!==a;){for(var u=[];r!==o&&r!==a;)u.push(r),r=n();t&&!(u=t(u,c++))||s.push(u)}return s},d3.csv.format=function(e){return e.map(gn).join("\n")},d3.geo={};var Pi=Math.PI/180;d3.geo.azimuthal=function(){function e(e){var t,r=e[0]*Pi-n,c=e[1]*Pi,u=Math.cos(r),h=Math.sin(r),f=Math.cos(c),d=Math.sin(c),p="orthographic"!==a?o*d+i*f*u:null,m="stereographic"===a?1/(1+p):"gnomonic"===a?1/p:"equidistant"===a?(t=Math.acos(p),t?t/Math.sin(t):0):"equalarea"===a?Math.sqrt(2/(1+p)):1,v=m*f*h,g=m*(o*f*u-i*d);return[s*v+l[0],s*g+l[1]]}var t,n,r,i,o,a="orthographic",s=200,l=[480,250];return e.invert=function(e){var t=(e[0]-l[0])/s,r=(e[1]-l[1])/s,c=Math.sqrt(t*t+r*r),u="stereographic"===a?2*Math.atan(c):"gnomonic"===a?Math.atan(c):"equidistant"===a?c:"equalarea"===a?2*Math.asin(.5*c):Math.asin(c),h=Math.sin(u),f=Math.cos(u);return[(n+Math.atan2(t*h,c*i*f+r*o*h))/Pi,Math.asin(f*o-(c?r*h*i/c:0))/Pi]},e.mode=function(t){return arguments.length?(a=t+"",e):a},e.origin=function(a){return arguments.length?(t=a,n=t[0]*Pi,r=t[1]*Pi,i=Math.cos(r),o=Math.sin(r),e):t},e.scale=function(t){return arguments.length?(s=+t,e):s},e.translate=function(t){return arguments.length?(l=[+t[0],+t[1]],e):l},e.origin([0,0])},d3.geo.albers=function(){function e(e){var t=r*(Pi*e[0]-n),a=Math.sqrt(i-2*r*Math.sin(Pi*e[1]))/r;return[l*a*Math.sin(t)+c[0],l*(a*Math.cos(t)-o)+c[1]]}function t(){var t=Pi*s[0],l=Pi*s[1],c=Pi*a[1],u=Math.sin(t),h=Math.cos(t);return n=Pi*a[0],r=.5*(u+Math.sin(l)),i=h*h+2*r*u,o=Math.sqrt(i-2*r*Math.sin(c))/r,e}var n,r,i,o,a=[-98,38],s=[29.5,45.5],l=1e3,c=[480,250];return e.invert=function(e){var t=(e[0]-c[0])/l,a=(e[1]-c[1])/l,s=o+a,u=Math.atan2(t,s),h=Math.sqrt(t*t+s*s);return[(n+u/r)/Pi,Math.asin((i-h*h*r*r)/(2*r))/Pi]},e.origin=function(e){return arguments.length?(a=[+e[0],+e[1]],t()):a},e.parallels=function(e){return arguments.length?(s=[+e[0],+e[1]],t()):s},e.scale=function(t){return arguments.length?(l=+t,e):l},e.translate=function(t){return arguments.length?(c=[+t[0],+t[1]],e):c},t()},d3.geo.albersUsa=function(){function e(e){var o=e[0],a=e[1];return(a>50?n:o<-140?r:a<21?i:t)(e)}var t=d3.geo.albers(),n=d3.geo.albers().origin([-160,60]).parallels([55,65]),r=d3.geo.albers().origin([-160,20]).parallels([8,18]),i=d3.geo.albers().origin([-60,10]).parallels([8,18]);return e.scale=function(o){return arguments.length?(t.scale(o),n.scale(.6*o),r.scale(o),i.scale(1.5*o),e.translate(t.translate())):t.scale()},e.translate=function(o){if(!arguments.length)return t.translate();var a=t.scale()/1e3,s=o[0],l=o[1];return t.translate(o),n.translate([s-400*a,l+170*a]),r.translate([s-190*a,l+200*a]),i.translate([s+580*a,l+430*a]),e},e.scale(t.scale())},d3.geo.bonne=function(){function e(e){var s=e[0]*Pi-t,l=e[1]*Pi-n;if(r){var c=i+r-l,u=s*Math.cos(l)/c;s=c*Math.sin(u),l=c*Math.cos(u)-i}else s*=Math.cos(l),l*=-1;return[o*s+a[0],o*l+a[1]]}var t,n,r,i,o=200,a=[480,250];return e.invert=function(e){var n=(e[0]-a[0])/o,s=(e[1]-a[1])/o;if(r){var l=i+s,c=Math.sqrt(n*n+l*l);s=i+r-c,n=t+c*Math.atan2(n,l)/Math.cos(s)}else s*=-1,n/=Math.cos(s);return[n/Pi,s/Pi]},e.parallel=function(t){return arguments.length?(i=1/Math.tan(r=t*Pi),e):r/Pi},e.origin=function(r){return arguments.length?(t=r[0]*Pi,n=r[1]*Pi,e):[t/Pi,n/Pi]},e.scale=function(t){return arguments.length?(o=+t,e):o},e.translate=function(t){return arguments.length?(a=[+t[0],+t[1]],e):a},e.origin([0,0]).parallel(45)},d3.geo.equirectangular=function(){function e(e){var r=e[0]/360,i=-e[1]/360;return[t*r+n[0],t*i+n[1]]}var t=500,n=[480,250];return e.invert=function(e){return[(e[0]-n[0])/t*360,(e[1]-n[1])/t*-360]},e.scale=function(n){return arguments.length?(t=+n,e):t},e.translate=function(t){return arguments.length?(n=[+t[0],+t[1]],e):n},e},d3.geo.mercator=function(){function e(e){var r=e[0]/360,i=-Math.log(Math.tan(Math.PI/4+e[1]*Pi/2))/Pi/360;return[t*r+n[0],t*Math.max(-.5,Math.min(.5,i))+n[1]]}var t=500,n=[480,250];return e.invert=function(e){var r=(e[0]-n[0])/t,i=(e[1]-n[1])/t;return[360*r,2*Math.atan(Math.exp(-360*i*Pi))/Pi-90]},e.scale=function(n){return arguments.length?(t=+n,e):t},e.translate=function(t){return arguments.length?(n=[+t[0],+t[1]],e):n},e},d3.geo.path=function(){function e(e,t){"function"==typeof o&&(a=xn(o.apply(this,arguments))),c(e);var n=l.length?l.join(""):null;return l=[],n}function t(e){return s(e).join(",")}function n(e){for(var t=i(e[0]),n=0,r=e.length;++n<r;)t-=i(e[n]);return t}function r(e){for(var t=d3.geom.polygon(e[0].map(s)),n=t.area(),r=t.centroid(n<0?(n*=-1,1):-1),i=r[0],o=r[1],a=n,l=0,c=e.length;++l<c;)t=d3.geom.polygon(e[l].map(s)),n=t.area(),r=t.centroid(n<0?(n*=-1,1):-1),i-=r[0],o-=r[1],a-=n;return[i,o,6*a]}function i(e){return Math.abs(d3.geom.polygon(e.map(s)).area())}var o=4.5,a=xn(o),s=d3.geo.albersUsa(),l=[],c=yn({FeatureCollection:function(e){for(var t=e.features,n=-1,r=t.length;++n<r;)l.push(c(t[n].geometry))},Feature:function(e){c(e.geometry)},Point:function(e){l.push("M",t(e.coordinates),a)},MultiPoint:function(e){for(var n=e.coordinates,r=-1,i=n.length;++r<i;)l.push("M",t(n[r]),a)},LineString:function(e){var n=e.coordinates,r=-1,i=n.length;for(l.push("M");++r<i;)l.push(t(n[r]),"L");l.pop()},MultiLineString:function(e){for(var n,r,i,o=e.coordinates,a=-1,s=o.length;++a<s;){for(n=o[a],r=-1,i=n.length,l.push("M");++r<i;)l.push(t(n[r]),"L");l.pop()}},Polygon:function(e){for(var n,r,i,o=e.coordinates,a=-1,s=o.length;++a<s;)if(n=o[a],r=-1,(i=n.length-1)>0){for(l.push("M");++r<i;)l.push(t(n[r]),"L");l[l.length-1]="Z"}},MultiPolygon:function(e){for(var n,r,i,o,a,s,c=e.coordinates,u=-1,h=c.length;++u<h;)for(n=c[u],r=-1,i=n.length;++r<i;)if(o=n[r],a=-1,(s=o.length-1)>0){for(l.push("M");++a<s;)l.push(t(o[a]),"L");l[l.length-1]="Z"}},GeometryCollection:function(e){for(var t=e.geometries,n=-1,r=t.length;++n<r;)l.push(c(t[n]))}}),u=e.area=yn({FeatureCollection:function(e){for(var t=0,n=e.features,r=-1,i=n.length;++r<i;)t+=u(n[r]);return t},Feature:function(e){return u(e.geometry)},Polygon:function(e){return n(e.coordinates)},MultiPolygon:function(e){for(var t=0,r=e.coordinates,i=-1,o=r.length;++i<o;)t+=n(r[i]);return t},GeometryCollection:function(e){for(var t=0,n=e.geometries,r=-1,i=n.length;++r<i;)t+=u(n[r]);return t}},0),h=e.centroid=yn({Feature:function(e){return h(e.geometry)},Polygon:function(e){var t=r(e.coordinates);return[t[0]/t[2],t[1]/t[2]]},MultiPolygon:function(e){for(var t,n=e.coordinates,i=0,o=0,a=0,s=-1,l=n.length;++s<l;)t=r(n[s]),i+=t[0],o+=t[1],a+=t[2];return[i/a,o/a]}});return e.projection=function(t){return s=t,e},e.pointRadius=function(t){return"function"==typeof t?o=t:(o=+t,a=xn(o)),e},e},d3.geo.bounds=function(e){var t=1/0,n=1/0,r=-1/0,i=-1/0;return Tn(e,function(e,o){e<t&&(t=e),e>r&&(r=e),o<n&&(n=o),o>i&&(i=o)}),[[t,n],[r,i]]};var Di={Feature:bn,FeatureCollection:Rn,GeometryCollection:wn,LineString:_n,MultiLineString:Hn,MultiPoint:_n,MultiPolygon:Mn,Point:Sn,Polygon:Cn};d3.geo.circle=function(){function e(){}function t(e){return l.distance(e)<s}function n(e){for(var t,n,r,o,a,c=-1,u=e.length,h=[];++c<u;)a=l.distance(r=e[c]),a<s?(n&&h.push(Ln(n,r)((o-s)/(o-a))),h.push(r),t=n=null):(n=r,!t&&h.length&&(h.push(Ln(h[h.length-1],n)((s-o)/(a-o))),t=n)),o=a;return t=e[0],n=h[0],n&&r[0]===t[0]&&r[1]===t[1]&&(r[0]!==n[0]||r[1]!==n[1])&&h.push(n),i(h)}function i(e){for(var t,n,r,i=0,o=e.length,a=o?[e[0]]:e,s=l.source();++i<o;)for(r=l.source(e[i-1])(e[i]).coordinates,t=0,n=r.length;++t<n;)a.push(r[t]);return l.source(s),a}var o=[0,0],a=89.99,s=a*Pi,l=d3.geo.greatArc().source(o).target(r);e.clip=function(e){return"function"==typeof o&&l.source(o.apply(this,arguments)),c(e)||null};var c=yn({FeatureCollection:function(e){var t=e.features.map(c).filter(r);return t&&(e=Object.create(e),e.features=t,e)},Feature:function(e){var t=c(e.geometry);return t&&(e=Object.create(e),e.geometry=t,e)},Point:function(e){return t(e.coordinates)&&e},MultiPoint:function(e){var n=e.coordinates.filter(t);return n.length&&{type:e.type,coordinates:n}},LineString:function(e){var t=n(e.coordinates);return t.length&&(e=Object.create(e),e.coordinates=t,e)},MultiLineString:function(e){var t=e.coordinates.map(n).filter(function(e){return e.length});return t.length&&(e=Object.create(e),e.coordinates=t,e)},Polygon:function(e){var t=e.coordinates.map(n);return t[0].length&&(e=Object.create(e),e.coordinates=t,e)},MultiPolygon:function(e){var t=e.coordinates.map(function(e){return e.map(n)}).filter(function(e){return e[0].length});return t.length&&(e=Object.create(e),e.coordinates=t,e)},GeometryCollection:function(e){var t=e.geometries.map(c).filter(r);return t.length&&(e=Object.create(e),e.geometries=t,e)}});return e.origin=function(t){return arguments.length?(o=t,"function"!=typeof o&&l.source(o),e):o},e.angle=function(t){return arguments.length?(s=(a=+t)*Pi,e):a},d3.rebind(e,l,"precision")},d3.geo.greatArc=function(){function e(){for(var r=e.distance.apply(this,arguments),i=0,s=o/r,l=[t];(i+=s)<1;)l.push(a(i));return l.push(n),{type:"LineString",coordinates:l}}var t,n,r=An,i=Pn,o=6*Pi,a=Dn();return e.distance=function(){return"function"==typeof r&&a.source(t=r.apply(this,arguments)),"function"==typeof i&&a.target(n=i.apply(this,arguments)),a.distance()},e.source=function(n){return arguments.length?(r=n,"function"!=typeof r&&a.source(t=r),e):r},e.target=function(t){return arguments.length?(i=t,"function"!=typeof i&&a.target(n=i),e):i},e.precision=function(t){return arguments.length?(o=t*Pi,e):o/Pi},e},d3.geo.greatCircle=d3.geo.circle,d3.geom={},d3.geom.contour=function(e,t){var n=t||Nn(e),r=[],i=n[0],o=n[1],a=0,s=0,l=NaN,c=NaN,u=0;do{u=0,e(i-1,o-1)&&(u+=1),e(i,o-1)&&(u+=2),e(i-1,o)&&(u+=4),e(i,o)&&(u+=8),6===u?(a=-1===c?-1:1,s=0):9===u?(a=0,s=1===l?-1:1):(a=Li[u],s=Ni[u]),a!=l&&s!=c&&(r.push([i,o]),l=a,c=s),i+=a,o+=s}while(n[0]!=i||n[1]!=o);return r};var Li=[1,0,1,1,-1,0,-1,1,0,0,0,0,-1,0,-1,NaN],Ni=[0,-1,0,0,0,-1,0,0,1,-1,1,1,0,-1,0,NaN];d3.geom.hull=function(e){if(e.length<3)return[];var t,n,r,i,o,a,s,l,c,u,h=e.length,f=h-1,d=[],p=[],m=0;for(t=1;t<h;++t)e[t][1]<e[m][1]?m=t:e[t][1]==e[m][1]&&(m=e[t][0]<e[m][0]?t:m);for(t=0;t<h;++t)t!==m&&(i=e[t][1]-e[m][1],r=e[t][0]-e[m][0],d.push({angle:Math.atan2(i,r),index:t}));for(d.sort(function(e,t){return e.angle-t.angle}),c=d[0].angle,l=d[0].index,s=0,t=1;t<f;++t)n=d[t].index,c==d[t].angle?(r=e[l][0]-e[m][0],i=e[l][1]-e[m][1],o=e[n][0]-e[m][0],a=e[n][1]-e[m][1],r*r+i*i>=o*o+a*a?d[t].index=-1:(d[s].index=-1,c=d[t].angle,s=t,l=n)):(c=d[t].angle,s=t,l=n);for(p.push(m),t=0,n=0;t<2;++n)-1!==d[n].index&&(p.push(d[n].index),t++);for(u=p.length;n<f;++n)if(-1!==d[n].index){for(;!kn(p[u-2],p[u-1],d[n].index,e);)--u;p[u++]=d[n].index}var v=[];for(t=0;t<u;++t)v.push(e[p[t]]);return v},d3.geom.polygon=function(e){return e.area=function(){for(var t=0,n=e.length,r=e[n-1][0]*e[0][1],i=e[n-1][1]*e[0][0];++t<n;)r+=e[t-1][0]*e[t][1],i+=e[t-1][1]*e[t][0];return.5*(i-r)},e.centroid=function(t){var n,r,i=-1,o=e.length,a=0,s=0,l=e[o-1];for(arguments.length||(t=-1/(6*e.area()));++i<o;)n=l,l=e[i],r=n[0]*l[1]-l[0]*n[1],a+=(n[0]+l[0])*r,s+=(n[1]+l[1])*r;return[a*t,s*t]},e.clip=function(t){for(var n,r,i,o,a,s,l=-1,c=e.length,u=e[c-1];++l<c;){for(n=t.slice(),t.length=0,o=e[l],a=n[(i=n.length)-1],r=-1;++r<i;)s=n[r],Fn(s,u,o)?(Fn(a,u,o)||t.push(Un(a,s,u,o)),t.push(s)):Fn(a,u,o)&&t.push(Un(a,s,u,o)),a=s;u=o}return t},e},d3.geom.voronoi=function(e){var t=e.map(function(){return[]});return Bn(e,function(e){var n,r,i,o,a,s;1===e.a&&e.b>=0?(n=e.ep.r,r=e.ep.l):(n=e.ep.l,r=e.ep.r),1===e.a?(a=n?n.y:-1e6,i=e.c-e.b*a,s=r?r.y:1e6,o=e.c-e.b*s):(i=n?n.x:-1e6,a=e.c-e.a*i,o=r?r.x:1e6,s=e.c-e.a*o);var l=[i,a],c=[o,s];t[e.region.l.index].push(l,c),t[e.region.r.index].push(l,c)}),t.map(function(t,n){var r=e[n][0],i=e[n][1];return t.forEach(function(e){e.angle=Math.atan2(e[0]-r,e[1]-i)}),t.sort(function(e,t){return e.angle-t.angle}).filter(function(e,n){return!n||e.angle-t[n-1].angle>1e-10})})};var ki={l:"r",r:"l"};d3.geom.delaunay=function(e){var t=e.map(function(){return[]}),n=[];return Bn(e,function(n){t[n.region.l.index].push(e[n.region.r.index])}),t.forEach(function(t,r){var i=e[r],o=i[0],a=i[1];t.forEach(function(e){e.angle=Math.atan2(e[0]-o,e[1]-a)}),t.sort(function(e,t){return e.angle-t.angle});for(var s=0,l=t.length-1;s<l;s++)n.push([i,t[s],t[s+1]])}),n},d3.geom.quadtree=function(e,t,n,r,i){function o(e,t,n,r,i,o){if(!isNaN(t.x)&&!isNaN(t.y))if(e.leaf){var s=e.point;s?Math.abs(s.x-t.x)+Math.abs(s.y-t.y)<.01?a(e,t,n,r,i,o):(e.point=null,a(e,s,n,r,i,o),a(e,t,n,r,i,o)):e.point=t}else a(e,t,n,r,i,o)}function a(e,t,n,r,i,a){var s=.5*(n+i),l=.5*(r+a),c=t.x>=s,u=t.y>=l,h=(u<<1)+c;e.leaf=!1,e=e.nodes[h]||(e.nodes[h]=Vn()),c?n=s:i=s,u?r=l:a=l,o(e,t,n,r,i,a)}var s,l=-1,c=e.length;if(c&&isNaN(e[0].x)&&(e=e.map(In)),arguments.length<5)if(3===arguments.length)i=r=n,n=t;else{for(t=n=1/0,r=i=-1/0;++l<c;)s=e[l],s.x<t&&(t=s.x),s.y<n&&(n=s.y),s.x>r&&(r=s.x),s.y>i&&(i=s.y);var u=r-t,h=i-n;u>h?i=n+u:r=t+h}var f=Vn();return f.add=function(e){o(f,e,t,n,r,i)},f.visit=function(e){zn(e,f,t,n,r,i)},e.forEach(f.add),f},d3.time={};var Fi=Date;On.prototype={getDate:function(){return this._.getUTCDate()},getDay:function(){return this._.getUTCDay()},getFullYear:function(){return this._.getUTCFullYear()},getHours:function(){return this._.getUTCHours()},getMilliseconds:function(){return this._.getUTCMilliseconds()},getMinutes:function(){return this._.getUTCMinutes()},getMonth:function(){return this._.getUTCMonth()},getSeconds:function(){return this._.getUTCSeconds()},getTime:function(){return this._.getTime()},getTimezoneOffset:function(){return 0},valueOf:function(){return this._.valueOf()},setDate:function(){Ui.setUTCDate.apply(this._,arguments)},setDay:function(){Ui.setUTCDay.apply(this._,arguments)},setFullYear:function(){Ui.setUTCFullYear.apply(this._,arguments)},setHours:function(){Ui.setUTCHours.apply(this._,arguments)},setMilliseconds:function(){Ui.setUTCMilliseconds.apply(this._,arguments)},setMinutes:function(){Ui.setUTCMinutes.apply(this._,arguments)},setMonth:function(){Ui.setUTCMonth.apply(this._,arguments)},setSeconds:function(){Ui.setUTCSeconds.apply(this._,arguments)},setTime:function(){Ui.setTime.apply(this._,arguments)}};var Ui=Date.prototype;d3.time.format=function(e){function t(t){for(var r,i,o=[],a=-1,s=0;++a<n;)37==e.charCodeAt(a)&&(o.push(e.substring(s,a),(i=Oi[r=e.charAt(++a)])?i(t):r),s=a+1);return o.push(e.substring(s,a)),o.join("")}var n=e.length;return t.parse=function(t){var n={y:1900,m:0,d:1,H:0,M:0,S:0,L:0};if(Wn(n,e,t,0)!=t.length)return null;"p"in n&&(n.H=n.H%12+12*n.p);var r=new Fi;return r.setFullYear(n.y,n.m,n.d),r.setHours(n.H,n.M,n.S,n.L),r},t.toString=function(){return e},t};var Bi=d3.format("02d"),Vi=d3.format("03d"),zi=d3.format("04d"),Ii=d3.format("2d"),Oi={a:function(e){return Xi[e.getDay()].substring(0,3)},A:function(e){return Xi[e.getDay()]},b:function(e){return $i[e.getMonth()].substring(0,3)},B:function(e){return $i[e.getMonth()]},c:d3.time.format("%a %b %e %H:%M:%S %Y"),d:function(e){return Bi(e.getDate())},e:function(e){return Ii(e.getDate())},H:function(e){return Bi(e.getHours())},I:function(e){return Bi(e.getHours()%12||12)},j:function(e){return Vi(1+d3.time.dayOfYear(e))},L:function(e){return Vi(e.getMilliseconds())},m:function(e){return Bi(e.getMonth()+1)},M:function(e){return Bi(e.getMinutes())},p:function(e){return e.getHours()>=12?"PM":"AM"},S:function(e){return Bi(e.getSeconds())},U:function(e){return Bi(d3.time.sundayOfYear(e))},w:function(e){return e.getDay()},W:function(e){return Bi(d3.time.mondayOfYear(e))},x:d3.time.format("%m/%d/%y"),X:d3.time.format("%H:%M:%S"),y:function(e){return Bi(e.getFullYear()%100)},Y:function(e){return zi(e.getFullYear()%1e4)},Z:sr,"%":function(e){return"%"}},Wi={a:jn,A:Gn,b:Xn,B:Yn,c:qn,d:tr,e:tr,H:nr,I:nr,L:or,m:er,M:rr,p:ar,S:ir,x:Kn,X:$n,y:Zn,Y:Qn},ji=/^(?:sun|mon|tue|wed|thu|fri|sat)/i,Gi=/^(?:Sunday|Monday|Tuesday|Wednesday|Thursday|Friday|Saturday)/i,Xi=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],Yi=d3.map({jan:0,feb:1,mar:2,apr:3,may:4,jun:5,jul:6,aug:7,sep:8,oct:9,nov:10,dec:11}),qi=/^(?:January|February|March|April|May|June|July|August|September|October|November|December)/gi,Ki=d3.map({january:0,february:1,march:2,april:3,may:4,june:5,july:6,august:7,september:8,october:9,november:10,december:11}),$i=["January","February","March","April","May","June","July","August","September","October","November","December"],Qi=/\s*\d+/,Zi=d3.map({am:0,pm:1});d3.time.format.utc=function(e){function t(e){try{Fi=On;var t=new Fi;return t._=e,n(t)}finally{Fi=Date}}var n=d3.time.format(e);return t.parse=function(e){try{Fi=On;var t=n.parse(e);return t&&t._}finally{Fi=Date}},t.toString=n.toString,t};var Ji=d3.time.format.utc("%Y-%m-%dT%H:%M:%S.%LZ");d3.time.format.iso=Date.prototype.toISOString?lr:Ji,lr.parse=function(e){var t=new Date(e);return isNaN(t)?null:t},lr.toString=Ji.toString,d3.time.second=cr(function(e){return new Fi(1e3*Math.floor(e/1e3))},function(e,t){e.setTime(e.getTime()+1e3*Math.floor(t))},function(e){return e.getSeconds()}),d3.time.seconds=d3.time.second.range,d3.time.seconds.utc=d3.time.second.utc.range,d3.time.minute=cr(function(e){return new Fi(6e4*Math.floor(e/6e4))},function(e,t){e.setTime(e.getTime()+6e4*Math.floor(t))},function(e){return e.getMinutes()}),d3.time.minutes=d3.time.minute.range,d3.time.minutes.utc=d3.time.minute.utc.range,d3.time.hour=cr(function(e){var t=e.getTimezoneOffset()/60;return new Fi(36e5*(Math.floor(e/36e5-t)+t))},function(e,t){e.setTime(e.getTime()+36e5*Math.floor(t))},function(e){return e.getHours()}),d3.time.hours=d3.time.hour.range,d3.time.hours.utc=d3.time.hour.utc.range,d3.time.day=cr(function(e){return new Fi(e.getFullYear(),e.getMonth(),e.getDate())},function(e,t){e.setDate(e.getDate()+t)},function(e){return e.getDate()-1}),d3.time.days=d3.time.day.range,d3.time.days.utc=d3.time.day.utc.range,d3.time.dayOfYear=function(e){var t=d3.time.year(e);return Math.floor((e-t)/864e5-(e.getTimezoneOffset()-t.getTimezoneOffset())/1440)},Xi.forEach(function(e,t){e=e.toLowerCase(),t=7-t;var n=d3.time[e]=cr(function(e){return(e=d3.time.day(e)).setDate(e.getDate()-(e.getDay()+t)%7),e},function(e,t){e.setDate(e.getDate()+7*Math.floor(t))},function(e){var n=d3.time.year(e).getDay();return Math.floor((d3.time.dayOfYear(e)+(n+t)%7)/7)-(n!==t)});d3.time[e+"s"]=n.range,d3.time[e+"s"].utc=n.utc.range,d3.time[e+"OfYear"]=function(e){var n=d3.time.year(e).getDay();return Math.floor((d3.time.dayOfYear(e)+(n+t)%7)/7)}}),d3.time.week=d3.time.sunday,d3.time.weeks=d3.time.sunday.range,d3.time.weeks.utc=d3.time.sunday.utc.range,d3.time.weekOfYear=d3.time.sundayOfYear,d3.time.month=cr(function(e){return new Fi(e.getFullYear(),e.getMonth(),1)},function(e,t){e.setMonth(e.getMonth()+t)},function(e){return e.getMonth()}),d3.time.months=d3.time.month.range,d3.time.months.utc=d3.time.month.utc.range,d3.time.year=cr(function(e){return new Fi(e.getFullYear(),0,1)},function(e,t){e.setFullYear(e.getFullYear()+t)},function(e){return e.getFullYear()}),d3.time.years=d3.time.year.range,d3.time.years.utc=d3.time.year.utc.range;var eo=[1e3,5e3,15e3,3e4,6e4,3e5,9e5,18e5,36e5,108e5,216e5,432e5,864e5,1728e5,6048e5,2592e6,7776e6,31536e6],to=[[d3.time.second,1],[d3.time.second,5],[d3.time.second,15],[d3.time.second,30],[d3.time.minute,1],[d3.time.minute,5],[d3.time.minute,15],[d3.time.minute,30],[d3.time.hour,1],[d3.time.hour,3],[d3.time.hour,6],[d3.time.hour,12],[d3.time.day,1],[d3.time.day,2],[d3.time.week,1],[d3.time.month,1],[d3.time.month,3],[d3.time.year,1]],no=[[d3.time.format("%Y"),function(e){return!0}],[d3.time.format("%B"),function(e){return e.getMonth()}],[d3.time.format("%b %d"),function(e){return 1!=e.getDate()}],[d3.time.format("%a %d"),function(e){return e.getDay()&&1!=e.getDate()}],[d3.time.format("%I %p"),function(e){return e.getHours()}],[d3.time.format("%I:%M"),function(e){return e.getMinutes()}],[d3.time.format(":%S"),function(e){return e.getSeconds()}],[d3.time.format(".%L"),function(e){return e.getMilliseconds()}]],ro=d3.scale.linear(),io=pr(no);to.year=function(e,t){return ro.domain(e.map(vr)).ticks(t).map(mr)},d3.time.scale=function(){return hr(d3.scale.linear(),to,io)};var oo=to.map(function(e){return[e[0].utc,e[1]]}),ao=[[d3.time.format.utc("%Y"),function(e){return!0}],[d3.time.format.utc("%B"),function(e){return e.getUTCMonth()}],[d3.time.format.utc("%b %d"),function(e){return 1!=e.getUTCDate()}],[d3.time.format.utc("%a %d"),function(e){return e.getUTCDay()&&1!=e.getUTCDate()}],[d3.time.format.utc("%I %p"),function(e){return e.getUTCHours()}],[d3.time.format.utc("%I:%M"),function(e){return e.getUTCMinutes()}],[d3.time.format.utc(":%S"),function(e){return e.getUTCSeconds()}],[d3.time.format.utc(".%L"),function(e){return e.getUTCMilliseconds()}]],so=pr(ao);oo.year=function(e,t){return ro.domain(e.map(Er)).ticks(t).map(gr)},d3.time.scale.utc=function(){return hr(d3.scale.linear(),oo,so)}}();var monthNames=new Array(12);monthNames[0]="January",monthNames[1]="February",monthNames[2]="March",monthNames[3]="April",monthNames[4]="May",monthNames[5]="June",monthNames[6]="July",monthNames[7]="August",monthNames[8]="September",monthNames[9]="October",monthNames[10]="November",monthNames[11]="December",THREE.Curve.Utils.createLineGeometry=function(e){for(var t=new THREE.Geometry,n=0;n<e.length;n++)t.vertices.push(e[n]);return t};var mouseX=0,mouseY=0,pmouseX=0,pmouseY=0,pressX=0,pressY=0,dragging=!1,rotateX=0,rotateY=0,rotateVX=0,rotateVY=0,rotateXMax=90*Math.PI/180,rotateTargetX=void 0,rotateTargetY=void 0,keyboard=new THREEx.KeyboardState,cameraStates=new Object,currentCameraState=null,targetCameraState=null,defaultCameraState,controllers={speed:3,multiplier:.5,backgroundColor:"#000000",zoom:1,spin:0,transitionTime:2e3},globeRadius=1e3,vec3_origin=new THREE.Vector3(0,0,0),markers=[],assets={};SVGToy.prototype.getOriginFromFile=function(){if(void 0===this.svg)return{x:0,y:0};var e=this.svg.getElementById("Origin"),t={x:0,y:0};return void 0===e||null===e?{x:0,y:0}:(t.x=parseFloat(e.getAttribute("cx")),t.y=parseFloat(e.getAttribute("cy")),t)},SVGToy.prototype.setOrigin=function(e,t){this.svg.style.marginLeft=-e+"px",this.svg.style.marginTop=-t+"px",this.origin.x=e,this.origin.y=t},SVGToy.prototype.setPosition=function(e,t,n){this.container.style.left=e+"px",this.container.style.top=t+"px"},SVGToy.prototype.setAlpha=function(e){this.container.style.opacity=e},SVGToy.prototype.setZIndex=function(e){this.container.style["z-index"]=e+""},SVGToy.prototype.setScale=function(e){this.svg.style.width=100*e+"%",this.svg.style.height=100*e+"%";var t=this.beginTransform().scaleOrigin(e).endTransform();this.setProperty("transform",t)},SVGToy.prototype.setProperty=function(e,t,n){var r=this.svg.getElementById(e);void 0!==r&&null!==r&&r.setAttribute(t,n)},SVGToy.prototype.getProperty=function(e,t){var n=this.svg.getElementById(e);if(void 0!==n&&null!==n)return n.getAttribute(t)},SVGToy.prototype.hide=function(){"visibile"!==this.container.style.visibility&&void 0!==this.container.style.visibility||void 0!==this.hideEvent&&this.hideEvent(),this.container.style.visibility="hidden",this.svg.style.visibility="hidden"},
SVGToy.prototype.show=function(){"hidden"!==this.container.style.visibility&&void 0!==this.container.style.visibility||void 0!==this.showEvent&&this.showEvent(),this.container.style.visibility="visible",this.svg.style.visibility="visible"},SVGToy.prototype.visibile=function(){return"visible"==this.container.style.visibility},SVGToy.prototype.setText=function(e,t){if(void 0!==this.svg){var n=this.svg.getElementById(e);void 0!==n&&null!==n&&(n.textContent=t)}},SVGToy.prototype.beginTransform=function(){return new this.TransformHelper},SVGToy.prototype.removeFromDom=function(){this.parentContainer.removeChild(this.container)};var masterContainer=document.getElementById("visualization"),overlay=document.getElementById("visualization"),mapIndexedImage,mapOutlineImage,glContainer=document.getElementById("glContainer"),isoFile="src/country_iso3166.json",latlonFile="src/country_lat_lon.json",camera,scene,renderer,controls,pinsBase,pinsBaseMat,lookupCanvas,lookupTexture,backTexture,worldCanvas,sphere,rotating,visualizationMesh,mapUniforms,timeBins,latlonData,countryData=new Object,countryLookup,selectableYears=[],selectableCountries=[],weaponLookup={"Military Weapons":"mil","Civilian Weapons":"civ",Ammunition:"ammo"},reverseWeaponLookup=new Object;for(var i in weaponLookup){var name=i,code=weaponLookup[i];reverseWeaponLookup[code]=name}var categoryColors={mil:14497804,civ:4045312,ammo:1393810},exportColor=14497804,importColor=1393810,selectedCountry=null,previouslySelectedCountry=null,selectionData,idle=!1,assetList=[];window.onload=function(){Detector.webgl?(mapIndexedImage=new Image,mapIndexedImage.src="../assets/img/map_indexed.png",mapIndexedImage.onload=function(){mapOutlineImage=new Image,mapOutlineImage.src="../assets/img/map_outline.png",mapOutlineImage.onload=function(){loadCountryCodes(function(){loadWorldPins(function(){loadContentData(function(){initScene(),animate()})})})}}):Detector.addGetWebGLMessage()};var Selection=function(){this.selectedYear="2010",this.selectedCountry="UNITED STATES",this.exportCategories=new Object,this.importCategories=new Object;for(var e in weaponLookup)this.exportCategories[e]=!0,this.importCategories[e]=!0;this.getExportCategories=function(){var e=[];for(var t in this.exportCategories)this.exportCategories[t]&&e.push(t);return e},this.getImportCategories=function(){var e=[];for(var t in this.importCategories)this.importCategories[t]&&e.push(t);return e}},countryColorMap={PE:1,BF:2,FR:3,LY:4,BY:5,PK:6,ID:7,YE:8,MG:9,BO:10,CI:11,DZ:12,CH:13,CM:14,MK:15,BW:16,UA:17,KE:18,TW:19,JO:20,MX:21,AE:22,BZ:23,BR:24,SL:25,ML:26,CD:27,IT:28,SO:29,AF:30,BD:31,DO:32,GW:33,GH:34,AT:35,SE:36,TR:37,UG:38,MZ:39,JP:40,NZ:41,CU:42,VE:43,PT:44,CO:45,MR:46,AO:47,DE:48,SD:49,TH:50,AU:51,PG:52,IQ:53,HR:54,GL:55,NE:56,DK:57,LV:58,RO:59,ZM:60,IR:61,MM:62,ET:63,GT:64,SR:65,EH:66,CZ:67,TD:68,AL:69,FI:70,SY:71,KG:72,SB:73,OM:74,PA:75,AR:76,GB:77,CR:78,PY:79,GN:80,IE:81,NG:82,TN:83,PL:84,NA:85,ZA:86,EG:87,TZ:88,GE:89,SA:90,VN:91,RU:92,HT:93,BA:94,IN:95,CN:96,CA:97,SV:98,GY:99,BE:100,GQ:101,LS:102,BG:103,BI:104,DJ:105,AZ:106,MY:107,PH:108,UY:109,CG:110,RS:111,ME:112,EE:113,RW:114,AM:115,SN:116,TG:117,ES:118,GA:119,HU:120,MW:121,TJ:122,KH:123,KR:124,HN:125,IS:126,NI:127,CL:128,MA:129,LR:130,NL:131,CF:132,SK:133,LT:134,ZW:135,LK:136,IL:137,LA:138,KP:139,GR:140,TM:141,EC:142,BJ:143,SI:144,NO:145,MD:146,LB:147,NP:148,ER:149,US:150,KZ:151,AQ:152,SZ:153,UZ:154,MN:155,BT:156,NC:157,FJ:158,KW:159,TL:160,BS:161,VU:162,FK:163,GM:164,QA:165,JM:166,CY:167,PR:168,PS:169,BN:170,TT:171,CV:172,PF:173,WS:174,LU:175,KM:176,MU:177,FO:178,ST:179,AN:180,DM:181,TO:182,KI:183,FM:184,BH:185,AD:186,MP:187,PW:188,SC:189,AG:190,BB:191,TC:192,VC:193,LC:194,YT:195,VI:196,GD:197,MT:198,MV:199,KY:200,KN:201,MS:202,BL:203,NU:204,PM:205,CK:206,WF:207,AS:208,MH:209,AW:210,LI:211,VG:212,SH:213,JE:214,AI:215,MF_1_:216,GG:217,SM:218,BM:219,TV:220,NR:221,GI:222,PN:223,MC:224,VA:225,IM:226,GU:227,SG:228};